import{s as p,g as J,S as f,e as X,u as U,R as j,_ as w,a as Z,r as u,j as n,Q as S}from"./index-c4b9fcd5.js";import{u as ee,o as F}from"./fighters-query-31c95075.js";import{u as te}from"./index-425ac3e2.js";import{u as ae,F as se}from"./index-c7590afe.js";import{u as ne}from"./useQuery-41b050a0.js";import{s as b}from"./sleep-da79c358.js";import{u as C}from"./use-transaction-b27a37d3.js";const re=p("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{gridTemplateAreas:`
          "empty empty header"
          "main main side"
        `,"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),ie=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),le=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",overflowY:"auto",position:"relative",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@xmd":{display:"none"}}}},"@xmd":{mt:"30px"}});p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-35px",left:"0px"});p("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:first-child":{br:"8px 0px 0px 0px"},"&:last-child":{br:"0 8px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}});p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"});p("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}});const oe=p("div",{display:"none",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{display:"flex"},false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"}}),ce=p("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),ue=async()=>await J({options:{code:f.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:f.battleAle,table:"levels"}}),de=()=>ne({queryKey:[X.levelsState],queryFn:()=>pe(),staleTime:1e3*60*60,enabled:!!U.getState().user});async function pe(){try{return await ue()}catch(a){return console.log(a),null}}async function me(a,t){const{executeTransaction:r}=C(),o=xe(a,t);return!!await r(o)}function xe(a,{cost_credits:t,cost_gems:r,fighter_ids:o}){return{actions:[{account:f.battleAle,name:"levelup",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,fighter_ids:o,cost_gems:r,cost_credits:t}}]}}async function fe(a,t){const{executeTransaction:r}=C(),o=ge(a,t);return!!await r(o)}function ge(a,{fighter_id:t}){return{actions:[{account:f.battleAle,name:"payday",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,fighter_id:t}}]}}async function _e(a,t){const{executeTransaction:r}=C(),o=he(a,t);return!!await r(o)}function he(a,{fighter_ids:t}){return{actions:[{account:f.battleAle,name:"sellfighter",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,fighter_ids:t}}]}}const ve=[{label:"Level",value:"level"},{label:"Health",value:"health_max"},{label:"Damage",value:"damage_max"},{label:"Initiative",value:"initiative_max"},{label:"Attack Speed",value:"attackspeed_max"},{label:"Taunt",value:"taunt_max"},{label:"Res Fire",value:"res_fire"},{label:"Res Gem",value:"res_gem"},{label:"Res Neutral",value:"res_neutral"},{label:"Res Nature",value:"res_nature"},{label:"Res Air",value:"res_air"},{label:"Res Metal",value:"res_metal"}],T=j.lazy(()=>w(()=>import("./index-7570b4f4.js"),["assets/index-7570b4f4.js","assets/index-c4b9fcd5.js","assets/index-55fec1ff.css"])),ye=j.lazy(()=>w(()=>import("./index-3b029dee.js"),["assets/index-3b029dee.js","assets/index-c4b9fcd5.js","assets/index-55fec1ff.css","assets/index-425ac3e2.js","assets/index-c7590afe.js","assets/useQuery-41b050a0.js","assets/sleep-da79c358.js","assets/fighters-query-31c95075.js","assets/markers-21ad5773.js","assets/use-transaction-b27a37d3.js","assets/toast-options-703c7f8e.js","assets/react-icons.esm-c8abdcd6.js"])),Se=j.lazy(()=>w(()=>import("./index-b41df185.js"),["assets/index-b41df185.js","assets/index-c4b9fcd5.js","assets/index-55fec1ff.css","assets/index-7570b4f4.js","assets/elements-a94bd2b3.js","assets/markers-21ad5773.js","assets/useQuery-41b050a0.js","assets/fighters-query-31c95075.js","assets/index-425ac3e2.js","assets/index-c7590afe.js","assets/sleep-da79c358.js","assets/use-transaction-b27a37d3.js","assets/toast-options-703c7f8e.js"])),Fe=()=>{var E,I,M;const a=U(Z(e=>e.user)),{data:t}=ee(a.name),{data:r}=de(),{data:o}=ae(),{selectedFighter:d,setSelectedFighter:A,checkedFighters:L,setCheckedFighters:W}=te(),[h,g]=u.useState(!1),[k,R]=u.useState(!1),[P,be]=u.useState("inventory"),[v,O]=u.useState([]),[i,Q]=u.useState(ve[0]),[Y,q]=u.useState({label:"",value:""}),N=u.useMemo(()=>t==null?void 0:t.some(e=>e.stats.experience>=e.stats.required_experience),[t]),D=u.useMemo(()=>(t==null?void 0:t.reduce((e,s)=>{var l;const c=(l=r==null?void 0:r.find(m=>m.level===s.stats.level))==null?void 0:l.unlock_cost_gem;return c?e+=c:e},0))||0,[r,t]);async function $(){try{g(!0);const e=(t==null?void 0:t.filter(l=>l.stats.experience>=l.stats.required_experience).map(l=>l.fighter_id))||[],s=(t==null?void 0:t.reduce((l,m)=>{var x;const _=(x=r==null?void 0:r.find(y=>y.level===m.stats.level))==null?void 0:x.unlock_cost_credits;return _?l+=_:l},0))||0;if(!await me(a,{cost_credits:s,cost_gems:D,fighter_ids:e}))return;await b(2e3),F(a.name),S.success("Fighter leveled up!")}catch(e){console.error(e)}finally{g(!1)}}const z=u.useMemo(()=>(t==null?void 0:t.reduce((e,s)=>{const c=new Date(s.next_payday).getTime()/1e3,l=new Date(s.last_payday).getTime()/1e3,m=new Date().getTime()/1e3,_=(o==null?void 0:o.standard_pay_payday)||0;let x=0;c>m&&(x=c-m);const y=c-l-x,G=c-l,H=Math.floor(y/G*_+1);return H>1?e+=H:e},0))||0,[o,t]);async function B(){try{R(!0);const e=(t==null?void 0:t.map(c=>c.fighter_id))||[];if(!await fe(a,{fighter_id:e}))return;await b(2e3),F(a.name),S.success("Fighter payday!")}catch(e){console.error(e)}finally{R(!1)}}async function V(){try{g(!0);const e=L.map(c=>Number(c));if(!await _e(a,{fighter_ids:e}))return;await b(2e3)}catch(e){console.error(e)}finally{F(a.name),S.success("Fighters sold!"),g(!1),W([])}}const K=(e,s)=>i.value==="level"?s.stats.level-e.stats.level:i.value==="health_max"?s.stats.health_max-e.stats.health_max:i.value==="damage_max"?s.stats.damage_max-e.stats.damage_max:i.value==="initiative_max"?s.stats.initiative_max-e.stats.initiative_max:i.value==="attackspeed_max"?s.stats.attackspeed_max-e.stats.attackspeed_max:i.value==="taunt_max"?s.stats.taunt_max-e.stats.taunt_max:i.value==="res_fire"?s.stats.res_fire-e.stats.res_fire:i.value==="res_gem"?s.stats.res_gem-e.stats.res_gem:i.value==="res_neutral"?s.stats.res_neutral-e.stats.res_neutral:i.value==="res_nature"?s.stats.res_nature-e.stats.res_nature:i.value==="res_air"?s.stats.res_air-e.stats.res_air:i.value==="res_metal"?s.stats.res_metal-e.stats.res_metal:s.stats.level-e.stats.level;return u.useEffect(()=>()=>A(null),[]),n.jsxs(re,{isFighterSelected:!!d,children:[n.jsx(ie,{children:P==="sell"?n.jsx(n.Fragment,{children:n.jsxs(T,{isLoading:h,onClick:V,children:["Sell selected",n.jsxs("div",{children:[L.length*100,n.jsx("img",{src:"/assets/icons/dust.png",alt:"Dust"})]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs(T,{isLoading:h,disabled:h||!N,onClick:$,children:["Level All"," ",n.jsxs("div",{children:[D,n.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})," "]})]}),n.jsxs(T,{isLoading:k,disabled:k||z>((E=a.activestats)==null?void 0:E.action_points),onClick:B,children:["Payday",n.jsxs("div",{children:["-",z,n.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})]})]})]})}),n.jsxs(le,{isFighterSelected:!!d,children:[n.jsx(Se,{filterSelected:v,setFilterSelected:O,selectedSort:i,setSelectedSort:Q,selectedFighterClassname:Y,setSelectedFighterClassname:q}),t?(M=(I=t==null?void 0:t.filter(e=>v.length===0||v.some(s=>s.type==="element"&&s.value===e.element||s.type==="marker"&&s.value===e.marker)))==null?void 0:I.toSorted(K))==null?void 0:M.map(e=>n.jsx(ye,{isSelling:P==="sell",fighter:e},e.fighter_id)):n.jsx(n.Fragment,{children:n.jsx(ce,{children:"You don't have Fighters"})})]}),n.jsx(oe,{isFighterSelected:!!d,children:!!d&&n.jsx(se,{selectedFighter:d,onCloseFighterDetail:A})})]})},Re=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{fe as a,me as e,Re as i,ve as s,de as u};

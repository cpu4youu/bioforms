import{s as y,L as J,S as T,d as X,Q as P,g as R,q as $,u as D,e as L,r as S,R as A,_ as C,a as Z,b as ee,j as n,v as te}from"./index-32234248.js";import{s as ne,u as re}from"./fightersSort-2e989641.js";import{s as ie}from"./sleep-da79c358.js";import{u as se}from"./use-transaction-12e25294.js";import{u as M}from"./useQuery-91053d03.js";import{u as ae}from"./config-query-efbe5711.js";import{g as oe}from"./generateRandomWaxName-ee0d1ff2.js";import{u as le}from"./inventory-query-27ee4dd2.js";const de=y("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",overflowY:"hidden",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),ce=y("div",{gridArea:"header",d:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@lgxxx":{gridColumnStart:2,w:"100%",gridTemplateColumns:"1fr 1fr"},"@md":{gridColumnStart:1,gridTemplateColumns:"1fr 1fr"},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),ue=y("div",{position:"relative",gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}},"@md":{minH:"calc(100vh - 185px)",mt:"30px"}}),pe=y("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",br:"15px 15px 0 0",bg:"#19192D",position:"absolute",top:"-35px",left:"0"}),fe=y(J,{border:"1px solid rgba(0, 0, 0, 0.25)",padding:"10px 20px",ff:"$heading",fs:"12px",color:"#fff","&:last-child":{br:"15px 15px 0 0"}}),ge=y("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",padding:"0px 15px ",bg:"#141423",br:"15px",w:"100%",overflowY:"auto",position:"relative",">img":{position:"absolute",top:0,left:0,w:"100%",h:"100%",objectFit:"cover"},gridArea:"main",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}},"@md":{minH:"calc(100vh - 185px)"}}),me=y("div",{d:"flex",align:"center",justify:"center",w:"100%",maxW:"350px",padding:"15px 10px",zIndex:"2",boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.25)",bg:"#1D1B20",color:"#E9E9E9",ff:"$heading",fs:"14px",fw:"bold"}),xe=y("div",{d:"flex",justify:"space-between",gridTemplateColumns:"1fr 2fr",gap:"10px",mt:"48px",pb:"10px",w:"100%",zIndex:"2",">span":{ff:"$heading",fs:"20px",fw:"bold",color:"#fff"},"@lg":{direction:"column",justify:"center",">span":{my:"10px",order:"-1"}}}),he=y("div",{w:"100%",h:"100%"}),ye=y("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),_e=y("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function be(e,t,l,i,a,d,_,g,u,c,m){const{executeTransaction:x}=se(),p=we(e,t,l,i,a,d,_,g,u,c,m);return!!await x(p)}function we(e,t,l,i,a,d,_,g,u,c,m){return{actions:[{account:T.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:t,land_id:l,crew_asset_id:i,weapon_asset_id:a,fighter_ids:d,difficulty:_,use_gems:g,history_id:u,x:c,y:m}}]}}const K=X(e=>({myTeam:[null,null,null,null,null],setMyTeam:t=>e({myTeam:t}),selectedCards:[void 0,void 0],setSelectedCards:t=>e({selectedCards:t}),selectedFighterClassname:{label:"All",value:""},setSelectedFighterClassname:t=>e({selectedFighterClassname:t}),selectedSort:ne[0],setSelectedSort:t=>e({selectedSort:t}),selectedElement:[],setSelectedElement:t=>e({selectedElement:t}),selectedMarkers:[],setSelectedMarkers:t=>e({selectedMarkers:t})}));function ve({user:e,areaSelected:t,myTeam:l,selectedCards:i,selectedLevel:a}){var _,g,u,c,m,x,p,o;const d=l.reduce((j,E)=>E?[...j,E.fighter_id]:j,[]);return!e||!(t!=null&&t.landId)||!d.length||!((_=i[0])!=null&&_.asset_id)||!((g=i[1])!=null&&g.asset_id)?(d.length||P.error("No Warrior selected"),(u=i[0])!=null&&u.asset_id||P.error("No Crew selected (First spot on cards)"),(c=i[1])!=null&&c.asset_id||P.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:t,crew_asset_id:Number((m=i[0])==null?void 0:m.asset_id),weapon_asset_id:Number((x=i[1])==null?void 0:x.asset_id),fighter_ids:d,selectedLevel:a})):{user:e,planet:e.planet,landId:t.landId,x:t.x,y:t.y,card1:Number((p=i[0])==null?void 0:p.asset_id),card2:Number((o=i[1])==null?void 0:o.asset_id),teamFiltered:d,level:a.level}}const Fe=async()=>await R({options:{code:T.dungeonsAle,index_position:1,limit:"1000",scope:T.dungeonsAle,table:$.config}}),Se=()=>M({enabled:!!D.getState().user,queryKey:[L.dungeonConfigDataState],queryFn:()=>Te(),staleTime:1e3*60*20});async function Te(){try{const e=await Fe();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const je=async()=>await R({options:{code:T.battleAle,index_position:1,limit:"1000",scope:T.battleAle,table:"variables"}}),Ae=()=>M({enabled:!!D.getState().user,queryKey:[L.VariablesState],queryFn:()=>Ce(),staleTime:1e3*60*20});async function Ce(){try{const e=await je();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const Ee=async()=>await R({options:{code:T.battleAle,index_position:1,limit:"1000",scope:T.battleAle,table:"weather"}}),Ie=()=>M({enabled:!!D.getState().user,queryKey:[L.WeatherState],queryFn:()=>Pe(),staleTime:1e3*60*20});async function Pe(){try{return await Ee()}catch(e){return console.log(e),null}}const De=async e=>await R({options:{code:T.battleAle,index_position:1,limit:"1000",lower_bound:e,upper_bound:e,scope:T.battleAle,table:$.history}}),Ge=e=>M({enabled:!!D.getState().user,queryKey:[L.HistoryDataState,e],queryFn:()=>Y(e),staleTime:1e3*60*20});async function Y(e){try{const t=await De(e);if(!t)return null;const l=t==null?void 0:t.find(a=>a.history_id===e);return l?{...l,team1_fighters:l.team1_fighters.filter(a=>typeof a.fighter_id=="number")}:null}catch(t){return console.log(t),null}}function Le(){const{selectedCards:e,setSelectedCards:t,myTeam:l,setMyTeam:i}=K(),[a,d]=S.useState([]),[_,g]=S.useState("fighter"),[u,c]=S.useState(0),[m,x]=S.useState("level.worlds"),[p,o]=S.useState(-1),{data:j,isLoading:E}=le(m);function z(r){if(o(-1),g("fighter"),r===u){c(-1);return}c(r)}function N(r){if(c(-1),g("nft"),r===p){o(-1);return}o(r),x(r===0?"crew.worlds":r===1?"arms.worlds":"crew.worlds")}function q(r){if(!r){const h=e.map((H,O)=>{if(O!==p)return H}),w=p+1;if(o(w),t(h),x(w===0?"crew.worlds":w===1?"arms.worlds":"crew.worlds"),w>1){o(-1);return}return}if(e.some(h=>(h==null?void 0:h.asset_id)===(r==null?void 0:r.asset_id))){o(-1);return}const f=e.map((h,w)=>w===p?r:h),b=p+1;if(o(b),t(f),x(b===0?"crew.worlds":b===1?"arms.worlds":"crew.worlds"),b>1){o(-1);return}}function V(r){if(a.includes(r)){d(a.filter(f=>f!==r));return}d([...a,r])}function v(r){const f=l.map((h,w)=>w===u?r:h);i(f);const b=u+1;if(b===5){c(-1);return}c(b)}function W(r){return e.some(f=>(f==null?void 0:f.asset_id)!==r.asset_id)}return{selectedCards:e,inventoryPosition:p,filterSelected:a,inventoryFilter:m,fighterPosition:u,itemSelected:_,inventory:j,isInventoryLoading:E,handleFighterPosition:z,handleInventoryPosition:N,handleSelectCard:q,handleSelectFilter:V,handleAddFighter:v,filterInventoryCards:W}}const B=A.lazy(()=>C(()=>import("./index-b4d7ed01.js"),["assets/index-b4d7ed01.js","assets/index-32234248.js","assets/index-55fec1ff.css"])),He=A.lazy(()=>C(()=>import("./index-4ec37a84.js"),["assets/index-4ec37a84.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/useQuery-91053d03.js","assets/v4-4a60fe23.js","assets/fightersSort-2e989641.js","assets/sleep-da79c358.js","assets/use-transaction-12e25294.js","assets/toast-options-da6e6ed9.js","assets/config-query-efbe5711.js","assets/generateRandomWaxName-ee0d1ff2.js","assets/inventory-query-27ee4dd2.js","assets/atomic-api-b6220a6e.js"])),Re=A.lazy(()=>C(()=>import("./index-fda3abbb.js"),["assets/index-fda3abbb.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/fightersSort-2e989641.js","assets/use-media-47fc8cad.js","assets/sleep-da79c358.js","assets/use-transaction-12e25294.js","assets/toast-options-da6e6ed9.js","assets/useQuery-91053d03.js","assets/config-query-efbe5711.js","assets/generateRandomWaxName-ee0d1ff2.js","assets/inventory-query-27ee4dd2.js","assets/atomic-api-b6220a6e.js"])),Me=A.lazy(()=>C(()=>import("./index-320ad75e.js"),["assets/index-320ad75e.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/useQuery-91053d03.js","assets/fightersSort-2e989641.js","assets/use-media-47fc8cad.js"])),ze=A.lazy(()=>C(()=>import("./index-d477d688.js"),["assets/index-d477d688.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/config-query-efbe5711.js","assets/useQuery-91053d03.js","assets/classtemps-query-1a82e9a1.js"])),Ne=A.lazy(()=>C(()=>import("./index-ac586e07.js"),["assets/index-ac586e07.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/fightersSort-2e989641.js","assets/use-media-47fc8cad.js","assets/fighterFilters-e6065055.js","assets/fighters-query-653f3b68.js","assets/useQuery-91053d03.js","assets/sleep-da79c358.js","assets/use-transaction-12e25294.js","assets/toast-options-da6e6ed9.js","assets/config-query-efbe5711.js","assets/generateRandomWaxName-ee0d1ff2.js","assets/inventory-query-27ee4dd2.js","assets/atomic-api-b6220a6e.js"])),qe=A.lazy(()=>C(()=>import("./index-83fae785.js"),["assets/index-83fae785.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/inventory-query-27ee4dd2.js","assets/useQuery-91053d03.js","assets/atomic-api-b6220a6e.js","assets/toast-options-da6e6ed9.js","assets/fightersSort-2e989641.js","assets/sleep-da79c358.js","assets/use-transaction-12e25294.js","assets/config-query-efbe5711.js","assets/generateRandomWaxName-ee0d1ff2.js"])),Ve=()=>{const e=D(Z(s=>s.user));ae();const{data:t}=Se(),{data:l}=Ae(),{data:i}=Ie(),{inventoryFilter:a,inventoryPosition:d,fighterPosition:_,itemSelected:g,handleAddFighter:u,handleInventoryPosition:c,handleFighterPosition:m,handleSelectCard:x,filterInventoryCards:p}=Le(),{selectedCards:o,myTeam:j,setMyTeam:E,setSelectedCards:z}=K(),{areaSelected:N,setAreaSelected:q}=ee(),{selectedLevel:V,selectedFighter:v,setSelectedFighter:W}=re(),[r,f]=S.useState(!1),[b,h]=S.useState("");async function w(){try{f(!0);const s=ve({areaSelected:N,myTeam:j,selectedCards:o,selectedLevel:V,user:e});if(!s)return;const F=oe();if(!await be(e,e.planet,s.landId,s.card1,s.card2,s.teamFiltered,s.level,!0,F,s.x,s.y))return;await H(F),P.warn("No history data found yet. Retrying..."),await H(F)}catch(s){console.error(s)}finally{f(!1)}}async function H(s){await ie(5e3);const F=await Y(s);if(F){te.setQueryData([L.HistoryDataState,s],F),h(s),P.success("Fight Started !");return}}function O(){z([void 0,void 0]),E([null,null,null,null,null]),q(null)}const U=S.useMemo(()=>{var F,Q,k;return!j.filter(G=>G!==null).length||!((F=o[0])!=null&&F.asset_id)||!((Q=o[1])!=null&&Q.asset_id)||Number(((k=e==null?void 0:e.activestats)==null?void 0:k.action_points)||0)<((t==null?void 0:t.energy_cost)||0)},[j,o,t,e]),I=S.useMemo(()=>i==null?void 0:i.find(s=>s.weather_id===(l==null?void 0:l.current_weather_id)),[i,l]);return b?n.jsx(He,{historyId:b}):n.jsxs(de,{isFighterSelected:!!v,children:[n.jsxs(ce,{children:[n.jsx(B,{onClick:O,children:"Back"}),n.jsxs(B,{disabled:U||r,isLoading:r,onClick:w,children:["Start Fight",n.jsxs("div",{children:["-",t==null?void 0:t.energy_cost,n.jsx("img",{src:"/assets/icons/energy.png",alt:"Potion"})]})]})]}),n.jsxs(ue,{isFighterSelected:!!v,children:[n.jsx(pe,{children:n.jsx(fe,{to:"/dungeon-leaderboard",children:"Leaderboard"})}),n.jsxs(ge,{isFighterSelected:!!v,children:[(I==null?void 0:I.displayname)&&n.jsx(me,{children:I==null?void 0:I.displayname}),n.jsxs(xe,{children:[n.jsx(Re,{inventoryPosition:d,handleInventoryPosition:c,fighterPosition:_,handleFighterPosition:m}),n.jsx("span",{children:"VS"}),n.jsx(Me,{})]}),n.jsx(he,{children:g==="fighter"?n.jsx(Ne,{handleAddFighter:u}):n.jsx(qe,{inventoryPosition:d,inventoryFilter:a,handleSelectCard:x,filterInventoryCards:p})}),n.jsx("img",{src:"/assets/background/bg-dungeon.png",alt:""})]})]}),n.jsx(ye,{isFighterSelected:!!v,children:v?n.jsx(ze,{selectedFighter:{...v,...v.stats},onCloseFighterDetail:W}):n.jsx(n.Fragment,{children:n.jsx(_e,{children:"Select a Fighter"})})})]})},We=A.memo(Ve),Je=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"}));export{Ie as a,Ae as b,K as c,Je as i,Ge as u};

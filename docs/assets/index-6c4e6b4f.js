import{s as M,g as Q,S as v,q,d as w,u as T,v as F,R as z,_ as B,r as y,j as i}from"./index-27f5dc01.js";import{o as H,a as N}from"./all-buildings-90fce775.js";import{u as I}from"./useQuery-68fa67c5.js";import{u as K}from"./land-config-f8d76ce4.js";import{u as O}from"./use-transaction-393a2ebb.js";import{s as P}from"./sleep-da79c358.js";import{u as U}from"./index-bb261836.js";import"./atomic-api-f57ed448.js";import"./toast-options-c7a6f52c.js";import"./constants-1566b5f3.js";const Y=M("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),k=async t=>await Q({options:{code:v.landsAle,index_position:1,limit:"1000",scope:t,table:q.buildingcost}}),D=t=>I({queryFn:()=>W(t),queryKey:[w.buildingConfigState],staleTime:1e3*60*60,enabled:!!T.getState().user});async function V(){return await F.invalidateQueries(w.buildingConfigState)}async function W(t){try{return await k(t)}catch(e){return console.log(e),null}}async function $(t,e){const{executeTransaction:o}=O(),l=G(t,e);return!!await o(l)}function G(t,e){return{actions:[{account:v.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:e.planet,x:e.x,y:e.y,building:e.building,level:e.level,cost_gem:e.cost_gem,cost_credits:e.cost_credits}}]}}const h=z.lazy(()=>B(()=>import("./index-5ae458e7.js"),["assets/index-5ae458e7.js","assets/index-27f5dc01.js","assets/index-55fec1ff.css"])),ct=()=>{var g,_,x,b,f;const{data:t}=K(),e=T(a=>a.user),{selectedLand:o,buildingBoost:l,selectedBuild:s}=U(),{data:r}=D((s==null?void 0:s.img)||""),[u,p]=y.useState(!1);async function S(){if(!e||!o||!n||!s||s.boost_score){console.log({user:e,selectedLand:o,buildCost:n,selectedBuild:s});return}try{p(!0);const a={planet:o.data.planetName,x:o.data.x,y:o.data.y,building:s.building_name.toLowerCase(),level:s.level||1,cost_gem:n.cost_gem,cost_credits:n.cost_credits};await $(e,a)&&(await P(1e3),await H(),await V(),await N())}catch(a){console.error(a)}finally{p(!1)}}const n=y.useMemo(()=>r==null?void 0:r.find(a=>a.building_name===s.img&&a.level===((s==null?void 0:s.level)||0)+1),[r,s]),L=((g=t==null?void 0:t[0])==null?void 0:g.boost_base_cost)||0,j=((_=t==null?void 0:t[0])==null?void 0:_.boost_cost_first_percent)||0,R=(s==null?void 0:s.boost_score)||0,c=Number(((x=t==null?void 0:t[0])==null?void 0:x.boost_cost_mod)||0),A=(1-Math.pow(c,l[0]+1))/(1-c),C=(1-Math.pow(c,R/1e4+1))/(1-c),m=L+j*(A-C),d=(((b=t==null?void 0:t[0])==null?void 0:b.start_boost_score)||0)/1e4,E=m<d?d:m;return console.log({buildCost:n,buildingConfig:r,selectedBuild:s}),i.jsxs(Y,{children:[o&&!!(s!=null&&s.boost_score)&&i.jsxs(h,{children:["Boost"," ",i.jsxs("div",{children:[E.toFixed(2),i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})," "]})]}),o&&!!n&&i.jsxs(h,{isLoading:u,disabled:u,onClick:S,children:["Build ",s==null?void 0:s.building_name,i.jsxs("div",{children:[(f=n==null?void 0:n.cost_gem)==null?void 0:f.toLocaleString("en-US")," ",i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})]})]})]})};export{ct as default};

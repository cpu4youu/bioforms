import{s as l,g as P,S as D,u as B,e as Q,R as $,_ as E,b as O,r as f,j as e}from"./index-7043a4b2.js";import{u as V,a as Y,b as K}from"./index-455073cb.js";import{u as L}from"./useQuery-600cc629.js";import{v as M}from"./v4-4a60fe23.js";import"./index-cabdec58.js";import"./index-71047fdd.js";import"./use-media-90864db7.js";import"./sleep-da79c358.js";import"./use-transaction-eaef7a1b.js";import"./toast-options-3ea258b9.js";const q=l("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),U=l("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),X=l("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justifyContent:"center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423"}),N=l("div",{gridArea:"main",d:"flex",direction:"column",w:"100%",maxW:"1360px",h:"calc(100vh - 235px)",mx:"auto",px:"20px"}),G=l("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),J=l("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),Z=l("div",{d:"flex",justify:"space-between",align:"center",gap:"5px",mt:"35px",">span":{mx:"95px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{mt:"10px",gap:"15px",direction:"column"}}),H=l("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"},">div":{d:"flex",justify:"space-between",gap:"5px"}}),ee=l("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"}}),te=l("div",{d:"flex",justify:"space-between",gap:"5px"}),ne=l("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"}),ae=l("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}}),se=l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}}),ie=l("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}}),re=l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{img:{scale:"3.2",translate:"-5px 10px"}}}}});l("div",{d:"flex",justify:"center",align:"center",direction:"column",gap:"20px",mt:"40px",img:{height:235,width:235,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});l("div",{d:"flex",justify:"center",align:"center",width:"23%"});l("div",{d:"flex",justify:"center",align:"center",direction:"column",textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",img:{height:80,width:80,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});const le=async h=>await P({options:{code:D.poolsAle,index_position:2,key_type:"i64",limit:"1000",reverse:!0,lower_bound:h,upper_bound:h,scope:D.poolsAle,table:"minehistory"}}),ce=()=>L({enabled:!!B.getState().user,queryKey:[Q.dungeonPoolDataState],queryFn:()=>de(),staleTime:1e3*60*20});async function de(){const h=B.getState().user;try{const m=await le(h==null?void 0:h.name);return m!=null&&m[0]?m[0]:null}catch(m){return console.log(m),null}}function oe(h,m){const w=[...h.map(c=>({...c,team:1})),...m.map(c=>({...c,team:2}))],v=[];for(;w.filter(c=>c.team===1&&c.health>0).length>0&&w.filter(c=>c.team===2&&c.health>0).length>0;){const c=w.filter(p=>p.health>0),d=c.reduce((p,u)=>u.initiative<p.initiative?u:p),T=d.team===1?2:1,j=c.filter(p=>p.team===T);if(j.length===0)return;const a=j.reduce((p,u)=>u.taunt>p.taunt?u:p),t=`res_${d.element}`,C=a[t]/10,i=d.damage*(100-C)/100,S=i*100/d.damage;v.push({attacker:d,defender:a,attack:i,attackerHealthBefore:d.health,attackerTeam:d.team,defenderTeam:a.team,defenderTauntBefore:a.taunt,defenderHealthBefore:a.health,effectiveness:S}),a.health-=i,a.taunt=Math.max(0,a.taunt-10),d.initiative+=d.attackspeed}return v}const y=$.lazy(()=>E(()=>import("./index-f186efb1.js"),["assets/index-f186efb1.js","assets/index-7043a4b2.js","assets/index-55fec1ff.css"])),b=$.lazy(()=>E(()=>import("./index-9a7149b4.js"),["assets/index-9a7149b4.js","assets/index-7043a4b2.js","assets/index-55fec1ff.css","assets/iconBase-d0d9cc2f.js"])),pe=$.lazy(()=>E(()=>import("./index-30917e3a.js"),["assets/index-30917e3a.js","assets/index-7043a4b2.js","assets/index-55fec1ff.css","assets/assets-id-query-9aea54f3.js","assets/useQuery-600cc629.js","assets/adapters-f159df86.js","assets/atomic-api-227d38dd.js","assets/toast-options-3ea258b9.js"])),we=({historyId:h})=>{const{areaSelected:m,setAreaSelected:w}=O(),{data:v}=V(h),{data:c}=ce(),{data:d}=Y(),{data:T}=K(),j=f.useRef(null),[a,F]=f.useState(),[t,C]=f.useState([]),[i,S]=f.useState(0),[p,u]=f.useState(!1),[_,k]=f.useState({}),A=f.useMemo(()=>d==null?void 0:d.find(n=>n.weather_id===(T==null?void 0:T.current_weather_id)),[d,T]);function W(){w(null)}function I(){if(!a)return;S(t.length);const n={},o=a.team1_fighters.map(s=>({...s,team:1})),r=a.team2_fighters.map(s=>({...s,team:2}));[...o,...r].forEach(s=>{n[`${s.fighter_id}-${s.team}`]=s.health}),t.forEach(s=>{n[`${s.defender.fighter_id}-${s.defenderTeam}`]=s.defender.health}),k(n),u(!0)}return f.useEffect(()=>{F(v??void 0)},[v]),f.useEffect(()=>{if(a!=null&&a.team1_fighters&&(a!=null&&a.team2_fighters)){const n=a.team1_fighters.map(g=>({...g,team:1})),o=a.team2_fighters.map(g=>({...g,team:2})),r={};[...n,...o].forEach(g=>{r[`${g.fighter_id}-${g.team}`]=g.health}),k(r);const s=oe(n,o);C(s||[]),S(0)}},[a,m]),f.useEffect(()=>{if(t.length===0)return;i>t.length&&u(!0);const n=setTimeout(()=>{var g,z,R;const o=(g=t==null?void 0:t[i])==null?void 0:g.attack,r=(z=t==null?void 0:t[i])==null?void 0:z.defender,x=(R=t==null?void 0:t[i])==null?void 0:R.defenderTeam;_[`${r==null?void 0:r.fighter_id}-${x}`]!==void 0&&k({..._,[`${r==null?void 0:r.fighter_id}-${x}`]:Math.max(0,_[`${r==null?void 0:r.fighter_id}-${x}`]-o)});const s=i+1;S(s)},1e3);return()=>clearTimeout(n)},[t,i,_]),f.useEffect(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)},[i]),e.jsxs(q,{children:[e.jsx(U,{children:p?e.jsx(y,{onClick:W,children:"Back"}):e.jsx(y,{onClick:I,children:"Skip Fight"})}),e.jsx(X,{children:p?e.jsx(pe,{data:v,pool:c,healthMap:_}):e.jsxs(e.Fragment,{children:[e.jsx(G,{children:"Weather"}),e.jsx(J,{children:A==null?void 0:A.displayname}),e.jsxs(N,{children:[e.jsxs(Z,{children:[e.jsxs(H,{children:[e.jsx("span",{children:"YOUR TEAM"}),e.jsx("div",{children:a==null?void 0:a.team1_fighters.map(n=>{var o,r,x,s;return e.jsx(b,{isFighting:!0,isAttacking:((o=t==null?void 0:t[i])==null?void 0:o.attackerTeam)===1&&((r=t==null?void 0:t[i])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((x=t==null?void 0:t[i])==null?void 0:x.defenderTeam)===1&&((s=t==null?void 0:t[i])==null?void 0:s.defender.fighter_id)===n.fighter_id,fighter:{...n,stats:{...n,health:_[`${n.fighter_id}-1`]}}},M())})})]}),e.jsx("span",{children:"VS"}),e.jsx(te,{children:a==null?void 0:a.team2_fighters.map(n=>{var o,r,x,s;return e.jsxs(ee,{children:[e.jsx("span",{children:"AI"}),e.jsx(b,{isFighting:!0,isAttacking:((o=t==null?void 0:t[i])==null?void 0:o.attackerTeam)===2&&((r=t==null?void 0:t[i])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((x=t==null?void 0:t[i])==null?void 0:x.defenderTeam)===2&&((s=t==null?void 0:t[i])==null?void 0:s.defender.fighter_id)===n.fighter_id,fighter:{...n,stats:{...n,health:_[`${n.fighter_id}-2`]}}})]},M())})})]}),e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsxs(se,{children:[e.jsx("span",{children:"Attacker"}),e.jsx("span",{children:"Defender"}),e.jsx("span",{children:"Attack"}),e.jsx("span",{children:"Damage"}),e.jsx("span",{children:"Remaining Health"}),e.jsx("span",{children:"Effectiveness"}),e.jsx("span",{children:"Special Event"})]}),e.jsx(ie,{ref:j,children:t.slice(0,i).map((n,o)=>e.jsxs(re,{children:[e.jsx(b,{isFighting:!0,fighter:{...n.attacker,stats:{...n.attacker,health:n.attackerHealthBefore}}}),e.jsx(b,{isFighting:!0,fighter:{...n.defender,stats:{...n.defender,health:n.defenderHealthBefore-n.attack}}}),e.jsx("span",{children:n.attack.toFixed(2)}),e.jsx("span",{children:n.attacker.damage.toFixed(2)}),e.jsx("span",{children:(n.defenderHealthBefore-n.attack).toFixed(2)}),e.jsxs("span",{children:[n.effectiveness.toFixed(2),"%"]}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:["ID: ",n.attacker.fighter_id,e.jsx("br",{}),"TEAM: ",n.attackerTeam," "]}),e.jsxs("span",{children:["ID: ",n.defender.fighter_id,e.jsx("br",{}),"TEAM: ",n.defenderTeam]})]},o))})]})})]})]})})]})};export{we as default};

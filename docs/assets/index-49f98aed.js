import{s as M,d as Q,S as h,T as B,Q as v,u as T,t as F,R as q,_ as z,r as b,j as i}from"./index-2797d32d.js";import{o as H,a as N}from"./all-buildings-5f5db081.js";import{u as I}from"./useQuery-4894b7d9.js";import{u as K}from"./land-config-ddcd9dc9.js";import{u as O}from"./use-transaction-ff31980e.js";import{s as P}from"./sleep-da79c358.js";import{u as U}from"./index-71674021.js";import"./atomic-api-794f0fcd.js";import"./toast-options-5a4f4045.js";import"./constants-2bbfa292.js";const Y=M("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),k=async t=>await Q({options:{code:h.landsAle,index_position:1,limit:"1000",scope:t,table:B.buildingcost}}),D=t=>I({queryFn:()=>W(t),queryKey:[v.buildingConfigState],staleTime:1e3*60*60,enabled:!!T.getState().user});async function V(){return await F.invalidateQueries(v.buildingConfigState)}async function W(t){try{return await k(t)}catch(s){return console.log(s),null}}async function $(t,s){const{executeTransaction:o}=O(),u=G(t,s);return!!await o(u)}function G(t,s){return{actions:[{account:h.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:s.planet,x:s.x,y:s.y,building:s.building,level:s.level,cost_gem:s.cost_gem,cost_credits:s.cost_credits}}]}}const y=q.lazy(()=>z(()=>import("./index-cee409ad.js"),["assets/index-cee409ad.js","assets/index-2797d32d.js","assets/index-55fec1ff.css"])),ct=()=>{var d,g,_,x,f;const{data:t}=K(),s=T(n=>n.user),{selectedLand:o,buildingBoost:u,selectedBuild:e}=U(),{data:r}=D((e==null?void 0:e.img)||""),[w,l]=b.useState(!1);async function S(){if(!(!s||!o||!a||!e))try{l(!0);const n={planet:o.data.planetName,x:o.data.x,y:o.data.y,building:e.name.toLowerCase(),level:e.level||1,cost_gem:a.cost_gem,cost_credits:a.cost_credits};await $(s,n)&&(await P(1e3),await H(),await V(),await N())}catch(n){console.error(n)}finally{l(!1)}}const a=b.useMemo(()=>r==null?void 0:r.find(n=>n.building_name===e.img&&n.level===((e==null?void 0:e.level)||0)+1),[r,e]),L=((d=t==null?void 0:t[0])==null?void 0:d.boost_base_cost)||0,j=((g=t==null?void 0:t[0])==null?void 0:g.boost_cost_first_percent)||0,R=(e==null?void 0:e.boost_score)||0,c=Number(((_=t==null?void 0:t[0])==null?void 0:_.boost_cost_mod)||0),A=(1-Math.pow(c,u[0]+1))/(1-c),C=(1-Math.pow(c,R/1e4+1))/(1-c),p=L+j*(A-C),m=(((x=t==null?void 0:t[0])==null?void 0:x.start_boost_score)||0)/1e4,E=p<m?m:p;return i.jsxs(Y,{children:[o&&(e==null?void 0:e.building_name)&&i.jsxs(y,{children:["Boost"," ",i.jsxs("div",{children:[E.toFixed(2),i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})," "]})]}),o&&a&&i.jsxs(y,{isLoading:w,onClick:S,children:["Build ",e.name,i.jsxs("div",{children:[(f=a==null?void 0:a.cost_gem)==null?void 0:f.toLocaleString("en-US")," ",i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})]})]})]})};export{ct as default};

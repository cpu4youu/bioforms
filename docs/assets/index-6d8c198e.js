import{s as p,g as k,S as f,e as H,u as P,R as D,_ as E,a as Q,r as m,j as n,Q as j}from"./index-a1092551.js";import{u as W,o as C}from"./fighters-query-28086337.js";import{u as O}from"./index-68e5c807.js";import{u as Y,F as q}from"./index-23ae44bc.js";import{u as $}from"./useQuery-072b8a1e.js";import{s as A}from"./sleep-da79c358.js";import{u as R}from"./use-transaction-7a354d21.js";const B=p("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{gridTemplateAreas:`
          "empty empty header"
          "main main side"
        `,"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),K=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),V=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423",variants:{isFighterSelected:{true:{"@xmd":{display:"none"}}}}});p("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}});const N=p("div",{display:"none",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{display:"flex"},false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"}}),G=p("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),J=async()=>await k({options:{code:f.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:f.battleAle,table:"levels"}}),X=()=>$({queryKey:[H.levelsState],queryFn:()=>Z(),staleTime:1e3*60*60,enabled:!!P.getState().user});async function Z(){try{return await J()}catch(t){return console.log(t),null}}async function ee(t,e){const{executeTransaction:s}=R(),i=te(t,e);return!!await s(i)}function te(t,{cost_credits:e,cost_gems:s,fighter_ids:i}){return{actions:[{account:f.battleAle,name:"levelup",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_ids:i,cost_gems:s,cost_credits:e}}]}}async function ae(t,e){const{executeTransaction:s}=R(),i=ne(t,e);return!!await s(i)}function ne(t,{fighter_id:e}){return{actions:[{account:f.battleAle,name:"payday",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_id:e}}]}}const L=D.lazy(()=>E(()=>import("./index-5ec8eea0.js"),["assets/index-5ec8eea0.js","assets/index-a1092551.js","assets/index-55fec1ff.css"])),se=D.lazy(()=>E(()=>import("./index-6d73234b.js"),["assets/index-6d73234b.js","assets/index-a1092551.js","assets/index-55fec1ff.css","assets/index-68e5c807.js","assets/index-23ae44bc.js","assets/useQuery-072b8a1e.js","assets/sleep-da79c358.js","assets/fighters-query-28086337.js","assets/markers-21ad5773.js","assets/use-transaction-7a354d21.js","assets/toast-options-6515d5a6.js"])),re=()=>{var S;const t=P(Q(a=>a.user)),{data:e}=W(t.name),{data:s}=X(),{data:i}=Y(),{selectedFighter:l,setSelectedFighter:y}=O(),[h,_]=m.useState(!1),[v,F]=m.useState(!1),z=e==null?void 0:e.some(a=>a.stats.experience>=a.stats.required_experience),T=m.useMemo(()=>(e==null?void 0:e.reduce((a,c)=>{var r;const o=(r=s==null?void 0:s.find(d=>d.level===c.stats.level))==null?void 0:r.unlock_cost_gem;return o?a+=o:a},0))||0,[s,e]);async function I(){try{_(!0);const a=(e==null?void 0:e.filter(r=>r.stats.experience>=r.stats.required_experience).map(r=>r.fighter_id))||[],c=(e==null?void 0:e.reduce((r,d)=>{var u;const x=(u=s==null?void 0:s.find(g=>g.level===d.stats.level))==null?void 0:u.unlock_cost_credits;return x?r+=x:r},0))||0;if(!await ee(t,{cost_credits:c,cost_gems:T,fighter_ids:a}))return;await A(2e3),C(t.name),j.success("Fighter leveled up!")}catch(a){console.error(a)}finally{_(!1)}}const b=m.useMemo(()=>(e==null?void 0:e.reduce((a,c)=>{const o=new Date(c.next_payday).getTime()/1e3,r=new Date(c.last_payday).getTime()/1e3,d=new Date().getTime()/1e3,x=(i==null?void 0:i.standard_pay_payday)||0;let u=0;o>d&&(u=o-d);const g=o-r-u,U=o-r,w=Math.floor(g/U*x+1);return w>1?a+=w:a},0))||0,[i,e]);async function M(){try{F(!0);const a=(e==null?void 0:e.map(o=>o.fighter_id))||[];if(!await ae(t,{fighter_id:a}))return;await A(2e3),C(t.name),j.success("Fighter payday!")}catch(a){console.error(a)}finally{F(!1)}}return m.useEffect(()=>()=>y(null),[]),n.jsxs(B,{isFighterSelected:!!l,children:[n.jsxs(K,{children:[n.jsxs(L,{isLoading:h,disabled:h||!z,onClick:I,children:["Level All"," ",n.jsxs("div",{children:[T,n.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})," "]})]}),n.jsxs(L,{isLoading:v,disabled:v||b>((S=t.activestats)==null?void 0:S.action_points),onClick:M,children:["Payday",n.jsxs("div",{children:["-",b,n.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})]})]})]}),n.jsx(V,{isFighterSelected:!!l,children:e?e==null?void 0:e.map(a=>n.jsx(se,{fighter:a},a.fighter_id)):n.jsx(n.Fragment,{children:n.jsx(G,{children:"You don't have Fighters"})})}),n.jsx(N,{isFighterSelected:!!l,children:!!l&&n.jsx(q,{selectedFighter:l,onCloseFighterDetail:y})})]})},me=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{ae as a,ee as e,me as i,X as u};

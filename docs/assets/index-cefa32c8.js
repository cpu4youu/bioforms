import{s as o,S as D,R as z,_ as A,u as $,a as R,r as d,j as s,Q as x}from"./index-9fc33c7c.js";import{u as E}from"./index-bbd30766.js";import{u as W,s as B}from"./index-2d133007.js";import{u as U,e as N,a as Q}from"./index-053ff3fb.js";import{s as m}from"./sleep-da79c358.js";import{o as u}from"./fighters-query-fbf4c053.js";import{m as q}from"./markers-21ad5773.js";import{u as H}from"./use-transaction-ed631b73.js";import"./useQuery-869993e9.js";import"./toast-options-a6d93504.js";const O=o("div",{display:"flex",h:"175px",w:"100%",maxW:"395px",gap:"5px",padding:"5px",position:"relative",">img":{br:"5px",zIndex:"1",position:"absolute",objectFit:"cover",top:"0",left:"0",w:"100%",h:"100%"}}),V=o("div",{display:"flex",gap:"5px",zIndex:"2"}),X=o("div",{display:"flex",bg:"#282828",br:"3px 3px 5px",w:"12px",h:"100%",div:{display:"flex",br:"3px 3px 5px",w:"100%",mt:"auto",background:"green"}}),G=o("div",{mt:"auto",w:"55px",h:"157px",overflow:"hidden",br:"10px",img:{w:"55px",h:"157px",objectPosition:"top",objectFit:"cover"}}),J=o("div",{display:"flex",direction:"column",zIndex:"2",w:"210px",br:"3px",bg:"rgba(0, 0, 0, 0.3)",padding:"10px",p:{ff:"$heading",fs:"10px",textShadow:"1px 1px 3px #000",color:"white",">span":{color:"#FFB800"}}}),K=o("div",{display:"flex",alignItems:"center",gap:"2px",color:"white",textShadow:"1px 1px 3px #000",textTransform:"capitalize",fs:"16px",">img":{w:"17px",h:"17px",objectFit:"cover",objectPosition:"center","-webkit-filter":"drop-shadow(0px 0px 4px #000)",filter:"drop-shadow(0px 0px 4px #000)"}}),Y=o("div",{display:"flex",gap:"15px",mb:"3px",color:"white",fs:"10px",textShadow:"1px 1px 3px #000"}),Z=o("div",{display:"flex",flexDirection:"column",mt:"7px"}),ee=o("div",{display:"flex",justifyContent:"space-between",color:"white",textTransform:"capitalize",textShadow:"1px 1px 3px #000",fs:"10px",">strong":{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"," >img":{w:"12px",h:"12px",objectFit:"cover"}}}),se=o("div",{display:"grid",gridTemplateRows:"40px 40px auto",w:"70px",gap:"5px",zIndex:"2",">button":{borderWidth:"1px",br:"5px",color:"white",fs:"10px",padding:"0px 5px",div:{d:"flex",alignItems:"center",fs:"10px",color:"#828282",img:{objectFit:"contain",w:"14px"}}}}),te=o("div",{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",margin:"auto auto 10px auto",maxW:"55px",maxH:"33px",button:{zIndex:"2",w:"17px",h:"17px"},img:{w:"17px",h:"17px",objectFit:"cover",objectPosition:"center","-webkit-filter":"drop-shadow(0px 0px 4px #000)",filter:"drop-shadow(0px 0px 4px #000)"}});async function S(t,n){const{executeTransaction:p}=H(),c=ae(t,n);return!!await p(c)}function ae(t,{marker:n,fighter_id:p}){return{actions:[{account:D.battleAle,name:"setmarker",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_id:p,marker:n}}]}}const F=z.lazy(()=>A(()=>import("./index-3b45a4b1.js"),["assets/index-3b45a4b1.js","assets/index-9fc33c7c.js","assets/index-55fec1ff.css"])),ye=({fighter:t})=>{var k;const n=t.stats,{setSelectedFighter:p}=E(),{data:c}=U(),{data:r}=W(),i=$(R(e=>e.user)),[h,g]=d.useState(!1),[f,j]=d.useState(!1),[w,_]=d.useState(!1);async function T(){const e=c==null?void 0:c.find(a=>a.level===t.stats.level);try{if(g(!0),!e){x.error("No level find on levels table");return}if(!await N(i,{cost_credits:e==null?void 0:e.unlock_cost_credits,cost_gems:e==null?void 0:e.unlock_cost_gem,fighter_ids:[t.fighter_id]}))return;await m(2e3),u(i.name),x.success("Fighter leveled up!")}catch(a){console.error(a)}finally{g(!1)}}async function C(){try{if(j(!0),!await Q(i,{fighter_id:[t.fighter_id]}))return;await m(2e3),u(i.name),x.success("Fighter payday!")}catch(e){console.error(e)}finally{j(!1)}}async function b(e){try{if(_(!0),e==="cancel"){if(!await S(i,{marker:"",fighter_id:t.fighter_id}))return;await m(2e3),u(i.name),x.success("Fighter marker removed!");return}if(!await S(i,{marker:e,fighter_id:t.fighter_id}))return;await m(2e3),u(i.name),x.success("Fighter marked!")}catch(a){console.error(a)}finally{_(!1)}}const v=d.useMemo(()=>{const e=Math.floor((Date.now()-new Date(t.creation_date).getTime())/864e5),a=((r==null?void 0:r.age_penaly_percent_day)??0)/100||0;return Math.floor(e*a)},[r,t.creation_date]),y=d.useMemo(()=>{const e=new Date(t.next_payday).getTime()/1e3,a=new Date(t.last_payday).getTime()/1e3,l=new Date().getTime()/1e3,L=(r==null?void 0:r.standard_pay_payday)||0;let P=0;e>l&&(P=e-l);const I=e-a-P,M=e-a;return Math.floor(I/M*L+1)},[r,t]);return console.log(t),s.jsxs(O,{onClick:()=>p({...t,...t.stats,agePenalty:v}),children:[s.jsxs(V,{children:[s.jsx(X,{children:s.jsx("div",{style:{height:"100%"}})}),s.jsx(G,{children:s.jsx("img",{src:`/assets/fighter/classes/full_${t.classname}_${t.racename}.png`,alt:"",loading:"lazy"})})]}),s.jsxs(J,{children:[s.jsxs(K,{children:[t.racename," ",t.classname,s.jsx("img",{src:`/assets/markers/${t.marker}.png`,alt:t.marker})]}),s.jsxs(Y,{children:[s.jsxs("span",{children:["Level: ",n.level]}),s.jsxs("span",{children:["XP: ",t.stats.experience,"/",t.stats.required_experience]})]}),s.jsxs("p",{children:["Element: ",t.element]}),s.jsxs("p",{children:["Age Penalty: ",s.jsxs("span",{children:[v,"%"]})]}),s.jsx(Z,{children:B.map(e=>{const a=(n==null?void 0:n[`${e}_min`])??0,l=(n==null?void 0:n[`${e}_max`])??0;return s.jsxs(ee,{children:[s.jsxs("strong",{children:[s.jsx("img",{src:`/assets/icons/stats/${e}.png`,alt:e}),e]}),s.jsx("span",{children:s.jsxs("span",{children:[s.jsxs("span",{children:[Math.floor((a+l)/2)," "]}),s.jsxs("span",{children:[" (+-",Math.floor(Math.abs(l-a)/2),")"]})]})})]},e)})})]}),s.jsxs(se,{children:[s.jsx(F,{isLoading:h,disabled:h||t.stats.experience<t.stats.required_experience,onClick:T,children:"Level up"}),s.jsxs(F,{isLoading:f,disabled:f||y<1||y>((k=i.activestats)==null?void 0:k.action_points),onClick:C,children:["Payday",s.jsxs("div",{children:["-",y,s.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})]})]}),s.jsxs(te,{children:[q.map(e=>s.jsx("button",{disabled:w,onClick:()=>b(e),children:s.jsx("img",{src:`/assets/markers/${e}.png`,alt:e})},e)),s.jsx("button",{disabled:w,onClick:()=>b("cancel"),children:s.jsx("img",{src:"/assets/markers/cancel.png",alt:"cancel"})})]})]}),s.jsx("img",{src:`/assets/fighter/classes/backgrounds/full/full_background_${t.element}.jpeg`,alt:""})]})};export{ye as default};

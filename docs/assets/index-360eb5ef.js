import{s as r,g as y,S as o,e as b,u as l,d as ne,R as H,_ as B,a as z,r as c,j as n,Q as P}from"./index-15b776a0.js";import{o as ae}from"./activequests-query-13c18d51.js";import{s as F}from"./sleep-da79c358.js";import{u as se,o as I}from"./inventory-query-064ea52a.js";import{u as w}from"./useQuery-849bc9a2.js";import{u as E}from"./use-transaction-03f8c72f.js";const oe=r("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"70px 1fr",gridTemplateColumns:"1fr 1fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),re=r("div",{gridArea:"header",d:"flex",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",span:{ff:"$heading",fs:"16px",fw:"bold",ml:"auto",color:"#828282"},img:{objectFit:"contain",w:"24px",h:"24px"}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),ie=r("div",{gridArea:"main",d:"flex",position:"relative",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423"}),le=r("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-30px",left:"0px"}),L=r("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:first-child":{br:"15px 0px 0px 0px"},"&:last-child":{br:"0 15px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}}),ce=r("div",{d:"flex",alignContent:"flex-start",justifyContent:"flex-start",flexWrap:"wrap",w:"100%",gap:"10px",maxH:"calc(100vh - 175px)",overflowY:"auto"}),de=r("div",{d:"flex",alignContent:"flex-start",justifyContent:"flex-start",gap:"20px",w:"100%"}),N=r("div",{d:"flex",alignItems:"center",gap:"2px",maxH:"35px",span:{d:"flex",alignItems:"center",h:"35px",bg:"#0E0E1C",padding:"5px 15px",color:"#fff",fw:"bold",fs:"12px",ff:"$heading",">img":{w:"25px",h:"25px",objectFit:"contain"},"&:first-child":{br:"10px 0 0 10px"},"&:last-child":{br:"0 10px 10px 0"}}}),ue=r("div",{d:"flex",alignContent:"flex-start",justifyContent:"flex-start",direction:"column",w:"100%",h:"100%",padding:"20px",br:"10px",bg:"#1D1B20",maxH:"calc(100vh - 230px)",overflowY:"auto","div::-webkit-scrollbar":{width:"20px",height:"10px",padding:"0px",background:"#2A2A2A",border:"solid 1px #4A4459",borderRadius:"2px"},"div::-webkit-scrollbar-thumb":{borderRadius:"2px"}}),pe=r("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"20px",ml:"20px"}),Q=r("button",{d:"flex",align:"center",justify:"center",pb:"10px",color:"#fff",fs:"12px",variants:{isSelected:{true:{color:"#36B9EA",borderBottom:"2px solid #36B9EA"}}}}),$=r("div",{d:"flex",alignContent:"flex-start",justifyContent:"flex-start",flexWrap:"wrap",gap:"10px",w:"100%",padding:"30px 0px 30px 40px",bg:"#1D1B20",border:"1px solid #4A4459",overflowY:"auto"}),T=r("span",{color:"#fff",fw:"bold",fs:"28px",ff:"$heading"}),fe=async e=>await y({options:{code:o.farmAle,index_position:1,key_type:"i64",limit:"1000",scope:o.farmAle,table:"pools",lower_bound:e,upper_bound:e}}),xe=e=>w({queryKey:[b.StakePoolsState],queryFn:()=>me(e),staleTime:1e3*60*60,enabled:!!l.getState().user});async function me(e){try{return await fe(e)}catch(a){return console.log(a),null}}const ge=async e=>await y({options:{code:o.farmAle,index_position:2,key_type:"i64",limit:"1000",scope:o.farmAle,table:"nfts",lower_bound:e,upper_bound:e}}),he=()=>w({queryKey:[b.StakedNftsState],queryFn:()=>ye(),staleTime:1e3*60*60,enabled:!!l.getState().user});async function ye(){const e=l.getState().user;if(!e)return null;try{return await ge(e==null?void 0:e.name)}catch(a){return console.log(a),null}}const be=ne((e,a)=>({selectedCards:[],setSelectedCards:i=>e({selectedCards:i})})),we=async e=>{const a=await y({options:{code:o.farmAle,index_position:1,key_type:"i64",limit:"1000",scope:o.farmAle,table:"user",lower_bound:e,upper_bound:e}});return(a==null?void 0:a[0])||null},Se=()=>w({queryKey:[b.StakeUserState],queryFn:()=>Ce(),staleTime:1e3*60*60,enabled:!!l.getState().user});async function Ce(){const e=l.getState().user;if(!e)return null;try{return await we(e==null?void 0:e.name)}catch(a){return console.log(a),null}}const _e=async e=>await y({options:{code:o.farmAle,index_position:1,key_type:"i64",limit:"1000",scope:o.farmAle,table:"poolconfig",lower_bound:e,upper_bound:e}}),ke=()=>w({queryKey:[b.StakePoolsConfigState],queryFn:()=>je(),staleTime:1e3*60*60,enabled:!!l.getState().user});async function je(){try{return await _e()}catch(e){return console.log(e),null}}const Te=async e=>await y({options:{code:o.farmAle,index_position:1,key_type:"i64",limit:"1000",scope:o.farmAle,table:"config",lower_bound:e,upper_bound:e}}),ve=()=>w({queryKey:[b.StakeConfigState],queryFn:()=>Ae(),staleTime:1e3*60*60,enabled:!!l.getState().user});async function Ae(){try{const e=await Te();return e==null?void 0:e[0]}catch(e){return console.log(e),null}}async function Pe(e){const{executeTransaction:a}=E(),i=Fe(e);return!!await a(i)}function Fe(e){return{actions:[{account:o.farmAle,name:"claim",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name}}]}}async function Le(e,a){const{executeTransaction:i}=E(),d=Re(e,a);return!!await i(d)}function Re(e,a){return{actions:[{account:o.farmAle,name:"unstake",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,asset_ids:a}}]}}async function Ee(e,a){const{executeTransaction:i}=E(),d=De(e,a);return!!await i(d)}function De(e,a){return{actions:[{account:o.atomicassets,name:"transfer",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{from:e.name,to:o.farmAle,memo:"nftstake",asset_ids:a}}]}}const R=H.lazy(()=>B(()=>import("./index-ced56574.js"),["assets/index-ced56574.js","assets/index-15b776a0.js","assets/index-55fec1ff.css","assets/index-15e5bc54.js"])),W=H.lazy(()=>B(()=>import("./index-96483f1c.js"),["assets/index-96483f1c.js","assets/index-15b776a0.js","assets/index-55fec1ff.css","assets/useQuery-849bc9a2.js","assets/activequests-query-13c18d51.js","assets/sleep-da79c358.js","assets/inventory-query-064ea52a.js","assets/adapters-87f75137.js","assets/atomic-api-434251fa.js","assets/toast-options-f9f71154.js","assets/use-transaction-03f8c72f.js"])),Me=()=>{var M;const e=l(z(t=>t.user)),a=l(z(t=>t.updatePlayerData)),{setSelectedCards:i,selectedCards:d}=be(),[s,K]=c.useState("tool.worlds"),[h,U]=c.useState("inventory"),[f,x]=c.useState(!1),{data:S}=xe(),{data:C}=ke(),{data:u}=Se(),{data:v}=ve(),{data:_,isLoading:Y}=se(s),{data:m,isLoading:O}=he();function A(t){K(t),i([])}function D(t){U(t),i([])}async function V(){x(!0);try{if(!await Pe(e)){console.log("Failed to claim rewards");return}await F(3e3),await ae(),P.success("Rewards claimed successfully!")}catch(t){console.log(t)}finally{x(!1)}}async function G(){x(!0);try{const t=d.map(j=>Number(j.asset_id));if(!await Ee(e,t)){console.log("Failed to stake cards");return}await F(3e3),await a(),await I(s),P.success("Staked successfully!")}catch(t){console.log(t)}finally{x(!1)}}async function J(){x(!0);try{const t=d.map(j=>Number(j.asset_id));if(!await Le(e,t)){console.log("Failed to unstake cards");return}await F(3e3),await a(),await I(s),P.success("Cards unstaked successfully!")}catch(t){console.log(t)}finally{x(!1)}}const X=c.useMemo(()=>(m==null?void 0:m.reduce((t,g)=>t+g.weight,0))||0,[m]),p=c.useMemo(()=>S==null?void 0:S.find(t=>t.schema===s),[s,S]),k=c.useMemo(()=>C==null?void 0:C.find(t=>t.schema===s),[s,C]),Z=c.useMemo(()=>{const t=new Date((p==null?void 0:p.last_claim)||0);return Math.floor((Date.now()-t.getTime())/(1e3*60*60))*((k==null?void 0:k.value_per_hour)||0)},[k,p]),ee=c.useMemo(()=>{var q;const t=new Date((u==null?void 0:u.last_claim)||0),g=Math.floor((Date.now()-t.getTime())/1e3);return(((q=u==null?void 0:u.pool_weights.find(te=>te.key===s))==null?void 0:q.value)||0)*g/3600},[u,s]);return n.jsxs(oe,{children:[n.jsxs(re,{children:[h==="inventory"?n.jsxs(R,{isLoading:f,disabled:f,onClick:G,children:["Stake",n.jsx("span",{children:v==null?void 0:v.gem_fee}),n.jsx("img",{src:"/assets/icons/gems.png",alt:"gem"})]}):n.jsx(R,{isLoading:f,disabled:f,onClick:J,children:"Unstake"}),n.jsx(R,{isLoading:f,disabled:f,onClick:V,children:"Claim Rewards"})]}),n.jsxs(ie,{children:[n.jsxs(le,{children:[n.jsx(L,{isSelected:s==="tool.worlds",onClick:()=>A("tool.worlds"),children:"Tools"}),n.jsx(L,{isSelected:s==="crew.worlds",onClick:()=>A("crew.worlds"),children:"Crew"}),n.jsx(L,{isSelected:s==="arms.worlds",onClick:()=>A("arms.worlds"),children:"Weapons"})]}),n.jsxs(ce,{children:[n.jsxs(de,{children:[n.jsxs(N,{children:[n.jsx("span",{children:"Current Pool"}),n.jsxs("span",{children:[n.jsx("img",{src:"/assets/icons/credits.png",alt:"credits"}),n.jsx("span",{children:(((p==null?void 0:p.current_size)||0)+Z).toLocaleString()})]})]}),n.jsxs(N,{children:[n.jsx("span",{children:"Your mining power"}),n.jsxs("span",{children:[ee.toLocaleString()," + (",X," / day)"]})]})]}),n.jsxs(ue,{children:[n.jsxs(pe,{children:[n.jsx(Q,{onClick:()=>D("inventory"),isSelected:h==="inventory",children:"Inventory"}),n.jsx(Q,{onClick:()=>D("staked"),isSelected:h==="staked",children:"Staked"})]}),h==="inventory"&&n.jsx($,{children:Y?n.jsx(T,{children:"Loading Cards..."}):_?_==null?void 0:_.map(t=>n.jsx(W,{...t},t.asset_id)):n.jsx(T,{children:"No items found"})}),h==="staked"&&n.jsx($,{children:O?n.jsx(T,{children:"Loading Cards..."}):m?(M=m.filter(t=>t.schema===s))==null?void 0:M.map(t=>n.jsx(W,{asset_id:t.asset_id,data:{rarity:t.rarity},template:{template_id:String(t.template_id)}},t.asset_id)):n.jsx(T,{children:"No items found"})})]})]})]})]})},We=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));export{We as i,be as u};

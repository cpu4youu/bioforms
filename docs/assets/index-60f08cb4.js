import{s as I,g as K,S as f,q as P,e as Q,u as q,v as Y,R as F,_ as $,a as D,r as m,j as r}from"./index-97e1acca.js";import{o as R,a as M}from"./all-buildings-683bdaed.js";import{u as G}from"./useQuery-058656e7.js";import{u as V}from"./land-config-1f8e39b2.js";import{u as H}from"./use-transaction-82be8609.js";import{s as B}from"./sleep-da79c358.js";import{u as W}from"./index-3ecd780a.js";import{b as J}from"./constants-9b21425a.js";import"./atomic-api-26274717.js";import"./toast-options-b29c0e26.js";const X=I("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}}}),Z=async t=>await K({options:{code:f.landsAle,index_position:1,limit:"1000",scope:t,table:P.buildingcost}}),tt=t=>G({queryFn:()=>ot(t),queryKey:[Q.buildingConfigState,t],staleTime:1e3*60*60,enabled:!!q.getState().user});async function E(t){return await Y.invalidateQueries([Q.buildingConfigState,t])}async function ot(t){try{return await Z(t)}catch(o){return console.log(o),null}}async function et(t,o){const{executeTransaction:n}=H(),u=nt(t,o);return!!await n(u)}function nt(t,o){return{actions:[{account:f.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,x:o.x,y:o.y,building:o.building,level:o.level,cost_gem:o.cost_gem,cost_credits:o.cost_credits}}]}}async function st(t,o){const{executeTransaction:n}=H(),u=at(t,o);return!!await n(u)}function at(t,o){return{actions:[{account:f.landsAle,name:"boost",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,building:o.building,x:o.x,y:o.y,cost_gems:o.cost_gems,cost_credits:o.cost_credits,boost_target:o.boost_target}}]}}const z=F.lazy(()=>$(()=>import("./index-45e8bed0.js"),["assets/index-45e8bed0.js","assets/index-97e1acca.js","assets/index-55fec1ff.css"])),it=()=>{var w;const{data:t}=V(),o=q(D(s=>s.user)),{selectedLand:n,setSelectedLand:u,buildingBoost:a,selectedBuild:e,setSelectedBuild:N}=W(),{data:d}=tt((e==null?void 0:e.img)||""),[b,x]=m.useState(!1),[y,h]=m.useState(!1);async function O(){var s;if(n)try{h(!0);const i=((s=o==null?void 0:o.activestats)==null?void 0:s.gems)>=g*10,p=i?g*10:0,l=i?0:g,_={planet:n.data.planetName,x:n.data.x,y:n.data.y,building:e.building_name.toLowerCase(),boost_target:a[0]*1e4,cost_gems:p,cost_credits:l};await st(o,_)&&(await B(1e3),await R(),await E(e.building_name.toLowerCase()),await M())}catch(i){console.error(i)}finally{h(!1)}}async function U(){if(!o){console.log("User not authenticated");return}if(!n||!e){console.log("Selected land or build is not available");return}if(!c){console.log("Building cost not available");return}if(!t||!t[0]){console.log("Land configuration not available");return}if(!a||a.length===0){console.log("Building boost not available");return}try{x(!0);const s={planet:n.data.planetName,x:n.data.x,y:n.data.y,building:e.building_name.toLowerCase(),level:e!=null&&e.boost_score?(e.level||1)+1:1,cost_gem:c.cost_gem,cost_credits:c.cost_credits};await et(o,s)&&(await B(2e3),await R(),await E(e==null?void 0:e.img),await M())}catch(s){console.error(s)}finally{x(!1),u(null),N({...J[0]})}}const c=m.useMemo(()=>d==null?void 0:d.find(s=>s.building_name===e.img&&s.level===((e==null?void 0:e.level)||0)+1),[d,e]),g=m.useMemo(()=>{var S,C,j,A;const s=((S=t==null?void 0:t[0])==null?void 0:S.boost_base_cost)||0,i=((C=t==null?void 0:t[0])==null?void 0:C.boost_cost_first_percent)||0,p=(e==null?void 0:e.boost_score)||0,l=Number(((j=t==null?void 0:t[0])==null?void 0:j.boost_cost_mod)||0),_=(1-Math.pow(l,a[0]+1))/(1-l),v=(1-Math.pow(l,p/1e4+1))/(1-l),T=s+i*(_-v),L=(((A=t==null?void 0:t[0])==null?void 0:A.start_boost_score)||0)/1e4;return Math.round(T<L?L:T)},[a,t,e]),k=!!(e!=null&&e.boost_score);return r.jsx(X,{children:n&&k?r.jsxs(z,{isLoading:y,disabled:y,onClick:O,children:["Boost"," ",r.jsxs("div",{children:[g.toFixed(2),r.jsx("img",{src:"/assets/icons/credits.png",alt:"Land"})," "]})]}):r.jsxs(z,{isLoading:b,disabled:b,onClick:U,children:["Build ",e==null?void 0:e.building_name,r.jsxs("div",{children:[(w=c==null?void 0:c.cost_credits)==null?void 0:w.toLocaleString("en-US")," ",r.jsx("img",{src:"/assets/icons/credits.png",alt:"Land"})]})]})})},bt=F.memo(it);export{bt as default};

import{s as p,o as be,p as we,S as b,T as oe,Q as le,u as D,d as _e,R as ce,_ as Ce,r as m,j as t,a as se}from"./index-3ef2c8a4.js";import{u as Te}from"./index-47afcfca.js";import{u as Le}from"./inventory-query-03907467.js";import{u as pe}from"./useQuery-47f5a8b1.js";import{u as de}from"./use-transaction-05983c75.js";import{s as Ae}from"./sleep-da79c358.js";import{F as ne}from"./index-d28090f1.js";import{u as ze}from"./use-media-5328fe24.js";import"./constants-1c8f422b.js";import"./atomic-api-46ebcc3d.js";import"./toast-options-72940f32.js";const Ie=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"100%"}),Fe=p("div",{d:"flex",align:"flex-end",justify:"flex-end",gap:"10px",position:"relative",w:"100%",button:{d:"flex",align:"center",justify:"center",maxW:"188px",h:"70px",svg:{fill:"#00BAFF"},span:{d:"flex",align:"center",justify:"center",gap:"5px",color:"#828282"},img:{maxW:"35px",maxH:"30px"}},"@sm":{button:{justify:"center",gap:"2px",padding:"0",maxW:"33%",h:"45px",fs:"12px",span:{gap:"0px"},svg:{display:"none"}}}}),Re=p("div",{d:"flex",align:"flex-start",justify:"center",gap:"10px",w:"100%",">img":{mt:"10px",h:"calc(100vh - 160px)",br:"15px"}}),Se=p("div",{d:"grid",gridTemplateAreas:`
    "title title title"
    "objectivesLeft content objectivesRight"
    "objectivesLeft inventory objectivesRight"
    "objectivesLeft inventory objectivesRight"
    "objectivesLeft inventory objectivesRight"
  `,gridTemplateColumns:"1fr 5fr 1fr",gap:"20px",mt:"10px",padding:"15px 10px",bg:"#141423",br:"15px",w:"100%",minH:"calc(100vh - 160px)","@sm":{gridTemplateAreas:`
    "title title title"
    "content content content"
    "objectivesLeft objectivesLeft objectivesLeft"
    "objectivesRight objectivesRight objectivesRight"
    "inventory inventory inventory"
  `},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),ke=p("h2",{gridArea:"title",w:"100%",textAlign:"center",textTransform:"capitalize",fs:"24px",color:"#fff"}),ae=p("div",{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"5px",mb:"auto",w:"100%","&.left":{gridArea:"objectivesLeft"},"&.right":{gridArea:"objectivesRight"},"@sm":{flexDirection:"row"}}),ie=p("div",{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",w:"100%",maxW:"82px",h:"85px",padding:"5px 0px 0px",bg:"#358CAC",br:"3px",span:{color:"#fff",ff:"$heading",fs:"12px","&:first-child":{color:"#07445A",mb:"12px"}},variants:{disabled:{true:{filter:"grayscale(100%)"}}}}),re=p("div",{display:"flex",alignItems:"center",gap:"5px",mt:"auto",padding:"5px 10px",color:"#fff",ff:"$heading",fs:"14px",br:"3px",bg:"#17566D",w:"100%"}),$e=p("div",{gridArea:"content",display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"35px",w:"100%",">img":{w:"135px",h:"195px",br:"10px",objectFit:"cover"},"@sm":{gap:"10px",img:{maxW:"85px"}},"@xsm":{gap:"5px",img:{maxW:"65px"}}}),De=p("div",{gridArea:"content",img:{"&:hover":{transform:"scale(1.05)",zIndex:"4","-webkit-filter":"drop-shadow(0px 0px 8px #00BAFF)",filter:"drop-shadow(0px 0px 5px #00BAFF)"},"&:nth-of-type(1)":{transform:"translate(30px,20px) rotate(-20deg)",zIndex:"3","&:hover":{transform:"scale(1.05) translate(30px,20px) rotate(-20deg)",zIndex:"4"}},"&:nth-of-type(3)":{transform:"translate(-30px,20px) rotate(20deg)",zIndex:"1","&:hover":{transform:"scale(1.05) translate(-30px,20px) rotate(20deg)",zIndex:"4"}},"@sm":{"&:nth-of-type(1)":{transform:"translate(20px,9px) rotate(-20deg)",zIndex:"3","&:hover":{transform:"scale(1.05) translate(20px,9px) rotate(-20deg)",zIndex:"4"}},"&:nth-of-type(3)":{transform:"translate(-20px,9px) rotate(20deg)",zIndex:"1","&:hover":{transform:"scale(1.05) translate(-20px,9px) rotate(20deg)",zIndex:"4"}}}},variants:{cardSelected:{0:{img:{"&:nth-of-type(1)":{zIndex:"3"},"&:nth-of-type(2)":{opacity:"0.2"},"&:nth-of-type(3)":{opacity:"0.2"}}},1:{img:{"&:nth-of-type(1)":{opacity:"0.2"},"&:nth-of-type(2)":{},"&:nth-of-type(3)":{opacity:"0.2"}}},2:{img:{"&:nth-of-type(1)":{opacity:"0.2"},"&:nth-of-type(2)":{opacity:"0.2"},"&:nth-of-type(3)":{}}}}}}),T=p("img",{cursor:"pointer",transition:"all 0.2s ease-in-out",w:"120px",h:"170px",zIndex:"2",variants:{isSelected:{true:{filter:"grayscale(100%)"}}},"@lg":{w:"100px",h:"150px"},"@sm":{width:"80px",height:"initial"},"@xsm":{width:"70px",height:"initial"}}),He=p("div",{gridArea:"inventory",display:"flex",direction:"column",w:"100%",span:{ff:"$heading",fs:"16px",fw:"bold",color:"#fff",textAlign:"center"},"@sm":{mt:"0px"}}),Ee=p("div",{d:"flex",align:"center",justify:"center",gap:"20px",mb:"20px","@sm":{m:"0px 0 20px",gap:"10px"}}),L=p("button",{d:"flex",align:"center",justify:"center",fs:"20px",ff:"$heading",fw:"$bold",color:"$white500",variants:{isSelected:{true:{textUnderlineOffset:"0.5em",textDecoration:"underline"}}},"@sm":{fs:"14px"}}),Me=p("div",{d:"flex",flexWrap:"wrap",gap:"10px",overflow:"auto",w:"100%",maxH:"calc(100vh - 520px)"}),We=be({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Pe=p("div",{w:"120px",h:"170px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${We} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Be=async()=>{var y,w;let i=!1,s;const n=[];for(;!i;){const g=await we.get_table_rows({code:b.ADVENTURE_MC,index_position:1,limit:"10000",scope:b.ADVENTURE_MC,table:oe.ADV_TEMPLATES,show_payer:!1,json:!0,lower_bound:s});i=!g.more,n.push(...g.rows.slice(0,-1)),s=((w=(y=g.rows)==null?void 0:y[g.rows.length-1])==null?void 0:w.templateid)??""}return n},Ne=()=>pe({queryKey:[le.tavernDataState],queryFn:()=>Oe(),staleTime:1e3*60*60,enabled:!!D.getState().user});async function Oe(){try{const i=await Be();return i?Qe(i):null}catch(i){return console.log(i),null}}function Qe(i){return i.map(s=>({...s,"nft.mp":s.nft_mp,"tlm.mp":s.tlm_mp}))}const Ue=async()=>await _e({options:{code:b.tavernAle,index_position:1,limit:"1000",scope:b.tavernAle,table:oe.CONFIG}}),Ve=()=>pe({queryKey:[le.tavernConfigState],queryFn:()=>qe(),staleTime:1e3*60*60,enabled:!!D.getState().user});async function qe(){try{const i=await Ue();return i||null}catch(i){return console.log(i),null}}async function Ke(i,s){const{executeTransaction:n}=de(),y=Ye(i,s);return!!await n(y)}function Ye(i,s){return{actions:[{account:b.tavernAle,name:"reveal",authorization:[{actor:i.name,permission:i.authorization.permission}],data:{wallet:i.name,use_gems:s}}]}}async function Ge(i){const{executeTransaction:s}=de(),n=Je(i);return!!await s(n)}function Je(i){return{actions:[{account:b.tavernAle,name:"travel",authorization:[{actor:i.name,permission:i.authorization.permission}],data:{wallet:i.name}}]}}const $=ce.lazy(()=>Ce(()=>import("./index-4a690c72.js"),["assets/index-4a690c72.js","assets/index-3ef2c8a4.js","assets/index-55fec1ff.css"])),Xe=()=>{var Q,U,V,q,K,Y,G,J,X,Z,ee,te;const{setAreaSelected:i,areaSelected:s}=Te(),{user:n,updatePlayerData:y}=D(),{isSmall:w}=ze(),[g,_]=m.useState("level.worlds"),[h,j]=m.useState(0),[v,xe]=m.useState({}),[d,H]=m.useState([void 0,void 0,void 0]),[E,M]=m.useState(!1),[W,P]=m.useState(!1),[z,A]=m.useState(!1),[I,fe]=m.useState(!1),{data:F,isLoading:ue}=Le(g),{data:R}=Ne(),{data:l}=Ve();function ge(){i(null)}function me(e){return d.some(a=>(a==null?void 0:a.asset_id)!==e.asset_id)}function S(e){if(e===h){j(-1);return}j(e)}function B(e){if(!e){const r=d.map((o,x)=>{if(x!==h)return o});N(r),j(h+1),H(r);return}if(d.some(r=>(r==null?void 0:r.asset_id)===(e==null?void 0:e.asset_id))){j(-1);return}const a=d.map((r,o)=>o===h?e:r);N(a),j(h+1),H(a),h===2&&j(-1)}function N(e){let a={};e.forEach(r=>{const o=R==null?void 0:R.find(u=>(u==null?void 0:u.templateid)===Number(r==null?void 0:r.template.template_id));if(!o||!(s!=null&&s.objectives))return;const x=s.objectives.reduce((u,c,k)=>{if(c.objective_value!==99999&&c.objective_value===(o==null?void 0:o[c.objective_type])){const C=c==null?void 0:c.mod_value;return u[k]=C,u}if(c.objective_type==="element"&&(c.objective_string.toLocaleLowerCase()===(o==null?void 0:o.element.toLocaleLowerCase())||c.objective_string.toLocaleLowerCase()===(o==null?void 0:o.weaponclass.toLocaleLowerCase()))){const C=c==null?void 0:c.mod_value;return u[k]=C,u}if(c.objective_string!=="-"&&c.objective_string.toLocaleLowerCase()===String(o==null?void 0:o[c.objective_type]).toLocaleLowerCase()){const C=c==null?void 0:c.mod_value;return u[k]=C,u}return u},{});a={...a,...x}}),xe(a)}function O(){var e,a,r,o,x,u;return!l||!n?null:((e=n==null?void 0:n.activestats)==null?void 0:e.gems)>=((a=l==null?void 0:l[0])==null?void 0:a.cost_reveal_gem)?(r=l==null?void 0:l[0])==null?void 0:r.cost_reveal_gem:((o=n==null?void 0:n.activestats)==null?void 0:o.credits)>=((x=l==null?void 0:l[0])==null?void 0:x.cost_reveal_credits)?(u=l==null?void 0:l[0])==null?void 0:u.cost_reveal_credits:null}async function he(e){if(f){A(!0),fe(!I);return}if(n){M(!0);try{await Ke(n,e)&&(await Ae(2e3),await y(),se.success("Reveal success"))}catch{}finally{M(!1)}}}async function ve(){if(n){P(!0);try{await Ge(n)&&se.success("Hire success")}catch{}finally{P(!1)}}}function ye(){var a;const e=new Array(10).fill(0).map((r,o)=>o).reduce((r,o,x)=>v[x]?r+=v[x]:r,0);return(((a=l==null?void 0:l[0])==null?void 0:a.cost_hire_ap)||0)-e}const je=m.useMemo(()=>{var e;return(e=n==null?void 0:n.active_taverns)==null?void 0:e.some(a=>a.x===(s==null?void 0:s.x)&&a.y===(s==null?void 0:s.y))},[n,s]),f=m.useMemo(()=>{var e,a;if(((e=n==null?void 0:n.last_tavern)==null?void 0:e.x)===(s==null?void 0:s.x)&&((a=n==null?void 0:n.last_tavern)==null?void 0:a.y)===(s==null?void 0:s.y))return n==null?void 0:n.last_tavern_fighter},[n,s]);return t.jsxs(Ie,{children:[t.jsxs(Fe,{children:[!je&&t.jsxs($,{disabled:W,isLoading:W,color:"black",onClick:ve,children:["Hire",t.jsxs("span",{children:[ye(),t.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]}),t.jsx($,{color:"black",isLoading:E,onClick:()=>{var e,a;return he((((e=n==null?void 0:n.activestats)==null?void 0:e.gems)||0)>=(((a=l==null?void 0:l[0])==null?void 0:a.cost_reveal_gem)||0))},disabled:O()===null||E,children:f?"Details":t.jsxs(t.Fragment,{children:["Reveal",t.jsxs("span",{children:[O(),t.jsx("img",{loading:"lazy",src:"/assets/icons/dust.png",alt:""})]})]})}),t.jsx($,{color:"black",onClick:ge,children:"Back"})]}),t.jsxs(Re,{children:[t.jsxs(Se,{isHidden:z,children:[t.jsx(ke,{children:f?`${f.racename} ${f.classname}`:"Unknown Fighter"}),t.jsx(ae,{className:"left",children:(Q=s==null?void 0:s.objectives)==null?void 0:Q.slice(0,5).map(({objective_string:e,objective_type:a,objective_value:r,mod_value:o},x)=>t.jsxs(ie,{disabled:!(v!=null&&v[x]),children:[t.jsx("span",{children:a}),t.jsx("span",{children:e==="-"?r:e}),t.jsxs(re,{children:[o,t.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]},x))}),t.jsxs($e,{children:[f?t.jsx("img",{onClick:()=>A(!0),src:`/assets/tavern/${f.racename}_${f.classname}.jpeg`,alt:"",loading:"lazy"}):t.jsx("img",{loading:"lazy",src:"/assets/tavern/default-avatar.jpg",alt:""}),t.jsxs(De,{cardSelected:h,children:[t.jsx(T,{onClick:()=>S(0),loading:"lazy",src:d[0]?`/assets/aw-nft-images/${(U=d[0])==null?void 0:U.template.template_id}.webp`:"/assets/default-card.png",alt:(q=(V=d[0])==null?void 0:V.data)==null?void 0:q.name}),t.jsx(T,{onClick:()=>S(1),loading:"lazy",src:d[1]?`/assets/aw-nft-images/${(K=d[1])==null?void 0:K.template.template_id}.webp`:"/assets/default-card.png",alt:(G=(Y=d[1])==null?void 0:Y.data)==null?void 0:G.name}),t.jsx(T,{onClick:()=>S(2),loading:"lazy",src:d[2]?`/assets/aw-nft-images/${(J=d[2])==null?void 0:J.template.template_id}.webp`:"/assets/default-card.png",alt:(Z=(X=d[2])==null?void 0:X.data)==null?void 0:Z.name})]})]}),t.jsx(He,{children:d.length!==0&&h===-1?t.jsx("span",{children:"Select a card"}):t.jsxs(t.Fragment,{children:[t.jsxs(Ee,{children:[t.jsx(L,{isSelected:g==="crew.worlds",onClick:()=>_("crew.worlds"),children:"Minions"}),t.jsx(L,{isSelected:g==="arms.worlds",onClick:()=>_("arms.worlds"),children:"Weapons"}),t.jsx(L,{isSelected:g==="tool.worlds",onClick:()=>_("tool.worlds"),children:"Tools"}),t.jsx(L,{isSelected:g==="level.worlds",onClick:()=>_("level.worlds"),children:"Levels"}),t.jsx(L,{isSelected:g==="faces.worlds",onClick:()=>_("faces.worlds"),children:"Avatars"})]}),t.jsx(Me,{children:ue?new Array(10).fill(0).map((e,a)=>t.jsx(Pe,{},a)):t.jsxs(t.Fragment,{children:[t.jsx(T,{onClick:()=>B(void 0),src:"/assets/default-card.png",alt:"default card"}),(ee=F==null?void 0:F.filter(me))==null?void 0:ee.map(e=>{var a;return t.jsx(T,{isSelected:d.some(r=>(r==null?void 0:r.asset_id)===(e==null?void 0:e.asset_id)),onClick:()=>B(e),loading:"lazy",src:`/assets/aw-nft-images/${e==null?void 0:e.template.template_id}.webp`,alt:(a=e==null?void 0:e.data)==null?void 0:a.name},e==null?void 0:e.asset_id)})]})})]})}),t.jsx(ae,{className:"right",children:(te=s==null?void 0:s.objectives)==null?void 0:te.slice(5,10).map(({objective_string:e,objective_type:a,objective_value:r,mod_value:o},x)=>t.jsxs(ie,{disabled:!(v!=null&&v[x+5]),children:[t.jsx("span",{children:a}),t.jsx("span",{children:e==="-"?r:e}),t.jsxs(re,{children:[o,t.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]},x))})]}),I&&f?t.jsx(ne,{isHidden:!z,selectedFighter:f,setSelectedFighter:e=>A(!!e)}):!I&&f?w?t.jsx(ne,{isHidden:!z,selectedFighter:f,setSelectedFighter:e=>A(!!e)}):t.jsx("img",{src:`/assets/tavern/${f.racename}_${f.classname}.jpeg`,alt:"",loading:"lazy"}):t.jsx("img",{src:"/assets/tavern/unknown-fighter.jpeg",alt:"",loading:"lazy"})]})]})},pt=ce.memo(Xe);export{pt as default};

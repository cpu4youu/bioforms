import{s as p,R as z,_ as k,u as W,a as L,b as B,r as g,j as c}from"./index-7c133604.js";import{b as D,u as P}from"./weather-query-6d211327.js";import{u as O}from"./landtranking-query-179578ea.js";import"./useQuery-fad1acaf.js";import"./sleep-da79c358.js";const Q=p("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),V=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),X=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"center",justifyContent:"center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423",backgroundImage:"url(/assets/background/bg-fight.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",variants:{isResult:{true:{backgroundImage:"url(/assets/background/bg-result.png)"}}}}),Y=p("div",{gridArea:"main",zIndex:2,d:"flex",justify:"center",direction:"column",w:"100%",maxW:"1360px",h:"calc(100vh - 350px)"}),K=p("h3",{d:"flex",justify:"center",align:"center",gap:"10px",zIndex:2,textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),N=p("span",{textAlign:"center",w:"100%",mx:"auto",zIndex:2,fontSize:"58px",ff:"$heading",fw:"bold",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),q=p("div",{d:"flex",justify:"space-between",align:"center","@lg":{mt:"10px",gap:"15px",direction:"column"}}),G=p("div",{d:"flex",ml:"auto",">div":{"&:nth-child(1)":{marginTop:"60px",marginRight:"-120px",zIndex:2},"&:nth-child(2)":{marginLeft:"80px",marginTop:"-40px",zIndex:1},"&:nth-child(3)":{marginLeft:"-100px",marginTop:"90px",marginRight:"-35px",zIndex:2},"&:nth-child(4)":{marginRight:"-50px",marginTop:"20px",zIndex:1},"&:nth-child(5)":{marginTop:"120px",zIndex:1}}}),J=p("div",{d:"flex",align:"center",direction:"column",">span":{color:"#E1CAFF",fw:"bold",ff:"$heading",fs:"22px"}}),U=p("div",{d:"flex",mx:"auto",">div":{transform:"scaleX(-1)","&:nth-child(1)":{marginTop:"60px",marginRight:"-120px",zIndex:2},"&:nth-child(2)":{marginLeft:"80px",marginTop:"-40px",zIndex:1},"&:nth-child(3)":{marginLeft:"-100px",marginTop:"90px",marginRight:"-35px",zIndex:2},"&:nth-child(4)":{marginRight:"-60px",marginTop:"20px",zIndex:1},"&:nth-child(5)":{marginTop:"120px",zIndex:1}}});p("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"});p("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}});p("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}});p("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}});p("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{img:{scale:"3.2",translate:"-5px 10px"}}}}});p("div",{d:"flex",justify:"center",align:"center",direction:"column",gap:"20px",mt:"40px",img:{height:235,width:235,objectFit:"contain"}});p("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});p("div",{d:"flex",justify:"center",align:"center",width:"23%"});p("div",{d:"flex",justify:"center",align:"center",direction:"column",textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",img:{height:80,width:80,objectFit:"contain"}});p("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});function Z(u){const f=[];for(;u.filter(l=>l.team===1&&l.health>0).length>0&&u.filter(l=>l.team===2&&l.health>0).length>0;){const l=u.filter(t=>t.health>0),x=l.reduce((t,h)=>h.initiative<t.initiative?h:t),T=x.team===1?2:1,v=l.filter(t=>t.team===T);if(v.length===0)return;const s=v.reduce((t,h)=>h.taunt>t.taunt?h:t),i=`res_${x.element}`,b=s[i]/10,e=x.damage*(100-b)/100,j=e*100/x.damage;f.push({attacker:x,defender:s,attack:e,attackerHealthBefore:x.health,attackerTeam:x.team,defenderTeam:s.team,defenderTauntBefore:s.taunt,defenderHealthBefore:s.health,effectiveness:j}),s.health-=e,s.taunt=Math.max(0,s.taunt-10),x.initiative+=x.attackspeed}return f}const R=z.lazy(()=>k(()=>import("./index-36b5d866.js"),["assets/index-36b5d866.js","assets/index-7c133604.js","assets/index-55fec1ff.css","assets/index-933f5374.js"])),E=z.lazy(()=>k(()=>import("./index-0e642afa.js"),["assets/index-0e642afa.js","assets/index-7c133604.js","assets/index-55fec1ff.css"])),y=z.lazy(()=>k(()=>import("./index-24c0abef.js"),["assets/index-24c0abef.js","assets/index-7c133604.js","assets/index-55fec1ff.css","assets/index-36b5d866.js","assets/index-933f5374.js","assets/use-transaction-9bada44c.js","assets/toast-options-5ed5e9a1.js","assets/sleep-da79c358.js"])),ie=({historyId:u})=>{const f=W(L(n=>n.user)),{areaSelected:l,setAreaSelected:x}=B(),{data:T}=O((f==null?void 0:f.planet)||"",(l==null?void 0:l.landId)||""),{data:v}=D(u),{data:s}=P(f.planet,(T==null?void 0:T.weather_id)||""),w=g.useRef(null),[i,b]=g.useState(),[e,j]=g.useState([]),[t,h]=g.useState(0),[C,I]=g.useState(!1),[_,S]=g.useState({});function F(){x(null)}function M(){if(!i)return;h(e.length);const n={},o=i.team1_fighters.map(a=>({...a,team:1})),r=i.team2_fighters.map(a=>({...a,team:2}));[...o,...r].forEach(a=>{n[`${a.fighter_id}-${a.team}`]=a.health}),e.forEach(a=>{n[`${a.defender.fighter_id}-${a.defenderTeam}`]=a.defender.health}),S(n),I(!0)}return g.useEffect(()=>{b(v??void 0)},[v]),g.useEffect(()=>{if(i!=null&&i.team1_fighters&&(i!=null&&i.team2_fighters)){const n=i.team1_fighters.map(m=>({...m,team:1})),o=i.team2_fighters.map(m=>({...m,team:2})),r={},d=[...n,...o];d.forEach(m=>{r[`${m.fighter_id}-${m.team}`]=m.health}),S(r);const a=Z(d);j(a||[]),h(0)}},[i,l]),g.useEffect(()=>{if(e.length===0)return;const n=setTimeout(()=>{var m,$,A;const o=(m=e==null?void 0:e[t])==null?void 0:m.attack,r=($=e==null?void 0:e[t])==null?void 0:$.defender,d=(A=e==null?void 0:e[t])==null?void 0:A.defenderTeam;_[`${r==null?void 0:r.fighter_id}-${d}`]!==void 0&&S({..._,[`${r==null?void 0:r.fighter_id}-${d}`]:Math.max(0,_[`${r==null?void 0:r.fighter_id}-${d}`]-o)});const a=t+1;h(a)},1e3);return t>e.length&&(I(!0),clearTimeout(n)),()=>clearTimeout(n)},[e,t,_]),g.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[t]),c.jsxs(Q,{children:[c.jsx(V,{children:C?c.jsx(R,{onClick:F,children:"Back"}):c.jsx(R,{onClick:M,children:"Skip Fight"})}),c.jsx(X,{isResult:C,children:C?c.jsx(y,{data:v,historyId:u}):c.jsxs(c.Fragment,{children:[c.jsxs(K,{children:[c.jsx("img",{src:"/assets/icons/weather.png",alt:""}),s==null?void 0:s.displayname]}),c.jsx(N,{children:"SHRIMPS ARENA"}),c.jsx(Y,{children:c.jsxs(q,{children:[c.jsx(G,{children:i==null?void 0:i.team1_fighters.map(n=>{var o,r,d,a;return c.jsx(E,{isAttacking:((o=e==null?void 0:e[t])==null?void 0:o.attackerTeam)===1&&((r=e==null?void 0:e[t])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((d=e==null?void 0:e[t])==null?void 0:d.defenderTeam)===1&&((a=e==null?void 0:e[t])==null?void 0:a.defender.fighter_id)===n.fighter_id,fighter:{...n,health:_[`${n.fighter_id}-1`]}},n.fighter_id)})}),c.jsx(U,{children:i==null?void 0:i.team2_fighters.map(n=>{var o,r,d,a;return c.jsxs(J,{children:[c.jsx(E,{isAttacking:((o=e==null?void 0:e[t])==null?void 0:o.attackerTeam)===2&&((r=e==null?void 0:e[t])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((d=e==null?void 0:e[t])==null?void 0:d.defenderTeam)===2&&((a=e==null?void 0:e[t])==null?void 0:a.defender.fighter_id)===n.fighter_id,fighter:{...n,health:_[`${n.fighter_id}-2`]}}),c.jsx("span",{children:"AI"})]},n.fighter_id)})})]})})]})})]})};export{ie as default};

import{s as O,g as K,S as x,v as P,e as D,u as F,q as Y,R as Q,_ as $,a as G,r as p,j as a,Q as V}from"./index-176ffc21.js";import{u as W,o as B}from"./land-config-7c904250.js";import{o as E}from"./all-buildings-1b850b5e.js";import{u as J}from"./useQuery-eb758be5.js";import{u as N}from"./use-transaction-471f0de8.js";import{s as M}from"./sleep-da79c358.js";import{u as X}from"./index-892ee6ee.js";import{b as Z}from"./constants-b95c644e.js";import"./atomic-api-68fa82cd.js";import"./toast-options-aff9643e.js";const tt=O("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%","&.destroy":{borderColor:"#9E475D"},div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}}}),ot=async t=>await K({options:{code:x.landsAle,index_position:1,limit:"1000",scope:t,table:P.buildingcost}}),st=t=>J({queryFn:()=>et(t),queryKey:[D.buildingConfigState,t],staleTime:1e3*60*60,enabled:!!F.getState().user});async function z(t){return await Y.invalidateQueries([D.buildingConfigState,t])}async function et(t){try{return await ot(t)}catch(o){return console.log(o),null}}async function nt(t,o){const{executeTransaction:e}=N(),u=at(t,o);return!!await e(u)}function at(t,o){return{actions:[{account:x.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,x:o.x,y:o.y,building:o.building,level:o.level,cost_gem:o.cost_gem,cost_credits:o.cost_credits}}]}}async function it(t,o){const{executeTransaction:e}=N(),u=rt(t,o);return!!await e(u)}function rt(t,o){return{actions:[{account:x.landsAle,name:"boost",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,building:o.building,x:o.x,y:o.y,cost_gems:o.cost_gems,cost_credits:o.cost_credits,boost_target:o.boost_target}}]}}const f=Q.lazy(()=>$(()=>import("./index-4ccdf400.js"),["assets/index-4ccdf400.js","assets/index-176ffc21.js","assets/index-55fec1ff.css","assets/index-ba842aa2.js"])),ct=()=>{var v;const{data:t}=W(),o=F(G(n=>n.user)),{selectedLand:e,setSelectedLand:u,buildingBoost:i,selectedBuild:s,setSelectedBuild:q,setIsDestroying:H}=X(),{data:d}=st((s==null?void 0:s.img)||""),[y,h]=p.useState(!1),[g,w]=p.useState(!1);async function U(){var n;if(e)try{w(!0);const r=((n=o==null?void 0:o.activestats)==null?void 0:n.gems)>=m*10,_=r?m*10:0,l=r?0:m,b={planet:e.data.planetName,x:e.data.x,y:e.data.y,building:s.building_name.toLowerCase(),boost_target:i[0]*1e4,cost_gems:_,cost_credits:l};await it(o,b)&&(await M(1e3),await B(),await z(s.building_name.toLowerCase()),await E())}catch(r){console.error(r)}finally{w(!1)}}async function k(){if(!o){console.log("User not authenticated");return}if(!e||!s){console.log("Selected land or build is not available");return}if(!c){console.log("Building cost not available");return}if(!t||!t[0]){console.log("Land configuration not available");return}if(!i||i.length===0){console.log("Building boost not available");return}try{h(!0);const n={planet:e.data.planetName,x:e.data.x,y:e.data.y,building:s.building_name.toLowerCase(),level:s!=null&&s.boost_score?(s.level||1)+1:1,cost_gem:c.cost_gem,cost_credits:c.cost_credits};await nt(o,n)&&(await M(2e3),await B(),await z(s==null?void 0:s.img),await E(),V.success("Building constructed"))}catch(n){console.error(n)}finally{h(!1),u(null),q({...Z[0]})}}const c=p.useMemo(()=>d==null?void 0:d.find(n=>n.building_name===s.img&&n.level===((s==null?void 0:s.level)||0)+1),[d,s]),m=p.useMemo(()=>{var C,j,A,R;const n=((C=t==null?void 0:t[0])==null?void 0:C.boost_base_cost)||0,r=((j=t==null?void 0:t[0])==null?void 0:j.boost_cost_first_percent)||0,_=(s==null?void 0:s.boost_score)||0,l=Number(((A=t==null?void 0:t[0])==null?void 0:A.boost_cost_mod)||0),b=(1-Math.pow(l,i[0]+1))/(1-l),T=(1-Math.pow(l,_/1e4+1))/(1-l),S=n+r*(b-T),L=(((R=t==null?void 0:t[0])==null?void 0:R.start_boost_score)||0)/1e4;return Math.round(S<L?L:S)},[i,t,s]),I=!!(s!=null&&s.boost_score_update);return a.jsx(tt,{children:e&&(I?a.jsxs(a.Fragment,{children:[a.jsx(f,{className:"destroy",isLoading:g,disabled:g,onClick:()=>H(!0),children:"Destroy Building"}),a.jsxs(f,{isLoading:g,disabled:g,onClick:U,children:["Boost"," ",a.jsxs("div",{children:[m.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),a.jsx("img",{src:"/assets/icons/credits.png",alt:"credits",loading:"lazy"})," "]})]})]}):a.jsxs(f,{isLoading:y,disabled:y,onClick:k,children:["Build ",s==null?void 0:s.building_name,a.jsxs("div",{children:[(v=c==null?void 0:c.cost_credits)==null?void 0:v.toLocaleString("en-US")," ",a.jsx("img",{src:"/assets/icons/credits.png",alt:"credits",loading:"lazy"})]})]}))})},yt=Q.memo(ct);export{yt as default};

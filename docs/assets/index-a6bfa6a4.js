import{s as k,g as B,S as b,t as I,e as F,u as H,w as K,R as N,_ as P,a as Y,r as d,j as c}from"./index-a1092551.js";import{o as R,a as E}from"./all-buildings-bc94da81.js";import{u as D}from"./useQuery-072b8a1e.js";import{u as G}from"./land-config-74189d33.js";import{u as U}from"./use-transaction-7a354d21.js";import{s as M}from"./sleep-da79c358.js";import{u as V}from"./index-06306c24.js";import{f as W}from"./constants-308cd0ac.js";import"./atomic-api-0a3c64be.js";import"./toast-options-6515d5a6.js";const J=k("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),X=async t=>await B({options:{code:b.landsAle,index_position:1,limit:"1000",scope:t,table:I.buildingcost}}),Z=t=>D({queryFn:()=>tt(t),queryKey:[F.buildingConfigState,t],staleTime:1e3*60*60,enabled:!!H.getState().user});async function z(t){return await K.invalidateQueries([F.buildingConfigState,t])}async function tt(t){try{return await X(t)}catch(n){return console.log(n),null}}async function ot(t,n){const{executeTransaction:e}=U(),u=nt(t,n);return!!await e(u)}function nt(t,n){return{actions:[{account:b.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:n.planet,x:n.x,y:n.y,building:n.building,level:n.level,cost_gem:n.cost_gem,cost_credits:n.cost_credits}}]}}async function et(t,n){const{executeTransaction:e}=U(),u=st(t,n);return!!await e(u)}function st(t,n){return{actions:[{account:b.landsAle,name:"boost",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:n.planet,building:n.building,x:n.x,y:n.y,cost_gem:n.cost_gem,cost_credits:n.cost_credits,boost_target:n.boost_target}}]}}const Q=N.lazy(()=>P(()=>import("./index-5ec8eea0.js"),["assets/index-5ec8eea0.js","assets/index-a1092551.js","assets/index-55fec1ff.css"])),at=()=>{var h;const{data:t}=G(),n=H(Y(s=>s.user)),{selectedLand:e,setSelectedLand:u,buildingBoost:a,selectedBuild:o,setSelectedBuild:$}=V(),{data:g}=Z((o==null?void 0:o.building_name)||""),[f,x]=d.useState(!1),[y,w]=d.useState(!1);async function q(){var s;if(e)try{w(!0);const r=((s=n==null?void 0:n.activestats)==null?void 0:s.gems)>=m*10,p=r?m*10:0,l=r?0:m,_={planet:e.data.planetName,x:e.data.x,y:e.data.y,building:o.building_name.toLowerCase(),boost_target:a[0],cost_gem:p,cost_credits:l};await et(n,_)&&(await M(1e3),await R(),await z(o.building_name.toLowerCase()),await E())}catch(r){console.error(r)}finally{w(!1)}}async function O(){if(!n){console.log("User not authenticated");return}if(!e||!o){console.log("Selected land or build is not available");return}if(!i){console.log("Building cost not available");return}if(!t||!t[0]){console.log("Land configuration not available");return}if(!a||a.length===0){console.log("Building boost not available");return}try{x(!0);const s={planet:e.data.planetName,x:e.data.x,y:e.data.y,building:o.building_name.toLowerCase(),level:o!=null&&o.boost_score?(o.level||1)+1:1,cost_gem:i.cost_gem,cost_credits:i.cost_credits};await ot(n,s)&&(await M(2e3),await R(),await z(o==null?void 0:o.img),await E())}catch(s){console.error(s)}finally{x(!1),u(null),$({...W[0],index:0})}}const i=d.useMemo(()=>g==null?void 0:g.find(s=>s.building_name===o.building_name&&s.level===((o==null?void 0:o.level)||0)+1),[g,o]),m=d.useMemo(()=>{var S,j,C,A;const s=((S=t==null?void 0:t[0])==null?void 0:S.boost_base_cost)||0,r=((j=t==null?void 0:t[0])==null?void 0:j.boost_cost_first_percent)||0,p=(o==null?void 0:o.boost_score)||0,l=Number(((C=t==null?void 0:t[0])==null?void 0:C.boost_cost_mod)||0),_=(1-Math.pow(l,a[0]+1))/(1-l),v=(1-Math.pow(l,p/1e4+1))/(1-l),T=s+r*(_-v),L=(((A=t==null?void 0:t[0])==null?void 0:A.start_boost_score)||0)/1e4;return T<L?L:T},[a,t,o]);return c.jsxs(J,{children:[e&&!!(o!=null&&o.boost_score)&&c.jsxs(Q,{isLoading:y,disabled:y,onClick:q,children:["Boost"," ",c.jsxs("div",{children:[m.toFixed(2),c.jsx("img",{src:"/assets/icons/gems.png",alt:"Land"})," "]})]}),e&&!!i&&c.jsxs(Q,{isLoading:f,disabled:f,onClick:O,children:[o!=null&&o.boost_score?`Upgrade ${o==null?void 0:o.building_name}`:`Build ${o==null?void 0:o.building_name}`,c.jsxs("div",{children:[(h=i==null?void 0:i.cost_gem)==null?void 0:h.toLocaleString("en-US")," ",c.jsx("img",{src:"/assets/icons/gems.png",alt:"Land"})]})]})]})},bt=N.memo(at);export{bt as default};

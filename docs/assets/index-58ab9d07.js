import{s as U,g as $,S as _,q as k,d as Q,u as q,v as I,R as K,_ as O,r as m,j as c}from"./index-d4e28a8d.js";import{o as A,a as R}from"./all-buildings-da5d10f5.js";import{u as P}from"./useQuery-377f8c3c.js";import{u as Y}from"./land-config-8009df84.js";import{u as F}from"./use-transaction-4865d7b7.js";import{s as E}from"./sleep-da79c358.js";import{u as D}from"./index-4830c2a0.js";import"./atomic-api-1783db37.js";import"./toast-options-90575795.js";import"./constants-308cd0ac.js";const G=U("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),V=async o=>await $({options:{code:_.landsAle,index_position:1,limit:"1000",scope:o,table:k.buildingcost}}),W=o=>P({queryFn:()=>B(o),queryKey:[Q.buildingConfigState,o],staleTime:1e3*60*60,enabled:!!q.getState().user});async function M(o){return await I.invalidateQueries([Q.buildingConfigState,o])}async function B(o){try{return await V(o)}catch(n){return console.log(n),null}}async function J(o,n){const{executeTransaction:s}=F(),a=X(o,n);return!!await s(a)}function X(o,n){return{actions:[{account:_.landsAle,name:"build",authorization:[{actor:o.name,permission:o.authorization.permission}],data:{wallet:o.name,planet:n.planet,x:n.x,y:n.y,building:n.building,level:n.level,cost_gem:n.cost_gem,cost_credits:n.cost_credits}}]}}async function Z(o,n){const{executeTransaction:s}=F(),a=tt(o,n);return!!await s(a)}function tt(o,n){return{actions:[{account:_.landsAle,name:"boost",authorization:[{actor:o.name,permission:o.authorization.permission}],data:{wallet:o.name,planet:n.planet,building:n.building,x:n.x,y:n.y,cost_gem:n.cost_gem,cost_credits:n.cost_credits,boost_target:n.boost_target}}]}}const z=K.lazy(()=>O(()=>import("./index-70c9800a.js"),["assets/index-70c9800a.js","assets/index-d4e28a8d.js","assets/index-55fec1ff.css"])),gt=()=>{var w;const{data:o}=Y(),n=q(e=>e.user),{selectedLand:s,buildingBoost:a,selectedBuild:t}=D(),{data:u}=W((t==null?void 0:t.img)||""),[b,f]=m.useState(!1),[x,y]=m.useState(!1);async function H(){var e;if(s)try{y(!0);const r=((e=n==null?void 0:n.activestats)==null?void 0:e.gems)>=g*10,p=r?g*10:0,l=r?0:g,d={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:t.building_name.toLowerCase(),boost_target:a[0],cost_gem:p,cost_credits:l};await Z(n,d)&&(await E(1e3),await A(),await M(t.building_name.toLowerCase()),await R())}catch(r){console.error(r)}finally{y(!1)}}async function N(){if(!n){console.log("User not authenticated");return}if(!s||!t){console.log("Selected land or build is not available");return}if(!i){console.log("Building cost not available");return}if(!o||!o[0]){console.log("Land configuration not available");return}if(!a||a.length===0){console.log("Building boost not available");return}try{f(!0);const e={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:t.building_name.toLowerCase(),level:t!=null&&t.boost_score?(t.level||1)+1:1,cost_gem:i.cost_gem,cost_credits:i.cost_credits};await J(n,e)&&(await E(1e3),await A(),await M(t==null?void 0:t.img),await R())}catch(e){console.error(e)}finally{f(!1)}}const i=m.useMemo(()=>u==null?void 0:u.find(e=>e.building_name===t.img&&e.level===((t==null?void 0:t.level)||0)+1),[u,t]),g=m.useMemo(()=>{var L,S,j,C;const e=((L=o==null?void 0:o[0])==null?void 0:L.boost_base_cost)||0,r=((S=o==null?void 0:o[0])==null?void 0:S.boost_cost_first_percent)||0,p=(t==null?void 0:t.boost_score)||0,l=Number(((j=o==null?void 0:o[0])==null?void 0:j.boost_cost_mod)||0),d=(1-Math.pow(l,a[0]+1))/(1-l),h=(1-Math.pow(l,p/1e4+1))/(1-l),v=e+r*(d-h),T=(((C=o==null?void 0:o[0])==null?void 0:C.start_boost_score)||0)/1e4;return v<T?T:v},[a,o,t]);return c.jsxs(G,{children:[s&&!!(t!=null&&t.boost_score)&&c.jsxs(z,{isLoading:x,disabled:x,onClick:H,children:["Boost"," ",c.jsxs("div",{children:[g.toFixed(2),c.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})," "]})]}),s&&!!i&&c.jsxs(z,{isLoading:b,disabled:b,onClick:N,children:[t!=null&&t.boost_score?`Upgrade ${t==null?void 0:t.building_name}`:`Build ${t==null?void 0:t.building_name}`,c.jsxs("div",{children:[(w=i==null?void 0:i.cost_gem)==null?void 0:w.toLocaleString("en-US")," ",c.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})]})]})]})};export{gt as default};

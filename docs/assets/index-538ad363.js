import{s as p,g as le,S as h,e as oe,u as R,R as D,_ as P,a as $,r as l,j as n,Q as w}from"./index-78dc7b1e.js";import{s as ce}from"./shimmer-78d15c7c.js";import{u as de,o as A}from"./fighters-query-8286655b.js";import{u as ue}from"./index-776b06b1.js";import{u as pe,F as me}from"./index-721462f5.js";import{u as xe}from"./useQuery-0b74c68b.js";import{s as k}from"./sleep-da79c358.js";import{u as E}from"./use-transaction-7fcf6795.js";const ge=p("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{gridTemplateAreas:`
          "empty empty header"
          "main main side"
        `,"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),fe=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),he=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",direction:"column",position:"relative",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@xmd":{display:"none"}}}},"@xmd":{mt:"30px"}}),_e=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",width:"100%",height:"100%",flexWrap:"wrap",overflowY:"auto"}),ve=p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-35px",left:"0px"}),N=p("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:first-child":{br:"8px 0px 0px 0px"},"&:last-child":{br:"0 8px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}});p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"});p("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}});const ye=p("div",{display:"none",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{display:"flex"},false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"}}),be=p("div",{h:"175px",w:"395px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${ce} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Se=p("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),Fe=async()=>await le({options:{code:h.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:h.battleAle,table:"levels"}}),Ce=()=>xe({queryKey:[oe.levelsState],queryFn:()=>je(),staleTime:1e3*60*60,enabled:!!R.getState().user});async function je(){try{return await Fe()}catch(s){return console.log(s),null}}async function Te(s,o){const{executeTransaction:r}=E(),a=we(s,o);return!!await r(a)}function we(s,{cost_credits:o,cost_gems:r,fighter_ids:a}){return{actions:[{account:h.battleAle,name:"levelup",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_ids:a,cost_gems:r,cost_credits:o}}]}}async function Ae(s,o){const{executeTransaction:r}=E(),a=ke(s,o);return!!await r(a)}function ke(s,{fighter_id:o}){return{actions:[{account:h.battleAle,name:"payday",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_id:o}}]}}async function Le(s,o){const{executeTransaction:r}=E(),a=Re(s,o);return!!await r(a)}function Re(s,{fighter_ids:o}){return{actions:[{account:h.battleAle,name:"sellfighter",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_ids:o}}]}}const De=[{label:"Level",value:"level"},{label:"Health",value:"health_max"},{label:"Damage",value:"damage_max"},{label:"Initiative",value:"initiative_max"},{label:"Attack Speed",value:"attackspeed_max"},{label:"Taunt",value:"taunt_max"},{label:"Res Fire",value:"res_fire"},{label:"Res Gem",value:"res_gem"},{label:"Res Neutral",value:"res_neutral"},{label:"Res Nature",value:"res_nature"},{label:"Res Air",value:"res_air"},{label:"Res Metal",value:"res_metal"}],L=D.lazy(()=>P(()=>import("./index-392c3423.js"),["assets/index-392c3423.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css"])),Pe=D.lazy(()=>P(()=>import("./index-0971e4b5.js"),["assets/index-0971e4b5.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css","assets/index-776b06b1.js","assets/sleep-da79c358.js","assets/fighters-query-8286655b.js","assets/useQuery-0b74c68b.js","assets/index-721462f5.js","assets/markers-21ad5773.js","assets/use-transaction-7fcf6795.js","assets/toast-options-251f3299.js","assets/react-icons.esm-aee9b2a1.js","assets/shimmer-78d15c7c.js"])),Ee=D.lazy(()=>P(()=>import("./index-a37f0f4f.js"),["assets/index-a37f0f4f.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css","assets/index-392c3423.js","assets/elements-a94bd2b3.js","assets/markers-21ad5773.js","assets/index-721462f5.js","assets/useQuery-0b74c68b.js","assets/shimmer-78d15c7c.js","assets/fighters-query-8286655b.js","assets/index-776b06b1.js","assets/sleep-da79c358.js","assets/use-transaction-7fcf6795.js","assets/toast-options-251f3299.js"])),ze=()=>{var W,q,O,Q;const s=R($(e=>e.user)),o=R($(e=>e.updatePlayerData)),{data:r}=pe(),{data:a,isLoading:x,isFetching:B}=de(s.name),{data:u}=Ce(),{selectedFighter:g,setSelectedFighter:z,checkedFighters:_,setCheckedFighters:V}=ue(),[C,v]=l.useState(!1),[M,I]=l.useState(!1),[y,H]=l.useState("inventory"),[b,G]=l.useState([]),[i,K]=l.useState(De[0]),[S,J]=l.useState({label:"All",value:""}),X=l.useMemo(()=>a==null?void 0:a.some(e=>e.stats.experience>=e.stats.required_experience&&(u==null?void 0:u.some(t=>t.level===e.stats.level+1))),[a,u]),U=l.useMemo(()=>(a==null?void 0:a.reduce((e,t)=>{var c;const d=(c=u==null?void 0:u.find(m=>m.level===t.stats.level+1))==null?void 0:c.unlock_cost_gem;return d&&t.stats.experience>=t.stats.required_experience?e+=d:e},0))||0,[u,a]),j=l.useMemo(()=>(a==null?void 0:a.reduce((e,t)=>{const d=new Date(t.next_payday).getTime()/1e3,c=new Date(t.last_payday).getTime()/1e3,m=new Date().getTime()/1e3,F=(r==null?void 0:r.standard_pay_payday)||0;let f=0;d>m&&(f=d-m);const T=d-c-f,ie=d-c,Y=Math.floor(T/ie*F+1);return Y>1?e+=Y:e},0))||0,[r,a]),Z=l.useMemo(()=>_.length*_.reduce((e,t)=>e+t.stats.credits,0),[_]),ee=l.useCallback(e=>S.value===""||e.classname===S.value,[S]),te=l.useCallback(e=>b.length===0||b.some(t=>t.type==="element"&&t.value===e.element||t.type==="marker"&&t.value===e.marker),[b]),ae=l.useCallback((e,t)=>i.value==="level"?t.stats.level-e.stats.level:i.value==="health_max"?t.stats.health_max-e.stats.health_max:i.value==="damage_max"?t.stats.damage_max-e.stats.damage_max:i.value==="initiative_max"?t.stats.initiative_max-e.stats.initiative_max:i.value==="attackspeed_max"?t.stats.attackspeed_max-e.stats.attackspeed_max:i.value==="taunt_max"?t.stats.taunt_max-e.stats.taunt_max:i.value==="res_fire"?t.stats.res_fire-e.stats.res_fire:i.value==="res_gem"?t.stats.res_gem-e.stats.res_gem:i.value==="res_neutral"?t.stats.res_neutral-e.stats.res_neutral:i.value==="res_nature"?t.stats.res_nature-e.stats.res_nature:i.value==="res_air"?t.stats.res_air-e.stats.res_air:i.value==="res_metal"?t.stats.res_metal-e.stats.res_metal:t.stats.level-e.stats.level,[i]);async function se(){try{v(!0);const e=(a==null?void 0:a.filter(c=>c.stats.experience>=c.stats.required_experience).map(c=>c.fighter_id))||[],t=(a==null?void 0:a.reduce((c,m)=>{var f;const F=(f=u==null?void 0:u.find(T=>T.level===m.stats.level+1))==null?void 0:f.unlock_cost_credits;return F&&m.stats.experience>=m.stats.required_experience?c+=F:c},0))||0;if(!await Te(s,{cost_credits:t,cost_gems:U,fighter_ids:e}))return;await k(2e3),A(s.name),w.success("Fighter leveled up!")}catch(e){console.error(e)}finally{v(!1)}}async function ne(){try{I(!0);const e=(a==null?void 0:a.map(d=>d.fighter_id))||[];if(!await Ae(s,{fighter_id:e}))return;await k(2e3),A(s.name),w.success("Fighter payday!")}catch(e){console.error(e)}finally{I(!1)}}async function re(){try{v(!0);const e=_.map(d=>Number(d));if(!await Le(s,{fighter_ids:e}))return;await k(2e3),A(s.name),V([]),await o(),w.success("Fighters sold!")}catch(e){console.error(e)}finally{v(!1)}}return l.useEffect(()=>()=>z(null),[]),n.jsxs(ge,{isFighterSelected:!!g,children:[n.jsx(fe,{children:y==="sell"?n.jsx(n.Fragment,{children:n.jsxs(L,{isLoading:C,onClick:re,children:["Sell selected",n.jsxs("div",{children:[Z,n.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs(L,{isLoading:C,disabled:C||!X,onClick:se,children:["Level All"," ",n.jsxs("div",{children:[U,n.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})," "]})]}),n.jsxs(L,{isLoading:M,disabled:M||j>((W=s.activestats)==null?void 0:W.action_points)||j<=0,onClick:ne,children:["Payday",n.jsxs("div",{children:["-",j,n.jsx("img",{src:"/assets/icons/credits.png",alt:"Energy"})]})]})]})}),n.jsxs(he,{isFighterSelected:!!g,children:[n.jsxs(ve,{children:[n.jsx(N,{isSelected:y==="inventory",onClick:()=>H("inventory"),children:"Inventory"}),n.jsx(N,{isSelected:y==="sell",onClick:()=>H("sell"),children:"Sell"})]}),n.jsx(Ee,{filterSelected:b,setFilterSelected:G,selectedSort:i,setSelectedSort:K,selectedFighterClassname:S,setSelectedFighterClassname:J}),n.jsx(_e,{children:x||B?Array.from({length:9},(e,t)=>n.jsx(be,{},t)):a?(Q=(O=(q=a==null?void 0:a.filter(ee))==null?void 0:q.filter(te))==null?void 0:O.toSorted(ae))==null?void 0:Q.map(e=>n.jsx(Pe,{isSelling:y==="sell",fighter:e},e.fighter_id)):n.jsx(n.Fragment,{children:n.jsx(Se,{children:"You don't have Fighters"})})})]}),n.jsx(ye,{isFighterSelected:!!g,children:!!g&&n.jsx(me,{selectedFighter:g,onCloseFighterDetail:z})})]})},Ye=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"}));export{Ae as a,Te as e,Ye as i,De as s,Ce as u};

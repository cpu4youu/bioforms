import{s as p,g as V,S as f,e as $,u as I,R as y,_ as h,a as K,r as d,j as n,Q as k}from"./index-9fc33c7c.js";import{u as G,o as D}from"./fighters-query-fbf4c053.js";import{u as J}from"./index-bbd30766.js";import{u as X,F as Z}from"./index-2d133007.js";import{u as ee}from"./useQuery-869993e9.js";import{s as E}from"./sleep-da79c358.js";import{u as M}from"./use-transaction-ed631b73.js";const te=p("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{gridTemplateAreas:`
          "empty empty header"
          "main main side"
        `,"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),ae=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),se=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423",variants:{isFighterSelected:{true:{"@xmd":{display:"none"}}}}});p("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}});const ne=p("div",{display:"none",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{display:"flex"},false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"}}),re=p("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),ie=async()=>await V({options:{code:f.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:f.battleAle,table:"levels"}}),le=()=>ee({queryKey:[$.levelsState],queryFn:()=>oe(),staleTime:1e3*60*60,enabled:!!I.getState().user});async function oe(){try{return await ie()}catch(s){return console.log(s),null}}async function ce(s,t){const{executeTransaction:r}=M(),o=ue(s,t);return!!await r(o)}function ue(s,{cost_credits:t,cost_gems:r,fighter_ids:o}){return{actions:[{account:f.battleAle,name:"levelup",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_ids:o,cost_gems:r,cost_credits:t}}]}}async function de(s,t){const{executeTransaction:r}=M(),o=me(s,t);return!!await r(o)}function me(s,{fighter_id:t}){return{actions:[{account:f.battleAle,name:"payday",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_id:t}}]}}const pe=[{label:"Level",value:"level"},{label:"Health",value:"health_max"},{label:"Damage",value:"damage_max"},{label:"Initiative",value:"initiative_max"},{label:"Attack Speed",value:"attackspeed_max"},{label:"Taunt",value:"taunt_max"},{label:"Res Fire",value:"res_fire"},{label:"Res Gem",value:"res_gem"},{label:"Res Neutral",value:"res_neutral"},{label:"Res Nature",value:"res_nature"},{label:"Res Air",value:"res_air"},{label:"Res Metal",value:"res_metal"}],z=y.lazy(()=>h(()=>import("./index-3b45a4b1.js"),["assets/index-3b45a4b1.js","assets/index-9fc33c7c.js","assets/index-55fec1ff.css"])),xe=y.lazy(()=>h(()=>import("./index-cefa32c8.js"),["assets/index-cefa32c8.js","assets/index-9fc33c7c.js","assets/index-55fec1ff.css","assets/index-bbd30766.js","assets/index-2d133007.js","assets/useQuery-869993e9.js","assets/sleep-da79c358.js","assets/fighters-query-fbf4c053.js","assets/markers-21ad5773.js","assets/use-transaction-ed631b73.js","assets/toast-options-a6d93504.js"])),_e=y.lazy(()=>h(()=>import("./index-c9865bfd.js"),["assets/index-c9865bfd.js","assets/index-9fc33c7c.js","assets/index-55fec1ff.css","assets/index-3b45a4b1.js","assets/elements-a94bd2b3.js","assets/markers-21ad5773.js","assets/useQuery-869993e9.js","assets/fighters-query-fbf4c053.js","assets/index-bbd30766.js","assets/index-2d133007.js","assets/sleep-da79c358.js","assets/use-transaction-ed631b73.js","assets/toast-options-a6d93504.js"])),fe=()=>{var j,L,R;const s=I(K(e=>e.user)),{data:t}=G(s.name),{data:r}=le(),{data:o}=X(),{selectedFighter:u,setSelectedFighter:S}=J(),[F,T]=d.useState(!1),[b,w]=d.useState(!1),[g,U]=d.useState([]),[i,H]=d.useState(pe[0]),[O,Q]=d.useState({label:"",value:""}),W=t==null?void 0:t.some(e=>e.stats.experience>=e.stats.required_experience),A=d.useMemo(()=>(t==null?void 0:t.reduce((e,a)=>{var l;const c=(l=r==null?void 0:r.find(m=>m.level===a.stats.level))==null?void 0:l.unlock_cost_gem;return c?e+=c:e},0))||0,[r,t]);async function Y(){try{T(!0);const e=(t==null?void 0:t.filter(l=>l.stats.experience>=l.stats.required_experience).map(l=>l.fighter_id))||[],a=(t==null?void 0:t.reduce((l,m)=>{var x;const _=(x=r==null?void 0:r.find(v=>v.level===m.stats.level))==null?void 0:x.unlock_cost_credits;return _?l+=_:l},0))||0;if(!await ce(s,{cost_credits:a,cost_gems:A,fighter_ids:e}))return;await E(2e3),D(s.name),k.success("Fighter leveled up!")}catch(e){console.error(e)}finally{T(!1)}}const C=d.useMemo(()=>(t==null?void 0:t.reduce((e,a)=>{const c=new Date(a.next_payday).getTime()/1e3,l=new Date(a.last_payday).getTime()/1e3,m=new Date().getTime()/1e3,_=(o==null?void 0:o.standard_pay_payday)||0;let x=0;c>m&&(x=c-m);const v=c-l-x,N=c-l,P=Math.floor(v/N*_+1);return P>1?e+=P:e},0))||0,[o,t]);async function q(){try{w(!0);const e=(t==null?void 0:t.map(c=>c.fighter_id))||[];if(!await de(s,{fighter_id:e}))return;await E(2e3),D(s.name),k.success("Fighter payday!")}catch(e){console.error(e)}finally{w(!1)}}const B=(e,a)=>i.value==="level"?a.stats.level-e.stats.level:i.value==="health_max"?a.stats.health_max-e.stats.health_max:i.value==="damage_max"?a.stats.damage_max-e.stats.damage_max:i.value==="initiative_max"?a.stats.initiative_max-e.stats.initiative_max:i.value==="attackspeed_max"?a.stats.attackspeed_max-e.stats.attackspeed_max:i.value==="taunt_max"?a.stats.taunt_max-e.stats.taunt_max:i.value==="res_fire"?a.stats.res_fire-e.stats.res_fire:i.value==="res_gem"?a.stats.res_gem-e.stats.res_gem:i.value==="res_neutral"?a.stats.res_neutral-e.stats.res_neutral:i.value==="res_nature"?a.stats.res_nature-e.stats.res_nature:i.value==="res_air"?a.stats.res_air-e.stats.res_air:i.value==="res_metal"?a.stats.res_metal-e.stats.res_metal:a.stats.level-e.stats.level;return d.useEffect(()=>()=>S(null),[]),n.jsxs(te,{isFighterSelected:!!u,children:[n.jsxs(ae,{children:[n.jsxs(z,{isLoading:F,disabled:F||!W,onClick:Y,children:["Level All"," ",n.jsxs("div",{children:[A,n.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})," "]})]}),n.jsxs(z,{isLoading:b,disabled:b||C>((j=s.activestats)==null?void 0:j.action_points),onClick:q,children:["Payday",n.jsxs("div",{children:["-",C,n.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})]})]})]}),n.jsxs(se,{isFighterSelected:!!u,children:[n.jsx(_e,{filterSelected:g,setFilterSelected:U,selectedSort:i,setSelectedSort:H,selectedFighterClassname:O,setSelectedFighterClassname:Q}),t?(R=(L=t==null?void 0:t.filter(e=>g.length===0||g.some(a=>a.type==="element"&&a.value===e.element||a.type==="marker"&&a.value===e.marker)))==null?void 0:L.toSorted(B))==null?void 0:R.map(e=>n.jsx(xe,{fighter:e},e.fighter_id)):n.jsx(n.Fragment,{children:n.jsx(re,{children:"You don't have Fighters"})})]}),n.jsx(ne,{isFighterSelected:!!u,children:!!u&&n.jsx(Z,{selectedFighter:u,onCloseFighterDetail:S})})]})},be=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"}));export{de as a,ce as e,be as i,pe as s,le as u};

import{s as r,g as z,S as C,p as B,u as D,b as W,R as E,_ as $,r as o,j as e}from"./index-127176c3.js";import{u as I}from"./index-7921260e.js";import{u as Y}from"./useQuery-f6abb408.js";import{v as k}from"./v4-4a60fe23.js";const O=r("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),L=r("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),P=r("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 175px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423"}),Q=r("div",{gridArea:"main",d:"flex",direction:"column",w:"100%",maxW:"1360px",h:"calc(100vh - 235px)",mx:"auto",px:"20px"}),V=r("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),q=r("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),K=r("div",{d:"flex",justify:"space-between",align:"center",gap:"5px",mt:"35px",">span":{mx:"95px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{mt:"10px",gap:"15px",direction:"column"}}),U=r("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"},">div":{d:"flex",justify:"space-between",gap:"5px"}}),X=r("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"}}),G=r("div",{d:"flex",justify:"space-between",gap:"5px"}),N=r("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"}),J=r("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}}),Z=r("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}}),ee=r("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}}),te=r("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{w:"50px",h:"50px",img:{scale:"3.2",translate:"-5px 10px"}}}}}),ae=async c=>await z({options:{code:C.battleAle,index_position:1,limit:"1000",lower_bound:c,upper_bound:c,scope:C.battleAle,table:B.history}}),se=c=>Y({enabled:!!D.getState().user,queryKey:[W.HistoryDataState,c],queryFn:()=>ne(c),staleTime:1e3*60*20});async function ne(c){try{const f=await ae(c);return f!=null&&f[0]?f[0]:null}catch(f){return console.log(f),null}}const A=E.lazy(()=>$(()=>import("./index-eea6254e.js"),["assets/index-eea6254e.js","assets/index-127176c3.js","assets/index-55fec1ff.css"])),w=E.lazy(()=>$(()=>import("./index-2a30c43e.js"),["assets/index-2a30c43e.js","assets/index-127176c3.js","assets/index-55fec1ff.css"])),ce=()=>{const{areaSelected:c,setAreaSelected:f}=I(),{data:_}=se(),v=o.useRef(null),[i,y]=o.useState(),[s,F]=o.useState([]),[x,b]=o.useState(0),[u,S]=o.useState({});function H(){f(null)}function M(){b(s.length-1);const t={};s.forEach(l=>{t[`${l.defender.fighter_id}-${l.defenderTeam}`]=l.defender.stats.health}),S(t)}function R(t,l){const n=[...t.map(a=>({...a,team:1})),...l.map(a=>({...a,team:2}))],h=[];for(;n.filter(a=>a.team===1&&a.stats.health>0).length>0&&n.filter(a=>a.team===2&&a.stats.health>0).length>0;){const a=n.filter(d=>d.stats.health>0),p=a.reduce((d,j)=>j.stats.initiative<d.stats.initiative?j:d),T=p.team===1?2:1,m=a.filter(d=>d.team===T);if(m.length===0)return;const g=m.reduce((d,j)=>j.stats.taunt>d.stats.taunt?j:d);h.push({attacker:p,defender:g,attack:p.stats.damage,attackerHealthBefore:p.stats.health,attackerTeam:p.team,defenderTeam:g.team,defenderTauntBefore:g.stats.taunt,defenderHealthBefore:g.stats.health}),g.stats.health-=p.stats.damage,g.stats.taunt=Math.max(0,g.stats.taunt-10),p.stats.initiative+=p.stats.attackspeed}return h}return o.useEffect(()=>{y(_??void 0)},[_]),o.useEffect(()=>{if(i!=null&&i.team1_fighters&&(i!=null&&i.team2_fighters)){const t=i.team1_fighters.map(a=>({...a,team:1,stats:{...a.stats}})),l=i.team2_fighters.map(a=>({...a,team:2,stats:{...a.stats}})),n={};[...t,...l].forEach(a=>{n[`${a.fighter_id}-${a.team}`]=a.stats.health}),S(n);const h=R(t,l);F(h||[]),b(0)}},[i,c]),o.useEffect(()=>{if(s.length===0||x>=s.length)return;const t=setTimeout(()=>{var p,T,m;const l=(p=s==null?void 0:s[x])==null?void 0:p.attack,n=(T=s==null?void 0:s[x])==null?void 0:T.defender,h=(m=s==null?void 0:s[x])==null?void 0:m.defenderTeam;u[`${n==null?void 0:n.fighter_id}-${h}`]!==void 0&&S({...u,[`${n==null?void 0:n.fighter_id}-${h}`]:Math.max(0,u[`${n==null?void 0:n.fighter_id}-${h}`]-l)});const a=x+1;b(a)},1e3);return()=>clearTimeout(t)},[s,x,u]),o.useEffect(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)},[x]),e.jsxs(O,{children:[e.jsx(L,{children:x>=s.length-1?e.jsx(A,{onClick:H,children:"Back"}):e.jsx(A,{onClick:M,children:"Skip Fight"})}),e.jsxs(P,{children:[e.jsx(V,{children:"Weather"}),e.jsx(q,{children:"+20% Gem Damage"}),e.jsxs(Q,{children:[e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsx("span",{children:"YOUR TEAM"}),e.jsx("div",{children:i==null?void 0:i.team1_fighters.map(t=>e.jsx(w,{isFighting:!0,fighter:{...t,stats:{...t.stats,health:u[`${t.fighter_id}-1`]}}},k()))})]}),e.jsx("span",{children:"VS"}),e.jsx(G,{children:i==null?void 0:i.team2_fighters.map(t=>e.jsxs(X,{children:[e.jsx("span",{children:"AI"}),e.jsx(w,{isFighting:!0,fighter:{...t,stats:{...t.stats,health:u[`${t.fighter_id}-2`]}}})]},k()))})]}),e.jsx(N,{children:e.jsxs(J,{children:[e.jsxs(Z,{children:[e.jsx("span",{children:"Attacker"}),e.jsx("span",{children:"Defender"}),e.jsx("span",{children:"Attack"}),e.jsx("span",{children:"Damage"}),e.jsx("span",{children:"Remaining Health"}),e.jsx("span",{children:"Effectiveness"}),e.jsx("span",{children:"Special Event"})]}),e.jsx(ee,{ref:v,children:s.slice(0,x).map((t,l)=>e.jsxs(te,{children:[e.jsx(w,{isFighting:!0,fighter:{...t.attacker,stats:{...t.attacker.stats,health:t.attackerHealthBefore}}}),e.jsx(w,{isFighting:!0,fighter:{...t.defender,stats:{...t.defender.stats,health:t.defenderHealthBefore-t.attack}}}),e.jsx("span",{children:t.attack}),e.jsx("span",{children:t.attack}),e.jsx("span",{children:t.defenderHealthBefore-t.attack}),e.jsx("span",{children:"100%"}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:["ID: ",t.attacker.fighter_id," TEAM: ",t.attackerTeam," "]}),e.jsxs("span",{children:["ID: ",t.defender.fighter_id," TEAM: ",t.defenderTeam]})]},l))})]})})]})]})]})};export{ce as default};

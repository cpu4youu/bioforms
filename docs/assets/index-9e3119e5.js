import{s,g as D,S,t as P,u as C,e as R,R as B,_ as M,b as Y,r as m,j as e}from"./index-907b2698.js";import{u as W}from"./useQuery-468e16bd.js";import{v as F}from"./v4-4a60fe23.js";const q=s("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),I=s("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),K=s("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 175px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423"}),L=s("div",{gridArea:"main",d:"flex",direction:"column",w:"100%",maxW:"1360px",h:"calc(100vh - 235px)",mx:"auto",px:"20px"}),O=s("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),Q=s("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),V=s("div",{d:"flex",justify:"space-between",align:"center",gap:"5px",mt:"35px",">span":{mx:"95px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{mt:"10px",gap:"15px",direction:"column"}}),U=s("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"},">div":{d:"flex",justify:"space-between",gap:"5px"}}),X=s("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"}}),G=s("div",{d:"flex",justify:"space-between",gap:"5px"}),N=s("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"}),J=s("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}}),Z=s("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}}),H=s("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}}),ee=s("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{img:{scale:"3.2",translate:"-5px 10px"}}}}}),te=s("div",{d:"flex",justify:"center",align:"center",direction:"column",gap:"20px",mt:"40px",img:{height:235,width:235,objectFit:"contain"}}),ne=s("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),ae=s("div",{d:"flex",justify:"center",align:"center",width:"23%"}),y=s("div",{d:"flex",justify:"center",align:"center",direction:"column",textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",img:{height:80,width:80,objectFit:"contain"}}),se=s("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),ie=async r=>await D({options:{code:S.battleAle,index_position:1,limit:"1000",lower_bound:r,upper_bound:r,scope:S.battleAle,table:P.history}}),re=r=>W({enabled:!!C.getState().user,queryKey:[R.HistoryDataState,r],queryFn:()=>le(r),staleTime:1e3*60*20});async function le(r){try{const c=await ie(r);return c!=null&&c[0]?c[0]:null}catch(c){return console.log(c),null}}const ce=async r=>await D({options:{code:S.poolsAle,index_position:2,key_type:"i64",limit:"1000",reverse:!0,lower_bound:r,upper_bound:r,scope:S.poolsAle,table:"minehistory"}}),oe=()=>W({enabled:!!C.getState().user,queryKey:[R.dungeonPoolDataState],queryFn:()=>de(),staleTime:1e3*60*20});async function de(){const r=C.getState().user;try{const c=await ce(r==null?void 0:r.name);return c!=null&&c[0]?c[0]:null}catch(c){return console.log(c),null}}function pe(r,c){const v=[...r.map(i=>({...i,team:1})),...c.map(i=>({...i,team:2}))],o=[];for(;v.filter(i=>i.team===1&&i.stats.health>0).length>0&&v.filter(i=>i.team===2&&i.stats.health>0).length>0;){const i=v.filter(g=>g.stats.health>0),f=i.reduce((g,j)=>j.stats.initiative<g.stats.initiative?j:g),d=f.team===1?2:1,b=i.filter(g=>g.team===d);if(b.length===0)return;const t=b.reduce((g,j)=>j.stats.taunt>g.stats.taunt?j:g),a=`res_${f.element}`,T=t.stats[a],u=f.stats.damage*(100-T)/100,_=u*100/f.stats.damage;o.push({attacker:f,defender:t,attack:u,attackerHealthBefore:f.stats.health,attackerTeam:f.team,defenderTeam:t.team,defenderTauntBefore:t.stats.taunt,defenderHealthBefore:t.stats.health,effectiveness:_}),t.stats.health-=u,t.stats.taunt=Math.max(0,t.stats.taunt-10),f.stats.initiative+=f.stats.attackspeed}return o}const z=B.lazy(()=>M(()=>import("./index-22ec13bb.js"),["assets/index-22ec13bb.js","assets/index-907b2698.js","assets/index-55fec1ff.css"])),w=B.lazy(()=>M(()=>import("./index-01791754.js"),["assets/index-01791754.js","assets/index-907b2698.js","assets/index-55fec1ff.css","assets/iconBase-bc0c040b.js"])),he=({historyId:r})=>{const{areaSelected:c,setAreaSelected:v}=Y(),{data:o}=re(r),{data:i}=oe(),f=m.useRef(null),[d,b]=m.useState(),[t,k]=m.useState([]),[a,T]=m.useState(0),[u,_]=m.useState({});function g(){v(null)}function j(){T(t.length-1);const n={};t.forEach(x=>{n[`${x.defender.fighter_id}-${x.defenderTeam}`]=x.defender.stats.health}),_(n)}return m.useEffect(()=>{b(o??void 0)},[o]),m.useEffect(()=>{if(d!=null&&d.team1_fighters&&(d!=null&&d.team2_fighters)){const n=d.team1_fighters.map(p=>({...p,team:1,stats:{...p.stats}})),x=d.team2_fighters.map(p=>({...p,team:2,stats:{...p.stats}})),l={};[...n,...x].forEach(p=>{l[`${p.fighter_id}-${p.team}`]=p.stats.health}),_(l);const h=pe(n,x);k(h||[]),T(0)}},[d,c]),m.useEffect(()=>{if(t.length===0||a>=t.length)return;const n=setTimeout(()=>{var A,$,E;const x=(A=t==null?void 0:t[a])==null?void 0:A.attack,l=($=t==null?void 0:t[a])==null?void 0:$.defender,h=(E=t==null?void 0:t[a])==null?void 0:E.defenderTeam;u[`${l==null?void 0:l.fighter_id}-${h}`]!==void 0&&_({...u,[`${l==null?void 0:l.fighter_id}-${h}`]:Math.max(0,u[`${l==null?void 0:l.fighter_id}-${h}`]-x)});const p=a+1;T(p)},1e3);return()=>clearTimeout(n)},[t,a,u]),m.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[a]),e.jsxs(q,{children:[e.jsx(I,{children:a>=t.length-1?e.jsx(z,{onClick:g,children:"Back"}):e.jsx(z,{onClick:j,children:"Skip Fight"})}),e.jsxs(K,{children:[e.jsx(O,{children:"Weather"}),e.jsx(Q,{children:"+20% Gem Damage"}),e.jsxs(L,{children:[e.jsxs(V,{children:[e.jsxs(U,{children:[e.jsx("span",{children:"YOUR TEAM"}),e.jsx("div",{children:d==null?void 0:d.team1_fighters.map(n=>{var x,l,h,p;return e.jsx(w,{isFighting:!0,isAttacking:((x=t==null?void 0:t[a])==null?void 0:x.attackerTeam)===1&&((l=t==null?void 0:t[a])==null?void 0:l.attacker.fighter_id)===n.fighter_id,isDefending:((h=t==null?void 0:t[a])==null?void 0:h.defenderTeam)===1&&((p=t==null?void 0:t[a])==null?void 0:p.defender.fighter_id)===n.fighter_id,fighter:{...n,stats:{...n.stats,health:u[`${n.fighter_id}-1`]}}},F())})})]}),e.jsx("span",{children:"VS"}),e.jsx(G,{children:d==null?void 0:d.team2_fighters.map(n=>{var x,l,h,p;return e.jsxs(X,{children:[e.jsx("span",{children:"AI"}),e.jsx(w,{isFighting:!0,isAttacking:((x=t==null?void 0:t[a])==null?void 0:x.attackerTeam)===2&&((l=t==null?void 0:t[a])==null?void 0:l.attacker.fighter_id)===n.fighter_id,isDefending:((h=t==null?void 0:t[a])==null?void 0:h.defenderTeam)===2&&((p=t==null?void 0:t[a])==null?void 0:p.defender.fighter_id)===n.fighter_id,fighter:{...n,stats:{...n.stats,health:u[`${n.fighter_id}-2`]}}})]},F())})})]}),a>=t.length-1?e.jsxs(te,{children:[e.jsx(ne,{children:o!=null&&o.log.includes("Team 1")?"Winner Winner, Chicken Dinner!":"You lost! "}),(o==null?void 0:o.log.includes("Team 1"))&&e.jsxs(ae,{children:[e.jsxs(y,{children:[e.jsx("img",{loading:"lazy",src:"/assets/icons/tlm.png",alt:""}),e.jsx("span",{children:i==null?void 0:i.total_tlm})]}),e.jsxs(y,{children:[e.jsx("img",{loading:"lazy",src:"/assets/icons/credit.png",alt:""}),e.jsx("span",{children:i==null?void 0:i.total_shards})]})]}),e.jsx("img",{src:`/assets/dungeon/${o!=null&&o.log.includes("Team 1")?"winner":"lost"}.png`,alt:"",loading:"lazy"}),e.jsx(se,{children:o!=null&&o.log.includes("Team 1")?"Equip better tools to earn more instant rewards":"Looks like your fighters arenâ€™t good enough yet"})]}):e.jsx(N,{children:e.jsxs(J,{children:[e.jsxs(Z,{children:[e.jsx("span",{children:"Attacker"}),e.jsx("span",{children:"Defender"}),e.jsx("span",{children:"Attack"}),e.jsx("span",{children:"Damage"}),e.jsx("span",{children:"Remaining Health"}),e.jsx("span",{children:"Effectiveness"}),e.jsx("span",{children:"Special Event"})]}),e.jsx(H,{ref:f,children:t.slice(0,a).map((n,x)=>e.jsxs(ee,{children:[e.jsx(w,{isFighting:!0,fighter:{...n.attacker,stats:{...n.attacker.stats,health:n.attackerHealthBefore}}}),e.jsx(w,{isFighting:!0,fighter:{...n.defender,stats:{...n.defender.stats,health:n.defenderHealthBefore-n.attack}}}),e.jsx("span",{children:n.attack}),e.jsx("span",{children:n.attacker.stats.damage}),e.jsx("span",{children:(n.defenderHealthBefore-n.attack).toFixed(2)}),e.jsxs("span",{children:[n.effectiveness.toFixed(2),"%"]}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:["ID: ",n.attacker.fighter_id,e.jsx("br",{}),"TEAM: ",n.attackerTeam," "]}),e.jsxs("span",{children:["ID: ",n.defender.fighter_id,e.jsx("br",{}),"TEAM: ",n.defenderTeam]})]},x))})]})})]})]})]})};export{he as default};

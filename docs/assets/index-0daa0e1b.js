import{s as g,S as h,c as P,Q as S,g as E,q as Q,u as w,d as W,R as j,_ as v,a as $,r as F,j as t}from"./index-4034d623.js";import{u as k}from"./index-cce2017a.js";import{F as B}from"./index-585f9113.js";import{u as K}from"./use-media-ef909521.js";import{s as Y}from"./sleep-da79c358.js";import{u as U}from"./use-transaction-c828b2ca.js";import{u as D}from"./useQuery-66878643.js";const G=g("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),J=g("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}},"&:nth-child(1)":{display:"none"},"&:nth-child(2)":{display:"none"}},"@lgxxx":{button:{"&:nth-child(1)":{display:"flex"},"&:nth-child(2)":{display:"flex"}}},"@md":{button:{"&:nth-child(1)":{display:"none"},"&:nth-child(2)":{display:"none"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),X=g("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}}}),Z=g("div",{gridArea:"main",d:"flex",justify:"space-between",gap:"5px",w:"100%",px:"20px",">span":{mt:"55px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@xlg":{justify:"center",flexWrap:"wrap",">span":{my:"25px"}},variants:{isFighterSelected:{true:{justify:"center",flexWrap:"wrap",">span":{my:"25px"}}}}}),ee=g("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),te=g("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),ne=g("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),ae=g("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function re(e,n,s,a,l,i,d,c,u,p,x){const{executeTransaction:m}=U(),o=se(e,n,s,a,l,i,d,c,u,p,x);return!!await m(o)}function se(e,n,s,a,l,i,d,c,u,p,x){return{actions:[{account:h.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:n,land_id:s,crew_asset_id:a,weapon_asset_id:l,fighter_ids:i,difficulty:d,use_gems:c,history_id:u,x:p,y:x}}]}}const ie=P(e=>({myTeam:[null,null,null,null,null],setMyTeam:n=>e({myTeam:n}),selectedCards:[void 0,void 0],setSelectedCards:n=>e({selectedCards:n})}));function oe({user:e,areaSelected:n,myTeam:s,selectedCards:a,selectedLevel:l}){var d,c,u,p,x,m,o,f;const i=s.reduce((y,_)=>_?[...y,_.fighter_id]:y,[]);return!e||!(n!=null&&n.landId)||!i.length||!((d=a[0])!=null&&d.asset_id)||!((c=a[1])!=null&&c.asset_id)?(i.length||S.error("No Warrior selected"),(u=a[0])!=null&&u.asset_id||S.error("No Crew selected (First spot on cards)"),(p=a[1])!=null&&p.asset_id||S.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:n,crew_asset_id:Number((x=a[0])==null?void 0:x.asset_id),weapon_asset_id:Number((m=a[1])==null?void 0:m.asset_id),fighter_ids:i,selectedLevel:l})):{user:e,planet:e.planet,landId:n.landId,x:n.x,y:n.y,card1:Number((o=a[0])==null?void 0:o.asset_id),card2:Number((f=a[1])==null?void 0:f.asset_id),teamFiltered:i,level:l.level}}const le=async()=>await E({options:{code:h.dungeonsAle,index_position:1,limit:"1000",scope:h.dungeonsAle,table:Q.config}}),de=()=>D({enabled:!!w.getState().user,queryKey:[W.dungeonConfigDataState],queryFn:()=>ce(),staleTime:1e3*60*20});async function ce(){try{const e=await le();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const ue=async()=>await E({options:{code:h.battleAle,index_position:1,limit:"1000",scope:h.battleAle,table:"variables"}}),pe=()=>D({enabled:!!w.getState().user,queryKey:[W.VariablesState],queryFn:()=>xe(),staleTime:1e3*60*20});async function xe(){try{const e=await ue();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const ge=async()=>await E({options:{code:h.battleAle,index_position:1,limit:"1000",scope:h.battleAle,table:"weather"}}),me=()=>D({enabled:!!w.getState().user,queryKey:[W.WeatherState],queryFn:()=>he(),staleTime:1e3*60*20});async function he(){try{return await ge()}catch(e){return console.log(e),null}}const L=j.lazy(()=>v(()=>import("./index-8e185a16.js"),["assets/index-8e185a16.js","assets/index-4034d623.js","assets/index-55fec1ff.css"])),fe=j.lazy(()=>v(()=>import("./index-87a0d6b6.js"),["assets/index-87a0d6b6.js","assets/index-4034d623.js","assets/index-55fec1ff.css","assets/useQuery-66878643.js","assets/v4-4a60fe23.js"])),ye=j.lazy(()=>v(()=>import("./index-2c30b586.js"),["assets/index-2c30b586.js","assets/index-4034d623.js","assets/index-55fec1ff.css","assets/fighters-query-a752de7e.js","assets/useQuery-66878643.js","assets/index-cce2017a.js","assets/index-8e185a16.js","assets/use-media-ef909521.js","assets/inventory-query-f10fa785.js","assets/atomic-api-67b3b924.js","assets/toast-options-5544c8ed.js","assets/v4-4a60fe23.js","assets/index-585f9113.js","assets/sleep-da79c358.js","assets/use-transaction-c828b2ca.js"])),_e=j.lazy(()=>v(()=>import("./index-5bba9c34.js"),["assets/index-5bba9c34.js","assets/index-4034d623.js","assets/index-55fec1ff.css","assets/useQuery-66878643.js","assets/fighters-query-a752de7e.js","assets/index-cce2017a.js","assets/use-media-ef909521.js","assets/v4-4a60fe23.js"])),be=()=>{const e=w(r=>r.user),{isSuperLarge:n}=K(),{data:s}=de(),{data:a}=pe(),{data:l}=me(),{selectedCards:i,myTeam:d,setMyTeam:c,setSelectedCards:u}=ie(),{areaSelected:p,setAreaSelected:x}=$(),{selectedLevel:m,selectedFighter:o,setSelectedFighter:f}=k(),[y,_]=F.useState(!1),[M,N]=F.useState("");async function q(){try{_(!0);const r=oe({areaSelected:p,myTeam:d,selectedCards:i,selectedLevel:m,user:e});if(!r)return;const b=(()=>{const I="abcdefghijklmnopqrstuvwxyz12345";let R="";for(let z=0;z<12;z++){const O=Math.round(Math.random()*12+1);R+=I[O]}return R})();if(!await re(e,e.planet,r.landId,r.card1,r.card2,r.teamFiltered,r.level,!0,b,r.x,r.y))return;await Y(2e3),N(b),S.success("Fight Started !")}catch(r){console.error(r)}finally{_(!1)}}function H(){u([void 0,void 0]),c([null,null,null,null,null]),x(null)}const V=F.useMemo(()=>{var A,b,C;return!d.filter(I=>I!==null).length||!((A=i[0])!=null&&A.asset_id)||!((b=i[1])!=null&&b.asset_id)||Number(((C=e==null?void 0:e.activestats)==null?void 0:C.action_points)||0)<((s==null?void 0:s.energy_cost)||0)},[d,i,s,e]),T=F.useMemo(()=>l==null?void 0:l.find(r=>r.weather_id===(a==null?void 0:a.current_weather_id)),[l,a]);return M?t.jsx(fe,{historyId:M}):t.jsxs(G,{isFighterSelected:!!o,children:[t.jsxs(J,{children:[t.jsx("button",{}),t.jsx("button",{}),t.jsx(L,{onClick:H,children:"Back"}),t.jsxs(L,{disabled:V||y,isLoading:y,onClick:q,children:["Start Fight",t.jsxs("div",{children:["-",s==null?void 0:s.energy_cost,t.jsx("img",{src:"/assets/icons/potion.png",alt:"Potion"})]})]})]}),t.jsxs(X,{isFighterSelected:!!o,children:[t.jsx(ee,{children:"Weather"}),t.jsx(te,{children:T==null?void 0:T.displayname}),t.jsxs(Z,{isFighterSelected:n&&!!o,children:[t.jsx(ye,{}),t.jsx("span",{children:"VS"}),t.jsx(_e,{})]})]}),t.jsx(ne,{isFighterSelected:!!o,children:o?t.jsx(B,{selectedFighter:{...o,...o.stats},onCloseFighterDetail:f}):t.jsx(t.Fragment,{children:t.jsx(ae,{children:"Select a Fighter"})})})]})},Ie=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{Ie as i,ie as u};

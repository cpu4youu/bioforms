import{s as l,g as d,S as r,e as y,u,R as f,_ as j,j as o,r as w,Q as c}from"./index-2bb4cf2e.js";import{u as S}from"./index-0bfe9c8e.js";import T from"./index-82b65957.js";import{u as h}from"./useQuery-71cb0283.js";import{u as g}from"./use-transaction-842dae15.js";import{v as _}from"./v4-4a60fe23.js";import"./toast-options-8783363e.js";const A=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"10px",mt:"10px",bg:"#141423",br:"15px",w:"100%",maxW:"510px",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),C=l("div",{d:"flex",fw:"bold",ff:"$heading",fs:"16px",color:"white",mb:"50px"}),m=l("div",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"16px",color:"white",strong:{display:"flex",align:"center",justify:"center",gap:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"},"&:last-of-type":{my:"50px"}}),W=l("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),F=async t=>{const n=await d({options:{code:r.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:t,table:"accounts"}});return(n==null?void 0:n[0])||null},z=()=>h({queryKey:[y.WaxCoinsState],queryFn:()=>Y(),staleTime:1e3*60*60,enabled:!!u.getState().user});async function Y(){const t=u.getState().user;if(!t)return null;try{const n=await F(t.name);return n?{balance:parseFloat(n.balance),currency:n.balance.split(" ")[1]}:null}catch(n){return console.log(n),null}}const v=async t=>await d({options:{code:r.shopAle,index_position:1,key_type:"i64",limit:"1000",scope:r.shopAle,table:"shopitems"}}),E=()=>h({queryKey:[y.ShopState],queryFn:()=>R(),staleTime:1e3*60*60,enabled:!!u.getState().user});async function R(){try{return await v()}catch(t){return console.log(t),null}}async function I(t,n){const{executeTransaction:e}=g(),s=X(t,n);return!!await e(s)}function X(t,n){return{actions:[{account:r.shopAle,name:"buyshopitem",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,item:n}}]}}async function G(t,n,e){const{executeTransaction:s}=g(),a=L(t,n,e);return!!await s(a)}function L(t,n,e){return{actions:[{account:r.eosioToken,name:"transfer",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{from:t.name,to:"shop.ale",memo:`purchase,${n}`,quantity:e}}]}}function Q(t,n,e){return!t||!n?t:e?t.replaceAll(" WAX",e):t.replaceAll(" WAX","")}const $=f.lazy(()=>j(()=>import("./index-845770a9.js"),["assets/index-845770a9.js","assets/index-2bb4cf2e.js","assets/index-55fec1ff.css","assets/index-0bfe9c8e.js"])),k=f.memo(()=>{const{data:t}=E();return o.jsx(o.Fragment,{children:t==null?void 0:t.map(n=>o.jsx($,{...n},_()))})}),q=f.memo(()=>{const{user:t,updatePlayerData:n}=u(),{selectedPack:e,setSelectedPack:s}=S(),{data:a}=z(),[p,x]=w.useState(!1);async function b(){if(!t)return c.error("You need to be logged in to buy items");if(!e)return c.error("You need to select a pack to buy items");x(!0);try{let i=!1;(e==null?void 0:e.cost_gem)>0?i=await I(t,e.offer_name):i=await G(t,e.item,e.cost_wax),i&&(await n(),c.success("Item bought successfully"))}catch{c.error("Error buying item")}finally{x(!1),s(null)}}return o.jsxs(A,{children:[o.jsx(W,{onClick:()=>s(null),children:"x"}),o.jsx(C,{children:o.jsxs("span",{children:["Your selection: ",e==null?void 0:e.offer_name]})}),o.jsxs(m,{children:[o.jsx("span",{children:"You will receive: "}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""}),e==null?void 0:e.gain_gem]})]}),o.jsxs(m,{children:[o.jsx("span",{children:"You will pay:"}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),+Q((e==null?void 0:e.cost_wax)||"0","WAX","")," WAX"]})]}),o.jsxs(m,{children:[o.jsx("span",{children:"Your current WAX balance:"}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),a==null?void 0:a.balance.toLocaleString("en-US",{maximumFractionDigits:2})]})]}),o.jsx(T,{isLoading:p,disabled:p,onClick:b,color:"blue",children:"Purchase now"})]})});k.displayName="GemList";q.displayName="GemSelection";export{k as GemList,q as GemSelection};

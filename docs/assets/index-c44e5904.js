import{s as l,g as W,S as C,q as O,u as E,e as P,R as F,_ as y,b as V,r as m,j as e}from"./index-32d28607.js";import{u as I}from"./useQuery-20f20cfd.js";import{u as Y,a as K}from"./index-f8b94533.js";import{v as D}from"./v4-4a60fe23.js";import"./index-9b05f7de.js";import"./index-a60768cb.js";import"./use-media-a63fb5b2.js";import"./sleep-da79c358.js";import"./use-transaction-86ced0bc.js";import"./toast-options-07ca6d7b.js";const L=l("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),U=l("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),X=l("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justifyContent:"center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423"}),N=l("div",{gridArea:"main",d:"flex",direction:"column",w:"100%",maxW:"1360px",h:"calc(100vh - 235px)",mx:"auto",px:"20px"}),G=l("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),J=l("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),Z=l("div",{d:"flex",justify:"space-between",align:"center",gap:"5px",mt:"35px",">span":{mx:"95px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{mt:"10px",gap:"15px",direction:"column"}}),H=l("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"},">div":{d:"flex",justify:"space-between",gap:"5px"}}),ee=l("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"}}),te=l("div",{d:"flex",justify:"space-between",gap:"5px"}),ne=l("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"}),ae=l("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}}),ie=l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}}),se=l("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}}),re=l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{img:{scale:"3.2",translate:"-5px 10px"}}}}});l("div",{d:"flex",justify:"center",align:"center",direction:"column",gap:"20px",mt:"40px",img:{height:235,width:235,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});l("div",{d:"flex",justify:"center",align:"center",width:"23%"});l("div",{d:"flex",justify:"center",align:"center",direction:"column",textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",img:{height:80,width:80,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});const le=async c=>await W({options:{code:C.battleAle,index_position:1,limit:"1000",lower_bound:c,upper_bound:c,scope:C.battleAle,table:O.history}}),ce=c=>I({enabled:!!E.getState().user,queryKey:[P.HistoryDataState,c],queryFn:()=>oe(c),staleTime:1e3*60*20});async function oe(c){try{const d=await le(c);if(!d)return null;const g=d==null?void 0:d.find(o=>o.history_id===c);return g?{...g,team1_fighters:g.team1_fighters.filter(o=>typeof o.fighter_id=="number")}:null}catch(d){return console.log(d),null}}const de=async c=>await W({options:{code:C.poolsAle,index_position:2,key_type:"i64",limit:"1000",reverse:!0,lower_bound:c,upper_bound:c,scope:C.poolsAle,table:"minehistory"}}),pe=()=>I({enabled:!!E.getState().user,queryKey:[P.dungeonPoolDataState],queryFn:()=>xe(),staleTime:1e3*60*20});async function xe(){const c=E.getState().user;try{const d=await de(c==null?void 0:c.name);return d!=null&&d[0]?d[0]:null}catch(d){return console.log(d),null}}function fe(c,d){const g=[...c.map(o=>({...o,team:1})),...d.map(o=>({...o,team:2}))],j=[];for(;g.filter(o=>o.team===1&&o.health>0).length>0&&g.filter(o=>o.team===2&&o.health>0).length>0;){const o=g.filter(f=>f.health>0),p=o.reduce((f,_)=>_.initiative<f.initiative?_:f),w=p.team===1?2:1,v=o.filter(f=>f.team===w);if(v.length===0)return;const a=v.reduce((f,_)=>_.taunt>f.taunt?_:f),t=`res_${p.element}`,A=a[t]/10,s=p.damage*(100-A)/100,b=s*100/p.damage;j.push({attacker:p,defender:a,attack:s,attackerHealthBefore:p.health,attackerTeam:p.team,defenderTeam:a.team,defenderTauntBefore:a.taunt,defenderHealthBefore:a.health,effectiveness:b}),a.health-=s,a.taunt=Math.max(0,a.taunt-10),p.initiative+=p.attackspeed}return j}const B=F.lazy(()=>y(()=>import("./index-3839b643.js"),["assets/index-3839b643.js","assets/index-32d28607.js","assets/index-55fec1ff.css"])),S=F.lazy(()=>y(()=>import("./index-f45dfb67.js"),["assets/index-f45dfb67.js","assets/index-32d28607.js","assets/index-55fec1ff.css","assets/iconBase-e23722e6.js"])),he=F.lazy(()=>y(()=>import("./index-7d0fb9dc.js"),["assets/index-7d0fb9dc.js","assets/index-32d28607.js","assets/index-55fec1ff.css","assets/assets-id-query-c4836dcb.js","assets/useQuery-20f20cfd.js","assets/adapters-c28745f5.js","assets/atomic-api-848de6bf.js","assets/toast-options-07ca6d7b.js"])),Ce=({historyId:c})=>{const{areaSelected:d,setAreaSelected:g}=V(),{data:j}=ce(c),{data:o}=pe(),{data:p}=Y(),{data:w}=K(),v=m.useRef(null),[a,z]=m.useState(),[t,A]=m.useState([]),[s,b]=m.useState(0),[f,_]=m.useState(!1),[T,k]=m.useState({}),$=m.useMemo(()=>p==null?void 0:p.find(n=>n.weather_id===(w==null?void 0:w.current_weather_id)),[p,w]);function Q(){g(null)}function q(){if(!a)return;b(t.length);const n={},x=a.team1_fighters.map(i=>({...i,team:1})),r=a.team2_fighters.map(i=>({...i,team:2}));[...x,...r].forEach(i=>{n[`${i.fighter_id}-${i.team}`]=i.health}),t.forEach(i=>{n[`${i.defender.fighter_id}-${i.defenderTeam}`]=i.defender.health}),k(n),_(!0)}return m.useEffect(()=>{z(j??void 0)},[j]),m.useEffect(()=>{if(a!=null&&a.team1_fighters&&(a!=null&&a.team2_fighters)){const n=a.team1_fighters.map(u=>({...u,team:1})),x=a.team2_fighters.map(u=>({...u,team:2})),r={};[...n,...x].forEach(u=>{r[`${u.fighter_id}-${u.team}`]=u.health}),k(r);const i=fe(n,x);A(i||[]),b(0)}},[a,d]),m.useEffect(()=>{if(t.length===0)return;s>t.length&&_(!0);const n=setTimeout(()=>{var u,R,M;const x=(u=t==null?void 0:t[s])==null?void 0:u.attack,r=(R=t==null?void 0:t[s])==null?void 0:R.defender,h=(M=t==null?void 0:t[s])==null?void 0:M.defenderTeam;T[`${r==null?void 0:r.fighter_id}-${h}`]!==void 0&&k({...T,[`${r==null?void 0:r.fighter_id}-${h}`]:Math.max(0,T[`${r==null?void 0:r.fighter_id}-${h}`]-x)});const i=s+1;b(i)},1e3);return()=>clearTimeout(n)},[t,s,T]),m.useEffect(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)},[s]),e.jsxs(L,{children:[e.jsx(U,{children:f?e.jsx(B,{onClick:Q,children:"Back"}):e.jsx(B,{onClick:q,children:"Skip Fight"})}),e.jsx(X,{children:f?e.jsx(he,{data:j,pool:o,healthMap:T}):e.jsxs(e.Fragment,{children:[e.jsx(G,{children:"Weather"}),e.jsx(J,{children:$==null?void 0:$.displayname}),e.jsxs(N,{children:[e.jsxs(Z,{children:[e.jsxs(H,{children:[e.jsx("span",{children:"YOUR TEAM"}),e.jsx("div",{children:a==null?void 0:a.team1_fighters.map(n=>{var x,r,h,i;return e.jsx(S,{isFighting:!0,isAttacking:((x=t==null?void 0:t[s])==null?void 0:x.attackerTeam)===1&&((r=t==null?void 0:t[s])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((h=t==null?void 0:t[s])==null?void 0:h.defenderTeam)===1&&((i=t==null?void 0:t[s])==null?void 0:i.defender.fighter_id)===n.fighter_id,fighter:{...n,stats:{...n,health:T[`${n.fighter_id}-1`]}}},D())})})]}),e.jsx("span",{children:"VS"}),e.jsx(te,{children:a==null?void 0:a.team2_fighters.map(n=>{var x,r,h,i;return e.jsxs(ee,{children:[e.jsx("span",{children:"AI"}),e.jsx(S,{isFighting:!0,isAttacking:((x=t==null?void 0:t[s])==null?void 0:x.attackerTeam)===2&&((r=t==null?void 0:t[s])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((h=t==null?void 0:t[s])==null?void 0:h.defenderTeam)===2&&((i=t==null?void 0:t[s])==null?void 0:i.defender.fighter_id)===n.fighter_id,fighter:{...n,stats:{...n,health:T[`${n.fighter_id}-2`]}}})]},D())})})]}),e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsxs(ie,{children:[e.jsx("span",{children:"Attacker"}),e.jsx("span",{children:"Defender"}),e.jsx("span",{children:"Attack"}),e.jsx("span",{children:"Damage"}),e.jsx("span",{children:"Remaining Health"}),e.jsx("span",{children:"Effectiveness"}),e.jsx("span",{children:"Special Event"})]}),e.jsx(se,{ref:v,children:t.slice(0,s).map((n,x)=>e.jsxs(re,{children:[e.jsx(S,{isFighting:!0,fighter:{...n.attacker,stats:{...n.attacker,health:n.attackerHealthBefore}}}),e.jsx(S,{isFighting:!0,fighter:{...n.defender,stats:{...n.defender,health:n.defenderHealthBefore-n.attack}}}),e.jsx("span",{children:n.attack.toFixed(2)}),e.jsx("span",{children:n.attacker.damage.toFixed(2)}),e.jsx("span",{children:(n.defenderHealthBefore-n.attack).toFixed(2)}),e.jsxs("span",{children:[n.effectiveness.toFixed(2),"%"]}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:["ID: ",n.attacker.fighter_id,e.jsx("br",{}),"TEAM: ",n.attackerTeam," "]}),e.jsxs("span",{children:["ID: ",n.defender.fighter_id,e.jsx("br",{}),"TEAM: ",n.defenderTeam]})]},x))})]})})]})]})})]})};export{Ce as default};

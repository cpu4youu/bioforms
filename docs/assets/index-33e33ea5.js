import{s as n,S as v,R as a,_ as x,u as T,a as C,r as l,j as s,Q as E}from"./index-79e9db7e.js";import R from"./index-3d3e0d78.js";import{u as S}from"./use-transaction-0358c116.js";import{s as D}from"./sleep-da79c358.js";import{o as k}from"./activequests-query-7afa6567.js";import{c as z,a as A}from"./calculateTImeLeft-7c0113ed.js";import{u as F}from"./index-0e7089f3.js";import"./index-ae46ad61.js";import"./toast-options-7e30d8e2.js";import"./useQuery-dc7c5337.js";import"./v4-4a60fe23.js";const I=n("div",{display:"flex",align:"flex-end",justify:"flex-end",direction:"column",gap:"10px",padding:"5px",h:"540px",w:"100%",maxW:"425px",bg:"#6E6E6E",border:"2px solid #C8C8C8",position:"relative"}),q=n("div",{display:"flex",w:"100%",position:"relative",img:{w:"100%",objectFit:"cover",h:"225px"},span:{fw:"bold",ff:"$heading",fs:"18px",color:"white",zIndex:"2",textShadow:"2px 2px 2px rgba(0, 0, 0)",position:"absolute",bottom:"10px",right:"10px"}}),Q=n("h2",{display:"flex",align:"center",justify:"center",w:"100%",h:"115px",zIndex:"2",fw:"normal",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),L=n("span",{display:"flex",align:"center",justify:"center",gap:"10px",w:"100%",h:"80px",zIndex:"2",fw:"bold",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),$=n("div",{display:"flex",direction:"column",position:"relative",height:"30px",w:"100%",br:"5px",bg:"#282828",border:"1px solid #121212",">span":{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","-webkit-text-stroke":".5px rgba(0, 0, 0, 0.36)",fw:"bold",ff:"$heading",fs:"18px",color:"white"},div:{br:"5px",height:"100%"}}),B=n(R,{display:"flex",align:"center",justify:"center",zIndex:"3",w:"100%",h:"40px",fw:"bold",br:"2px !important",bg:"#9E475D !important",borderWidth:"1px",img:{w:"25px",h:"25px",objectFit:"contain"},variants:{isCompleted:{true:{bg:"#6750A4 !important"}}}});async function P(e,r,i){const{executeTransaction:c}=S(),p=M(e,r,i);return!!await c(p)}function M(e,r,i){return{actions:[{account:v.questAle,name:"reroll",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,scope:r,quest_name:i}}]}}const O=a.lazy(()=>x(()=>import("./shards-a600cca0.js"),["assets/shards-a600cca0.js","assets/index-79e9db7e.js","assets/index-55fec1ff.css"])),W=a.lazy(()=>x(()=>import("./tlm-6795b8b3.js"),["assets/tlm-6795b8b3.js","assets/index-79e9db7e.js","assets/index-55fec1ff.css"])),V=a.lazy(()=>x(()=>import("./index-41b0e6ea.js"),["assets/index-41b0e6ea.js","assets/index-79e9db7e.js","assets/index-55fec1ff.css"])),N=e=>{const r=T(C(t=>t.user)),{setCompleteQuests:i,completeQuests:c}=F(),[p,g]=a.useState(""),[m,_]=a.useState(!1),[h,w]=a.useState(!1);async function y(){if(!h){w(!0);return}_(!0);try{if(!await P(r,e.quest_scope,e.quest_name)){console.log("Failed to reroll quest");return}await D(3e3),await k(),E.success("Quest rerolled successfully!")}catch(t){console.log(t)}finally{_(!1)}}const f=l.useCallback(()=>{const t=z(new Date(e.expiry_date));if(t){const o=A(t,"days");g(o)}},[e.expiry_date]),d=l.useMemo(()=>{const t=r.permstats.find(j=>j.first===e.task_type),o=((t==null?void 0:t.second)||0)-e.task_start_value;return o>=0?o:0},[r,e]),b=l.useMemo(()=>{const t=d/e.task_end_value*100;let o="linear-gradient(90deg, #C2253F 0%, #f1546e92 100%)";return t>=50&&t<100?o="linear-gradient(90deg, #F7A600 0%, #FFD86B 100%)":t>=100&&(o="linear-gradient(90deg, #6CC000 0%, #ADDE6F 100%)"),{width:t+"%",background:o}},[d,e]);l.useEffect(()=>{f();const t=setTimeout(()=>{f()},1e3*60);return()=>{clearTimeout(t)}},[f]);const u=d>=e.task_end_value;return l.useEffect(()=>{u&&i([...c,e.quest_scope])},[u,e.quest_scope]),p===""?s.jsx(V,{}):s.jsxs(I,{children:[s.jsxs(q,{children:[s.jsx("img",{loading:"lazy",src:`/assets/quests/${e.task_type}_${e.quest_scope}.jpeg`,alt:""}),s.jsx("span",{children:p})]}),s.jsx(Q,{children:e.quest_description.replace("[amount]",String(e.task_end_value))}),s.jsxs(L,{children:[e.reward_type==="shards"?s.jsx(O,{}):s.jsx(W,{}),e.reward_amount]}),s.jsxs($,{children:[s.jsxs("span",{children:[d," / ",e.task_end_value]}),s.jsx("div",{style:b})]}),s.jsx(B,{isCompleted:u,isLoading:m,disabled:m,onClick:y,children:u?"Complete Quest":s.jsxs(s.Fragment,{children:[h?"Confirm Rerolling":"Reroll"," -10"," ",s.jsx("img",{loading:"lazy",src:"/assets/icons/credits.png",alt:""})]})})]})},oe=a.memo(N);export{oe as default};

import{s as c,L as k,S as u,d as B,Q as w,g as C,q as N,u as S,e as T,R as v,_ as A,a as K,b as Y,r as j,j as n,v as U}from"./index-8ba6f6d2.js";import{u as G}from"./index-f9d0dfe0.js";import{u as J,F as X}from"./index-24216194.js";import{u as Z}from"./use-media-6915e44a.js";import{s as ee}from"./sleep-da79c358.js";import{u as te}from"./use-transaction-59ddab84.js";import{u as D}from"./useQuery-8673c832.js";const ne=c("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",overflowY:"hidden",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),re=c("div",{gridArea:"header",d:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@lgxxx":{gridColumnStart:2,w:"100%",gridTemplateColumns:"1fr 1fr"},"@md":{gridColumnStart:1,gridTemplateColumns:"1fr 1fr"},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),ae=c("div",{position:"relative",gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}},"@md":{minH:"calc(100vh - 185px)",mt:"30px"}}),ie=c("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",br:"15px 15px 0 0",bg:"#19192D",position:"absolute",top:"-35px",left:"0"}),se=c(k,{border:"1px solid rgba(0, 0, 0, 0.25)",padding:"10px 20px",ff:"$heading",fs:"12px",color:"#fff","&:last-child":{br:"15px 15px 0 0"}}),oe=c("div",{gridArea:"main",d:"flex",justify:"space-between",gap:"5px",h:"100%",w:"100%",overflowY:"auto",px:"20px",">span":{mt:"55px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@xlg":{justify:"center",flexWrap:"wrap",">span":{my:"25px"}},"@md":{h:"calc(-280px + 100vh)"},variants:{isFighterSelected:{true:{justify:"center",flexWrap:"wrap",">span":{my:"25px"}}}}}),le=c("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),de=c("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),ce=c("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),ue=c("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function pe(e,t,i,a,s,o,d,p,x,g,f){const{executeTransaction:m}=te(),l=xe(e,t,i,a,s,o,d,p,x,g,f);return!!await m(l)}function xe(e,t,i,a,s,o,d,p,x,g,f){return{actions:[{account:u.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:t,land_id:i,crew_asset_id:a,weapon_asset_id:s,fighter_ids:o,difficulty:d,use_gems:p,history_id:x,x:g,y:f}}]}}const ge=B(e=>({myTeam:[null,null,null,null,null],setMyTeam:t=>e({myTeam:t}),selectedCards:[void 0,void 0],setSelectedCards:t=>e({selectedCards:t})}));function fe({user:e,areaSelected:t,myTeam:i,selectedCards:a,selectedLevel:s}){var d,p,x,g,f,m,l,b;const o=i.reduce((_,F)=>F?[..._,F.fighter_id]:_,[]);return!e||!(t!=null&&t.landId)||!o.length||!((d=a[0])!=null&&d.asset_id)||!((p=a[1])!=null&&p.asset_id)?(o.length||w.error("No Warrior selected"),(x=a[0])!=null&&x.asset_id||w.error("No Crew selected (First spot on cards)"),(g=a[1])!=null&&g.asset_id||w.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:t,crew_asset_id:Number((f=a[0])==null?void 0:f.asset_id),weapon_asset_id:Number((m=a[1])==null?void 0:m.asset_id),fighter_ids:o,selectedLevel:s})):{user:e,planet:e.planet,landId:t.landId,x:t.x,y:t.y,card1:Number((l=a[0])==null?void 0:l.asset_id),card2:Number((b=a[1])==null?void 0:b.asset_id),teamFiltered:o,level:s.level}}const me=async()=>await C({options:{code:u.dungeonsAle,index_position:1,limit:"1000",scope:u.dungeonsAle,table:N.config}}),he=()=>D({enabled:!!S.getState().user,queryKey:[T.dungeonConfigDataState],queryFn:()=>ye(),staleTime:1e3*60*20});async function ye(){try{const e=await me();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const be=async()=>await C({options:{code:u.battleAle,index_position:1,limit:"1000",scope:u.battleAle,table:"variables"}}),_e=()=>D({enabled:!!S.getState().user,queryKey:[T.VariablesState],queryFn:()=>Fe(),staleTime:1e3*60*20});async function Fe(){try{const e=await be();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const we=async()=>await C({options:{code:u.battleAle,index_position:1,limit:"1000",scope:u.battleAle,table:"weather"}}),Se=()=>D({enabled:!!S.getState().user,queryKey:[T.WeatherState],queryFn:()=>Te(),staleTime:1e3*60*20});async function Te(){try{return await we()}catch(e){return console.log(e),null}}const ve=async e=>await C({options:{code:u.battleAle,index_position:1,limit:"1000",lower_bound:e,upper_bound:e,scope:u.battleAle,table:N.history}}),Ie=e=>D({enabled:!!S.getState().user,queryKey:[T.HistoryDataState,e],queryFn:()=>I(e),staleTime:1e3*60*20});async function I(e){try{const t=await ve(e);if(!t)return null;const i=t==null?void 0:t.find(s=>s.history_id===e);return i?{...i,team1_fighters:i.team1_fighters.filter(s=>typeof s.fighter_id=="number")}:null}catch(t){return console.log(t),null}}const z=v.lazy(()=>A(()=>import("./index-edb23fa7.js"),["assets/index-edb23fa7.js","assets/index-8ba6f6d2.js","assets/index-55fec1ff.css"])),je=v.lazy(()=>A(()=>import("./index-c01d2ffb.js"),["assets/index-c01d2ffb.js","assets/index-8ba6f6d2.js","assets/index-55fec1ff.css","assets/useQuery-8673c832.js","assets/v4-4a60fe23.js","assets/index-f9d0dfe0.js","assets/index-24216194.js","assets/use-media-6915e44a.js","assets/sleep-da79c358.js","assets/use-transaction-59ddab84.js","assets/toast-options-d8835062.js"])),Ce=v.lazy(()=>A(()=>import("./index-b55d368b.js"),["assets/index-b55d368b.js","assets/index-8ba6f6d2.js","assets/index-55fec1ff.css","assets/fighters-query-24f74eb1.js","assets/useQuery-8673c832.js","assets/index-f9d0dfe0.js","assets/index-edb23fa7.js","assets/elements-a94bd2b3.js","assets/use-media-6915e44a.js","assets/inventory-query-5c4f2aaa.js","assets/adapters-3096d7cf.js","assets/atomic-api-90da65a2.js","assets/toast-options-d8835062.js","assets/markers-21ad5773.js","assets/v4-4a60fe23.js","assets/index-24216194.js","assets/sleep-da79c358.js","assets/use-transaction-59ddab84.js"])),Ae=v.lazy(()=>A(()=>import("./index-f96a83ec.js"),["assets/index-f96a83ec.js","assets/index-8ba6f6d2.js","assets/index-55fec1ff.css","assets/useQuery-8673c832.js","assets/index-f9d0dfe0.js","assets/use-media-6915e44a.js","assets/v4-4a60fe23.js"])),De=()=>{const e=S(K(r=>r.user)),{isSuperLarge:t}=Z();J();const{data:i}=he(),{data:a}=_e(),{data:s}=Se(),{selectedCards:o,myTeam:d,setMyTeam:p,setSelectedCards:x}=ge(),{areaSelected:g,setAreaSelected:f}=Y(),{selectedLevel:m,selectedFighter:l,setSelectedFighter:b}=G(),[_,F]=j.useState(!1),[W,Q]=j.useState("");async function V(){try{F(!0);const r=fe({areaSelected:g,myTeam:d,selectedCards:o,selectedLevel:m,user:e});if(!r)return;const y=(()=>{const H="abcdefghijklmnopqrstuvwxyz12345";let R="";for(let q=0;q<12;q++){const P=Math.round(Math.random()*12+1);R+=H[P]}return R})();if(!await pe(e,e.planet,r.landId,r.card1,r.card2,r.teamFiltered,r.level,!0,y,r.x,r.y))return;await M(y),w.warn("No history data found yet. Retrying..."),await M(y)}catch(r){console.error(r)}finally{F(!1)}}async function M(r){await ee(5e3);const h=await I(r);if(h){U.setQueryData([T.HistoryDataState,r],h),Q(r),w.success("Fight Started !");return}}function $(){x([void 0,void 0]),p([null,null,null,null,null]),f(null)}const O=j.useMemo(()=>{var h,y,E;return!d.filter(H=>H!==null).length||!((h=o[0])!=null&&h.asset_id)||!((y=o[1])!=null&&y.asset_id)||Number(((E=e==null?void 0:e.activestats)==null?void 0:E.action_points)||0)<((i==null?void 0:i.energy_cost)||0)},[d,o,i,e]),L=j.useMemo(()=>s==null?void 0:s.find(r=>r.weather_id===(a==null?void 0:a.current_weather_id)),[s,a]);return W?n.jsx(je,{historyId:W}):n.jsxs(ne,{isFighterSelected:!!l,children:[n.jsxs(re,{children:[n.jsx(z,{onClick:$,children:"Back"}),n.jsxs(z,{disabled:O||_,isLoading:_,onClick:V,children:["Start Fight",n.jsxs("div",{children:["-",i==null?void 0:i.energy_cost,n.jsx("img",{src:"/assets/icons/energy.png",alt:"Potion"})]})]})]}),n.jsxs(ae,{isFighterSelected:!!l,children:[n.jsx(ie,{children:n.jsx(se,{to:"/dungeon-leaderboard",children:"Leaderboard"})}),n.jsx(le,{children:"Weather"}),n.jsx(de,{children:L==null?void 0:L.displayname}),n.jsxs(oe,{isFighterSelected:t&&!!l,children:[n.jsx(Ce,{}),n.jsx("span",{children:"VS"}),n.jsx(Ae,{})]})]}),n.jsx(ce,{isFighterSelected:!!l,children:l?n.jsx(X,{selectedFighter:{...l,...l.stats},onCloseFighterDetail:b}):n.jsx(n.Fragment,{children:n.jsx(ue,{children:"Select a Fighter"})})})]})},Le=v.memo(De),Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{Se as a,_e as b,ge as c,Qe as i,Ie as u};

import{s as l,g as P,S as M,u as A,e as Q,R as $,_ as E,a as O,b as Y,r as u,j as e}from"./index-4a337f59.js";import{b as L,u as V}from"./weather-query-7c12a889.js";import{u as K}from"./useQuery-48081c09.js";import{u as q}from"./landtranking-query-a76724dd.js";import{v as y}from"./v4-4a60fe23.js";import"./sleep-da79c358.js";const U=l("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),X=l("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),N=l("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justifyContent:"center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423"}),G=l("div",{gridArea:"main",d:"flex",direction:"column",w:"100%",maxW:"1360px",h:"calc(100vh - 235px)",mx:"auto",px:"20px"}),J=l("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),Z=l("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),H=l("div",{d:"flex",justify:"space-between",align:"center",gap:"5px",mt:"35px",">span":{mx:"95px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{mt:"10px",gap:"15px",direction:"column"}}),ee=l("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"},">div":{d:"flex",justify:"space-between",gap:"5px"}}),te=l("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"}}),ne=l("div",{d:"flex",justify:"space-between",gap:"5px"}),ae=l("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"}),ie=l("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}}),se=l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}}),re=l("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}}),le=l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{img:{scale:"3.2",translate:"-5px 10px"}}}}});l("div",{d:"flex",justify:"center",align:"center",direction:"column",gap:"20px",mt:"40px",img:{height:235,width:235,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});l("div",{d:"flex",justify:"center",align:"center",width:"23%"});l("div",{d:"flex",justify:"center",align:"center",direction:"column",textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",img:{height:80,width:80,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});const ce=async x=>await P({options:{code:M.poolsAle,index_position:2,key_type:"i64",limit:"1000",reverse:!0,lower_bound:x,upper_bound:x,scope:M.poolsAle,table:"minehistory"}}),de=()=>K({enabled:!!A.getState().user,queryKey:[Q.dungeonPoolDataState],queryFn:()=>oe(),staleTime:1e3*60*20});async function oe(){const x=A.getState().user;try{const c=await ce(x==null?void 0:x.name);return c!=null&&c[0]?c[0]:null}catch(c){return console.log(c),null}}function pe(x){const c=[];for(;x.filter(d=>d.team===1&&d.health>0).length>0&&x.filter(d=>d.team===2&&d.health>0).length>0;){const d=x.filter(h=>h.health>0),f=d.reduce((h,a)=>a.initiative<h.initiative?a:h),T=f.team===1?2:1,v=d.filter(h=>h.team===T);if(v.length===0)return;const m=v.reduce((h,a)=>a.taunt>h.taunt?a:h),_=`res_${f.element}`,s=m[_]/10,w=f.damage*(100-s)/100,t=w*100/f.damage;c.push({attacker:f,defender:m,attack:w,attackerHealthBefore:f.health,attackerTeam:f.team,defenderTeam:m.team,defenderTauntBefore:m.taunt,defenderHealthBefore:m.health,effectiveness:t}),m.health-=w,m.taunt=Math.max(0,m.taunt-10),f.initiative+=f.attackspeed}return c}const W=$.lazy(()=>E(()=>import("./index-c6b2b6e0.js"),["assets/index-c6b2b6e0.js","assets/index-4a337f59.js","assets/index-55fec1ff.css"])),S=$.lazy(()=>E(()=>import("./index-153a8162.js"),["assets/index-153a8162.js","assets/index-4a337f59.js","assets/index-55fec1ff.css","assets/iconBase-01cc0061.js"])),xe=$.lazy(()=>E(()=>import("./index-370430cb.js"),["assets/index-370430cb.js","assets/index-4a337f59.js","assets/index-55fec1ff.css","assets/assets-id-query-91aca443.js","assets/useQuery-48081c09.js","assets/adapters-52de22a2.js","assets/atomic-api-18d0773e.js","assets/toast-options-4f3fcaeb.js"])),ve=({historyId:x})=>{const c=A(O(n=>n.user)),{areaSelected:d,setAreaSelected:f}=Y(),{data:T}=q((c==null?void 0:c.planet)||"",(d==null?void 0:d.landId)||""),{data:v}=L(x),{data:m}=de(),{data:b}=V(c.planet,(T==null?void 0:T.weather_id)||""),_=u.useRef(null),[s,w]=u.useState(),[t,h]=u.useState([]),[a,C]=u.useState(0),[F,z]=u.useState(!1),[j,k]=u.useState({});function B(){f(null)}function I(){if(!s)return;C(t.length);const n={},o=s.team1_fighters.map(i=>({...i,team:1})),r=s.team2_fighters.map(i=>({...i,team:2}));[...o,...r].forEach(i=>{n[`${i.fighter_id}-${i.team}`]=i.health}),t.forEach(i=>{n[`${i.defender.fighter_id}-${i.defenderTeam}`]=i.defender.health}),k(n),z(!0)}return u.useEffect(()=>{w(v??void 0)},[v]),u.useEffect(()=>{if(s!=null&&s.team1_fighters&&(s!=null&&s.team2_fighters)){const n=s.team1_fighters.map(g=>({...g,team:1})),o=s.team2_fighters.map(g=>({...g,team:2})),r={},p=[...n,...o];p.forEach(g=>{r[`${g.fighter_id}-${g.team}`]=g.health}),k(r);const i=pe(p);h(i||[]),C(0)}},[s,d]),u.useEffect(()=>{if(t.length===0)return;const n=setTimeout(()=>{var g,R,D;const o=(g=t==null?void 0:t[a])==null?void 0:g.attack,r=(R=t==null?void 0:t[a])==null?void 0:R.defender,p=(D=t==null?void 0:t[a])==null?void 0:D.defenderTeam;j[`${r==null?void 0:r.fighter_id}-${p}`]!==void 0&&k({...j,[`${r==null?void 0:r.fighter_id}-${p}`]:Math.max(0,j[`${r==null?void 0:r.fighter_id}-${p}`]-o)});const i=a+1;C(i)},1e3);return a>t.length&&(z(!0),clearTimeout(n)),()=>clearTimeout(n)},[t,a,j]),u.useEffect(()=>{_.current&&(_.current.scrollTop=_.current.scrollHeight)},[a]),e.jsxs(U,{children:[e.jsx(X,{children:F?e.jsx(W,{onClick:B,children:"Back"}):e.jsx(W,{onClick:I,children:"Skip Fight"})}),e.jsx(N,{children:F?e.jsx(xe,{data:v,pool:m,healthMap:j}):e.jsxs(e.Fragment,{children:[e.jsx(J,{children:"Weather"}),e.jsx(Z,{children:b==null?void 0:b.displayname}),e.jsxs(G,{children:[e.jsxs(H,{children:[e.jsxs(ee,{children:[e.jsx("span",{children:"YOUR TEAM"}),e.jsx("div",{children:s==null?void 0:s.team1_fighters.map(n=>{var o,r,p,i;return e.jsx(S,{isFighting:!0,isAttacking:((o=t==null?void 0:t[a])==null?void 0:o.attackerTeam)===1&&((r=t==null?void 0:t[a])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((p=t==null?void 0:t[a])==null?void 0:p.defenderTeam)===1&&((i=t==null?void 0:t[a])==null?void 0:i.defender.fighter_id)===n.fighter_id,fighter:{...n,health:j[`${n.fighter_id}-1`]}},y())})})]}),e.jsx("span",{children:"VS"}),e.jsx(ne,{children:s==null?void 0:s.team2_fighters.map(n=>{var o,r,p,i;return e.jsxs(te,{children:[e.jsx("span",{children:"AI"}),e.jsx(S,{isFighting:!0,isAttacking:((o=t==null?void 0:t[a])==null?void 0:o.attackerTeam)===2&&((r=t==null?void 0:t[a])==null?void 0:r.attacker.fighter_id)===n.fighter_id,isDefending:((p=t==null?void 0:t[a])==null?void 0:p.defenderTeam)===2&&((i=t==null?void 0:t[a])==null?void 0:i.defender.fighter_id)===n.fighter_id,fighter:{...n,health:j[`${n.fighter_id}-2`]}})]},y())})})]}),e.jsx(ae,{children:e.jsxs(ie,{children:[e.jsxs(se,{children:[e.jsx("span",{children:"Attacker"}),e.jsx("span",{children:"Defender"}),e.jsx("span",{children:"Attack"}),e.jsx("span",{children:"Damage"}),e.jsx("span",{children:"Remaining Health"}),e.jsx("span",{children:"Effectiveness"}),e.jsx("span",{children:"Special Event"})]}),e.jsx(re,{ref:_,children:t.slice(0,a).map((n,o)=>e.jsxs(le,{children:[e.jsx(S,{isFighting:!0,fighter:{...n.attacker,health:n.attackerHealthBefore}}),e.jsx(S,{isFighting:!0,fighter:{...n.defender,health:n.defenderHealthBefore-n.attack}}),e.jsx("span",{children:n.attack.toFixed(2)}),e.jsx("span",{children:n.attacker.damage.toFixed(2)}),e.jsx("span",{children:(n.defenderHealthBefore-n.attack).toFixed(2)}),e.jsxs("span",{children:[n.effectiveness.toFixed(2),"%"]}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:["ID: ",n.attacker.fighter_id,e.jsx("br",{}),"TEAM: ",n.attackerTeam," "]}),e.jsxs("span",{children:["ID: ",n.defender.fighter_id,e.jsx("br",{}),"TEAM: ",n.defenderTeam]})]},o))})]})})]})]})})]})};export{ve as default};

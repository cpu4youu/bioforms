import{s as y,g as xe,S as T,e as fe,u as E,R as I,_ as z,a as J,r as d,j as s,Q as x}from"./index-20d8da76.js";import{s as ge}from"./shimmer-94ac80bd.js";import{u as _e,o as j}from"./fighters-query-c9df798f.js";import{u as he,s as be}from"./fightersSort-1ace76ad.js";import{u as we}from"./useQuery-90eb73c7.js";import{s as v}from"./sleep-da79c358.js";import{u as R}from"./use-transaction-780d0b02.js";import{u as je}from"./config-query-4a61f471.js";import{f as ve,a as Se,b as Te,s as Fe}from"./fighterFilters-e6065055.js";import"./toast-options-1e019bbe.js";const Le=y("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%","@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),Ce=y("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),ke=y("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",direction:"column",position:"relative",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",br:"0 15px 15px 15px",bg:"#141423",">img":{position:"absolute",top:0,left:0,w:"100%",h:"100%",objectFit:"cover"},"@xmd":{mt:"30px"}}),Pe=y("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",padding:"20px",width:"100%",height:"100%",flexWrap:"wrap",overflowY:"auto"}),Ae=y("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-35px",left:"0px"}),X=y("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:first-child":{br:"8px 0px 0px 0px"},"&:last-child":{br:"0 8px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}});y("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"});const De=y("div",{h:"175px",w:"395px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${ge} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Me=y("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),Ee=async()=>await xe({options:{code:T.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:T.battleAle,table:"levels"}}),Ie=()=>we({queryKey:[fe.levelsState],queryFn:()=>ze(),staleTime:1e3*60*60,enabled:!!E.getState().user});async function ze(){try{return await Ee()}catch(t){return console.log(t),null}}async function Z(t,l){const{executeTransaction:i}=R(),a=Re(t,l);return!!await i(a)}function Re(t,{cost_credits:l,cost_gems:i,fighter_ids:a}){return{actions:[{account:T.battleAle,name:"levelup",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_ids:a,cost_gems:i,cost_credits:l}}]}}async function ee(t,l){const{executeTransaction:i}=R(),a=qe(t,l);return!!await i(a)}function qe(t,{fighter_id:l}){return{actions:[{account:T.battleAle,name:"payday",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_id:l}}]}}async function Qe(t,l){const{executeTransaction:i}=R(),a=He(t,l);return!!await i(a)}function He(t,{fighter_ids:l}){return{actions:[{account:T.battleAle,name:"sellfighter",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_ids:l}}]}}const S=I.lazy(()=>z(()=>import("./index-d7ff8747.js"),["assets/index-d7ff8747.js","assets/index-20d8da76.js","assets/index-55fec1ff.css","assets/index-b5298baa.js"])),Ne=I.lazy(()=>z(()=>import("./index-675dd54c.js"),["assets/index-675dd54c.js","assets/index-20d8da76.js","assets/index-55fec1ff.css","assets/fightersSort-1ace76ad.js","assets/sleep-da79c358.js","assets/fighters-query-c9df798f.js","assets/useQuery-90eb73c7.js","assets/config-query-4a61f471.js","assets/markers-45cb96d1.js","assets/use-transaction-780d0b02.js","assets/toast-options-1e019bbe.js","assets/resStats-7c9727e3.js","assets/classtemps-query-0a7168af.js","assets/dateUtils-ab03db27.js","assets/index-b5298baa.js"])),Ye=I.lazy(()=>z(()=>import("./index-bf31f996.js"),["assets/index-bf31f996.js","assets/index-20d8da76.js","assets/index-55fec1ff.css","assets/elements-a94bd2b3.js","assets/markers-45cb96d1.js","assets/fightersSort-1ace76ad.js","assets/classtemps-query-0a7168af.js","assets/useQuery-90eb73c7.js"])),et=()=>{var O,W,B,V,K,U,G;const t=E(J(e=>e.user)),l=E(J(e=>e.updatePlayerData)),{data:i}=je(),{data:a,isLoading:w,isFetching:te}=_e(t.name),{data:c}=Ie(),{checkedFighters:F,setCheckedFighters:se,selectedFighter:o}=he(),[D,g]=d.useState(!1),[_,L]=d.useState(!1),[M,q]=d.useState("inventory"),[Q,ae]=d.useState([]),[H,ne]=d.useState([]),[N,re]=d.useState({label:"All",value:""}),[Y,ie]=d.useState(be[0]),oe=d.useMemo(()=>a==null?void 0:a.some(e=>e.stats.experience>=e.stats.required_experience&&(c==null?void 0:c.some(n=>n.level===e.stats.level+1))),[a,c]),u=d.useMemo(()=>a==null?void 0:a.reduce((e,n)=>{const r=c==null?void 0:c.find(p=>p.level===n.stats.level+1);return r&&n.stats.experience>=n.stats.required_experience?e={cost_credits:e.cost_credits+r.unlock_cost_credits,cost_gems:e.cost_gems+r.unlock_cost_gem,quantity:e.quantity+1}:e},{cost_credits:0,cost_gems:0,quantity:0}),[c,a]),$=d.useMemo(()=>(a==null?void 0:a.reduce((e,n)=>{const r=new Date(n.next_payday).getTime()/1e3,p=new Date(n.last_payday).getTime()/1e3,m=new Date().getTime()/1e3,b=(i==null?void 0:i.standard_pay_payday)||0;let f=0;r>m&&(f=r-m);const k=r-p-f,P=r-p,A=Math.floor(k/P*b+1);return A>1?e+=A:e},0))||0,[i,a]),ce=d.useMemo(()=>F.length*F.reduce((e,n)=>e+n.stats.credits,0),[F]),C=d.useMemo(()=>{if(!o)return 0;const e=new Date(o.next_payday).getTime()/1e3,n=new Date(o.last_payday).getTime()/1e3,r=new Date().getTime()/1e3,p=(i==null?void 0:i.standard_pay_payday)||0;let m=0;e>r&&(m=e-r);const b=e-n-m,f=e-n;return Math.floor(b/f*p+1)},[i,o]),h=d.useMemo(()=>{var n;if(!o)return null;const e=c==null?void 0:c.find(r=>r.level===o.stats.level+1);return e?((n=t.activestats)==null?void 0:n.credits)>=(e==null?void 0:e.unlock_cost_credits)?{type:"credits",amount:e==null?void 0:e.unlock_cost_credits}:{type:"gems",amount:e==null?void 0:e.unlock_cost_gem}:{type:"max-level",amount:0}},[c,t,o]);async function le(){try{g(!0);const e=(a==null?void 0:a.filter(r=>r.stats.experience>=r.stats.required_experience).map(r=>r.fighter_id))||[];if(!await Z(t,{cost_credits:(u==null?void 0:u.cost_credits)||0,cost_gems:(u==null?void 0:u.cost_gems)||0,fighter_ids:e}))return;await v(2e3),j(t.name),x.success("Fighter leveled up!")}catch(e){console.error(e)}finally{g(!1)}}async function de(){try{L(!0);const e=(a==null?void 0:a.reduce((r,p)=>{const m=new Date(p.next_payday).getTime()/1e3,b=new Date(p.last_payday).getTime()/1e3,f=new Date().getTime()/1e3,k=(i==null?void 0:i.standard_pay_payday)||0;let P=0;m>f&&(P=m-f);const A=m-b-P,ye=m-b;return Math.floor(A/ye*k+1)>1&&r.push(p.fighter_id),r},[]))||[];if(!await ee(t,{fighter_id:e}))return;await v(2e3),j(t.name),x.success("All available fighters paid!")}catch(e){console.error(e)}finally{L(!1)}}async function ue(){try{if(L(!0),!o)return x.error("No fighter selected for payday");if(!await ee(t,{fighter_id:[o.fighter_id]}))return;await v(2e3),j(t.name),x.success("Fighter paid!")}catch(e){console.error(e)}finally{L(!1)}}async function pe(){if(!o)return x.error("No fighter selected for payday");const e=c==null?void 0:c.find(n=>n.level===o.stats.level);try{if(g(!0),!e){x.error("No level find on levels table");return}if(!await Z(t,{cost_credits:e==null?void 0:e.unlock_cost_credits,cost_gems:e==null?void 0:e.unlock_cost_gem,fighter_ids:[o.fighter_id]}))return;await v(2e3),j(t.name),x.success("Fighter leveled up!")}catch(n){console.error(n)}finally{g(!1)}}async function me(){try{g(!0);const e=F.map(r=>Number(r));if(!await Qe(t,{fighter_ids:e}))return;await v(2e3),j(t.name),se([]),await l(),x.success("Fighters sold!")}catch(e){console.error(e)}finally{g(!1)}}return s.jsxs(Le,{children:[s.jsx(Ce,{children:M==="sell"?s.jsx(s.Fragment,{children:s.jsxs(S,{isLoading:D,onClick:me,children:["Sell selected",s.jsxs("div",{children:[ce,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs(S,{isLoading:_,disabled:_||$<=0,onClick:de,children:["Payday All"," ",s.jsxs("div",{children:[$,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})," "]})]}),s.jsxs(S,{isLoading:D,disabled:D||!oe,onClick:le,children:[s.jsxs("span",{children:["Level All ",s.jsxs("span",{children:["(",u==null?void 0:u.quantity,")"]})]}),s.jsxs("div",{children:[u==null?void 0:u.cost_credits,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})," "]})]}),C>0&&s.jsxs(S,{isLoading:_,disabled:_||C>((O=t.activestats)==null?void 0:O.action_points)||C<=0,onClick:ue,children:["Payday",s.jsxs("div",{children:["-",C,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Energy"})]})]}),h&&s.jsxs(S,{isLoading:_,disabled:_||((o==null?void 0:o.stats.experience)||0)<((o==null?void 0:o.stats.required_experience)||0)||h.amount>((W=t.activestats)==null?void 0:W.action_points)||h.amount>((B=t.activestats)==null?void 0:B.credits)||h.amount<=0,onClick:pe,children:["Level Up",s.jsxs("div",{children:["-",h.amount,s.jsx("img",{src:`/assets/icons/${h.type}.png`,alt:"Energy"})]})]})]})}),s.jsxs(ke,{children:[s.jsxs(Ae,{children:[s.jsx(X,{isSelected:M==="inventory",onClick:()=>q("inventory"),children:"Inventory"}),s.jsx(X,{isSelected:M==="sell",onClick:()=>q("sell"),children:"Sell"})]}),s.jsx(Ye,{selectedElement:Q,setSelectedElement:ae,selectedMarkers:H,setSelectedMarkers:ne,selectedClassname:N,setSelectedClassname:re,selectedSort:Y,setSelectedSort:ie}),s.jsx(Pe,{children:w||te?Array.from({length:9},(e,n)=>s.jsx(De,{},n)):a?(G=(U=(K=(V=a==null?void 0:a.filter(e=>ve(Q,e)))==null?void 0:V.filter(e=>Se(H,e)))==null?void 0:K.filter(e=>Te(N,e)))==null?void 0:U.toSorted((e,n)=>Fe(Y,e,n)))==null?void 0:G.map(e=>s.jsx(Ne,{fighter:e},e.fighter_id)):s.jsx(s.Fragment,{children:s.jsx(Me,{children:"You don't have Fighters"})})}),s.jsx("img",{src:"/assets/background/bg-fighters.png",alt:"",loading:"lazy"})]})]})};export{et as default};

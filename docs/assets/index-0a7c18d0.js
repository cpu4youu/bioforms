import{s as l,R as k,_ as $,u as L,a as B,b as D,r as f,j as p}from"./index-f65e9766.js";import{b as P,u as V}from"./weather-query-5af051bc.js";import{u as X}from"./landtranking-query-fc7e353a.js";import{u as O}from"./use-media-addaf86f.js";import"./useQuery-85c75519.js";import"./sleep-da79c358.js";const Q=l("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),Y=l("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),y=l("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justifyContent:"center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",overflowX:"hidden",padding:"10px",br:"15px",bg:"#141423",backgroundImage:"url(/assets/background/bg-fight.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",variants:{isResult:{true:{backgroundImage:"url(/assets/background/bg-result.png)"}}}}),K=l("div",{gridArea:"main",zIndex:2,d:"flex",justify:"center",direction:"column",w:"100%",maxW:"1360px",h:"100%","@lg":{mt:"60px"},"@sm":{mt:"0px"}}),N=l("h3",{d:"flex",justify:"center",align:"center",gap:"10px",zIndex:2,textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@lg":{img:{w:"50px",objectFit:"contain"},fontSize:"14px"}}),q=l("span",{textAlign:"center",w:"100%",mx:"auto",zIndex:2,fontSize:"58px",ff:"$heading",fw:"bold",color:"#C9C9C9","@lg":{h:"initial",fontSize:"28px"}}),G=l("div",{d:"flex",justify:"space-between",align:"center","@lg":{mt:"10px",gap:"15px",direction:"column"},"@sm":{">span":{color:"#E1CAFF",fw:"bold",ff:"$heading",fs:"22px"}}}),J=l("div",{d:"flex",ml:"auto",">div":{"&:nth-child(1)":{marginTop:"60px",marginRight:"-120px",zIndex:2},"&:nth-child(2)":{marginLeft:"80px",marginTop:"-40px",zIndex:1},"&:nth-child(3)":{marginLeft:"-100px",marginTop:"90px",marginRight:"-35px",zIndex:2},"&:nth-child(4)":{marginRight:"-50px",marginTop:"20px",zIndex:1},"&:nth-child(5)":{marginTop:"120px",zIndex:1}},"@lg":{mx:"auto"},"@sm":{flexWrap:"wrap",justifyContent:"center","> div:nth-child(n)":{margin:"0px "}}}),U=l("div",{d:"flex",align:"center",direction:"column",">span":{color:"#E1CAFF",fw:"bold",ff:"$heading",fs:"22px"}}),Z=l("div",{d:"flex",mx:"auto",">div":{transform:"scaleX(-1)","&:nth-child(1)":{marginTop:"60px",marginRight:"-120px",zIndex:2},"&:nth-child(2)":{marginLeft:"80px",marginTop:"-40px",zIndex:1},"&:nth-child(3)":{marginLeft:"-100px",marginTop:"90px",marginRight:"-35px",zIndex:2},"&:nth-child(4)":{marginRight:"-60px",marginTop:"20px",zIndex:1},"&:nth-child(5)":{marginTop:"120px",zIndex:1}},"@sm":{flexWrap:"wrap",justifyContent:"center","> div:nth-child(n)":{margin:"0px "}}});l("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"});l("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}});l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}});l("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}});l("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{img:{scale:"3.2",translate:"-5px 10px"}}}}});l("div",{d:"flex",justify:"center",align:"center",direction:"column",gap:"20px",mt:"40px",img:{height:235,width:235,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});l("div",{d:"flex",justify:"center",align:"center",width:"23%"});l("div",{d:"flex",justify:"center",align:"center",direction:"column",textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",img:{height:80,width:80,objectFit:"contain"}});l("div",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}});function H(u){const h=[];for(;u.filter(m=>m.team===1&&m.health>0).length>0&&u.filter(m=>m.team===2&&m.health>0).length>0;){const m=u.filter(o=>o.health>0),s=m.reduce((o,n)=>n.initiative<o.initiative?n:o),C=s.team===1?2:1,v=m.filter(o=>o.team===C);if(v.length===0)return;const c=v.reduce((o,n)=>n.taunt>o.taunt?n:o),w=`res_${s.element}`,i=c[w]/10,T=s.damage*(100-i)/100,e=T*100/s.damage;h.push({attacker:s,defender:c,attack:T,attackerHealthBefore:s.health,attackerTeam:s.team,defenderTeam:c.team,defenderTauntBefore:c.taunt,defenderHealthBefore:c.health,effectiveness:e}),c.health-=T,c.taunt=Math.max(0,c.taunt-10),s.initiative+=s.attackspeed}return h}const E=k.lazy(()=>$(()=>import("./index-00b7fb7c.js"),["assets/index-00b7fb7c.js","assets/index-f65e9766.js","assets/index-55fec1ff.css","assets/index-c53f66e7.js"])),F=k.lazy(()=>$(()=>import("./index-a7ffcd5a.js"),["assets/index-a7ffcd5a.js","assets/index-f65e9766.js","assets/index-55fec1ff.css"])),ee=k.lazy(()=>$(()=>import("./index-f0ccbad0.js"),["assets/index-f0ccbad0.js","assets/index-f65e9766.js","assets/index-55fec1ff.css","assets/index-00b7fb7c.js","assets/index-c53f66e7.js","assets/use-transaction-2f14948a.js","assets/toast-options-575cd6e6.js","assets/sleep-da79c358.js"])),le=({historyId:u})=>{const h=L(B(t=>t.user)),{isSmall:m}=O(),{areaSelected:s,setAreaSelected:C}=D(),{data:v}=X((h==null?void 0:h.planet)||"",(s==null?void 0:s.landId)||""),{data:c}=P(u),{data:j}=V(h.planet,(v==null?void 0:v.weather_id)||""),w=f.useRef(null),[i,T]=f.useState(),[e,o]=f.useState([]),[n,b]=f.useState(0),[S,A]=f.useState(!1),[_,z]=f.useState({});function W(){C(null)}function M(){if(!i)return;b(e.length);const t={},x=i.team1_fighters.map(a=>({...a,team:1})),r=i.team2_fighters.map(a=>({...a,team:2}));[...x,...r].forEach(a=>{t[`${a.fighter_id}-${a.team}`]=a.health}),e.forEach(a=>{t[`${a.defender.fighter_id}-${a.defenderTeam}`]=a.defender.health}),z(t),A(!0)}return f.useEffect(()=>{T(c??void 0)},[c]),f.useEffect(()=>{if(i!=null&&i.team1_fighters&&(i!=null&&i.team2_fighters)){const t=i.team1_fighters.map(g=>({...g,team:1})),x=i.team2_fighters.map(g=>({...g,team:2})),r={},d=[...t,...x];d.forEach(g=>{r[`${g.fighter_id}-${g.team}`]=g.health}),z(r);const a=H(d);o(a||[]),b(0)}},[i,s]),f.useEffect(()=>{if(e.length===0)return;const t=setTimeout(()=>{var g,I,R;const x=(g=e==null?void 0:e[n])==null?void 0:g.attack,r=(I=e==null?void 0:e[n])==null?void 0:I.defender,d=(R=e==null?void 0:e[n])==null?void 0:R.defenderTeam;_[`${r==null?void 0:r.fighter_id}-${d}`]!==void 0&&z({..._,[`${r==null?void 0:r.fighter_id}-${d}`]:Math.max(0,_[`${r==null?void 0:r.fighter_id}-${d}`]-x)});const a=n+1;b(a)},1e3);return n>e.length&&(A(!0),clearTimeout(t)),()=>clearTimeout(t)},[e,n,_]),f.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[n]),p.jsxs(Q,{children:[p.jsx(Y,{children:S?p.jsx(E,{onClick:W,children:"Back"}):p.jsx(E,{onClick:M,children:"Skip Fight"})}),p.jsx(y,{isResult:S,children:S?p.jsx(ee,{data:c,historyId:u}):p.jsxs(p.Fragment,{children:[p.jsxs(N,{children:[p.jsx("img",{src:"/assets/icons/weather.png",alt:""}),j==null?void 0:j.displayname]}),p.jsx(q,{children:"SHRIMPS ARENA"}),p.jsx(K,{children:p.jsxs(G,{children:[p.jsx(J,{children:i==null?void 0:i.team1_fighters.map(t=>{var x,r,d,a;return p.jsx(F,{isAttacking:((x=e==null?void 0:e[n])==null?void 0:x.attackerTeam)===1&&((r=e==null?void 0:e[n])==null?void 0:r.attacker.fighter_id)===t.fighter_id,isDefending:((d=e==null?void 0:e[n])==null?void 0:d.defenderTeam)===1&&((a=e==null?void 0:e[n])==null?void 0:a.defender.fighter_id)===t.fighter_id,fighter:{...t,health:_[`${t.fighter_id}-1`]}},t.fighter_id)})}),m&&p.jsx("span",{children:"VS"}),p.jsx(Z,{children:i==null?void 0:i.team2_fighters.map(t=>{var x,r,d,a;return p.jsxs(U,{children:[p.jsx(F,{isAttacking:((x=e==null?void 0:e[n])==null?void 0:x.attackerTeam)===2&&((r=e==null?void 0:e[n])==null?void 0:r.attacker.fighter_id)===t.fighter_id,isDefending:((d=e==null?void 0:e[n])==null?void 0:d.defenderTeam)===2&&((a=e==null?void 0:e[n])==null?void 0:a.defender.fighter_id)===t.fighter_id,fighter:{...t,health:_[`${t.fighter_id}-2`]}}),p.jsx("span",{children:"AI"})]},t.fighter_id)})})]})})]})})]})};export{le as default};

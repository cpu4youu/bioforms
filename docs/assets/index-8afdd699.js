import{s as a,S as D,d as E,R as d,_ as b,u as T,a as S,r as u,j as s,Q as C}from"./index-8891f2a7.js";import R from"./index-cd2df217.js";import{u as k}from"./use-transaction-d5204d54.js";import{s as z}from"./sleep-da79c358.js";import{o as A}from"./index-6dcc7a53.js";import"./index-fa3a6fb9.js";import"./toast-options-3ad8520a.js";import"./useQuery-597d3db4.js";import"./v4-4a60fe23.js";const I=a("div",{display:"flex",align:"flex-end",justify:"flex-end",direction:"column",gap:"10px",padding:"5px",w:"100%",maxW:"425px",bg:"#6E6E6E",border:"2px solid #C8C8C8",position:"relative",variants:{isExpired:{true:{"&::after":{zIndex:"2",content:'""',position:"absolute",top:"0",left:"0",w:"100%",h:"100%",bg:"rgba(0, 0, 0, 0.5)"}}}}}),L=a("div",{display:"flex",w:"100%",position:"relative",img:{w:"100%",objectFit:"cover",h:"225px"},span:{fw:"bold",ff:"$heading",fs:"18px",color:"white",zIndex:"2",position:"absolute",bottom:"10px",right:"10px"}}),B=a("h2",{display:"flex",align:"center",justify:"center",w:"100%",h:"115px",zIndex:"2",fw:"normal",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),F=a("span",{display:"flex",align:"center",justify:"center",gap:"10px",w:"100%",h:"80px",zIndex:"2",fw:"bold",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),Q=a("div",{display:"flex",direction:"column",position:"relative",height:"30px",w:"100%",br:"5px",bg:"#282828",border:"1px solid #121212",">span":{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","-webkit-text-stroke":".5px rgba(0, 0, 0, 0.36)",fw:"bold",ff:"$heading",fs:"18px",color:"white"},div:{br:"5px",height:"100%"}}),M=a(R,{display:"flex",align:"center",justify:"center",zIndex:"3",w:"100%",h:"40px",fw:"bold",br:"2px !important",bg:"#9E475D !important",borderWidth:"1px",img:{w:"25px",h:"25px",objectFit:"contain"},variants:{isCompleted:{true:{bg:"#6750A4 !important"}}}});async function $(e,o,r){const{executeTransaction:i}=k(),l=q(e,o,r);return!!await i(l)}function q(e,o,r){return{actions:[{account:D.questAle,name:"reroll",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,scope:o,quest_name:r}}]}}const N=E((e,o)=>({showNewQuestsButton:!0,setShowNewQuestsButton:r=>e({showNewQuestsButton:r})})),P=d.lazy(()=>b(()=>import("./shards-d5c6101f.js"),["assets/shards-d5c6101f.js","assets/index-8891f2a7.js","assets/index-55fec1ff.css"])),W=d.lazy(()=>b(()=>import("./tlm-7f06cb1a.js"),["assets/tlm-7f06cb1a.js","assets/index-8891f2a7.js","assets/index-55fec1ff.css"])),O=e=>{const o=T(S(t=>t.user)),{setShowNewQuestsButton:r}=N(),[i,l]=d.useState(""),[f,w]=d.useState(!1);async function y(){w(!0);try{if(!await $(o,e.quest_scope,e.quest_name)){console.log("Failed to reroll quest");return}await z(3e3),await A(),C.success("Quest rerolled successfully!")}catch(t){console.log(t)}finally{w(!1)}}const x=u.useCallback(()=>{if(!(e!=null&&e.expiry_date))return l("");const t=new Date,c=new Date(e==null?void 0:e.expiry_date).getTime()-t.getTime(),g=Math.floor(c/(1e3*60*60*24*7)),h=Math.floor(c/(1e3*60*60*24)-g*7),_=Math.floor(c/(1e3*60*60)-g*7*24-h*24),v=Math.floor(c/(1e3*60)-g*7*24*60-h*24*60-_*60);if(c<=0)return r(!0),l("Expired");l(`${h}d ${_}h ${v}m`)},[e]),p=u.useMemo(()=>{var t;return((t=o.permstats.find(n=>n.first===e.task_type))==null?void 0:t.second)||0},[o,e]),j=u.useMemo(()=>{const t=p/e.task_end_value*100;let n="linear-gradient(90deg, #C2253F 0%, #f1546e92 100%)";return t>=50&&t<100?n="linear-gradient(90deg, #F7A600 0%, #FFD86B 100%)":t>=100&&(n="linear-gradient(90deg, #6CC000 0%, #ADDE6F 100%)"),{width:t+"%",background:n}},[p,e]);u.useEffect(()=>{x();const t=setTimeout(()=>{x()},1e3*60);return()=>{clearTimeout(t)}},[x]);const m=p>=e.task_end_value;return s.jsxs(I,{isExpired:i==="Expired",children:[s.jsxs(L,{children:[s.jsx("img",{loading:"lazy",src:`/assets/quests/${e.task_type}.jpeg`,alt:""}),s.jsx("span",{children:i})]}),s.jsx(B,{children:e.quest_description.replace("[amount]",String(e.task_end_value))}),s.jsxs(F,{children:[e.reward_type==="shards"?s.jsx(P,{}):s.jsx(W,{}),e.reward_amount]}),s.jsxs(Q,{children:[s.jsxs("span",{children:[p," / ",e.task_end_value]}),s.jsx("div",{style:j})]}),s.jsx(M,{isCompleted:m,isLoading:f,disabled:f,onClick:y,children:m?"Complete Quest":s.jsxs(s.Fragment,{children:["Reroll -10 ",s.jsx("img",{loading:"lazy",src:"/assets/icons/credits.png",alt:""})]})})]})},ee=d.memo(O);export{ee as default};

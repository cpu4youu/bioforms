import{s as c,g as O,S as C,q,u as K,d as L,R as $,_ as F,a as P,r as f,j as e}from"./index-17cebb9f.js";import{u as Q}from"./useQuery-d48b4923.js";import{v as A}from"./v4-4a60fe23.js";const V=c("div",{d:"grid",gridTemplateAreas:`
    "empty header"
    "main main"
  `,gridTemplateColumns:"3fr 1fr",gap:"10px",br:"15px",w:"100%",h:"100%"}),U=c("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}}}),X=c("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",w:"100%",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 175px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423"}),y=c("div",{gridArea:"main",d:"flex",direction:"column",w:"100%",maxW:"1360px",h:"calc(100vh - 235px)",mx:"auto",px:"20px"}),G=c("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),N=c("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),J=c("div",{d:"flex",justify:"space-between",align:"center",gap:"5px",mt:"35px",">span":{mx:"95px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{mt:"10px",gap:"15px",direction:"column"}}),Z=c("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"},">div":{d:"flex",justify:"space-between",gap:"5px"}}),H=c("div",{d:"flex",direction:"column",">span":{color:"#535353",fw:"bold",ff:"$heading",fs:"12px"}}),ee=c("div",{d:"flex",justify:"space-between",gap:"5px"}),te=c("div",{d:"flex",justify:"space-between",gap:"5px",mt:"20px"}),ae=c("div",{mt:"20px",w:"100%","@sm":{mt:"5px",overflowX:"scroll"}}),ne=c("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",w:"100%",bg:"#242438",padding:"8px",fontSize:"12px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9",span:{d:"flex",align:"center",justify:"center",textAlign:"center"},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@md":{gap:"3px",fontSize:"12px"},"@sm":{padding:"2px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",gap:"3px",fontSize:"10px",w:"calc(100vw )",span:{fontSize:"8px"}},"@xsm":{w:"calc(110vw)"}}),se=c("div",{d:"flex",direction:"column",gap:"10px",pb:"20px",overflowY:"auto",h:"calc(100vh - 500px)",span:{d:"flex",align:"center",justify:"center",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@lg":{h:"calc(100vh - 500px)"},"@sm":{span:{fs:"8px"},w:"calc(100vw)",overflowX:"hidden"},"@xsm":{w:"calc(110vw)"}}),re=c("div",{d:"grid",gridTemplateColumns:"70px 70px 90px 90px 150px 150px 150px",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@xlg":{gridTemplateColumns:"70px 70px 70px 70px 100px 100px 100px"},"@sm":{padding:"2px",gap:"3px",gridTemplateColumns:"50px 50px 50px 50px 60px 60px 60px",span:{textAlign:"center",fontSize:"8px"},">button":{w:"50px",h:"50px",">div":{img:{scale:"3.2",translate:"-5px 10px"}}}}}),ie=async x=>await O({options:{code:C.battleAle,index_position:1,limit:"1000",lower_bound:x,upper_bound:x,scope:C.battleAle,table:q.history}}),le=x=>Q({enabled:!!K.getState().user,queryKey:[L.HistoryDataState,x],queryFn:()=>ce(x),staleTime:1e3*60*20});async function ce(x){try{const h=await ie(x);return h!=null&&h[0]?h[0]:null}catch(h){return console.log(h),null}}const E=$.lazy(()=>F(()=>import("./index-3a65e8b6.js"),["assets/index-3a65e8b6.js","assets/index-17cebb9f.js","assets/index-55fec1ff.css"])),_=$.lazy(()=>F(()=>import("./index-73d53c4c.js"),["assets/index-73d53c4c.js","assets/index-17cebb9f.js","assets/index-55fec1ff.css","assets/iconBase-ea21e7e7.js"])),fe=({historyId:x})=>{const{areaSelected:h,setAreaSelected:M}=P(),{data:S}=le(x),v=f.useRef(null),[l,R]=f.useState(),[t,z]=f.useState([]),[i,w]=f.useState(0),[m,b]=f.useState({});function B(){M(null)}function D(){w(t.length-1);const a={};t.forEach(r=>{a[`${r.defender.fighter_id}-${r.defenderTeam}`]=r.defender.stats.health}),b(a)}function W(a,r){const s=[...a.map(n=>({...n,team:1})),...r.map(n=>({...n,team:2}))],p=[];for(;s.filter(n=>n.team===1&&n.stats.health>0).length>0&&s.filter(n=>n.team===2&&n.stats.health>0).length>0;){const n=s.filter(o=>o.stats.health>0),d=n.reduce((o,j)=>j.stats.initiative<o.stats.initiative?j:o),T=d.team===1?2:1,u=n.filter(o=>o.team===T);if(u.length===0)return;const g=u.reduce((o,j)=>j.stats.taunt>o.stats.taunt?j:o);p.push({attacker:d,defender:g,attack:d.stats.damage,attackerHealthBefore:d.stats.health,attackerTeam:d.team,defenderTeam:g.team,defenderTauntBefore:g.stats.taunt,defenderHealthBefore:g.stats.health});const I=`res_${d.element}`,k=g.stats[I],Y=d.stats.damage*(100-k)*100;console.log("resistance",k),console.log("attack",Y,"attacker.stats.damage",d.stats.damage),console.log("=================="),g.stats.health-=d.stats.damage,g.stats.taunt=Math.max(0,g.stats.taunt-10),d.stats.initiative+=d.stats.attackspeed}return p}return f.useEffect(()=>{R(S??void 0)},[S]),f.useEffect(()=>{if(l!=null&&l.team1_fighters&&(l!=null&&l.team2_fighters)){const a=l.team1_fighters.map(n=>({...n,team:1,stats:{...n.stats}})),r=l.team2_fighters.map(n=>({...n,team:2,stats:{...n.stats}})),s={};[...a,...r].forEach(n=>{s[`${n.fighter_id}-${n.team}`]=n.stats.health}),b(s);const p=W(a,r);z(p||[]),w(0)}},[l,h]),f.useEffect(()=>{if(t.length===0||i>=t.length)return;const a=setTimeout(()=>{var d,T,u;const r=(d=t==null?void 0:t[i])==null?void 0:d.attack,s=(T=t==null?void 0:t[i])==null?void 0:T.defender,p=(u=t==null?void 0:t[i])==null?void 0:u.defenderTeam;m[`${s==null?void 0:s.fighter_id}-${p}`]!==void 0&&b({...m,[`${s==null?void 0:s.fighter_id}-${p}`]:Math.max(0,m[`${s==null?void 0:s.fighter_id}-${p}`]-r)});const n=i+1;w(n)},1e3);return()=>clearTimeout(a)},[t,i,m]),f.useEffect(()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight)},[i]),e.jsxs(V,{children:[e.jsx(U,{children:i>=t.length-1?e.jsx(E,{onClick:B,children:"Back"}):e.jsx(E,{onClick:D,children:"Skip Fight"})}),e.jsxs(X,{children:[e.jsx(G,{children:"Weather"}),e.jsx(N,{children:"+20% Gem Damage"}),e.jsxs(y,{children:[e.jsxs(J,{children:[e.jsxs(Z,{children:[e.jsx("span",{children:"YOUR TEAM"}),e.jsx("div",{children:l==null?void 0:l.team1_fighters.map(a=>{var r,s,p,n;return e.jsx(_,{isFighting:!0,isAttacking:((r=t==null?void 0:t[i])==null?void 0:r.attackerTeam)===1&&((s=t==null?void 0:t[i])==null?void 0:s.attacker.fighter_id)===a.fighter_id,isDefending:((p=t==null?void 0:t[i])==null?void 0:p.defenderTeam)===1&&((n=t==null?void 0:t[i])==null?void 0:n.defender.fighter_id)===a.fighter_id,fighter:{...a,stats:{...a.stats,health:m[`${a.fighter_id}-1`]}}},A())})})]}),e.jsx("span",{children:"VS"}),e.jsx(ee,{children:l==null?void 0:l.team2_fighters.map(a=>{var r,s,p,n;return e.jsxs(H,{children:[e.jsx("span",{children:"AI"}),e.jsx(_,{isFighting:!0,isAttacking:((r=t==null?void 0:t[i])==null?void 0:r.attackerTeam)===2&&((s=t==null?void 0:t[i])==null?void 0:s.attacker.fighter_id)===a.fighter_id,isDefending:((p=t==null?void 0:t[i])==null?void 0:p.defenderTeam)===2&&((n=t==null?void 0:t[i])==null?void 0:n.defender.fighter_id)===a.fighter_id,fighter:{...a,stats:{...a.stats,health:m[`${a.fighter_id}-2`]}}})]},A())})})]}),e.jsx(te,{children:e.jsxs(ae,{children:[e.jsxs(ne,{children:[e.jsx("span",{children:"Attacker"}),e.jsx("span",{children:"Defender"}),e.jsx("span",{children:"Attack"}),e.jsx("span",{children:"Damage"}),e.jsx("span",{children:"Remaining Health"}),e.jsx("span",{children:"Effectiveness"}),e.jsx("span",{children:"Special Event"})]}),e.jsx(se,{ref:v,children:t.slice(0,i).map((a,r)=>e.jsxs(re,{children:[e.jsx(_,{isFighting:!0,fighter:{...a.attacker,stats:{...a.attacker.stats,health:a.attackerHealthBefore}}}),e.jsx(_,{isFighting:!0,fighter:{...a.defender,stats:{...a.defender.stats,health:a.defenderHealthBefore-a.attack}}}),e.jsx("span",{children:a.attack}),e.jsx("span",{children:a.attack}),e.jsx("span",{children:a.defenderHealthBefore-a.attack}),e.jsx("span",{children:"100%"}),e.jsx("span",{children:"-"}),e.jsxs("span",{children:["ID: ",a.attacker.fighter_id,e.jsx("br",{}),"TEAM: ",a.attackerTeam," "]}),e.jsxs("span",{children:["ID: ",a.defender.fighter_id,e.jsx("br",{}),"TEAM: ",a.defenderTeam]})]},r))})]})})]})]})]})};export{fe as default};

import{s as p,f as pe,q as xe,S as w,t as G,e as J,u as M,g as fe,R as _,j as s,_ as X,b as ge,r as v,Q as I}from"./index-907b2698.js";import{u as de}from"./inventory-query-5c4bed6d.js";import{u as Z}from"./useQuery-468e16bd.js";import{u as ee}from"./use-transaction-5ddd46eb.js";import{s as ue}from"./sleep-da79c358.js";import{u as he}from"./use-media-092f6a8d.js";import{o as ve}from"./fighters-query-f5affac5.js";import"./atomic-api-2d5f4e0a.js";import"./toast-options-f08cc4c0.js";const me=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"100%"}),ye=p("div",{d:"flex",align:"flex-end",justify:"flex-end",gap:"10px",position:"relative",w:"100%",button:{d:"flex",align:"center",justify:"center",maxW:"188px",h:"70px",svg:{fill:"#00BAFF"},span:{d:"flex",align:"center",justify:"center",gap:"5px",color:"#828282"},img:{maxW:"35px",maxH:"30px"}},"@sm":{button:{justify:"center",gap:"2px",padding:"0",maxW:"33%",h:"45px",fs:"12px",span:{gap:"0px"},svg:{display:"none"}}}}),je=p("div",{d:"flex",align:"flex-start",justify:"center",gap:"10px",w:"100%",h:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",">img":{mt:"10px",h:"calc(100vh - 160px)",br:"15px","@lg":{d:"none"}}}),be=p("div",{d:"grid",gridTemplateAreas:`
    "title title title"
    "objectivesLeft content objectivesRight"
    "objectivesLeft inventory objectivesRight"
    "objectivesLeft inventory objectivesRight"
    "objectivesLeft inventory objectivesRight"
  `,gridTemplateColumns:"1fr 5fr 1fr",gap:"20px",mt:"10px",padding:"15px 10px",bg:"#141423",br:"15px",w:"100%",h:"100%","@sm":{gridTemplateAreas:`
    "title title title"
    "content content content"
    "objectivesLeft objectivesLeft objectivesLeft"
    "objectivesRight objectivesRight objectivesRight"
    "inventory inventory inventory"
  `},variants:{isHidden:{true:{"@sm":{display:"none"}}}}});p("div",{d:"grid",gridTemplateAreas:`
    "title title title"
    "objectivesLeft content objectivesRight"
    "objectivesLeft inventory objectivesRight"
  `,gridTemplateColumns:"1fr 5fr 1fr",gap:"20px",mt:"10px",padding:"15px 10px",bg:"#141423",br:"15px",w:"100%","@sm":{gridTemplateAreas:`
    "title title title"
    "content content content"
    "objectivesLeft objectivesLeft objectivesLeft"
    "objectivesRight objectivesRight objectivesRight"
    "inventory inventory inventory"
  `},variants:{isHidden:{true:{"@sm":{display:"none"}}}}});const we=p("h2",{gridArea:"title",w:"100%",textAlign:"center",textTransform:"capitalize",fs:"24px",color:"#fff"}),_e=p("div",{gridArea:"content",display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"35px",w:"100%",">img":{w:"135px",h:"195px",br:"10px",objectPosition:"top",objectFit:"cover"},"@sm":{gap:"10px",img:{maxW:"85px"}},"@xsm":{gap:"5px",img:{maxW:"65px"}}}),Ce=p("div",{gridArea:"content",img:{"&:hover":{transform:"scale(1.05)",zIndex:"4","-webkit-filter":"drop-shadow(0px 0px 8px #00BAFF)",filter:"drop-shadow(0px 0px 5px #00BAFF)"},"&:nth-of-type(1)":{transform:"translate(30px,20px) rotate(-20deg)",zIndex:"3","&:hover":{transform:"scale(1.05) translate(30px,20px) rotate(-20deg)",zIndex:"4"}},"&:nth-of-type(3)":{transform:"translate(-30px,20px) rotate(20deg)",zIndex:"1","&:hover":{transform:"scale(1.05) translate(-30px,20px) rotate(20deg)",zIndex:"4"}},"@sm":{"&:nth-of-type(1)":{transform:"translate(20px,9px) rotate(-20deg)",zIndex:"3","&:hover":{transform:"scale(1.05) translate(20px,9px) rotate(-20deg)",zIndex:"4"}},"&:nth-of-type(3)":{transform:"translate(-20px,9px) rotate(20deg)",zIndex:"1","&:hover":{transform:"scale(1.05) translate(-20px,9px) rotate(20deg)",zIndex:"4"}}}},variants:{cardSelected:{0:{img:{"&:nth-of-type(1)":{zIndex:"3"},"&:nth-of-type(2)":{opacity:"0.2"},"&:nth-of-type(3)":{opacity:"0.2"}}},1:{img:{"&:nth-of-type(1)":{opacity:"0.2"},"&:nth-of-type(2)":{},"&:nth-of-type(3)":{opacity:"0.2"}}},2:{img:{"&:nth-of-type(1)":{opacity:"0.2"},"&:nth-of-type(2)":{opacity:"0.2"},"&:nth-of-type(3)":{}}}}}});p("img",{cursor:"pointer",transition:"all 0.2s ease-in-out",w:"120px",h:"170px",zIndex:"2",variants:{isSelected:{true:{filter:"grayscale(100%)"}}},"@lg":{w:"100px",h:"150px"},"@sm":{width:"80px",height:"initial"},"@xsm":{width:"70px",height:"initial"}});const Le=pe({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Te=p("div",{w:"120px",h:"170px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${Le} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Ae=async()=>{var l,g;let n=!1,e;const t=[];for(;!n;){const h=await xe.get_table_rows({code:w.ADVENTURE_MC,index_position:1,limit:"10000",scope:w.ADVENTURE_MC,table:G.ADV_TEMPLATES,show_payer:!1,json:!0,lower_bound:e});n=!h.more,t.push(...h.rows.slice(0,-1)),e=((g=(l=h.rows)==null?void 0:l[h.rows.length-1])==null?void 0:g.templateid)??""}return t},Ie=()=>Z({queryKey:[J.tavernDataState],queryFn:()=>Re(),staleTime:1e3*60*60,enabled:!!M.getState().user});async function Re(){try{const n=await Ae();return n?ke(n):null}catch(n){return console.log(n),null}}function ke(n){return n.map(e=>({...e,"nft.mp":e.nft_mp,"tlm.mp":e.tlm_mp}))}const ze=async()=>await fe({options:{code:w.tavernAle,index_position:1,limit:"1000",scope:w.tavernAle,table:G.CONFIG}}),Fe=()=>Z({queryKey:[J.tavernConfigState],queryFn:()=>$e(),staleTime:1e3*60*60,enabled:!!M.getState().user});async function $e(){try{const n=await ze();return n||null}catch(n){return console.log(n),null}}async function De(n,e){const{executeTransaction:t}=ee(),l=Ee(n,e);return!!await t(l)}function Ee(n,e){return{actions:[{account:w.tavernAle,name:"reveal",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,use_gems:e}}]}}async function He(n,e,t){const{executeTransaction:l}=ee(),g=Se(n,e,t);return!!await l(g)}function Se(n,e,t){return{actions:[{account:w.playersAle,name:"hire",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,asset_ids:e,cost_action_points:t}}]}}const Me=n=>n?`/assets/aw-nft-images/${n}.webp`:"/assets/default-card.png",K=(n,e=!0)=>`/assets/fighter/${e?"full_":""}${n.racename}_${n.classname}${e?`_${n.element}`:""}.jpeg`,Ne=p("img",{cursor:"pointer",transition:"all 0.2s ease-in-out",w:"120px",h:"170px",zIndex:"2",variants:{isSelected:{true:{filter:"grayscale(100%)"}}},"@lg":{w:"100px",h:"150px"},"@sm":{width:"80px",height:"initial"},"@xsm":{width:"70px",height:"initial"}}),T=_.memo(({item:n,isSelected:e,onClick:t})=>{var l,g;return s.jsx(Ne,{isSelected:e,onClick:t,loading:"lazy",src:Me((l=n==null?void 0:n.template)==null?void 0:l.template_id),alt:(g=n==null?void 0:n.data)==null?void 0:g.name},n==null?void 0:n.asset_id)});T.displayName="InventoryCard";const Oe=p("div",{gridArea:"inventory",display:"flex",direction:"column",w:"100%",span:{ff:"$heading",fs:"16px",fw:"bold",color:"#fff",textAlign:"center"},"@sm":{mt:"0px"}}),Pe=p("div",{d:"flex",align:"center",justify:"center",gap:"20px",mb:"20px","@sm":{m:"0px 0 20px",gap:"10px"}}),We=p("button",{d:"flex",align:"center",justify:"center",fs:"20px",ff:"$heading",fw:"$bold",color:"$white500",variants:{isSelected:{true:{textUnderlineOffset:"0.5em",textDecoration:"underline"}}},"@sm":{fs:"14px"}}),Be=p("div",{d:"flex",flexWrap:"wrap",gap:"10px",overflow:"auto",w:"100%",maxH:"calc(100vh - 520px)"}),Ve=p("img",{cursor:"pointer",transition:"all 0.2s ease-in-out",w:"120px",h:"170px",zIndex:"2",variants:{isSelected:{true:{filter:"grayscale(100%)"}}},"@lg":{w:"100px",h:"150px"},"@sm":{width:"80px",height:"initial"},"@xsm":{width:"70px",height:"initial"}}),Qe=[{key:"crew.worlds",label:"Minions"},{key:"arms.worlds",label:"Weapons"},{key:"tool.worlds",label:"Tools"},{key:"level.worlds",label:"Levels"},{key:"faces.worlds",label:"Avatars"}],te=_.memo(({isInventoryLoading:n,filteredInventory:e,handleSelectCard:t,selectedCards:l,inventoryPosition:g,inventoryFilter:h,setInventoryFilter:C})=>s.jsx(Oe,{children:l.length!==0&&g===-1?s.jsx("span",{children:"Select a card"}):s.jsxs(s.Fragment,{children:[s.jsx(Pe,{children:Qe.map(o=>s.jsx(We,{isSelected:h===o.key,onClick:()=>C(o.key),children:o.label},o.key))}),s.jsx(Be,{children:n?Array.from({length:10}).map((o,d)=>s.jsx(Te,{},d)):s.jsxs(s.Fragment,{children:[s.jsx(Ve,{onClick:()=>t(void 0),src:"/assets/default-card.png",alt:"default card"}),e==null?void 0:e.map(o=>s.jsx(T,{item:o,isSelected:l.some(d=>(d==null?void 0:d.asset_id)===(o==null?void 0:o.asset_id)),onClick:()=>t(o)},o.asset_id))]})})]})}));te.displayName="InventoryContainer";const qe=p("div",{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"5px",mb:"auto",w:"100%","&.left":{gridArea:"objectivesLeft"},"&.right":{gridArea:"objectivesRight"},"@sm":{flexDirection:"row"}}),Ue=p("div",{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",w:"100%",maxW:"82px",h:"85px",padding:"5px 0px 0px",bg:"#358CAC",br:"3px",span:{color:"#fff",ff:"$heading",fs:"12px","&:first-child":{color:"#07445A",mb:"12px"}},variants:{disabled:{true:{filter:"grayscale(100%)"}}}}),Ke=p("div",{display:"flex",alignItems:"center",gap:"5px",mt:"auto",padding:"5px 10px",color:"#fff",ff:"$heading",fs:"14px",br:"3px",bg:"#17566D",w:"100%"}),S=_.memo(({areaSelected:n,selectedBonus:e,orientation:t})=>{var g;const l=t==="left";return s.jsx(qe,{className:t,children:(g=n==null?void 0:n.objectives)==null?void 0:g.slice(l?5:0,l?10:5).map(({objective_string:h,objective_type:C,objective_value:o,mod_value:d},j)=>s.jsxs(Ue,{disabled:!(e!=null&&e[j+(l?5:0)]),children:[s.jsx("span",{children:C}),s.jsx("span",{children:h==="-"?o:h}),s.jsxs(Ke,{children:[d,s.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]},j))})});S.displayName="ObjectivesContainer";const H=_.lazy(()=>X(()=>import("./index-22ec13bb.js"),["assets/index-22ec13bb.js","assets/index-907b2698.js","assets/index-55fec1ff.css"])),Y=_.lazy(()=>X(()=>import("./index-1459995b.js").then(n=>n.i),["assets/index-1459995b.js","assets/index-907b2698.js","assets/index-55fec1ff.css","assets/useQuery-468e16bd.js"])),Ye=()=>{const{setAreaSelected:n,areaSelected:e}=ge(),{user:t,updatePlayerData:l}=M(),{isSmall:g}=he(),[h,C]=v.useState("level.worlds"),[o,d]=v.useState(0),[j,ne]=v.useState({}),[y,N]=v.useState([void 0,void 0,void 0]),[O,P]=v.useState(!1),[W,B]=v.useState(!1),[R,k]=v.useState(!1),[z,V]=v.useState(!1),{data:A,isLoading:se}=de(h),{data:F}=Ie(),{data:c}=Fe();function ie(){n(null)}function $(i){if(i===o){d(-1);return}d(i)}function ae(i){if(!i){const x=y.map((r,b)=>{if(b!==o)return r});Q(x),d(o+1),N(x);return}if(y.some(x=>(x==null?void 0:x.asset_id)===(i==null?void 0:i.asset_id))){d(-1);return}const a=y.map((x,r)=>r===o?i:x);Q(a),d(o+1),N(a),o===2&&d(-1)}function Q(i){let a={};i.forEach(x=>{const r=F==null?void 0:F.find(u=>(u==null?void 0:u.templateid)===Number(x==null?void 0:x.template.template_id));if(!r||!(e!=null&&e.objectives))return;const b=e.objectives.reduce((u,f,E)=>{if(f.objective_value!==99999&&f.objective_value===(r==null?void 0:r[f.objective_type])){const L=f==null?void 0:f.mod_value;return u[E]=L,u}if(f.objective_type==="element"&&(f.objective_string.toLocaleLowerCase()===(r==null?void 0:r.element.toLocaleLowerCase())||f.objective_string.toLocaleLowerCase()===(r==null?void 0:r.weaponclass.toLocaleLowerCase()))){const L=f==null?void 0:f.mod_value;return u[E]=L,u}if(f.objective_string!=="-"&&f.objective_string.toLocaleLowerCase()===String(r==null?void 0:r[f.objective_type]).toLocaleLowerCase()){const L=f==null?void 0:f.mod_value;return u[E]=L,u}return u},{});a={...a,...b}}),ne(a)}function q(){var i,a,x,r,b,u;return!c||!t?null:((i=t==null?void 0:t.activestats)==null?void 0:i.gems)>=((a=c==null?void 0:c[0])==null?void 0:a.cost_reveal_gem)?(x=c==null?void 0:c[0])==null?void 0:x.cost_reveal_gem:((r=t==null?void 0:t.activestats)==null?void 0:r.credits)>=((b=c==null?void 0:c[0])==null?void 0:b.cost_reveal_credits)?(u=c==null?void 0:c[0])==null?void 0:u.cost_reveal_credits:null}async function D(i){if(!i){k(!1),V(!1);return}if(m){k(!0),V(!z);return}if(t){P(!0);try{await De(t,i)&&(await ue(2e3),await l(),I.success("Reveal success"))}catch(a){console.error("Error during reveal:",a),I.error("Failed to reveal fighter")}finally{P(!1)}}}async function re(){if(t){B(!0);try{await He(t,le,U)&&(await l(),ve(t.name),n(null),I.success("Hire success"))}catch(i){console.error("Error during hire:",i),I.error("Failed to hire fighter")}finally{B(!1)}}}const U=v.useMemo(()=>{var a;const i=Array.from({length:10},(x,r)=>j[r]||0).reduce((x,r)=>x+r,0);return(((a=c==null?void 0:c[0])==null?void 0:a.cost_hire_ap)||0)-i},[j,c]),oe=v.useMemo(()=>(A==null?void 0:A.filter(i=>y.some(a=>(a==null?void 0:a.asset_id)!==i.asset_id)))||[],[A,y]),le=v.useMemo(()=>y.filter(i=>!!i).map(i=>Number(i==null?void 0:i.asset_id)),[y]),ce=v.useMemo(()=>{var i;return(i=t==null?void 0:t.active_taverns)==null?void 0:i.some(a=>a.x===(e==null?void 0:e.x)&&a.y===(e==null?void 0:e.y))},[t==null?void 0:t.active_taverns,e==null?void 0:e.x,e==null?void 0:e.y]),m=v.useMemo(()=>{var i,a;if(((i=t==null?void 0:t.last_tavern)==null?void 0:i.x)===(e==null?void 0:e.x)&&((a=t==null?void 0:t.last_tavern)==null?void 0:a.y)===(e==null?void 0:e.y))return t==null?void 0:t.last_tavern_fighter},[t==null?void 0:t.last_tavern,t==null?void 0:t.last_tavern_fighter,e==null?void 0:e.x,e==null?void 0:e.y]);return s.jsxs(me,{children:[s.jsxs(ye,{children:[!ce&&s.jsxs(H,{disabled:W,isLoading:W,color:"black",onClick:re,children:["Hire",s.jsxs("span",{children:[U,s.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]}),s.jsx(H,{color:"black",isLoading:O,onClick:()=>{var i,a;return D((((i=t==null?void 0:t.activestats)==null?void 0:i.gems)||0)>=(((a=c==null?void 0:c[0])==null?void 0:a.cost_reveal_gem)||0))},disabled:q()===null||O,children:m?"Details":s.jsxs(s.Fragment,{children:["Reveal",s.jsxs("span",{children:[q(),s.jsx("img",{loading:"lazy",src:"/assets/icons/dust.png",alt:""})]})]})}),s.jsx(H,{color:"black",onClick:ie,children:"Back"})]}),s.jsxs(je,{children:[s.jsxs(be,{isHidden:R,children:[s.jsx(we,{children:m?`${m.racename} ${m.classname}`:"Unknown Fighter"}),s.jsx(S,{areaSelected:e,selectedBonus:j,orientation:"left"}),s.jsxs(_e,{children:[m?s.jsx("img",{onClick:()=>k(!0),src:K(m,!0),alt:"",loading:"lazy"}):s.jsx("img",{loading:"lazy",src:"/assets/fighter/default-avatar.jpg",alt:""}),s.jsxs(Ce,{cardSelected:o,children:[s.jsx(T,{item:y[0],onClick:()=>$(0)}),s.jsx(T,{item:y[1],onClick:()=>$(1)}),s.jsx(T,{item:y[2],onClick:()=>$(2)})]})]}),s.jsx(te,{selectedCards:y,inventoryPosition:o,isInventoryLoading:se,filteredInventory:oe,inventoryFilter:h,setInventoryFilter:C,handleSelectCard:ae}),s.jsx(S,{areaSelected:e,selectedBonus:j,orientation:"right"})]}),z&&m?s.jsx(Y,{isHidden:!R,selectedFighter:m,onCloseFighterDetail:()=>D()}):!z&&m?g?s.jsx(Y,{isHidden:!R,selectedFighter:m,onCloseFighterDetail:()=>D()}):s.jsx("img",{src:K(m,!1),alt:"",loading:"lazy"}):s.jsx("img",{src:"/assets/fighter/unknown-fighter.jpeg",alt:"",loading:"lazy"})]})]})},at=_.memo(Ye);export{at as default};

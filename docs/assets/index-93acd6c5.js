import{s as k,g as B,S as b,q as I,e as q,u as F,w as K,R as H,_ as P,a as Y,r as d,j as c}from"./index-9fc33c7c.js";import{o as R,a as M}from"./all-buildings-88238d1c.js";import{u as D}from"./useQuery-869993e9.js";import{u as G}from"./land-config-9f6448f5.js";import{u as N}from"./use-transaction-ed631b73.js";import{s as E}from"./sleep-da79c358.js";import{u as V}from"./index-387d6679.js";import{f as W}from"./constants-308cd0ac.js";import"./atomic-api-64194245.js";import"./toast-options-a6d93504.js";const J=k("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),X=async t=>await B({options:{code:b.landsAle,index_position:1,limit:"1000",scope:t,table:I.buildingcost}}),Z=t=>D({queryFn:()=>tt(t),queryKey:[q.buildingConfigState,t],staleTime:1e3*60*60,enabled:!!F.getState().user});async function z(t){return await K.invalidateQueries([q.buildingConfigState,t])}async function tt(t){try{return await X(t)}catch(n){return console.log(n),null}}async function ot(t,n){const{executeTransaction:s}=N(),u=nt(t,n);return!!await s(u)}function nt(t,n){return{actions:[{account:b.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:n.planet,x:n.x,y:n.y,building:n.building,level:n.level,cost_gem:n.cost_gem,cost_credits:n.cost_credits}}]}}async function st(t,n){const{executeTransaction:s}=N(),u=et(t,n);return!!await s(u)}function et(t,n){return{actions:[{account:b.landsAle,name:"boost",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:n.planet,building:n.building,x:n.x,y:n.y,cost_gems:n.cost_gems,cost_credits:n.cost_credits,boost_target:n.boost_target}}]}}const Q=H.lazy(()=>P(()=>import("./index-3b45a4b1.js"),["assets/index-3b45a4b1.js","assets/index-9fc33c7c.js","assets/index-55fec1ff.css"])),at=()=>{var h;const{data:t}=G(),n=F(Y(e=>e.user)),{selectedLand:s,setSelectedLand:u,buildingBoost:a,selectedBuild:o,setSelectedBuild:U}=V(),{data:g}=Z((o==null?void 0:o.building_name)||""),[f,x]=d.useState(!1),[y,w]=d.useState(!1);async function $(){var e;if(s)try{w(!0);const r=((e=n==null?void 0:n.activestats)==null?void 0:e.gems)>=m*10,p=r?m*10:0,l=r?0:m,_={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:o.building_name.toLowerCase(),boost_target:a[0],cost_gems:p,cost_credits:l};await st(n,_)&&(await E(1e3),await R(),await z(o.building_name.toLowerCase()),await M())}catch(r){console.error(r)}finally{w(!1)}}async function O(){if(!n){console.log("User not authenticated");return}if(!s||!o){console.log("Selected land or build is not available");return}if(!i){console.log("Building cost not available");return}if(!t||!t[0]){console.log("Land configuration not available");return}if(!a||a.length===0){console.log("Building boost not available");return}try{x(!0);const e={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:o.building_name.toLowerCase(),level:o!=null&&o.boost_score?(o.level||1)+1:1,cost_gem:i.cost_gem,cost_credits:i.cost_credits};await ot(n,e)&&(await E(2e3),await R(),await z(o==null?void 0:o.img),await M())}catch(e){console.error(e)}finally{x(!1),u(null),U({...W[0],index:0})}}const i=d.useMemo(()=>g==null?void 0:g.find(e=>e.building_name===o.building_name&&e.level===((o==null?void 0:o.level)||0)+1),[g,o]),m=d.useMemo(()=>{var S,j,C,A;const e=((S=t==null?void 0:t[0])==null?void 0:S.boost_base_cost)||0,r=((j=t==null?void 0:t[0])==null?void 0:j.boost_cost_first_percent)||0,p=(o==null?void 0:o.boost_score)||0,l=Number(((C=t==null?void 0:t[0])==null?void 0:C.boost_cost_mod)||0),_=(1-Math.pow(l,a[0]+1))/(1-l),v=(1-Math.pow(l,p/1e4+1))/(1-l),T=e+r*(_-v),L=(((A=t==null?void 0:t[0])==null?void 0:A.start_boost_score)||0)/1e4;return Math.round(T<L?L:T)},[a,t,o]);return c.jsxs(J,{children:[s&&!!(o!=null&&o.boost_score)&&c.jsxs(Q,{isLoading:y,disabled:y,onClick:$,children:["Boost"," ",c.jsxs("div",{children:[m.toFixed(2),c.jsx("img",{src:"/assets/icons/gems.png",alt:"Land"})," "]})]}),s&&!!i&&c.jsxs(Q,{isLoading:f,disabled:f,onClick:O,children:[o!=null&&o.boost_score?`Upgrade ${o==null?void 0:o.building_name}`:`Build ${o==null?void 0:o.building_name}`,c.jsxs("div",{children:[(h=i==null?void 0:i.cost_gem)==null?void 0:h.toLocaleString("en-US")," ",c.jsx("img",{src:"/assets/icons/gems.png",alt:"Land"})]})]})]})},bt=H.memo(at);export{bt as default};

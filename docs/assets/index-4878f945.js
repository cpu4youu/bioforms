import{s as M,d as Q,S as h,y as F,Q as v,u as w,A as q,R as z,_ as B,r as b,j as i}from"./index-52528459.js";import{o as H,a as N}from"./all-buildings-547a2686.js";import{u as I}from"./useQuery-a77f3a69.js";import{u as K}from"./land-config-3706c926.js";import{u as O}from"./use-transaction-0199cffb.js";import{s as P}from"./sleep-da79c358.js";import{u as U}from"./index-c48f97b0.js";import"./atomic-api-a23fb87b.js";import"./toast-options-a79bf299.js";import"./constants-1c8f422b.js";const Y=M("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),k=async t=>await Q({options:{code:h.landsAle,index_position:1,limit:"1000",scope:t,table:F.buildingcost}}),D=t=>I({queryFn:()=>W(t),queryKey:[v.buildingConfigState],staleTime:1e3*60*60,enabled:!!w.getState().user});async function V(){return await q.invalidateQueries(v.buildingConfigState)}async function W(t){try{return await k(t)}catch(s){return console.log(s),null}}async function $(t,s){const{executeTransaction:n}=O(),u=G(t,s);return!!await n(u)}function G(t,s){return{actions:[{account:h.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:s.planet,x:s.x,y:s.y,building:s.building,level:s.level,cost_gem:s.cost_gem,cost_credits:s.cost_credits}}]}}const y=z.lazy(()=>B(()=>import("./index-29423a27.js"),["assets/index-29423a27.js","assets/index-52528459.js","assets/index-55fec1ff.css"])),ct=()=>{var d,g,_,x,f;const{data:t}=K(),s=w(o=>o.user),{selectedLand:n,buildingBoost:u,selectedBuild:e}=U(),{data:r}=D((e==null?void 0:e.img)||""),[T,l]=b.useState(!1);async function S(){if(!(!s||!n||!a||!e||!e.building_name))try{l(!0);const o={planet:n.data.planetName,x:n.data.x,y:n.data.y,building:e.building_name.toLowerCase(),level:e.level||1,cost_gem:a.cost_gem,cost_credits:a.cost_credits};await $(s,o)&&(await P(1e3),await H(),await V(),await N())}catch(o){console.error(o)}finally{l(!1)}}const a=b.useMemo(()=>r==null?void 0:r.find(o=>o.building_name===e.img&&o.level===((e==null?void 0:e.level)||0)+1),[r,e]),L=((d=t==null?void 0:t[0])==null?void 0:d.boost_base_cost)||0,j=((g=t==null?void 0:t[0])==null?void 0:g.boost_cost_first_percent)||0,A=(e==null?void 0:e.boost_score)||0,c=Number(((_=t==null?void 0:t[0])==null?void 0:_.boost_cost_mod)||0),R=(1-Math.pow(c,u[0]+1))/(1-c),C=(1-Math.pow(c,A/1e4+1))/(1-c),m=L+j*(R-C),p=(((x=t==null?void 0:t[0])==null?void 0:x.start_boost_score)||0)/1e4,E=m<p?p:m;return i.jsxs(Y,{children:[n&&(e==null?void 0:e.building_name)&&i.jsxs(y,{children:["Boost"," ",i.jsxs("div",{children:[E.toFixed(2),i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})," "]})]}),n&&a&&i.jsxs(y,{isLoading:T,onClick:S,children:["Build ",e==null?void 0:e.building_name,i.jsxs("div",{children:[(f=a==null?void 0:a.cost_gem)==null?void 0:f.toLocaleString("en-US")," ",i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})]})]})]})};export{ct as default};

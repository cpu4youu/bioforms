import{s as t,Q as g,u as f,q as D,g as pe,d as X,S as N,T as Z,R as ee,_ as ne,r as u,j as e}from"./index-be2f8dd8.js";import{u as C}from"./useQuery-6472a36a.js";import{A as xe}from"./atomic-api-d6d8a65d.js";import{f as F}from"./constants-06470205.js";import{F as K}from"./index.esm-cf10c407.js";import{u as ge}from"./use-transaction-b7e1a517.js";import{s as me}from"./sleep-da79c358.js";import"./toast-options-46bb839f.js";import"./iconBase-2104346b.js";const fe=t("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",br:"15px",w:"100%",h:"100%",maxH:"calc(100vh - 160px)",variants:{isLandSelected:{true:{"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),ue=t("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),he=t("div",{gridArea:"main",padding:"0px 18px",br:"15px",bg:"#141423",variants:{isLandSelected:{false:{"@xmd":{display:"none"}}}}}),z=t("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),je=t("div",{mt:"20px","@sm":{mt:"5px"}}),be=t("div",{d:"grid",gridTemplateColumns:"1fr 1fr 1fr",w:"100%",bg:"#242438",padding:"10px 20px",fontSize:"14px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@md":{gap:"10px",fontSize:"12px",padding:"10px 10px",span:{textAlign:"center"}}}),ye=t("div",{d:"flex",direction:"column",gap:"10px",overflowY:"auto",h:"calc(100vh - 280px)",pb:"20px"}),ve=t("button",{d:"grid",gridTemplateColumns:"1fr 1fr 1fr",bg:"#201D2C",padding:"8px",variants:{isSelected:{true:{bg:"rgb(255 255 255 / 17%)"}}},"@sm":{gap:"3px"}}),Fe=t("div",{d:"flex",w:"100%",h:"100%",mt:"10px",img:{objectFit:"contain",w:"69px",h:"69px"},span:{ml:"10px",fontSize:"14px",ff:"$heading",color:"#C9C9C9"},"@md":{span:{fontSize:"12px"}},"@sm":{direction:"column-reverse",alignItems:"center",justify:"flex-end",gap:"10px",img:{w:"100%",h:"auto"}}}),we=t("div",{d:"flex",flexWrap:"wrap",gap:"2px 3px",w:"100%",h:"100%",mt:"10px","@sm":{}}),w=t("div",{d:"flex",w:"49%",h:"34px",gap:"2px",img:{objectFit:"contain",w:"34px",h:"34px",bg:"#242438"},span:{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",fontSize:"14px",ff:"$heading",fw:"bold",color:"#C9C9C9",bg:"#242438"},"@md":{w:"100%",span:{fontSize:"10px"}}}),O=t("div",{d:"flex",w:"100%",gap:"3px",mt:"6px",variants:{isSide:{true:{mt:"0px","@sm":{mt:"8px"}},false:{h:"100%"}}},"@sm":{gap:"3px",flexWrap:"wrap"}}),V=t("button",{d:"flex",justifyContent:"center",alignItems:"center",direction:"column",position:"relative",bg:"#242438",w:"100%",span:{position:"absolute",top:"8px",left:"5px",ff:"$heading",fw:"bold",fs:"16px",color:"#D9CA9A"},img:{objectFit:"contain",w:"45px"},variants:{isSide:{true:{justifyContent:"space-between",span:{position:"relative",top:"0px",left:"0px"},"&:first-child":{br:"0 0 0 15px",img:{br:"0 0 0 15px"}},"&:last-child":{br:"0 0 15px 0",img:{br:"0 0 15px 0"}},"@sm":{w:"24%"}}},disabled:{true:{"img, span":{filter:"grayscale(100%)"}}}},"@md":{span:{fontSize:"12px"}},"@sm":{maxW:"48%",span:{fontSize:"12px"},img:{objectFit:"contain",w:"50px"}}}),U=t("div",{position:"absolute",w:"100%",h:"7px",top:0,left:0,bg:"red","@sm":{h:"3px"}}),Ce=t("div",{display:"flex",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",maxHeight:"calc(100vh - 160px)",minW:"500px",variants:{isLandSelected:{false:{"@xmd":{display:"none"}}}},"@lg":{minW:"initial"},"@sm":{mt:"5px"}}),Se=t("div",{d:"flex",alignItems:"center",justifyContent:"center",direction:"column",h:"45px",w:"100%",padding:"0px 18px",bg:"#242438",fs:"16px",ff:"$heading",fw:"bold",color:"rgba(255, 255, 255, 0.56)",variants:{isSelected:{true:{bg:"#5DC3E8",color:"rgba(0, 0, 0, 0.83)"}}},"@sm":{h:"initial",padding:"5px 10px",fs:"12px"}}),_e=t("div",{d:"flex",alignItems:"center",justifyContent:"center",direction:"column",fs:"16px",ff:"$heading",fw:"bold",color:"rgba(255, 255, 255, 0.56)",position:"relative",w:"100%",h:"125px",">img":{zIndex:1,objectFit:"contain",w:"80px",h:"80px","&:first-child":{w:"100%",h:"100%",objectFit:"cover",left:"0px",top:"0px",position:"absolute"},"&:last-child":{br:"0 0 15px 0"}},span:{zIndex:2,textStroke:"2px #000",textShadow:"1px 1px 3px #000"},".question":{fs:"44px"},variants:{isSelected:{true:{bg:"#5DC3E8",color:"rgba(0, 0, 0, 0.83)"}}},"@sm":{">img":{h:"60px","&:first-child":{left:"-3px"}}}}),Te=t("div",{d:"flex",w:"100%",direction:"column",img:{my:"20px",objectFit:"contain",w:"100%"},h3:{d:"flex",alignItems:"center",gap:"10px",fs:"16px",color:"#FFFFFF",mb:"15px"},"@sm":{pb:"20px",">img":{d:"none"}}}),G=t("div",{d:"flex",gap:"3px",direction:"column",mt:"10px"}),L=t("div",{ff:"$heading",fs:"16px",color:"#FFFFFF",padding:"10px",br:"3px",bg:"#201D2C",mb:"10px",span:{color:"#FFB800"},"@sm":{fs:"12px"}}),ze=t("div",{d:"flex",gap:"3px",span:{w:"50%",ff:"$heading",fs:"13px",color:"#FFFFFF",padding:"5px 10px",br:"3px",bg:"#201D2C","&:last-child":{w:"100%"},"@sm":{fs:"10px"}}}),Le=t("div",{d:"flex",direction:"column",mt:"30px"}),Ie=t("h3",{color:"#FFFFFF","@sm":{fs:"12px"}}),Be=t("p",{color:"#FFFFFF",ff:"$heading",fs:"16px",mt:"5px",padding:"5px 10px",br:"3px",bg:"#201D2C","@sm":{fs:"10px"}}),Ae=t("div",{d:"flex",direction:"column",mt:"20px","@sm":{div:{top:"20px",left:"5px",fs:"10px"}}}),$e=t("div",{d:"flex",gap:"5px",mt:"30px"}),I=t("div",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",direction:"column",span:{d:"flex",alignItems:"center",justifyContent:"center",padding:"5px 10px",w:"100%",br:"5px 5px 0 0 ",color:"#FFFFFF",ff:"$heading",fs:"10px",fw:"$thin",bg:"#201D2C"}}),B=t("div",{d:"flex",alignItems:"center",justifyContent:"center",gap:"5px",padding:"5px",br:"0 0 5px 5px",w:"100%",color:"#FFFFFF",ff:"$heading",fs:"12px",fw:"normal",bg:"#1C1A26",img:{objectFit:"contain",w:"20px",my:"0px"}}),De=t("div",{d:"flex",gap:"3px",direction:"column",mt:"10px"}),Ne=t("div",{d:"flex",direction:"column",w:"100%",">p":{ff:"$heading",fs:"16px",color:"#FFFFFF",w:"100%",padding:"10px",br:"3px",bg:"#201D2C","@sm":{fs:"12px"}}}),qe=t("div",{d:"flex",gap:"10px",w:"100%"}),A=t("button",{d:"flex",alignItems:"center",justifyContent:"center",direction:"column",position:"relative",w:"100%",h:"200px",span:{color:"#FFFFFF",ff:"$heading",fs:"16px",fw:"bold",zIndex:2},img:{objectFit:"contain",w:"80px",zIndex:2,"&:last-child":{zIndex:1,objectFit:"cover",w:"100%",h:"100%",my:"0px",top:0,left:0,position:"absolute"}}}),Re=t("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),Ee=()=>C({queryKey:[g.myLandsState],queryFn:()=>Me(),staleTime:1e3*60*60,enabled:!!f.getState().user});async function Pe(){return await D.invalidateQueries(g.myLandsState)}async function Me(){var a;try{const{getAssets:i}=new xe,l=await i({collection_name:"alien.worlds",schema_name:"land.worlds",owner:(a=f.getState().user)==null?void 0:a.name,page:1,limit:1e3,order:"desc",sort:"asset_id"});return Qe(l)}catch(i){return console.log(i),null}}function Qe(a){return a.map(i=>({...i,asset_id:Number(i.asset_id),data:{...i.data,planetName:i.data.name.split("on ")[1].toLowerCase()}}))}const $=["eyeke","kavian","veles","magor","neri","naron"],We=()=>C({queryKey:[g.allBuildingsState],queryFn:()=>Ye(),staleTime:1e3*60*60,enabled:!!f.getState().user});async function ke(){return await D.invalidateQueries(g.allBuildingsState)}async function Ye(){try{const a={};for(let i=0;i<$.length;i++){const l=await pe($[i]);if(l){const p=(l==null?void 0:l.filter(o=>{var h;return!!((h=o.buildings)!=null&&h.length)}))||[];a[$[i]]=p}}return a}catch(a){return console.log(a),null}}const He=async a=>await X({options:{code:N.landsAle,index_position:1,limit:"1000",scope:a,table:Z.buildingcost}}),Ke=a=>C({queryFn:()=>Ve(a),queryKey:[g.buildingConfigState],staleTime:1e3*60*60,enabled:!!f.getState().user});async function Oe(){return await D.invalidateQueries(g.buildingConfigState)}async function Ve(a){try{return await He(a)}catch(i){return console.log(i),null}}const Ue=async()=>await X({options:{code:N.landsAle,index_position:1,limit:"1000",scope:"lands.ale",table:Z.CONFIG}}),Ge=()=>C({queryFn:()=>Je(),queryKey:[g.landConfigState],staleTime:1e3*60*60,enabled:!!f.getState().user});async function Je(){try{return await Ue()}catch(a){return console.log(a),null}}async function Xe(a,i){const{executeTransaction:l}=ge(),p=Ze(a,i);return!!await l(p)}function Ze(a,i){return{actions:[{account:N.landsAle,name:"build",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,planet:i.planet,x:i.x,y:i.y,building:i.building,level:i.level,cost_gem:i.cost_gem,cost_credits:i.cost_credits}}]}}const J=ee.lazy(()=>ne(()=>import("./index-bddbc882.js"),["assets/index-bddbc882.js","assets/index-be2f8dd8.js","assets/index-55fec1ff.css"])),en=ee.lazy(()=>ne(()=>import("./index-05159bb3.js"),["assets/index-05159bb3.js","assets/index-be2f8dd8.js","assets/index-55fec1ff.css","assets/index-f6cc37e9.js"])),pn=()=>{var M,Q,W,k,Y,H;const{data:a}=Ee(),{data:i}=We(),{data:l}=Ge(),p=f(s=>s.user),[o,h]=u.useState(null),[n,q]=u.useState({...F[0],index:0}),{data:j}=Ke((n==null?void 0:n.img)||""),[S,R]=u.useState([0]),[te,E]=u.useState(!1);function se(s){var m,d;h(s);const c={...(m=F)==null?void 0:m[0],...(d=s.buildings)==null?void 0:d[0],index:0},r=((c==null?void 0:c.boost_score)||0)/1e4;q(c),R([r])}function ie(s){const[c]=s,r=((n==null?void 0:n.boost_score)||0)/1e4;R(c<r?[r]:s)}async function ae(){if(!(!p||!o||!x||!n))try{E(!0);const s={planet:o.data.planetName,x:o.data.x,y:o.data.y,building:n.name,level:n.level||1,cost_gem:x.cost_gem,cost_credits:x.cost_credits};await Xe(p,s)&&(await me(1e3),await Pe(),await Oe(),await ke())}catch{}finally{E(!1)}}const x=u.useMemo(()=>j==null?void 0:j.find(s=>s.building_name===n.img&&s.level===((n==null?void 0:n.level)||0)+1),[j,n]),oe=((M=l==null?void 0:l[0])==null?void 0:M.boost_base_cost)||0,re=((Q=l==null?void 0:l[0])==null?void 0:Q.boost_cost_first_percent)||0,le=(n==null?void 0:n.boost_score)||0,b=Number(((W=l==null?void 0:l[0])==null?void 0:W.boost_cost_mod)||0),ce=(1-Math.pow(b,S[0]+1))/(1-b),de=(1-Math.pow(b,le/1e4+1))/(1-b),P=oe+re*(ce-de),y=(((k=l==null?void 0:l[0])==null?void 0:k.start_boost_score)||0)/1e4,_=P<y?y:P;return e.jsxs(fe,{isLandSelected:!!o,children:[e.jsxs(ue,{children:[o&&(n==null?void 0:n.building_name)&&e.jsxs(J,{children:["Boost"," ",e.jsxs("div",{children:[_.toFixed(2),e.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})," "]})]}),o&&x&&e.jsxs(J,{isLoading:te,onClick:ae,children:["Build ",n.name,e.jsxs("div",{children:[(Y=x==null?void 0:x.cost_gem)==null?void 0:Y.toLocaleString("en-US")," ",e.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})]})]})]}),e.jsxs(he,{isLandSelected:!o,children:[e.jsx(z,{children:"My Lands"}),e.jsxs(je,{children:[e.jsxs(be,{children:[e.jsx("span",{children:"Land"}),e.jsx("span",{children:"Income since last claim"}),e.jsx("span",{children:"Buildings"})]}),e.jsx(ye,{children:a==null?void 0:a.map(s=>{const c=i==null?void 0:i[s.data.planetName].find(r=>r.x===s.data.x&&r.y===s.data.y);return e.jsxs(ve,{isSelected:s.asset_id===Number(o==null?void 0:o.asset_id),onClick:()=>se({...s,...c}),children:[e.jsxs(Fe,{children:[e.jsx("img",{loading:"lazy",src:"/assets/lands/vulcano.png",alt:"Land"}),e.jsxs("span",{children:[s.data.name," (",s.data.x,":",s.data.y,")"]})]}),e.jsxs(we,{children:[e.jsxs(w,{children:[e.jsx("img",{loading:"lazy",src:"/assets/icons/dust.png",alt:""}),e.jsx("span",{children:"76.1253"})]}),e.jsxs(w,{children:[e.jsx("img",{loading:"lazy",src:"/assets/icons/credit.png",alt:""}),e.jsx("span",{children:"76.1253"})]}),e.jsxs(w,{children:[e.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""}),e.jsx("span",{children:"76.1253"})]}),e.jsxs(w,{children:[e.jsx("img",{loading:"lazy",src:"/assets/icons/tlm.png",alt:""}),e.jsx("span",{children:"76.1253"})]})]}),e.jsx(O,{isSide:!1,children:F.map((r,m)=>{const d=c==null?void 0:c.buildings.find(T=>T.building_name===r.name.toLowerCase()),v=((d==null?void 0:d.boost_score)||0)/1e4;return e.jsxs(V,{disabled:!c||!d,children:[e.jsx(U,{style:{width:`${v}%`}}),e.jsx("span",{children:d==null?void 0:d.level}),e.jsx("img",{loading:"lazy",src:`/assets/buildings/${r.img}.png`,alt:r.name,title:r.name})]},m)})})]},s.asset_id)})})]})]}),e.jsx(Ce,{isLandSelected:!!o,children:o?e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:[(H=o==null?void 0:o.data)==null?void 0:H.name," (",o==null?void 0:o.data.x,":",o==null?void 0:o.data.y,")"]}),e.jsx(O,{isSide:!0,children:F.map((s,c)=>{var d,v;const r=(d=o==null?void 0:o.buildings)==null?void 0:d.find(T=>T.building_name===s.name.toLowerCase()),m=((r==null?void 0:r.boost_score)||0)/1e4;return e.jsxs(V,{isSide:!0,disabled:!r,onClick:()=>q({...s,...r,index:c}),children:[e.jsx(U,{style:{width:`${m}%`}}),e.jsx(Se,{isSelected:((v=n==null?void 0:n.name)==null?void 0:v.toLowerCase())===s.name.toLowerCase(),children:c===0&&!r?"Primary Building":s.name}),e.jsxs(_e,{children:[e.jsx("img",{loading:"lazy",src:"/assets/lands/vulcano.png",alt:"Land"}),c===0&&!r?e.jsx("span",{className:"question",children:"?"}):e.jsx("img",{loading:"lazy",src:`/assets/buildings/${s.img}.png`,alt:s.name,title:s.name}),e.jsxs("span",{children:[" ",(r==null?void 0:r.level)!==void 0?`Level ${r==null?void 0:r.level}`:""]})]})]},c)})}),e.jsx(Te,{children:n!=null&&n.building_name?e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx(L,{children:"This building currently gets selected 5.4 times more often than a level 1 tavern at 100% boost."}),e.jsxs(ze,{children:[e.jsx("span",{children:"Next Level"}),e.jsx("span",{children:"Selection Frequency +20%"})]})]}),e.jsxs(Le,{children:[e.jsx(Ie,{children:"Building Boost"}),e.jsx(Be,{children:"Boosting a building raises its perks, but usage and time reduce boost levels. If boost drops below 1%, the building becomes unusable."}),e.jsx(Ae,{children:e.jsx(en,{onValueChange:ie,value:S})})]}),e.jsxs($e,{children:[e.jsxs(I,{children:[e.jsx("span",{children:"Total Cost"}),e.jsxs(B,{children:[_.toFixed(2),e.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""})]})]}),e.jsxs(I,{children:[e.jsx("span",{children:"Cost per 1%"}),e.jsxs(B,{children:[(_/(S[0]-y||1)).toFixed(2),e.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""})]})]}),e.jsxs(I,{children:[e.jsx("span",{children:"Start Score"}),e.jsxs(B,{children:[y,"%"]})]})]}),e.jsx("img",{loading:"lazy",src:"/assets/mock/building.png",alt:"Land"})]}):n.index==0?e.jsxs(De,{children:[e.jsx("h3",{children:"Select Primary Building"}),e.jsxs(Ne,{children:[e.jsx("p",{children:"You can only have one primary building on your land"}),e.jsxs(qe,{children:[e.jsxs(A,{children:[e.jsx("span",{children:"Tavern"}),e.jsx("img",{loading:"lazy",src:"/assets/buildings/tavern.png",alt:"Tavern",title:"Tavern"}),e.jsx("img",{loading:"lazy",src:"/assets/lands/vulcano.png",alt:"Land"})]}),e.jsxs(A,{children:[e.jsx("span",{children:"Tavern"}),e.jsx("img",{loading:"lazy",src:"/assets/buildings/tavern.png",alt:"Tavern",title:"Tavern"}),e.jsx("img",{loading:"lazy",src:"/assets/lands/vulcano.png",alt:"Land"})]}),e.jsxs(A,{children:[e.jsx("span",{children:"Tavern"}),e.jsx("img",{loading:"lazy",src:"/assets/buildings/tavern.png",alt:"Tavern",title:"Tavern"}),e.jsx("img",{loading:"lazy",src:"/assets/lands/vulcano.png",alt:"Land"})]})]})]}),e.jsxs(L,{children:[e.jsxs("h3",{children:[e.jsx(K,{size:30})," ",n==null?void 0:n.name," Information"]}),"In a ",n==null?void 0:n.name," players can recruit new fighters to their team. Landowners earn ",e.jsx("span",{children:"Shards"})," each time a trainer recruits a fighter on their land."]})]}):e.jsx(G,{children:e.jsxs(L,{children:[e.jsxs("h3",{children:[e.jsx(K,{size:30})," ",n==null?void 0:n.name," Information"]}),"This building currently gets selected 5.4 times more often than a level 1 tavern at 100% boost.In an ",n==null?void 0:n.name," players can ascend their fighters for",e.jsx("span",{children:" credits"})," or ",e.jsx("span",{children:"gems"}),". You will receive a portion of the spent currency."]})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{children:"Select a Land"}),e.jsx(Re,{children:"Select a Land"})]})})]})};export{pn as default};

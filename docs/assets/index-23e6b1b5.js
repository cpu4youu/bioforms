import{s as c,L as $,S as p,d as O,Q as F,g as j,q as M,u as S,e as w,R as T,_ as C,a as P,b as k,r as v,j as n,v as B}from"./index-002d79b3.js";import{u as K}from"./index-5ffe76d0.js";import{u as Y,F as U}from"./index-808b7a8a.js";import{u as G}from"./use-media-f50452b3.js";import{s as J}from"./sleep-da79c358.js";import{u as X}from"./use-transaction-1c225a1e.js";import{u as A}from"./useQuery-2039e484.js";import{g as Z}from"./generateRandomWaxName-ee0d1ff2.js";const ee=c("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",overflowY:"hidden",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),te=c("div",{gridArea:"header",d:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@lgxxx":{gridColumnStart:2,w:"100%",gridTemplateColumns:"1fr 1fr"},"@md":{gridColumnStart:1,gridTemplateColumns:"1fr 1fr"},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),ne=c("div",{position:"relative",gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}},"@md":{minH:"calc(100vh - 185px)",mt:"30px"}}),re=c("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",br:"15px 15px 0 0",bg:"#19192D",position:"absolute",top:"-35px",left:"0"}),ae=c($,{border:"1px solid rgba(0, 0, 0, 0.25)",padding:"10px 20px",ff:"$heading",fs:"12px",color:"#fff","&:last-child":{br:"15px 15px 0 0"}}),ie=c("div",{gridArea:"main",d:"flex",justify:"space-between",gap:"5px",h:"100%",w:"100%",overflowY:"auto",px:"20px",">span":{mt:"55px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@xlg":{justify:"center",flexWrap:"wrap",">span":{my:"25px"}},"@md":{h:"calc(-280px + 100vh)"},variants:{isFighterSelected:{true:{justify:"center",flexWrap:"wrap",">span":{my:"25px"}}}}}),se=c("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),oe=c("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),le=c("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),de=c("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function ce(e,t,i,a,s,o,d,f,x,g,m){const{executeTransaction:h}=X(),l=ue(e,t,i,a,s,o,d,f,x,g,m);return!!await h(l)}function ue(e,t,i,a,s,o,d,f,x,g,m){return{actions:[{account:p.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:t,land_id:i,crew_asset_id:a,weapon_asset_id:s,fighter_ids:o,difficulty:d,use_gems:f,history_id:x,x:g,y:m}}]}}const pe=O(e=>({myTeam:[null,null,null,null,null],setMyTeam:t=>e({myTeam:t}),selectedCards:[void 0,void 0],setSelectedCards:t=>e({selectedCards:t})}));function fe({user:e,areaSelected:t,myTeam:i,selectedCards:a,selectedLevel:s}){var d,f,x,g,m,h,l,y;const o=i.reduce((b,_)=>_?[...b,_.fighter_id]:b,[]);return!e||!(t!=null&&t.landId)||!o.length||!((d=a[0])!=null&&d.asset_id)||!((f=a[1])!=null&&f.asset_id)?(o.length||F.error("No Warrior selected"),(x=a[0])!=null&&x.asset_id||F.error("No Crew selected (First spot on cards)"),(g=a[1])!=null&&g.asset_id||F.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:t,crew_asset_id:Number((m=a[0])==null?void 0:m.asset_id),weapon_asset_id:Number((h=a[1])==null?void 0:h.asset_id),fighter_ids:o,selectedLevel:s})):{user:e,planet:e.planet,landId:t.landId,x:t.x,y:t.y,card1:Number((l=a[0])==null?void 0:l.asset_id),card2:Number((y=a[1])==null?void 0:y.asset_id),teamFiltered:o,level:s.level}}const xe=async()=>await j({options:{code:p.dungeonsAle,index_position:1,limit:"1000",scope:p.dungeonsAle,table:M.config}}),ge=()=>A({enabled:!!S.getState().user,queryKey:[w.dungeonConfigDataState],queryFn:()=>me(),staleTime:1e3*60*20});async function me(){try{const e=await xe();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const he=async()=>await j({options:{code:p.battleAle,index_position:1,limit:"1000",scope:p.battleAle,table:"variables"}}),ye=()=>A({enabled:!!S.getState().user,queryKey:[w.VariablesState],queryFn:()=>be(),staleTime:1e3*60*20});async function be(){try{const e=await he();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const _e=async()=>await j({options:{code:p.battleAle,index_position:1,limit:"1000",scope:p.battleAle,table:"weather"}}),Fe=()=>A({enabled:!!S.getState().user,queryKey:[w.WeatherState],queryFn:()=>Se(),staleTime:1e3*60*20});async function Se(){try{return await _e()}catch(e){return console.log(e),null}}const we=async e=>await j({options:{code:p.battleAle,index_position:1,limit:"1000",lower_bound:e,upper_bound:e,scope:p.battleAle,table:M.history}}),ze=e=>A({enabled:!!S.getState().user,queryKey:[w.HistoryDataState,e],queryFn:()=>q(e),staleTime:1e3*60*20});async function q(e){try{const t=await we(e);if(!t)return null;const i=t==null?void 0:t.find(s=>s.history_id===e);return i?{...i,team1_fighters:i.team1_fighters.filter(s=>typeof s.fighter_id=="number")}:null}catch(t){return console.log(t),null}}const R=T.lazy(()=>C(()=>import("./index-0ed9ea60.js"),["assets/index-0ed9ea60.js","assets/index-002d79b3.js","assets/index-55fec1ff.css"])),Te=T.lazy(()=>C(()=>import("./index-4a010656.js"),["assets/index-4a010656.js","assets/index-002d79b3.js","assets/index-55fec1ff.css","assets/useQuery-2039e484.js","assets/v4-4a60fe23.js","assets/index-5ffe76d0.js","assets/index-808b7a8a.js","assets/classtemps-query-b2910289.js","assets/use-media-f50452b3.js","assets/sleep-da79c358.js","assets/use-transaction-1c225a1e.js","assets/toast-options-488e77ba.js","assets/generateRandomWaxName-ee0d1ff2.js"])),ve=T.lazy(()=>C(()=>import("./index-2fef42a4.js"),["assets/index-2fef42a4.js","assets/index-002d79b3.js","assets/index-55fec1ff.css","assets/fighters-query-9923abf4.js","assets/useQuery-2039e484.js","assets/index-5ffe76d0.js","assets/index-0ed9ea60.js","assets/elements-a94bd2b3.js","assets/use-media-f50452b3.js","assets/inventory-query-a2dba62a.js","assets/adapters-cca835df.js","assets/atomic-api-89bd3048.js","assets/toast-options-488e77ba.js","assets/markers-21ad5773.js","assets/index-808b7a8a.js","assets/classtemps-query-b2910289.js","assets/sleep-da79c358.js","assets/use-transaction-1c225a1e.js","assets/generateRandomWaxName-ee0d1ff2.js"])),je=T.lazy(()=>C(()=>import("./index-d6b398a0.js"),["assets/index-d6b398a0.js","assets/index-002d79b3.js","assets/index-55fec1ff.css","assets/useQuery-2039e484.js","assets/index-5ffe76d0.js","assets/v4-4a60fe23.js"])),Ce=()=>{const e=S(P(r=>r.user)),{isSuperLarge:t}=G();Y();const{data:i}=ge(),{data:a}=ye(),{data:s}=Fe(),{selectedCards:o,myTeam:d,setMyTeam:f,setSelectedCards:x}=pe(),{areaSelected:g,setAreaSelected:m}=k(),{selectedLevel:h,selectedFighter:l,setSelectedFighter:y}=K(),[b,_]=v.useState(!1),[H,z]=v.useState("");async function I(){try{_(!0);const r=fe({areaSelected:g,myTeam:d,selectedCards:o,selectedLevel:h,user:e});if(!r)return;const u=Z();if(!await ce(e,e.planet,r.landId,r.card1,r.card2,r.teamFiltered,r.level,!0,u,r.x,r.y))return;await W(u),F.warn("No history data found yet. Retrying..."),await W(u)}catch(r){console.error(r)}finally{_(!1)}}async function W(r){await J(5e3);const u=await q(r);if(u){B.setQueryData([w.HistoryDataState,r],u),z(r),F.success("Fight Started !");return}}function N(){x([void 0,void 0]),f([null,null,null,null,null]),m(null)}const Q=v.useMemo(()=>{var u,E,L;return!d.filter(V=>V!==null).length||!((u=o[0])!=null&&u.asset_id)||!((E=o[1])!=null&&E.asset_id)||Number(((L=e==null?void 0:e.activestats)==null?void 0:L.action_points)||0)<((i==null?void 0:i.energy_cost)||0)},[d,o,i,e]),D=v.useMemo(()=>s==null?void 0:s.find(r=>r.weather_id===(a==null?void 0:a.current_weather_id)),[s,a]);return H?n.jsx(Te,{historyId:H}):n.jsxs(ee,{isFighterSelected:!!l,children:[n.jsxs(te,{children:[n.jsx(R,{onClick:N,children:"Back"}),n.jsxs(R,{disabled:Q||b,isLoading:b,onClick:I,children:["Start Fight",n.jsxs("div",{children:["-",i==null?void 0:i.energy_cost,n.jsx("img",{src:"/assets/icons/energy.png",alt:"Potion"})]})]})]}),n.jsxs(ne,{isFighterSelected:!!l,children:[n.jsx(re,{children:n.jsx(ae,{to:"/dungeon-leaderboard",children:"Leaderboard"})}),n.jsx(se,{children:"Weather"}),n.jsx(oe,{children:D==null?void 0:D.displayname}),n.jsxs(ie,{isFighterSelected:t&&!!l,children:[n.jsx(ve,{}),n.jsx("span",{children:"VS"}),n.jsx(je,{})]})]}),n.jsx(le,{isFighterSelected:!!l,children:l?n.jsx(U,{selectedFighter:{...l,...l.stats},onCloseFighterDetail:y}):n.jsx(n.Fragment,{children:n.jsx(de,{children:"Select a Fighter"})})})]})},Ae=T.memo(Ce),Ie=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"}));export{Fe as a,ye as b,pe as c,Ie as i,ze as u};

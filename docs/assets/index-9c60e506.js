import{s as p,g as oe,S as f,e as le,u as A,R as L,_ as E,a as V,r as c,j as s,Q as j}from"./index-32234248.js";import{s as ce}from"./shimmer-52e71611.js";import{u as de,o as C}from"./fighters-query-653f3b68.js";import{u as pe,s as ue}from"./fightersSort-2e989641.js";import xe from"./index-d477d688.js";import{u as me}from"./useQuery-91053d03.js";import{s as w}from"./sleep-da79c358.js";import{u as k}from"./use-transaction-12e25294.js";import{u as ge}from"./config-query-efbe5711.js";import{f as fe,a as he,b as ye,s as ve}from"./fighterFilters-e6065055.js";const _e=p("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{gridTemplateAreas:`
          "empty empty header"
          "main main side"
        `,"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),Se=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),be=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",direction:"column",position:"relative",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@xmd":{display:"none"}}}},"@xmd":{mt:"30px"}}),Fe=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",width:"100%",height:"100%",flexWrap:"wrap",overflowY:"auto"}),je=p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-35px",left:"0px"}),K=p("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:first-child":{br:"8px 0px 0px 0px"},"&:last-child":{br:"0 8px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}});p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"});p("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}});const Ce=p("div",{display:"none",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{display:"flex"},false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"}}),we=p("div",{h:"175px",w:"395px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${ce} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Te=p("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),Ae=async()=>await oe({options:{code:f.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:f.battleAle,table:"levels"}}),Le=()=>me({queryKey:[le.levelsState],queryFn:()=>Ee(),staleTime:1e3*60*60,enabled:!!A.getState().user});async function Ee(){try{return await Ae()}catch(a){return console.log(a),null}}async function ke(a,i){const{executeTransaction:r}=k(),t=Pe(a,i);return!!await r(t)}function Pe(a,{cost_credits:i,cost_gems:r,fighter_ids:t}){return{actions:[{account:f.battleAle,name:"levelup",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,fighter_ids:t,cost_gems:r,cost_credits:i}}]}}async function De(a,i){const{executeTransaction:r}=k(),t=Me(a,i);return!!await r(t)}function Me(a,{fighter_id:i}){return{actions:[{account:f.battleAle,name:"payday",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,fighter_id:i}}]}}async function ze(a,i){const{executeTransaction:r}=k(),t=Re(a,i);return!!await r(t)}function Re(a,{fighter_ids:i}){return{actions:[{account:f.battleAle,name:"sellfighter",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,fighter_ids:i}}]}}const T=L.lazy(()=>E(()=>import("./index-b4d7ed01.js"),["assets/index-b4d7ed01.js","assets/index-32234248.js","assets/index-55fec1ff.css"])),Ie=L.lazy(()=>E(()=>import("./index-17fe97a5.js"),["assets/index-17fe97a5.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/fightersSort-2e989641.js","assets/sleep-da79c358.js","assets/fighters-query-653f3b68.js","assets/useQuery-91053d03.js","assets/config-query-efbe5711.js","assets/markers-45cb96d1.js","assets/use-transaction-12e25294.js","assets/toast-options-da6e6ed9.js","assets/react-icons.esm-06181a6a.js","assets/shimmer-52e71611.js","assets/index-d477d688.js","assets/classtemps-query-1a82e9a1.js","assets/fighterFilters-e6065055.js"])),Ue=L.lazy(()=>E(()=>import("./index-ab7512d1.js"),["assets/index-ab7512d1.js","assets/index-32234248.js","assets/index-55fec1ff.css","assets/index-b4d7ed01.js","assets/elements-a94bd2b3.js","assets/markers-45cb96d1.js","assets/fightersSort-2e989641.js","assets/classtemps-query-1a82e9a1.js","assets/useQuery-91053d03.js"])),He=()=>{var q,O,Q,Y,$;const a=A(V(e=>e.user)),i=A(V(e=>e.updatePlayerData)),{data:r}=ge(),{data:t,isLoading:x,isFetching:N}=de(a.name),{data:d}=Le(),{selectedFighter:m,setSelectedFighter:P,checkedFighters:h,setCheckedFighters:G}=pe(),[S,y]=c.useState(!1),[D,M]=c.useState(!1),[v,z]=c.useState("inventory"),[R,J]=c.useState([]),[I,X]=c.useState([]),[U,Z]=c.useState({label:"All",value:""}),[H,ee]=c.useState(ue[0]),te=c.useMemo(()=>t==null?void 0:t.some(e=>e.stats.experience>=e.stats.required_experience&&(d==null?void 0:d.some(n=>n.level===e.stats.level+1))),[t,d]),W=c.useMemo(()=>(t==null?void 0:t.reduce((e,n)=>{var o;const l=(o=d==null?void 0:d.find(u=>u.level===n.stats.level+1))==null?void 0:o.unlock_cost_gem;return l&&n.stats.experience>=n.stats.required_experience?e+=l:e},0))||0,[d,t]),b=c.useMemo(()=>(t==null?void 0:t.reduce((e,n)=>{const l=new Date(n.next_payday).getTime()/1e3,o=new Date(n.last_payday).getTime()/1e3,u=new Date().getTime()/1e3,_=(r==null?void 0:r.standard_pay_payday)||0;let g=0;l>u&&(g=l-u);const F=l-o-g,ie=l-o,B=Math.floor(F/ie*_+1);return B>1?e+=B:e},0))||0,[r,t]),ae=c.useMemo(()=>h.length*h.reduce((e,n)=>e+n.stats.credits,0),[h]);async function se(){try{y(!0);const e=(t==null?void 0:t.filter(o=>o.stats.experience>=o.stats.required_experience).map(o=>o.fighter_id))||[],n=(t==null?void 0:t.reduce((o,u)=>{var g;const _=(g=d==null?void 0:d.find(F=>F.level===u.stats.level+1))==null?void 0:g.unlock_cost_credits;return _&&u.stats.experience>=u.stats.required_experience?o+=_:o},0))||0;if(!await ke(a,{cost_credits:n,cost_gems:W,fighter_ids:e}))return;await w(2e3),C(a.name),j.success("Fighter leveled up!")}catch(e){console.error(e)}finally{y(!1)}}async function ne(){try{M(!0);const e=(t==null?void 0:t.map(l=>l.fighter_id))||[];if(!await De(a,{fighter_id:e}))return;await w(2e3),C(a.name),j.success("Fighter payday!")}catch(e){console.error(e)}finally{M(!1)}}async function re(){try{y(!0);const e=h.map(l=>Number(l));if(!await ze(a,{fighter_ids:e}))return;await w(2e3),C(a.name),G([]),await i(),j.success("Fighters sold!")}catch(e){console.error(e)}finally{y(!1)}}return c.useEffect(()=>()=>P(null),[]),s.jsxs(_e,{isFighterSelected:!!m,children:[s.jsx(Se,{children:v==="sell"?s.jsx(s.Fragment,{children:s.jsxs(T,{isLoading:S,onClick:re,children:["Sell selected",s.jsxs("div",{children:[ae,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs(T,{isLoading:S,disabled:S||!te,onClick:se,children:["Level All"," ",s.jsxs("div",{children:[W,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})," "]})]}),s.jsxs(T,{isLoading:D,disabled:D||b>((q=a.activestats)==null?void 0:q.action_points)||b<=0,onClick:ne,children:["Payday",s.jsxs("div",{children:["-",b,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Energy"})]})]})]})}),s.jsxs(be,{isFighterSelected:!!m,children:[s.jsxs(je,{children:[s.jsx(K,{isSelected:v==="inventory",onClick:()=>z("inventory"),children:"Inventory"}),s.jsx(K,{isSelected:v==="sell",onClick:()=>z("sell"),children:"Sell"})]}),s.jsx(Ue,{selectedElement:R,setSelectedElement:J,selectedMarker:I,setSelectedMarker:X,selectedClassname:U,setSelectedClassname:Z,selectedSort:H,setSelectedSort:ee}),s.jsx(Fe,{children:x||N?Array.from({length:9},(e,n)=>s.jsx(we,{},n)):t?($=(Y=(Q=(O=t==null?void 0:t.filter(e=>fe(R,e)))==null?void 0:O.filter(e=>he(I,e)))==null?void 0:Q.filter(e=>ye(U,e)))==null?void 0:Y.toSorted((e,n)=>ve(H,e,n)))==null?void 0:$.map(e=>s.jsx(Ie,{isSelling:v==="sell",fighter:e},e.fighter_id)):s.jsx(s.Fragment,{children:s.jsx(Te,{children:"You don't have Fighters"})})})]}),s.jsx(Ce,{isFighterSelected:!!m,children:!!m&&s.jsx(xe,{selectedFighter:m,onCloseFighterDetail:P})})]})},Ge=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{De as a,ke as e,Ge as i,Le as u};

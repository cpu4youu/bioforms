import{s,g as C,S as d,e as S,u,R as l,_,a as E,j as o,r as f,Q as c}from"./index-176ffc21.js";import v from"./index-4ccdf400.js";import{u as z}from"./index-ec2a0aaf.js";import{u as A}from"./useQuery-eb758be5.js";import{u as w}from"./use-transaction-471f0de8.js";import{s as F}from"./sleep-da79c358.js";import{c as L,a as R}from"./calculateTImeLeft-3fbd33a3.js";import{v as D}from"./v4-4a60fe23.js";import"./index-ba842aa2.js";import"./toast-options-aff9643e.js";const I=s("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"13px",mt:"10px",bg:"#141423",br:"15px",w:"100%",maxW:"500px",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),W=s("div",{d:"flex",align:"center",justify:"center",w:"100%",fw:"bold",ff:"$heading",fs:"20px",color:"white",mb:"50px"}),x=s("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",w:"100%",ff:"$heading",fs:"16px",color:"#C7C7C7",strong:{display:"flex",align:"center",justify:"center",gap:"10px",padding:"10px",w:"100%",color:"white",bg:"#212130",br:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"}}),$=s("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),B=s(v,{display:"inline-flex",align:"center",justify:"center",gap:"5px",zIndex:"3",mt:"60px",w:"100%",h:"40px",br:"2px !important",bg:"#6750A4 !important",border:"1px solid #36B9EA !important",fw:"bold",ff:"$heading",fs:"14px",color:"white"}),G=async n=>{const e=await C({options:{code:d.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:n,table:"accounts"}});return(e==null?void 0:e[0])||null},Y=()=>A({queryKey:[S.WaxCoinsState],queryFn:()=>Q(),staleTime:1e3*60*60,enabled:!!u.getState().user});async function Q(){const n=u.getState().user;if(!n)return null;try{const e=await G(n.name);return e?{balance:parseFloat(e.balance),currency:e.balance.split(" ")[1]}:null}catch(e){return console.log(e),null}}async function N(n,e){const{executeTransaction:t}=w(),r=U(n,e);return!!await t(r)}function U(n,e){return{actions:[{account:d.shopAle,name:"buyshopitem",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,item:e}}]}}async function q(n,e,t){const{executeTransaction:r}=w(),i=K(n,e,t);return!!await r(i)}function K(n,e,t){return{actions:[{account:d.eosioToken,name:"transfer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{from:n.name,to:"shop.ale",memo:`purchase,${e}`,quantity:t}}]}}const O=l.lazy(()=>_(()=>import("./index-4f8d5642.js"),["assets/index-4f8d5642.js","assets/index-176ffc21.js","assets/index-55fec1ff.css","assets/index-ec2a0aaf.js","assets/useQuery-eb758be5.js","assets/calculateTImeLeft-3fbd33a3.js"])),X=l.memo(({list:n})=>{const e=u(E(t=>t.user));return o.jsx(o.Fragment,{children:n==null?void 0:n.map(t=>{if(!(t.trial_availability===0&&e.isLegendExpired))return o.jsx(O,{...t},D())})})}),H=l.memo(()=>{var b;const{user:n,updatePlayerData:e}=u(),{selectedPack:t,setSelectedPack:r}=z(),{data:i}=Y(),[m,g]=l.useState(""),[h,y]=f.useState(!1);async function T(){if(!n)return c.error("You need to be logged in to buy items");if(!t)return c.error("You need to select a pack to buy items");y(!0);let a=!1;try{(t==null?void 0:t.category)==="credits"||(t==null?void 0:t.category)==="flasks"||(t==null?void 0:t.category)==="account"?a=await N(n,t.item):a=await q(n,t.item,t.cost_wax),a&&(await F(3e3),await e(),c.success("Item bought successfully"))}catch{c.error("Error buying item")}finally{y(!1),r(null)}}const p=f.useCallback(()=>{if(!(t!=null&&t.itemCD))return g("");const a=L(new Date(t==null?void 0:t.itemCD)),j=R(a,"weeks");g(j)},[t]);return f.useEffect(()=>{p();const a=setTimeout(()=>{p()},1e3*60);return()=>{clearTimeout(a)}},[p]),o.jsxs(I,{children:[o.jsx($,{onClick:()=>r(null),children:"x"}),o.jsx(W,{children:"Confirm Selection"}),o.jsxs(x,{children:[o.jsx("span",{children:"You are about to exchange the following"}),t!=null&&t.cost?o.jsxs("strong",{children:[(b=t==null?void 0:t.cost)==null?void 0:b.toLocaleString("en-US"),o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageCost}`,alt:""})]}):o.jsx("strong",{children:"FREE"})]}),o.jsxs(x,{children:[o.jsx("span",{children:"and receive"}),o.jsxs("strong",{children:[t==null?void 0:t.offer_name,o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageGain}`,alt:""})]})]}),o.jsx(B,{isLoading:h,disabled:h,onClick:T,color:"blue",children:m||"Confirm exchange"}),o.jsx(x,{children:o.jsxs("strong",{children:[o.jsx("span",{children:"Your current WAX balance:"}),o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),(i==null?void 0:i.balance.toLocaleString("en-US",{maximumFractionDigits:2}))??0]})})]})});X.displayName="GemList";H.displayName="GemSelection";export{X as GemList,H as GemSelection};

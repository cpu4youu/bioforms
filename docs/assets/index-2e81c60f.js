import{s as P,g as Y,S as x,v as $,e as N,u as Q,q as G,R as q,_ as V,a as W,r as p,j as a,Q as J}from"./index-0cd9fab8.js";import{u as X,o as M}from"./land-config-e48a6537.js";import{o as z}from"./all-buildings-aff241d9.js";import{u as Z}from"./useQuery-7ffc4c85.js";import{u as H}from"./use-transaction-45cc1e39.js";import{s as D}from"./sleep-da79c358.js";import{u as tt}from"./index-da62a361.js";import{b as ot}from"./constants-b95c644e.js";import"./atomic-api-a8db6d1b.js";import"./toast-options-5fb0ea54.js";const st=P("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%","&.destroy":{borderColor:"#9E475D"},div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}}}),et=async t=>await Y({options:{code:x.landsAle,index_position:1,limit:"1000",scope:t,table:$.buildingcost}}),nt=t=>Z({queryFn:()=>at(t),queryKey:[N.buildingConfigState,t],staleTime:1e3*60*60,enabled:!!Q.getState().user});async function F(t){return await G.invalidateQueries([N.buildingConfigState,t])}async function at(t){try{return await et(t)}catch(o){return console.log(o),null}}async function it(t,o){const{executeTransaction:e}=H(),u=rt(t,o);return!!await e(u)}function rt(t,o){return{actions:[{account:x.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,x:o.x,y:o.y,building:o.building,level:o.level,cost_gem:o.cost_gem,cost_credits:o.cost_credits}}]}}async function ct(t,o){const{executeTransaction:e}=H(),u=lt(t,o);return!!await e(u)}function lt(t,o){return{actions:[{account:x.landsAle,name:"boost",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,building:o.building,x:o.x,y:o.y,cost_gems:o.cost_gems,cost_credits:o.cost_credits,boost_target:o.boost_target}}]}}const f=q.lazy(()=>V(()=>import("./index-182918b8.js"),["assets/index-182918b8.js","assets/index-0cd9fab8.js","assets/index-55fec1ff.css","assets/index-84a7b8cf.js"])),ut=()=>{var w,T,S;const{data:t}=X(),o=Q(W(n=>n.user)),{selectedLand:e,setSelectedLand:u,buildingBoost:r,selectedBuild:s,setSelectedBuild:U,setIsDestroying:k}=tt(),{data:g}=nt((s==null?void 0:s.img)||""),[y,h]=p.useState(!1),[m,v]=p.useState(!1);async function I(){var n;if(e)try{v(!0);const c=((n=o==null?void 0:o.activestats)==null?void 0:n.gems)>=d*10,_=c?d*10:0,l=c?0:d,b={planet:e.data.planetName,x:e.data.x,y:e.data.y,building:s.building_name.toLowerCase(),boost_target:r[0]*1e4,cost_gems:_,cost_credits:l};await ct(o,b)&&(await D(1e3),await M(),await F(s.building_name.toLowerCase()),await z())}catch(c){console.error(c)}finally{v(!1)}}async function O(){if(!o){console.log("User not authenticated");return}if(!e||!s){console.log("Selected land or build is not available");return}if(!i){console.log("Building cost not available");return}if(!t||!t[0]){console.log("Land configuration not available");return}if(!r||r.length===0){console.log("Building boost not available");return}try{h(!0);const n={planet:e.data.planetName,x:e.data.x,y:e.data.y,building:s.building_name.toLowerCase(),level:s!=null&&s.boost_score?(s.level||1)+1:1,cost_gem:i.cost_gem,cost_credits:i.cost_credits};await it(o,n)&&(await D(2e3),await M(),await F(s==null?void 0:s.img),await z(),J.success("Building constructed"))}catch(n){console.error(n)}finally{h(!1),u(null),U({...ot[0]})}}const i=p.useMemo(()=>g==null?void 0:g.find(n=>n.building_name===s.img&&n.level===((s==null?void 0:s.level)||0)+1),[g,s]),d=p.useMemo(()=>{var A,R,B,E;const n=((A=t==null?void 0:t[0])==null?void 0:A.boost_base_cost)||0,c=((R=t==null?void 0:t[0])==null?void 0:R.boost_cost_first_percent)||0,_=(s==null?void 0:s.boost_score)||0,l=Number(((B=t==null?void 0:t[0])==null?void 0:B.boost_cost_mod)||0),b=(1-Math.pow(l,r[0]+1))/(1-l),L=(1-Math.pow(l,_/1e4+1))/(1-l),j=n+c*(b-L),C=(((E=t==null?void 0:t[0])==null?void 0:E.start_boost_score)||0)/1e4;return Math.round(j<C?C:j)},[r,t,s]),K=!!(s!=null&&s.boost_score_update);return a.jsx(st,{children:e&&(K?a.jsxs(a.Fragment,{children:[a.jsx(f,{className:"destroy",isLoading:m,disabled:m,onClick:()=>k(!0),children:"Destroy Building"}),a.jsxs(f,{isLoading:m,disabled:m||d>Number(((w=o==null?void 0:o.activestats)==null?void 0:w.credits)||0),onClick:I,children:["Boost"," ",a.jsxs("div",{children:[d.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),a.jsx("img",{src:"/assets/icons/credits.png",alt:"credits",loading:"lazy"})," "]})]})]}):a.jsxs(f,{isLoading:y,disabled:y||((i==null?void 0:i.cost_credits)||0)>(((T=o==null?void 0:o.activestats)==null?void 0:T.credits)||0),onClick:O,children:["Build ",s==null?void 0:s.building_name,a.jsxs("div",{children:[(S=i==null?void 0:i.cost_credits)==null?void 0:S.toLocaleString("en-US")," ",a.jsx("img",{src:"/assets/icons/credits.png",alt:"credits",loading:"lazy"})]})]}))})},vt=q.memo(ut);export{vt as default};

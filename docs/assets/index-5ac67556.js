import{s as a,c as _,g as j,S as p,d as S,u as x,R as k,_ as A,r as y,j as t,Q as c}from"./index-078fb701.js";import F from"./index-1be0728a.js";import{u as w}from"./useQuery-721e9ceb.js";import{u as T}from"./use-transaction-1e10fa41.js";import{v as W}from"./v4-4a60fe23.js";const P=a("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isPackSelected:{true:{"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),z=a("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),I=a("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"relative",minH:"calc(100vh - 175px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isPackSelected:{true:{"@xmd":{display:"none"}}}}}),Y=a("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"}),E=a("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-40px",left:"0px"}),b=a("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",br:"15px 0px 0px 0px",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:last-child":{br:"0 15px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}}),R=a("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),D=a("div",{display:"flex",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",maxHeight:"calc(100vh - 160px)",minW:"500px",variants:{isPackSelected:{false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"},"@sm":{mt:"5px"}}),H=a("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),$=a("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"10px",w:"100%",mt:"10px",bg:"#141423",br:"15px",minH:"calc(-160px + 100vh)",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),X=a("div",{d:"flex",fw:"bold",ff:"$heading",fs:"16px",color:"white",mb:"50px"}),f=a("div",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"16px",color:"white",strong:{display:"flex",align:"center",justify:"center",gap:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"},"&:last-of-type":{my:"50px"}}),Q=a("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),q=_((e,s)=>({selectedPack:null,setSelectedPack:n=>e({selectedPack:n})})),B=async e=>{const s=await j({options:{code:p.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:e,table:"accounts"}});return(s==null?void 0:s[0])||null},L=()=>w({queryKey:[S.WaxCoinsState],queryFn:()=>M(),staleTime:1e3*60*60,enabled:!!x.getState().user});async function M(){const e=x.getState().user;if(!e)return null;try{const s=await B(e.name);return s?{balance:parseFloat(s.balance),currency:s.balance.split(" ")[1]}:null}catch(s){return console.log(s),null}}const O=async e=>await j({options:{code:p.shopAle,index_position:1,key_type:"i64",limit:"1000",scope:p.shopAle,table:"shopitems"}}),G=()=>w({queryKey:[S.ShopState],queryFn:()=>K(),staleTime:1e3*60*60,enabled:!!x.getState().user});async function K(){try{return await O()}catch(e){return console.log(e),null}}async function U(e,s){const{executeTransaction:n}=T(),i=N(e,s);return!!await n(i)}function N(e,s){return{actions:[{account:p.shopAle,name:"buyshopitem",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,item:s}}]}}async function V(e,s,n){const{executeTransaction:i}=T(),o=J(e,s,n);return!!await i(o)}function J(e,s,n){return{actions:[{account:p.eosioToken,name:"transfer",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{from:e.name,to:"shop.ale",memo:`purchase,${s}`,quantity:n}}]}}function Z(e,s,n){return!e||!s?e:n?e.replaceAll(" WAX",n):e.replaceAll(" WAX","")}const ee=k.lazy(()=>A(()=>import("./index-caa5ea46.js"),["assets/index-caa5ea46.js","assets/index-078fb701.js","assets/index-55fec1ff.css","assets/index-1be0728a.js","assets/useQuery-721e9ceb.js","assets/use-transaction-1e10fa41.js","assets/toast-options-b5902a92.js","assets/v4-4a60fe23.js"])),te=()=>{const{user:e,updatePlayerData:s}=x(),{selectedPack:n,setSelectedPack:i}=q(),{data:o}=L(),{data:l}=G(),[g,m]=y.useState("gems"),[h,d]=y.useState(!1);async function v(r){if(!e)return c.error("You need to be logged in to buy items");d(!0);try{await U(e,r.offer_name)&&c.success("Item bought successfully")}catch{c.error("Error buying item")}finally{d(!1),i(null)}}async function C(r){if(!e)return alert("You need to be logged in to buy items");d(!0);try{await V(e,r.item,r.cost_wax)&&(await s(),c.success("Item bought successfully"))}catch{c.error("Error buying item")}finally{d(!1),i(null)}}return console.log("shopList",l),t.jsxs(P,{isPackSelected:!!n,children:[t.jsx(z,{}),t.jsxs(I,{isPackSelected:!!n,children:[t.jsxs(E,{children:[t.jsxs(b,{isSelected:g==="gems",onClick:()=>m("gems"),children:["Gems",t.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""})]}),t.jsxs(b,{isSelected:g==="flasks",onClick:()=>m("flasks"),children:["Flasks",t.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]}),t.jsx(Y,{children:l==null?void 0:l.map(r=>t.jsx(ee,{...r},W()))})]}),t.jsx(D,{isPackSelected:!!n,children:n?t.jsxs($,{children:[t.jsx(Q,{onClick:()=>i(null),children:"x"}),t.jsx(X,{children:t.jsxs("span",{children:["Your selection: ",n==null?void 0:n.offer_name]})}),t.jsxs(f,{children:[t.jsx("span",{children:"You will receive: "}),t.jsxs("strong",{children:[t.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""}),n==null?void 0:n.gain_gem]})]}),t.jsxs(f,{children:[t.jsx("span",{children:"You will pay:"}),t.jsxs("strong",{children:[t.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),+Z(n==null?void 0:n.cost_wax,"WAX","")," WAX"]})]}),t.jsxs(f,{children:[t.jsx("span",{children:"Your current WAX balance:"}),t.jsxs("strong",{children:[t.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),o==null?void 0:o.balance.toLocaleString("en-US",{maximumFractionDigits:2})]})]}),t.jsx(F,{isLoading:h,disabled:h,onClick:()=>n.cost_gem>0?v(n):C(n),color:"blue",children:"Purchase now"})]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{children:"Select a Pack"}),t.jsx(H,{children:"Select a Pack"})]})})]})},re=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{re as i,q as u};

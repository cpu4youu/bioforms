import{s as l,g as x,S as r,d,u,R as b,_ as j,j as o,r as w,Q as c}from"./index-de94dd96.js";import{u as T}from"./index-25cfe113.js";import S from"./index-fc00affe.js";import{u as y}from"./useQuery-81239c59.js";import{u as h}from"./use-transaction-dc9600a1.js";import{v as _}from"./v4-4a60fe23.js";import"./toast-options-4a31c38b.js";const A=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"10px",mt:"10px",bg:"#141423",br:"15px",w:"100%",maxW:"510px",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),C=l("div",{d:"flex",fw:"bold",ff:"$heading",fs:"16px",color:"white",mb:"50px"}),m=l("div",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"16px",color:"white",strong:{display:"flex",align:"center",justify:"center",gap:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"},"&:last-of-type":{my:"50px"}}),W=l("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),F=async t=>{const n=await x({options:{code:r.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:t,table:"accounts"}});return(n==null?void 0:n[0])||null},z=()=>y({queryKey:[d.WaxCoinsState],queryFn:()=>Y(),staleTime:1e3*60*60,enabled:!!u.getState().user});async function Y(){const t=u.getState().user;if(!t)return null;try{const n=await F(t.name);return n?{balance:parseFloat(n.balance),currency:n.balance.split(" ")[1]}:null}catch(n){return console.log(n),null}}const v=async t=>await x({options:{code:r.shopAle,index_position:1,key_type:"i64",limit:"1000",scope:r.shopAle,table:"shopitems"}}),E=()=>y({queryKey:[d.ShopState],queryFn:()=>R(),staleTime:1e3*60*60,enabled:!!u.getState().user});async function R(){try{return await v()}catch(t){return console.log(t),null}}async function I(t,n){const{executeTransaction:e}=h(),s=X(t,n);return!!await e(s)}function X(t,n){return{actions:[{account:r.shopAle,name:"buyshopitem",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,item:n}}]}}async function Q(t,n,e){const{executeTransaction:s}=h(),a=$(t,n,e);return!!await s(a)}function $(t,n,e){return{actions:[{account:r.eosioToken,name:"transfer",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{from:t.name,to:"shop.ale",memo:`purchase,${n}`,quantity:e}}]}}function k(t,n,e){return!t||!n?t:e?t.replaceAll(" WAX",e):t.replaceAll(" WAX","")}const q=b.lazy(()=>j(()=>import("./index-935d742a.js"),["assets/index-935d742a.js","assets/index-de94dd96.js","assets/index-55fec1ff.css","assets/index-25cfe113.js"])),H=()=>{const{data:t}=E();return o.jsx(o.Fragment,{children:t==null?void 0:t.map(n=>o.jsx(q,{...n},_()))})},M=()=>{const{user:t,updatePlayerData:n}=u(),{selectedPack:e,setSelectedPack:s}=T(),{data:a}=z(),[p,f]=w.useState(!1);async function g(){if(!t)return c.error("You need to be logged in to buy items");if(!e)return c.error("You need to select a pack to buy items");f(!0);try{let i=!1;(e==null?void 0:e.cost_gem)>0?i=await I(t,e.offer_name):i=await Q(t,e.item,e.cost_wax),i&&(await n(),c.success("Item bought successfully"))}catch{c.error("Error buying item")}finally{f(!1),s(null)}}return o.jsxs(A,{children:[o.jsx(W,{onClick:()=>s(null),children:"x"}),o.jsx(C,{children:o.jsxs("span",{children:["Your selection: ",e==null?void 0:e.offer_name]})}),o.jsxs(m,{children:[o.jsx("span",{children:"You will receive: "}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""}),e==null?void 0:e.gain_gem]})]}),o.jsxs(m,{children:[o.jsx("span",{children:"You will pay:"}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),+k((e==null?void 0:e.cost_wax)||"0","WAX","")," WAX"]})]}),o.jsxs(m,{children:[o.jsx("span",{children:"Your current WAX balance:"}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),a==null?void 0:a.balance.toLocaleString("en-US",{maximumFractionDigits:2})]})]}),o.jsx(S,{isLoading:p,disabled:p,onClick:g,color:"blue",children:"Purchase now"})]})};export{H as GemList,M as GemSelection};

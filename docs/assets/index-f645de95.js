import{s as l,g as T,S as x,e as C,u as g,R as c,_ as S,j as o,r as p,Q as i}from"./index-071d7aac.js";import{u as _}from"./index-9f86ccbc.js";import E from"./index-acc17fb9.js";import{u as v}from"./useQuery-2d6d0cd6.js";import{u as j}from"./use-transaction-2ffed9f0.js";import{s as F}from"./sleep-da79c358.js";import{c as z,a as A}from"./calculateTImeLeft-c445cd36.js";import{v as R}from"./v4-4a60fe23.js";import"./index-e8f7093b.js";import"./toast-options-d01d1bd0.js";const W=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"10px",mt:"10px",bg:"#141423",br:"15px",w:"100%",maxW:"510px",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),Y=l("div",{d:"flex",fw:"bold",ff:"$heading",fs:"16px",color:"white",mb:"50px"}),f=l("div",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"16px",color:"white",strong:{display:"flex",align:"center",justify:"center",gap:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"},"&:last-of-type":{my:"50px"}}),D=l("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),L=async n=>{const e=await T({options:{code:x.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:n,table:"accounts"}});return(e==null?void 0:e[0])||null},G=()=>v({queryKey:[C.WaxCoinsState],queryFn:()=>I(),staleTime:1e3*60*60,enabled:!!g.getState().user});async function I(){const n=g.getState().user;if(!n)return null;try{const e=await L(n.name);return e?{balance:parseFloat(e.balance),currency:e.balance.split(" ")[1]}:null}catch(e){return console.log(e),null}}async function $(n,e){const{executeTransaction:t}=j(),s=Q(n,e);return!!await t(s)}function Q(n,e){return{actions:[{account:x.shopAle,name:"buyshopitem",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,item:e}}]}}async function B(n,e,t){const{executeTransaction:s}=j(),a=N(n,e,t);return!!await s(a)}function N(n,e,t){return{actions:[{account:x.eosioToken,name:"transfer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{from:n.name,to:"shop.ale",memo:`purchase,${e}`,quantity:t}}]}}const X=c.lazy(()=>S(()=>import("./index-7d18fdde.js"),["assets/index-7d18fdde.js","assets/index-071d7aac.js","assets/index-55fec1ff.css","assets/index-9f86ccbc.js","assets/useQuery-2d6d0cd6.js","assets/calculateTImeLeft-c445cd36.js"])),q=c.memo(({list:n})=>o.jsx(o.Fragment,{children:n==null?void 0:n.map(e=>o.jsx(X,{...e},R()))})),K=c.memo(()=>{const{user:n,updatePlayerData:e}=g(),{selectedPack:t,setSelectedPack:s}=_(),{data:a}=G(),[u,d]=c.useState(""),[y,h]=p.useState(!1);async function w(){if(!n)return i.error("You need to be logged in to buy items");if(!t)return i.error("You need to select a pack to buy items");h(!0);let r=!1;try{(t==null?void 0:t.category)==="credits"||(t==null?void 0:t.category)==="flasks"?r=await $(n,t.item):r=await B(n,t.item,t.cost_wax),r&&(await F(3e3),await e(),i.success("Item bought successfully"))}catch{i.error("Error buying item")}finally{h(!1),s(null)}}const m=p.useCallback(()=>{if(!(t!=null&&t.itemCD))return d("Expired");const r=z(new Date(t==null?void 0:t.itemCD)),b=A(r,"weeks");d(b)},[t]);return p.useEffect(()=>{m();const r=setTimeout(()=>{m()},1e3*60);return()=>{clearTimeout(r)}},[m]),o.jsxs(W,{children:[o.jsx(D,{onClick:()=>s(null),children:"x"}),o.jsx(Y,{children:o.jsxs("span",{children:["Your selection: ",t==null?void 0:t.offer_name]})}),o.jsxs(f,{children:[o.jsx("span",{children:"You will receive: "}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageGain}.png`,alt:""}),t==null?void 0:t.gain]})]}),o.jsxs(f,{children:[o.jsx("span",{children:"You will pay:"}),t!=null&&t.cost?o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageCost}.png`,alt:""}),t==null?void 0:t.cost,(t==null?void 0:t.imageCost)==="wax-coin"?" WAX":""]}):o.jsx("strong",{children:"FREE"})]}),o.jsxs(f,{children:[o.jsx("span",{children:"Your current WAX balance:"}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),a==null?void 0:a.balance.toLocaleString("en-US",{maximumFractionDigits:2})]})]}),o.jsx(E,{isLoading:y,disabled:y,onClick:w,color:"blue",children:u||"Purchase now"})]})});q.displayName="GemList";K.displayName="GemSelection";export{q as GemList,K as GemSelection};

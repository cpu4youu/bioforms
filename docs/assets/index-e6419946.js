import{s as m,g as E,S as d,e as L,u as y,R as l,_ as v,j as o,r as g,Q as u}from"./index-78dc7b1e.js";import{u as $}from"./index-658335f7.js";import z from"./index-392c3423.js";import{u as A}from"./useQuery-0b74c68b.js";import{u as C}from"./use-transaction-7fcf6795.js";import{s as F}from"./sleep-da79c358.js";import{v as R}from"./v4-4a60fe23.js";import"./toast-options-251f3299.js";const W=m("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"10px",mt:"10px",bg:"#141423",br:"15px",w:"100%",maxW:"510px",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),Y=m("div",{d:"flex",fw:"bold",ff:"$heading",fs:"16px",color:"white",mb:"50px"}),h=m("div",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"16px",color:"white",strong:{display:"flex",align:"center",justify:"center",gap:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"},"&:last-of-type":{my:"50px"}}),G=m("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),I=async n=>{const e=await E({options:{code:d.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:n,table:"accounts"}});return(e==null?void 0:e[0])||null},M=()=>A({queryKey:[L.WaxCoinsState],queryFn:()=>Q(),staleTime:1e3*60*60,enabled:!!y.getState().user});async function Q(){const n=y.getState().user;if(!n)return null;try{const e=await I(n.name);return e?{balance:parseFloat(e.balance),currency:e.balance.split(" ")[1]}:null}catch(e){return console.log(e),null}}async function B(n,e){const{executeTransaction:t}=C(),s=N(n,e);return!!await t(s)}function N(n,e){return{actions:[{account:d.shopAle,name:"buyshopitem",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,item:e}}]}}async function X(n,e,t){const{executeTransaction:s}=C(),r=q(n,e,t);return!!await s(r)}function q(n,e,t){return{actions:[{account:d.eosioToken,name:"transfer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{from:n.name,to:"shop.ale",memo:`purchase,${e}`,quantity:t}}]}}const K=l.lazy(()=>v(()=>import("./index-79886828.js"),["assets/index-79886828.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css","assets/index-658335f7.js","assets/useQuery-0b74c68b.js"])),O=l.memo(({list:n})=>o.jsx(o.Fragment,{children:n==null?void 0:n.map(e=>o.jsx(K,{...e},R()))})),U=l.memo(()=>{const{user:n,updatePlayerData:e}=y(),{selectedPack:t,setSelectedPack:s}=$(),{data:r}=M(),[f,b]=l.useState(""),[j,w]=g.useState(!1);async function S(){if(!n)return u.error("You need to be logged in to buy items");if(!t)return u.error("You need to select a pack to buy items");w(!0);let a=!1;try{((t==null?void 0:t.category)==="credits"||(t==null?void 0:t.category)==="flasks")&&(a=await B(n,t.item)),(t==null?void 0:t.imageCost)==="wax-coin"&&(a=await X(n,t.item,t.cost_wax)),a&&(await F(3e3),await e(),u.success("Item bought successfully"))}catch{u.error("Error buying item")}finally{w(!1),s(null)}}const p=g.useCallback(()=>{if(!(t!=null&&t.itemCD))return b("");const a=new Date,i=new Date(t==null?void 0:t.itemCD).getTime()-a.getTime(),c=Math.floor(i/(1e3*60*60*24*7)),x=Math.floor(i/(1e3*60*60*24)-c*7),T=Math.floor(i/(1e3*60*60)-c*7*24-x*24),D=Math.floor(i/(1e3*60)-c*7*24*60-x*24*60-T*60);b(`${c}w ${x}d ${T}h ${D}m`)},[t]);return g.useEffect(()=>{p();const a=setTimeout(()=>{p()},1e3*60);return()=>{clearTimeout(a)}},[p]),o.jsxs(W,{children:[o.jsx(G,{onClick:()=>s(null),children:"x"}),o.jsx(Y,{children:o.jsxs("span",{children:["Your selection: ",t==null?void 0:t.offer_name]})}),o.jsxs(h,{children:[o.jsx("span",{children:"You will receive: "}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageGain}.png`,alt:""}),t==null?void 0:t.gain]})]}),o.jsxs(h,{children:[o.jsx("span",{children:"You will pay:"}),t!=null&&t.cost?o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageCost}.png`,alt:""}),t==null?void 0:t.cost,(t==null?void 0:t.imageCost)==="wax-coin"?" WAX":""]}):o.jsx("strong",{children:"FREE"})]}),o.jsxs(h,{children:[o.jsx("span",{children:"Your current WAX balance:"}),o.jsxs("strong",{children:[o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),r==null?void 0:r.balance.toLocaleString("en-US",{maximumFractionDigits:2})]})]}),o.jsx(z,{isLoading:j,disabled:j,onClick:S,color:"blue",children:f||"Purchase now"})]})});O.displayName="GemList";U.displayName="GemSelection";export{O as GemList,U as GemSelection};

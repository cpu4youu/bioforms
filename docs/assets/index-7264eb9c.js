import{s as U,g as K,S as x,t as P,e as F,u as N,q as Y,R as Q,_ as $,a as G,r as p,j as a}from"./index-c43343c7.js";import{u as V,o as B}from"./land-config-2dcaf6d2.js";import{o as E}from"./all-buildings-32b790e1.js";import{u as W}from"./useQuery-5d538c17.js";import{u as q}from"./use-transaction-f8785654.js";import{s as M}from"./sleep-da79c358.js";import{u as J}from"./index-5130eb57.js";import{b as X}from"./constants-9b21425a.js";import"./atomic-api-c8f1e2fe.js";import"./toast-options-205b7f7e.js";const Z=U("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%","&.destroy":{borderColor:"#9E475D"},div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}}}),tt=async t=>await K({options:{code:x.landsAle,index_position:1,limit:"1000",scope:t,table:P.buildingcost}}),ot=t=>W({queryFn:()=>et(t),queryKey:[F.buildingConfigState,t],staleTime:1e3*60*60,enabled:!!N.getState().user});async function z(t){return await Y.invalidateQueries([F.buildingConfigState,t])}async function et(t){try{return await tt(t)}catch(o){return console.log(o),null}}async function st(t,o){const{executeTransaction:s}=q(),u=nt(t,o);return!!await s(u)}function nt(t,o){return{actions:[{account:x.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,x:o.x,y:o.y,building:o.building,level:o.level,cost_gem:o.cost_gem,cost_credits:o.cost_credits}}]}}async function at(t,o){const{executeTransaction:s}=q(),u=it(t,o);return!!await s(u)}function it(t,o){return{actions:[{account:x.landsAle,name:"boost",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:o.planet,building:o.building,x:o.x,y:o.y,cost_gems:o.cost_gems,cost_credits:o.cost_credits,boost_target:o.boost_target}}]}}const f=Q.lazy(()=>$(()=>import("./index-810fc098.js"),["assets/index-810fc098.js","assets/index-c43343c7.js","assets/index-55fec1ff.css","assets/index-4a789fe5.js"])),rt=()=>{var v;const{data:t}=V(),o=N(G(n=>n.user)),{selectedLand:s,setSelectedLand:u,buildingBoost:i,selectedBuild:e,setSelectedBuild:D,setIsDestroying:H}=J(),{data:d}=ot((e==null?void 0:e.img)||""),[y,h]=p.useState(!1),[g,w]=p.useState(!1);async function k(){var n;if(s)try{w(!0);const r=((n=o==null?void 0:o.activestats)==null?void 0:n.gems)>=m*10,b=r?m*10:0,l=r?0:m,_={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:e.building_name.toLowerCase(),boost_target:i[0]*1e4,cost_gems:b,cost_credits:l};await at(o,_)&&(await M(1e3),await B(),await z(e.building_name.toLowerCase()),await E())}catch(r){console.error(r)}finally{w(!1)}}async function I(){if(!o){console.log("User not authenticated");return}if(!s||!e){console.log("Selected land or build is not available");return}if(!c){console.log("Building cost not available");return}if(!t||!t[0]){console.log("Land configuration not available");return}if(!i||i.length===0){console.log("Building boost not available");return}try{h(!0);const n={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:e.building_name.toLowerCase(),level:e!=null&&e.boost_score?(e.level||1)+1:1,cost_gem:c.cost_gem,cost_credits:c.cost_credits};await st(o,n)&&(await M(2e3),await B(),await z(e==null?void 0:e.img),await E())}catch(n){console.error(n)}finally{h(!1),u(null),D({...X[0]})}}const c=p.useMemo(()=>d==null?void 0:d.find(n=>n.building_name===e.img&&n.level===((e==null?void 0:e.level)||0)+1),[d,e]),m=p.useMemo(()=>{var C,j,A,R;const n=((C=t==null?void 0:t[0])==null?void 0:C.boost_base_cost)||0,r=((j=t==null?void 0:t[0])==null?void 0:j.boost_cost_first_percent)||0,b=(e==null?void 0:e.boost_score)||0,l=Number(((A=t==null?void 0:t[0])==null?void 0:A.boost_cost_mod)||0),_=(1-Math.pow(l,i[0]+1))/(1-l),T=(1-Math.pow(l,b/1e4+1))/(1-l),L=n+r*(_-T),S=(((R=t==null?void 0:t[0])==null?void 0:R.start_boost_score)||0)/1e4;return Math.round(L<S?S:L)},[i,t,e]),O=!!(e!=null&&e.boost_score);return a.jsx(Z,{children:s&&O?a.jsxs(a.Fragment,{children:[a.jsx(f,{className:"destroy",isLoading:g,disabled:g,onClick:()=>H(!0),children:"Destroy Building"}),a.jsxs(f,{isLoading:g,disabled:g,onClick:k,children:["Boost"," ",a.jsxs("div",{children:[m.toFixed(2),a.jsx("img",{src:"/assets/icons/credits.png",alt:"credits",loading:"lazy"})," "]})]})]}):a.jsxs(f,{isLoading:y,disabled:y,onClick:I,children:["Build ",e==null?void 0:e.building_name,a.jsxs("div",{children:[(v=c==null?void 0:c.cost_credits)==null?void 0:v.toLocaleString("en-US")," ",a.jsx("img",{src:"/assets/icons/credits.png",alt:"credits",loading:"lazy"})]})]})})},xt=Q.memo(rt);export{xt as default};

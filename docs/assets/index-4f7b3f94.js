import{s as x,S as j,c as W,Q as _,g as z,q as L,u as C,d as M,R as F,_ as S,a as N,r as w,j as t}from"./index-078fb701.js";import{u as H}from"./index-0bbcc8f7.js";import{F as O}from"./index-394d4005.js";import{u as P}from"./use-media-9d63906c.js";import{s as q}from"./sleep-da79c358.js";import{u as V}from"./use-transaction-1e10fa41.js";import{u as k}from"./useQuery-721e9ceb.js";const Q=x("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),Y=x("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}},"&:nth-child(1)":{display:"none"},"&:nth-child(2)":{display:"none"}},"@lgxxx":{button:{"&:nth-child(1)":{display:"flex"},"&:nth-child(2)":{display:"flex"}}},"@md":{button:{"&:nth-child(1)":{display:"none"},"&:nth-child(2)":{display:"none"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),$=x("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}}}),B=x("div",{gridArea:"main",d:"flex",justify:"space-between",gap:"5px",w:"100%",px:"20px",">span":{mt:"55px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@xlg":{justify:"center",flexWrap:"wrap",">span":{my:"25px"}},variants:{isFighterSelected:{true:{justify:"center",flexWrap:"wrap",">span":{my:"25px"}}}}}),K=x("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),G=x("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),U=x("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),J=x("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function X(e,n,o,i,l,r,d,c,p,u,s){const{executeTransaction:g}=V(),m=Z(e,n,o,i,l,r,d,c,p,u,s);return!!await g(m)}function Z(e,n,o,i,l,r,d,c,p,u,s){return{actions:[{account:j.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:n,land_id:o,crew_asset_id:i,weapon_asset_id:l,fighter_ids:r,difficulty:d,use_gems:c,history_id:p,x:u,y:s}}]}}const ee=W(e=>({myTeam:[null,null,null,null,null],setMyTeam:n=>e({myTeam:n}),selectedCards:[void 0,void 0],setSelectedCards:n=>e({selectedCards:n})}));function te({user:e,areaSelected:n,myTeam:o,selectedCards:i,selectedLevel:l}){var d,c,p,u,s,g,m,f;const r=o.reduce((h,y)=>y?[...h,y.fighter_id]:h,[]);return!e||!(n!=null&&n.landId)||!r.length||!((d=i[0])!=null&&d.asset_id)||!((c=i[1])!=null&&c.asset_id)?(r.length||_.error("No Warrior selected"),(p=i[0])!=null&&p.asset_id||_.error("No Crew selected (First spot on cards)"),(u=i[1])!=null&&u.asset_id||_.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:n,crew_asset_id:Number((s=i[0])==null?void 0:s.asset_id),weapon_asset_id:Number((g=i[1])==null?void 0:g.asset_id),fighter_ids:r,selectedLevel:l})):{user:e,planet:e.planet,landId:n.landId,x:n.x,y:n.y,card1:Number((m=i[0])==null?void 0:m.asset_id),card2:Number((f=i[1])==null?void 0:f.asset_id),teamFiltered:r,level:l.level}}const ne=async()=>await z({options:{code:j.dungeonsAle,index_position:1,limit:"1000",scope:j.dungeonsAle,table:L.config}}),ie=()=>k({enabled:!!C.getState().user,queryKey:[M.dungeonConfigDataState],queryFn:()=>se(),staleTime:1e3*60*20});async function se(){try{const e=await ne();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const A=F.lazy(()=>S(()=>import("./index-1be0728a.js"),["assets/index-1be0728a.js","assets/index-078fb701.js","assets/index-55fec1ff.css"])),ae=F.lazy(()=>S(()=>import("./index-e4d31038.js"),["assets/index-e4d31038.js","assets/index-078fb701.js","assets/index-55fec1ff.css","assets/useQuery-721e9ceb.js","assets/v4-4a60fe23.js"])),re=F.lazy(()=>S(()=>import("./index-e9bdfe32.js"),["assets/index-e9bdfe32.js","assets/index-078fb701.js","assets/index-55fec1ff.css","assets/fighters-query-bc7d5bf6.js","assets/useQuery-721e9ceb.js","assets/index-0bbcc8f7.js","assets/index-1be0728a.js","assets/use-media-9d63906c.js","assets/inventory-query-613df0a7.js","assets/atomic-api-e2c6fe4f.js","assets/toast-options-b5902a92.js","assets/v4-4a60fe23.js","assets/index-394d4005.js","assets/sleep-da79c358.js","assets/use-transaction-1e10fa41.js"])),oe=F.lazy(()=>S(()=>import("./index-44a633f0.js"),["assets/index-44a633f0.js","assets/index-078fb701.js","assets/index-55fec1ff.css","assets/useQuery-721e9ceb.js","assets/fighters-query-bc7d5bf6.js","assets/index-0bbcc8f7.js","assets/use-media-9d63906c.js","assets/v4-4a60fe23.js"])),le=()=>{const e=C(a=>a.user),{isSuperLarge:n}=P(),{data:o}=ie(),{selectedCards:i,myTeam:l,setMyTeam:r,setSelectedCards:d}=ee(),{areaSelected:c,setAreaSelected:p}=N(),{selectedLevel:u,selectedFighter:s,setSelectedFighter:g}=H(),[m,f]=w.useState(!1),[h,y]=w.useState("");async function I(){try{f(!0);const a=te({areaSelected:c,myTeam:l,selectedCards:i,selectedLevel:u,user:e});if(!a)return;const v=(()=>{const D="abcdefghijklmnopqrstuvwxyz12345";let b="";for(let T=0;T<12;T++){const R=Math.round(Math.random()*12+1);b+=D[R]}return b})();if(!await X(e,e.planet,a.landId,a.card1,a.card2,a.teamFiltered,a.level,!0,v,a.x,a.y))return;await q(2e3),y(v),_.success("Fight Started !")}catch(a){console.error(a)}finally{f(!1)}}function E(){d([void 0,void 0]),r([null,null,null,null,null]),p(null)}return h?t.jsx(ae,{historyId:h}):t.jsxs(Q,{isFighterSelected:!!s,children:[t.jsxs(Y,{children:[t.jsx("button",{}),t.jsx("button",{}),t.jsx(A,{onClick:E,children:"Back"}),t.jsxs(A,{isLoading:m,onClick:I,children:["Start Fight",t.jsxs("div",{children:["-",o==null?void 0:o.energy_cost,t.jsx("img",{src:"/assets/icons/potion.png",alt:"Potion"})]})]})]}),t.jsxs($,{isFighterSelected:!!s,children:[t.jsx(K,{children:"Weather"}),t.jsx(G,{children:"+20% Gem Damage"}),t.jsxs(B,{isFighterSelected:n&&!!s,children:[t.jsx(re,{}),t.jsx("span",{children:"VS"}),t.jsx(oe,{})]})]}),t.jsx(U,{isFighterSelected:!!s,children:s?t.jsx(O,{selectedFighter:{...s,...s.stats},onCloseFighterDetail:g}):t.jsx(t.Fragment,{children:t.jsx(J,{children:"Select a Fighter"})})})]})},_e=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{_e as i,ee as u};

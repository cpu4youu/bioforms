import{s as p,e as _e,p as Ce,S as w,q as fe,d as xe,u as E,g as Le,R as P,_ as ge,a as Te,r as h,j as e,Q as oe}from"./index-8b01bd0a.js";import{u as Ae}from"./inventory-query-01926acb.js";import{u as ue}from"./useQuery-e36ba289.js";import{u as me}from"./use-transaction-d8858974.js";import{s as Re}from"./sleep-da79c358.js";import{u as Ie}from"./use-media-de53cb58.js";import{u as ze,o as Fe}from"./fighters-query-0a0babbd.js";import"./atomic-api-042bed03.js";import"./toast-options-cef04bb1.js";const ke=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"100%"}),Se=p("div",{d:"flex",align:"flex-end",justify:"flex-end",gap:"10px",position:"relative",w:"100%",button:{d:"flex",align:"center",justify:"center",maxW:"188px",h:"70px",svg:{fill:"#00BAFF"},span:{d:"flex",align:"center",justify:"center",gap:"5px",color:"#828282"},img:{maxW:"35px",maxH:"30px"}},"@sm":{button:{justify:"center",gap:"2px",padding:"0",maxW:"33%",h:"45px",fs:"12px",span:{gap:"0px"},svg:{display:"none"}}}}),$e=p("div",{d:"flex",align:"flex-start",justify:"center",gap:"10px",w:"100%",h:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",">img":{mt:"10px",h:"calc(100vh - 160px)",br:"15px","@lg":{d:"none"}}}),De=p("div",{d:"grid",gridTemplateAreas:`
    "title title title"
    "objectivesLeft content objectivesRight"
    "objectivesLeft inventory objectivesRight"
    "objectivesLeft inventory objectivesRight"
    "objectivesLeft inventory objectivesRight"
  `,gridTemplateColumns:"1fr 5fr 1fr",gap:"20px",mt:"10px",padding:"15px 10px",bg:"#141423",br:"15px",w:"100%",h:"100%","@sm":{gridTemplateAreas:`
    "title title title"
    "content content content"
    "objectivesLeft objectivesLeft objectivesLeft"
    "objectivesRight objectivesRight objectivesRight"
    "inventory inventory inventory"
  `},variants:{isHidden:{true:{"@sm":{display:"none"}}}}});p("div",{d:"grid",gridTemplateAreas:`
    "title title title"
    "objectivesLeft content objectivesRight"
    "objectivesLeft inventory objectivesRight"
  `,gridTemplateColumns:"1fr 5fr 1fr",gap:"20px",mt:"10px",padding:"15px 10px",bg:"#141423",br:"15px",w:"100%","@sm":{gridTemplateAreas:`
    "title title title"
    "content content content"
    "objectivesLeft objectivesLeft objectivesLeft"
    "objectivesRight objectivesRight objectivesRight"
    "inventory inventory inventory"
  `},variants:{isHidden:{true:{"@sm":{display:"none"}}}}});const He=p("h2",{gridArea:"title",w:"100%",textAlign:"center",textTransform:"capitalize",fs:"24px",color:"#fff"}),le=p("div",{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"5px",mb:"auto",w:"100%","&.left":{gridArea:"objectivesLeft"},"&.right":{gridArea:"objectivesRight"},"@sm":{flexDirection:"row"}}),ce=p("div",{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",w:"100%",maxW:"82px",h:"85px",padding:"5px 0px 0px",bg:"#358CAC",br:"3px",span:{color:"#fff",ff:"$heading",fs:"12px","&:first-child":{color:"#07445A",mb:"12px"}},variants:{disabled:{true:{filter:"grayscale(100%)"}}}}),pe=p("div",{display:"flex",alignItems:"center",gap:"5px",mt:"auto",padding:"5px 10px",color:"#fff",ff:"$heading",fs:"14px",br:"3px",bg:"#17566D",w:"100%"}),Ee=p("div",{gridArea:"content",display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"35px",w:"100%",">img":{w:"135px",h:"195px",br:"10px",objectPosition:"top",objectFit:"cover"},"@sm":{gap:"10px",img:{maxW:"85px"}},"@xsm":{gap:"5px",img:{maxW:"65px"}}}),Pe=p("div",{gridArea:"content",img:{"&:hover":{transform:"scale(1.05)",zIndex:"4","-webkit-filter":"drop-shadow(0px 0px 8px #00BAFF)",filter:"drop-shadow(0px 0px 5px #00BAFF)"},"&:nth-of-type(1)":{transform:"translate(30px,20px) rotate(-20deg)",zIndex:"3","&:hover":{transform:"scale(1.05) translate(30px,20px) rotate(-20deg)",zIndex:"4"}},"&:nth-of-type(3)":{transform:"translate(-30px,20px) rotate(20deg)",zIndex:"1","&:hover":{transform:"scale(1.05) translate(-30px,20px) rotate(20deg)",zIndex:"4"}},"@sm":{"&:nth-of-type(1)":{transform:"translate(20px,9px) rotate(-20deg)",zIndex:"3","&:hover":{transform:"scale(1.05) translate(20px,9px) rotate(-20deg)",zIndex:"4"}},"&:nth-of-type(3)":{transform:"translate(-20px,9px) rotate(20deg)",zIndex:"1","&:hover":{transform:"scale(1.05) translate(-20px,9px) rotate(20deg)",zIndex:"4"}}}},variants:{cardSelected:{0:{img:{"&:nth-of-type(1)":{zIndex:"3"},"&:nth-of-type(2)":{opacity:"0.2"},"&:nth-of-type(3)":{opacity:"0.2"}}},1:{img:{"&:nth-of-type(1)":{opacity:"0.2"},"&:nth-of-type(2)":{},"&:nth-of-type(3)":{opacity:"0.2"}}},2:{img:{"&:nth-of-type(1)":{opacity:"0.2"},"&:nth-of-type(2)":{opacity:"0.2"},"&:nth-of-type(3)":{}}}}}}),L=p("img",{cursor:"pointer",transition:"all 0.2s ease-in-out",w:"120px",h:"170px",zIndex:"2",variants:{isSelected:{true:{filter:"grayscale(100%)"}}},"@lg":{w:"100px",h:"150px"},"@sm":{width:"80px",height:"initial"},"@xsm":{width:"70px",height:"initial"}}),Me=p("div",{gridArea:"inventory",display:"flex",direction:"column",w:"100%",span:{ff:"$heading",fs:"16px",fw:"bold",color:"#fff",textAlign:"center"},"@sm":{mt:"0px"}}),We=p("div",{d:"flex",align:"center",justify:"center",gap:"20px",mb:"20px","@sm":{m:"0px 0 20px",gap:"10px"}}),T=p("button",{d:"flex",align:"center",justify:"center",fs:"20px",ff:"$heading",fw:"$bold",color:"$white500",variants:{isSelected:{true:{textUnderlineOffset:"0.5em",textDecoration:"underline"}}},"@sm":{fs:"14px"}}),Be=p("div",{d:"flex",flexWrap:"wrap",gap:"10px",overflow:"auto",w:"100%",maxH:"calc(100vh - 520px)"}),Ne=_e({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Oe=p("div",{w:"120px",h:"170px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${Ne} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Qe=async()=>{var m,j;let i=!1,a;const s=[];for(;!i;){const u=await Ce.get_table_rows({code:w.ADVENTURE_MC,index_position:1,limit:"10000",scope:w.ADVENTURE_MC,table:fe.ADV_TEMPLATES,show_payer:!1,json:!0,lower_bound:a});i=!u.more,s.push(...u.rows.slice(0,-1)),a=((j=(m=u.rows)==null?void 0:m[u.rows.length-1])==null?void 0:j.templateid)??""}return s},Ve=()=>ue({queryKey:[xe.tavernDataState],queryFn:()=>qe(),staleTime:1e3*60*60,enabled:!!E.getState().user});async function qe(){try{const i=await Qe();return i?Ue(i):null}catch(i){return console.log(i),null}}function Ue(i){return i.map(a=>({...a,"nft.mp":a.nft_mp,"tlm.mp":a.tlm_mp}))}const Ke=async()=>await Le({options:{code:w.tavernAle,index_position:1,limit:"1000",scope:w.tavernAle,table:fe.CONFIG}}),Ye=()=>ue({queryKey:[xe.tavernConfigState],queryFn:()=>Ge(),staleTime:1e3*60*60,enabled:!!E.getState().user});async function Ge(){try{const i=await Ke();return i||null}catch(i){return console.log(i),null}}async function Je(i,a){const{executeTransaction:s}=me(),m=Xe(i,a);return!!await s(m)}function Xe(i,a){return{actions:[{account:w.tavernAle,name:"reveal",authorization:[{actor:i.name,permission:i.authorization.permission}],data:{wallet:i.name,use_gems:a}}]}}async function Ze(i,a,s){const{executeTransaction:m}=me(),j=et(i,a,s);return!!await m(j)}function et(i,a,s){return{actions:[{account:w.playersAle,name:"hire",authorization:[{actor:i.name,permission:i.authorization.permission}],data:{wallet:i.name,asset_ids:a,cost_action_points:s}}]}}const H=P.lazy(()=>ge(()=>import("./index-acbe3f0e.js"),["assets/index-acbe3f0e.js","assets/index-8b01bd0a.js","assets/index-55fec1ff.css"])),de=P.lazy(()=>ge(()=>import("./index-98478877.js").then(i=>i.i),["assets/index-98478877.js","assets/index-8b01bd0a.js","assets/index-55fec1ff.css"])),tt=()=>{var Y,G,J,X,Z,ee,te,se,ne,ae,ie,re;const{setAreaSelected:i,areaSelected:a}=Te(),{user:s,updatePlayerData:m}=E(),{isSmall:j}=Ie(),[u,_]=h.useState("level.worlds"),[v,b]=h.useState(0),[y,he]=h.useState({}),[d,M]=h.useState([void 0,void 0,void 0]),[W,B]=h.useState(!1),[N,O]=h.useState(!1),[R,I]=h.useState(!1),[z,Q]=h.useState(!1),{data:F,isLoading:ve}=Ae(u),{data:k}=Ve(),{data:l}=Ye(),{data:A}=ze();function ye(){i(null)}function je(t){return d.some(n=>(n==null?void 0:n.asset_id)!==t.asset_id)}function S(t){if(t===v){b(-1);return}b(t)}function V(t){if(!t){const r=d.map((o,x)=>{if(x!==v)return o});q(r),b(v+1),M(r);return}if(d.some(r=>(r==null?void 0:r.asset_id)===(t==null?void 0:t.asset_id))){b(-1);return}const n=d.map((r,o)=>o===v?t:r);q(n),b(v+1),M(n),v===2&&b(-1)}function q(t){let n={};t.forEach(r=>{const o=k==null?void 0:k.find(g=>(g==null?void 0:g.templateid)===Number(r==null?void 0:r.template.template_id));if(!o||!(a!=null&&a.objectives))return;const x=a.objectives.reduce((g,c,D)=>{if(c.objective_value!==99999&&c.objective_value===(o==null?void 0:o[c.objective_type])){const C=c==null?void 0:c.mod_value;return g[D]=C,g}if(c.objective_type==="element"&&(c.objective_string.toLocaleLowerCase()===(o==null?void 0:o.element.toLocaleLowerCase())||c.objective_string.toLocaleLowerCase()===(o==null?void 0:o.weaponclass.toLocaleLowerCase()))){const C=c==null?void 0:c.mod_value;return g[D]=C,g}if(c.objective_string!=="-"&&c.objective_string.toLocaleLowerCase()===String(o==null?void 0:o[c.objective_type]).toLocaleLowerCase()){const C=c==null?void 0:c.mod_value;return g[D]=C,g}return g},{});n={...n,...x}}),he(n)}function U(){var t,n,r,o,x,g;return!l||!s?null:((t=s==null?void 0:s.activestats)==null?void 0:t.gems)>=((n=l==null?void 0:l[0])==null?void 0:n.cost_reveal_gem)?(r=l==null?void 0:l[0])==null?void 0:r.cost_reveal_gem:((o=s==null?void 0:s.activestats)==null?void 0:o.credits)>=((x=l==null?void 0:l[0])==null?void 0:x.cost_reveal_credits)?(g=l==null?void 0:l[0])==null?void 0:g.cost_reveal_credits:null}async function $(t){if(!t){I(!1),Q(!1);return}if(f){I(!0),Q(!z);return}if(s){B(!0);try{await Je(s,t)&&(await Re(2e3),await m(),oe.success("Reveal success"))}catch{}finally{B(!1)}}}async function be(){if(!s)return;O(!0);const t=d.filter(n=>!!n).map(n=>Number(n.asset_id));try{await Ze(s,t,K())&&(await m(),Fe(s.name),i(null),oe.success("Hire success"))}catch{}finally{O(!1)}}function K(){var n;const t=new Array(10).fill(0).map((r,o)=>o).reduce((r,o,x)=>y[x]?r+=y[x]:r,0);return(((n=l==null?void 0:l[0])==null?void 0:n.cost_hire_ap)||0)-t}const we=h.useMemo(()=>{var t;return(t=s==null?void 0:s.active_taverns)==null?void 0:t.some(n=>n.x===(a==null?void 0:a.x)&&n.y===(a==null?void 0:a.y))},[s,a]),f=h.useMemo(()=>{var t,n;if(((t=s==null?void 0:s.last_tavern)==null?void 0:t.x)===(a==null?void 0:a.x)&&((n=s==null?void 0:s.last_tavern)==null?void 0:n.y)===(a==null?void 0:a.y))return A==null?void 0:A.find(r=>(s==null?void 0:s.last_tavern_fighter.classname)===r.classname&&(s==null?void 0:s.last_tavern_fighter.element)===r.element&&(s==null?void 0:s.last_tavern_fighter.racename)===r.racename)},[s,a,A]);return e.jsxs(ke,{children:[e.jsxs(Se,{children:[!we&&e.jsxs(H,{disabled:N,isLoading:N,color:"black",onClick:be,children:["Hire",e.jsxs("span",{children:[K(),e.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]}),e.jsx(H,{color:"black",isLoading:W,onClick:()=>{var t,n;return $((((t=s==null?void 0:s.activestats)==null?void 0:t.gems)||0)>=(((n=l==null?void 0:l[0])==null?void 0:n.cost_reveal_gem)||0))},disabled:U()===null||W,children:f?"Details":e.jsxs(e.Fragment,{children:["Reveal",e.jsxs("span",{children:[U(),e.jsx("img",{loading:"lazy",src:"/assets/icons/dust.png",alt:""})]})]})}),e.jsx(H,{color:"black",onClick:ye,children:"Back"})]}),e.jsxs($e,{children:[e.jsxs(De,{isHidden:R,children:[e.jsx(He,{children:f?`${f.racename} ${f.classname}`:"Unknown Fighter"}),e.jsx(le,{className:"left",children:(Y=a==null?void 0:a.objectives)==null?void 0:Y.slice(0,5).map(({objective_string:t,objective_type:n,objective_value:r,mod_value:o},x)=>e.jsxs(ce,{disabled:!(y!=null&&y[x]),children:[e.jsx("span",{children:n}),e.jsx("span",{children:t==="-"?r:t}),e.jsxs(pe,{children:[o,e.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]},x))}),e.jsxs(Ee,{children:[f?e.jsx("img",{onClick:()=>I(!0),src:`/assets/fighter/full_${f.racename}_${f.classname}_${f.element}.jpeg`,alt:"",loading:"lazy"}):e.jsx("img",{loading:"lazy",src:"/assets/fighter/default-avatar.jpg",alt:""}),e.jsxs(Pe,{cardSelected:v,children:[e.jsx(L,{onClick:()=>S(0),loading:"lazy",src:d[0]?`/assets/aw-nft-images/${(G=d[0])==null?void 0:G.template.template_id}.webp`:"/assets/default-card.png",alt:(X=(J=d[0])==null?void 0:J.data)==null?void 0:X.name}),e.jsx(L,{onClick:()=>S(1),loading:"lazy",src:d[1]?`/assets/aw-nft-images/${(Z=d[1])==null?void 0:Z.template.template_id}.webp`:"/assets/default-card.png",alt:(te=(ee=d[1])==null?void 0:ee.data)==null?void 0:te.name}),e.jsx(L,{onClick:()=>S(2),loading:"lazy",src:d[2]?`/assets/aw-nft-images/${(se=d[2])==null?void 0:se.template.template_id}.webp`:"/assets/default-card.png",alt:(ae=(ne=d[2])==null?void 0:ne.data)==null?void 0:ae.name})]})]}),e.jsx(Me,{children:d.length!==0&&v===-1?e.jsx("span",{children:"Select a card"}):e.jsxs(e.Fragment,{children:[e.jsxs(We,{children:[e.jsx(T,{isSelected:u==="crew.worlds",onClick:()=>_("crew.worlds"),children:"Minions"}),e.jsx(T,{isSelected:u==="arms.worlds",onClick:()=>_("arms.worlds"),children:"Weapons"}),e.jsx(T,{isSelected:u==="tool.worlds",onClick:()=>_("tool.worlds"),children:"Tools"}),e.jsx(T,{isSelected:u==="level.worlds",onClick:()=>_("level.worlds"),children:"Levels"}),e.jsx(T,{isSelected:u==="faces.worlds",onClick:()=>_("faces.worlds"),children:"Avatars"})]}),e.jsx(Be,{children:ve?new Array(10).fill(0).map((t,n)=>e.jsx(Oe,{},n)):e.jsxs(e.Fragment,{children:[e.jsx(L,{onClick:()=>V(void 0),src:"/assets/default-card.png",alt:"default card"}),(ie=F==null?void 0:F.filter(je))==null?void 0:ie.map(t=>{var n;return e.jsx(L,{isSelected:d.some(r=>(r==null?void 0:r.asset_id)===(t==null?void 0:t.asset_id)),onClick:()=>V(t),loading:"lazy",src:`/assets/aw-nft-images/${t==null?void 0:t.template.template_id}.webp`,alt:(n=t==null?void 0:t.data)==null?void 0:n.name},t==null?void 0:t.asset_id)})]})})]})}),e.jsx(le,{className:"right",children:(re=a==null?void 0:a.objectives)==null?void 0:re.slice(5,10).map(({objective_string:t,objective_type:n,objective_value:r,mod_value:o},x)=>e.jsxs(ce,{disabled:!(y!=null&&y[x+5]),children:[e.jsx("span",{children:n}),e.jsx("span",{children:t==="-"?r:t}),e.jsxs(pe,{children:[o,e.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]},x))})]}),z&&f?e.jsx(de,{isHidden:!R,selectedFighter:f,onCloseFighterDetail:()=>$()}):!z&&f?j?e.jsx(de,{isHidden:!R,selectedFighter:f,onCloseFighterDetail:()=>$()}):e.jsx("img",{src:`/assets/tavern/${f.racename}_${f.classname}.jpeg`,alt:"",loading:"lazy"}):e.jsx("img",{src:"/assets/tavern/unknown-fighter.jpeg",alt:"",loading:"lazy"})]})]})},dt=P.memo(tt);export{dt as default};

import{s as a,c as C,g as b,S as c,b as j,u as x,R as _,_ as k,r as h,j as t,Q as l}from"./index-c493562e.js";import F from"./index-f7dbd0b6.js";import{u as S}from"./useQuery-065da00d.js";import{u as w}from"./use-transaction-0c6b2968.js";const A=a("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isPackSelected:{true:{"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),P=a("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),W=a("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"relative",minH:"calc(100vh - 175px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isPackSelected:{true:{"@xmd":{display:"none"}}}}}),z=a("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"}),I=a("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-40px",left:"0px"}),y=a("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",br:"15px 0px 0px 0px",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:last-child":{br:"0 15px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}}),E=a("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),Y=a("div",{display:"flex",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",maxHeight:"calc(100vh - 160px)",minW:"500px",variants:{isPackSelected:{false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"},"@sm":{mt:"5px"}}),R=a("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),D=a("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"10px",w:"100%",mt:"10px",bg:"#141423",br:"15px",minH:"calc(-160px + 100vh)",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),H=a("div",{d:"flex",fw:"bold",ff:"$heading",fs:"16px",color:"white",mb:"50px"}),f=a("div",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"16px",color:"white",strong:{display:"flex",align:"center",justify:"center",gap:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"},"&:last-of-type":{my:"50px"}}),$=a("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),L=C((n,e)=>({selectedPack:null,setSelectedPack:s=>n({selectedPack:s})})),O=async n=>{const e=await b({options:{code:c.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:n,table:"accounts"}});return(e==null?void 0:e[0])||null},Q=()=>S({queryKey:[j.WaxCoinsState],queryFn:()=>q(),staleTime:1e3*60*60,enabled:!!x.getState().user});async function q(){const n=x.getState().user;if(!n)return null;try{const e=await O(n.name);return e?{balance:parseFloat(e.balance),currency:e.balance.split(" ")[1]}:null}catch(e){return console.log(e),null}}const B=async n=>await b({options:{code:c.shopAle,index_position:1,key_type:"i64",limit:"1000",scope:c.shopAle,table:"shopitems"}}),M=()=>S({queryKey:[j.ShopState],queryFn:()=>G(),staleTime:1e3*60*60,enabled:!!x.getState().user});async function G(){try{return await B()}catch(n){return console.log(n),null}}async function K(n,e){const{executeTransaction:s}=w(),i=N(n,e);return!!await s(i)}function N(n,e){return{actions:[{account:c.shopAle,name:"buyshopitem",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,item:e}}]}}async function U(n,e,s){const{executeTransaction:i}=w(),o=X(n,e,s);return!!await i(o)}function X(n,e,s){return{actions:[{account:c.ALIEN_WORLDS,name:"transfer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{from:n.name,to:"shop.ale",memo:`purchase,${e}`,quantity:s}}]}}const V=_.lazy(()=>k(()=>import("./index-4a7be686.js"),["assets/index-4a7be686.js","assets/index-c493562e.js","assets/index-55fec1ff.css","assets/index-f7dbd0b6.js","assets/useQuery-065da00d.js","assets/use-transaction-0c6b2968.js","assets/toast-options-33778087.js"])),J=()=>{const{user:n}=x(),{selectedPack:e,setSelectedPack:s}=L(),{data:i}=Q(),{data:o}=M(),[d,g]=h.useState("gems"),[m,p]=h.useState(!1);async function T(r){if(!n)return l.error("You need to be logged in to buy items");p(!0);try{await K(n,r.offer_name)&&l.success("Item bought successfully")}catch{l.error("Error buying item")}finally{p(!1),s(null)}}async function v(r){if(!n)return alert("You need to be logged in to buy items");p(!0);try{await U(n,r.item,r.cost_wax)&&l.success("Item bought successfully")}catch{l.error("Error buying item")}finally{p(!1),s(null)}}return t.jsxs(A,{isPackSelected:!!e,children:[t.jsx(P,{}),t.jsxs(W,{isPackSelected:!!e,children:[t.jsxs(I,{children:[t.jsxs(y,{isSelected:d==="gems",onClick:()=>g("gems"),children:["Gems",t.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""})]}),t.jsxs(y,{isSelected:d==="flasks",onClick:()=>g("flasks"),children:["Flasks",t.jsx("img",{loading:"lazy",src:"/assets/icons/potion.png",alt:""})]})]}),t.jsx(z,{children:o==null?void 0:o.map(r=>t.jsx(V,{...r}))})]}),t.jsx(Y,{isPackSelected:!!e,children:e?t.jsxs(D,{children:[t.jsx($,{onClick:()=>s(null),children:"x"}),t.jsxs(H,{children:[t.jsx("span",{children:"Your selection"}),t.jsxs("span",{children:[" ",e==null?void 0:e.offer_name]})]}),t.jsxs(f,{children:[t.jsx("span",{children:"You will receive: "}),t.jsxs("strong",{children:[t.jsx("img",{loading:"lazy",src:"/assets/icons/gem.png",alt:""}),e==null?void 0:e.cost_gem]})]}),t.jsxs(f,{children:[t.jsx("span",{children:"You will pay:"}),t.jsxs("strong",{children:[t.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),e==null?void 0:e.cost_wax]})]}),t.jsxs(f,{children:[t.jsx("span",{children:"Your current WAX balance:"}),t.jsxs("strong",{children:[t.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),i==null?void 0:i.balance.toLocaleString("en-US",{maximumFractionDigits:2})]})]}),t.jsx(F,{isLoading:m,disabled:m,onClick:()=>e.cost_gem>0?T(e):v(e),color:"blue",children:"Purchase now"})]}):t.jsxs(t.Fragment,{children:[t.jsx(E,{children:"Select a Pack"}),t.jsx(R,{children:"Select a Pack"})]})})]})},se=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"}));export{se as i,L as u};

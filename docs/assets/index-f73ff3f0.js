import{s as c,L as O,S as m,d as P,Q as T,g as L,q as Q,u as w,e as D,R as F,_ as j,a as k,b as B,r as S,j as t}from"./index-ad1094a2.js";import{u as K}from"./index-e4fa9e4f.js";import{u as Y,F as U}from"./index-4c8d9217.js";import{u as G}from"./use-media-7ecc8733.js";import{s as J}from"./sleep-da79c358.js";import{u as X}from"./use-transaction-a8065d97.js";import{u as E}from"./useQuery-75794f1c.js";const Z=c("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),ee=c("div",{gridArea:"header",d:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@lgxxx":{gridColumnStart:2,w:"100%",gridTemplateColumns:"1fr 1fr"},"@md":{gridColumnStart:1,gridTemplateColumns:"1fr 1fr"},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),te=c("div",{position:"relative",gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}}}),ne=c("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",br:"15px 15px 0 0",bg:"#19192D",position:"absolute",top:"-35px",left:"0"}),re=c(O,{border:"1px solid rgba(0, 0, 0, 0.25)",padding:"10px 20px",ff:"$heading",fs:"12px",color:"#fff","&:last-child":{br:"15px 15px 0 0"}}),ae=c("div",{gridArea:"main",d:"flex",justify:"space-between",gap:"5px",w:"100%",px:"20px",">span":{mt:"55px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@xlg":{justify:"center",flexWrap:"wrap",">span":{my:"25px"}},variants:{isFighterSelected:{true:{justify:"center",flexWrap:"wrap",">span":{my:"25px"}}}}}),se=c("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),ie=c("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),oe=c("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),le=c("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function de(e,n,s,r,l,i,d,u,p,x,g){const{executeTransaction:f}=X(),o=ce(e,n,s,r,l,i,d,u,p,x,g);return!!await f(o)}function ce(e,n,s,r,l,i,d,u,p,x,g){return{actions:[{account:m.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:n,land_id:s,crew_asset_id:r,weapon_asset_id:l,fighter_ids:i,difficulty:d,use_gems:u,history_id:p,x,y:g}}]}}const ue=P(e=>({myTeam:[null,null,null,null,null],setMyTeam:n=>e({myTeam:n}),selectedCards:[void 0,void 0],setSelectedCards:n=>e({selectedCards:n})}));function pe({user:e,areaSelected:n,myTeam:s,selectedCards:r,selectedLevel:l}){var d,u,p,x,g,f,o,h;const i=s.reduce((y,_)=>_?[...y,_.fighter_id]:y,[]);return!e||!(n!=null&&n.landId)||!i.length||!((d=r[0])!=null&&d.asset_id)||!((u=r[1])!=null&&u.asset_id)?(i.length||T.error("No Warrior selected"),(p=r[0])!=null&&p.asset_id||T.error("No Crew selected (First spot on cards)"),(x=r[1])!=null&&x.asset_id||T.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:n,crew_asset_id:Number((g=r[0])==null?void 0:g.asset_id),weapon_asset_id:Number((f=r[1])==null?void 0:f.asset_id),fighter_ids:i,selectedLevel:l})):{user:e,planet:e.planet,landId:n.landId,x:n.x,y:n.y,card1:Number((o=r[0])==null?void 0:o.asset_id),card2:Number((h=r[1])==null?void 0:h.asset_id),teamFiltered:i,level:l.level}}const xe=async()=>await L({options:{code:m.dungeonsAle,index_position:1,limit:"1000",scope:m.dungeonsAle,table:Q.config}}),ge=()=>E({enabled:!!w.getState().user,queryKey:[D.dungeonConfigDataState],queryFn:()=>fe(),staleTime:1e3*60*20});async function fe(){try{const e=await xe();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const me=async()=>await L({options:{code:m.battleAle,index_position:1,limit:"1000",scope:m.battleAle,table:"variables"}}),he=()=>E({enabled:!!w.getState().user,queryKey:[D.VariablesState],queryFn:()=>ye(),staleTime:1e3*60*20});async function ye(){try{const e=await me();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const _e=async()=>await L({options:{code:m.battleAle,index_position:1,limit:"1000",scope:m.battleAle,table:"weather"}}),be=()=>E({enabled:!!w.getState().user,queryKey:[D.WeatherState],queryFn:()=>Fe(),staleTime:1e3*60*20});async function Fe(){try{return await _e()}catch(e){return console.log(e),null}}const z=F.lazy(()=>j(()=>import("./index-64314151.js"),["assets/index-64314151.js","assets/index-ad1094a2.js","assets/index-55fec1ff.css"])),Se=F.lazy(()=>j(()=>import("./index-3bfd3a92.js"),["assets/index-3bfd3a92.js","assets/index-ad1094a2.js","assets/index-55fec1ff.css","assets/useQuery-75794f1c.js","assets/v4-4a60fe23.js","assets/index-e4fa9e4f.js","assets/index-4c8d9217.js","assets/use-media-7ecc8733.js","assets/sleep-da79c358.js","assets/use-transaction-a8065d97.js","assets/toast-options-87ecc145.js"])),Te=F.lazy(()=>j(()=>import("./index-23a1b350.js"),["assets/index-23a1b350.js","assets/index-ad1094a2.js","assets/index-55fec1ff.css","assets/fighters-query-b8fe6a23.js","assets/useQuery-75794f1c.js","assets/index-e4fa9e4f.js","assets/index-64314151.js","assets/elements-a94bd2b3.js","assets/use-media-7ecc8733.js","assets/inventory-query-cf9223dc.js","assets/adapters-abb795bb.js","assets/atomic-api-d0313004.js","assets/toast-options-87ecc145.js","assets/markers-21ad5773.js","assets/v4-4a60fe23.js","assets/index-4c8d9217.js","assets/sleep-da79c358.js","assets/use-transaction-a8065d97.js"])),we=F.lazy(()=>j(()=>import("./index-c8bbbe1f.js"),["assets/index-c8bbbe1f.js","assets/index-ad1094a2.js","assets/index-55fec1ff.css","assets/useQuery-75794f1c.js","assets/fighters-query-b8fe6a23.js","assets/index-e4fa9e4f.js","assets/use-media-7ecc8733.js","assets/v4-4a60fe23.js"])),je=()=>{const e=w(k(a=>a.user)),{isSuperLarge:n}=G();Y();const{data:s}=ge(),{data:r}=he(),{data:l}=be(),{selectedCards:i,myTeam:d,setMyTeam:u,setSelectedCards:p}=ue(),{areaSelected:x,setAreaSelected:g}=B(),{selectedLevel:f,selectedFighter:o,setSelectedFighter:h}=K(),[y,_]=S.useState(!1),[W,N]=S.useState("");async function q(){try{_(!0);const a=pe({areaSelected:x,myTeam:d,selectedCards:i,selectedLevel:f,user:e});if(!a)return;const b=(()=>{const I="abcdefghijklmnopqrstuvwxyz12345";let M="";for(let R=0;R<12;R++){const $=Math.round(Math.random()*12+1);M+=I[$]}return M})();if(!await de(e,e.planet,a.landId,a.card1,a.card2,a.teamFiltered,a.level,!0,b,a.x,a.y))return;await J(2e3),N(b),T.success("Fight Started !")}catch(a){console.error(a)}finally{_(!1)}}function H(){p([void 0,void 0]),u([null,null,null,null,null]),g(null)}const V=S.useMemo(()=>{var C,b,A;return!d.filter(I=>I!==null).length||!((C=i[0])!=null&&C.asset_id)||!((b=i[1])!=null&&b.asset_id)||Number(((A=e==null?void 0:e.activestats)==null?void 0:A.action_points)||0)<((s==null?void 0:s.energy_cost)||0)},[d,i,s,e]),v=S.useMemo(()=>l==null?void 0:l.find(a=>a.weather_id===(r==null?void 0:r.current_weather_id)),[l,r]);return W?t.jsx(Se,{historyId:W}):t.jsxs(Z,{isFighterSelected:!!o,children:[t.jsxs(ee,{children:[t.jsx(z,{onClick:H,children:"Back"}),t.jsxs(z,{disabled:V||y,isLoading:y,onClick:q,children:["Start Fight",t.jsxs("div",{children:["-",s==null?void 0:s.energy_cost,t.jsx("img",{src:"/assets/icons/energy.png",alt:"Potion"})]})]})]}),t.jsxs(te,{isFighterSelected:!!o,children:[t.jsx(ne,{children:t.jsx(re,{to:"/dungeon-leaderboard",children:"Leaderboard"})}),t.jsx(se,{children:"Weather"}),t.jsx(ie,{children:v==null?void 0:v.displayname}),t.jsxs(ae,{isFighterSelected:n&&!!o,children:[t.jsx(Te,{}),t.jsx("span",{children:"VS"}),t.jsx(we,{})]})]}),t.jsx(oe,{isFighterSelected:!!o,children:o?t.jsx(U,{selectedFighter:{...o,...o.stats},onCloseFighterDetail:h}):t.jsx(t.Fragment,{children:t.jsx(le,{children:"Select a Fighter"})})})]})},ve=F.memo(je),Re=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{he as a,ue as b,Re as i,be as u};

import{s as n,S as j,R as a,_ as x,u as v,a as T,r as l,j as s,Q as C}from"./index-168661ec.js";import E from"./index-508cfe6c.js";import{u as R}from"./use-transaction-1070a51a.js";import{s as S}from"./sleep-da79c358.js";import{o as D}from"./activequests-query-bdcae572.js";import{c as k,a as z}from"./calculateTImeLeft-b770b02f.js";import{u as A}from"./index-7c77cbae.js";import"./index-0cd78c26.js";import"./toast-options-bf0621b1.js";import"./useQuery-746a9fbd.js";import"./v4-4a60fe23.js";const F=n("div",{display:"flex",align:"flex-end",justify:"flex-end",direction:"column",gap:"10px",padding:"5px",h:"540px",w:"100%",maxW:"425px",bg:"#6E6E6E",border:"2px solid #C8C8C8",position:"relative"}),I=n("div",{display:"flex",w:"100%",position:"relative",img:{w:"100%",objectFit:"cover",h:"225px"},span:{fw:"bold",ff:"$heading",fs:"18px",color:"white",zIndex:"2",textShadow:"2px 2px 2px rgba(0, 0, 0)",position:"absolute",bottom:"10px",right:"10px"}}),q=n("h2",{display:"flex",align:"center",justify:"center",w:"100%",h:"115px",zIndex:"2",fw:"normal",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),Q=n("span",{display:"flex",align:"center",justify:"center",gap:"10px",w:"100%",h:"80px",zIndex:"2",fw:"bold",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),L=n("div",{display:"flex",direction:"column",position:"relative",height:"30px",w:"100%",br:"5px",bg:"#282828",border:"1px solid #121212",">span":{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","-webkit-text-stroke":".5px rgba(0, 0, 0, 0.36)",fw:"bold",ff:"$heading",fs:"18px",color:"white"},div:{br:"5px",height:"100%"}}),P=n(E,{display:"flex",align:"center",justify:"center",zIndex:"3",w:"100%",h:"40px",fw:"bold",br:"2px !important",bg:"#9E475D !important",borderWidth:"1px",img:{w:"25px",h:"25px",objectFit:"contain"},variants:{isCompleted:{true:{bg:"#6750A4 !important"}}}});async function $(e,o,i){const{executeTransaction:c}=R(),p=B(e,o,i);return!!await c(p)}function B(e,o,i){return{actions:[{account:j.questAle,name:"reroll",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,scope:o,quest_name:i}}]}}const M=a.lazy(()=>x(()=>import("./shards-72ae0de4.js"),["assets/shards-72ae0de4.js","assets/index-168661ec.js","assets/index-55fec1ff.css"])),O=a.lazy(()=>x(()=>import("./tlm-87a0a92a.js"),["assets/tlm-87a0a92a.js","assets/index-168661ec.js","assets/index-55fec1ff.css"])),W=a.lazy(()=>x(()=>import("./index-b9317b77.js"),["assets/index-b9317b77.js","assets/index-168661ec.js","assets/index-55fec1ff.css"])),V=e=>{const o=v(T(t=>t.user)),{setCompleteQuests:i,completeQuests:c}=A(),[p,g]=a.useState(""),[m,h]=a.useState(!1),[_,w]=a.useState(!1);async function y(){if(!_){w(!0);return}h(!0);try{if(!await $(o,e.quest_scope,e.quest_name)){console.log("Failed to reroll quest");return}await S(3e3),await D(),C.success("Quest rerolled successfully!")}catch(t){console.log(t)}finally{h(!1)}}const f=l.useCallback(()=>{const t=k(new Date(e.expiry_date));if(t){const r=z(t,"days");g(r)}},[e.expiry_date]),d=l.useMemo(()=>{var t;return((t=o.permstats.find(r=>r.first===e.task_type))==null?void 0:t.second)||0},[o,e]),b=l.useMemo(()=>{const t=d/e.task_end_value*100;let r="linear-gradient(90deg, #C2253F 0%, #f1546e92 100%)";return t>=50&&t<100?r="linear-gradient(90deg, #F7A600 0%, #FFD86B 100%)":t>=100&&(r="linear-gradient(90deg, #6CC000 0%, #ADDE6F 100%)"),{width:t+"%",background:r}},[d,e]);l.useEffect(()=>{f();const t=setTimeout(()=>{f()},1e3*60);return()=>{clearTimeout(t)}},[f]);const u=d>=e.task_end_value;return l.useEffect(()=>{u&&i([...c,e.quest_scope])},[u,e.quest_scope]),p===""?s.jsx(W,{}):s.jsxs(F,{children:[s.jsxs(I,{children:[s.jsx("img",{loading:"lazy",src:`/assets/quests/${e.task_type}_${e.quest_scope}.jpeg`,alt:""}),s.jsx("span",{children:p})]}),s.jsx(q,{children:e.quest_description.replace("[amount]",String(e.task_end_value))}),s.jsxs(Q,{children:[e.reward_type==="shards"?s.jsx(M,{}):s.jsx(O,{}),e.reward_amount]}),s.jsxs(L,{children:[s.jsxs("span",{children:[d," / ",e.task_end_value]}),s.jsx("div",{style:b})]}),s.jsx(P,{isCompleted:u,isLoading:m,disabled:m,onClick:y,children:u?"Complete Quest":s.jsxs(s.Fragment,{children:[_?"Confirm Rerolling":"Reroll"," -10"," ",s.jsx("img",{loading:"lazy",src:"/assets/icons/credits.png",alt:""})]})})]})},se=a.memo(V);export{se as default};

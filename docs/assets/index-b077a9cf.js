import{s as l,S as b,R as r,_ as f,u as C,a as D,r as p,j as s,Q as _}from"./index-fa47d130.js";import F from"./index-7798b245.js";import{u as j}from"./use-transaction-c0718893.js";import{s as w}from"./sleep-da79c358.js";import{o as y}from"./activequests-query-6e59e3e1.js";import{c as z,a as A}from"./calculateTImeLeft-3fbd33a3.js";import"./index-24d29243.js";import"./toast-options-f964d8bf.js";import"./useQuery-bee0c5b2.js";const k=l("div",{display:"flex",align:"flex-end",justify:"flex-end",direction:"column",gap:"10px",padding:"5px",h:"540px",w:"100%",maxW:"425px",bg:"#6E6E6E",border:"2px solid #C8C8C8",position:"relative"}),q=l("div",{display:"flex",w:"100%",position:"relative",img:{w:"100%",objectFit:"cover",h:"225px"},span:{fw:"bold",ff:"$heading",fs:"18px",color:"white",zIndex:"2",textShadow:"2px 2px 2px rgba(0, 0, 0)",position:"absolute",bottom:"10px",right:"10px"}}),I=l("h2",{display:"flex",align:"center",justify:"center",w:"100%",h:"115px",zIndex:"2",fw:"normal",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),L=l("span",{display:"flex",align:"center",justify:"center",gap:"10px",w:"100%",h:"80px",zIndex:"2",fw:"bold",ff:"$heading",fs:"18px",color:"white",bg:"#4D4D4D"}),Q=l("div",{display:"flex",direction:"column",position:"relative",height:"30px",w:"100%",br:"5px",bg:"#282828",border:"1px solid #121212",">span":{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","-webkit-text-stroke":".5px rgba(0, 0, 0, 0.36)",fw:"bold",ff:"$heading",fs:"18px",color:"white"},div:{br:"5px",height:"100%"}}),$=l(F,{display:"flex",align:"center",justify:"center",zIndex:"3",w:"100%",h:"40px",fw:"bold",br:"2px !important",bg:"#9E475D !important",borderWidth:"1px",img:{w:"25px",h:"25px",objectFit:"contain"},variants:{isCompleted:{true:{bg:"#6750A4 !important"}}}});async function P(e,n,a){const{executeTransaction:i}=j(),c=B(e,n,a);return!!await i(c)}function B(e,n,a){return{actions:[{account:b.questAle,name:"reroll",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,scope:n,quest_name:a}}]}}async function O(e,n){const{executeTransaction:a}=j(),i=M(e,n);return!!await a(i)}function M(e,n){return{actions:[{account:b.questAle,name:"finishquest",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,quest_name:e}}]}}const V=r.lazy(()=>f(()=>import("./shards-14e7722c.js"),["assets/shards-14e7722c.js","assets/index-fa47d130.js","assets/index-55fec1ff.css"])),W=r.lazy(()=>f(()=>import("./tlm-0b311b6e.js"),["assets/tlm-0b311b6e.js","assets/index-fa47d130.js","assets/index-55fec1ff.css"])),U=r.lazy(()=>f(()=>import("./index-7eb00abd.js"),["assets/index-7eb00abd.js","assets/index-fa47d130.js","assets/index-55fec1ff.css"])),N=r.lazy(()=>f(()=>import("./index-c6cf0ef3.js"),["assets/index-c6cf0ef3.js","assets/index-fa47d130.js","assets/index-55fec1ff.css"])),G=({item:e,isItemLoading:n})=>{const a=C(D(t=>t.user)),[i,c]=r.useState(""),[x,u]=r.useState(!1),[h,v]=r.useState(!1);async function T(){if(!h){v(!0);return}u(!0);try{if(!await P(a,e.quest_scope,e.quest_name)){console.log("Failed to reroll quest");return}await w(3e3),await y(),_.success("Quest rerolled successfully!")}catch(t){console.log(t)}finally{u(!1)}}async function E(){u(!0);try{if(!await O(e.quest_name,a)){console.log("Failed to finish quest");return}await w(3e3),await y(),_.success("Quest finished successfully!")}catch(t){console.log(t)}finally{u(!1)}}const g=p.useCallback(()=>{const t=z(new Date(e.expiry_date));if(t){const o=A(t,"days");c(o)}},[e.expiry_date]),d=p.useMemo(()=>{const t=a.permstats.find(S=>S.first===e.task_type),o=((t==null?void 0:t.second)||0)-e.task_start_value;return o>=0?o:0},[a,e]),R=p.useMemo(()=>{const t=d/e.task_end_value*100;let o="linear-gradient(90deg, #C2253F 0%, #f1546e92 100%)";return t>=50&&t<100?o="linear-gradient(90deg, #F7A600 0%, #FFD86B 100%)":t>=100&&(o="linear-gradient(90deg, #6CC000 0%, #ADDE6F 100%)"),{width:t+"%",background:o}},[d,e]);p.useEffect(()=>{g();const t=setTimeout(()=>{g()},1e3*60);return()=>{clearTimeout(t)}},[g]);const m=d>=e.task_end_value;return n?s.jsx(N,{}):i===""?s.jsx(U,{}):s.jsxs(k,{children:[s.jsxs(q,{children:[s.jsx("img",{loading:"lazy",src:`/assets/quests/${e.task_type}_${e.quest_scope}.jpeg`,alt:""}),s.jsx("span",{children:i})]}),s.jsx(I,{children:e.quest_description.replace("[amount]",String(e.task_end_value))}),s.jsxs(L,{children:[e.reward_type==="shards"?s.jsx(V,{}):s.jsx(W,{}),e.reward_type==="shards"?e.reward_amount.toLocaleString("en-US"):(e.reward_amount/1e4).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})]}),s.jsxs(Q,{children:[s.jsxs("span",{children:[d," / ",e.task_end_value]}),s.jsx("div",{style:R})]}),s.jsx($,{isCompleted:m,isLoading:x,disabled:x,onClick:m?E:T,children:m?"Complete Quest":s.jsxs(s.Fragment,{children:[h?"Confirm Rerolling":"Reroll"," -10"," ",s.jsx("img",{loading:"lazy",src:"/assets/icons/credits.png",alt:""})]})})]})},ne=r.memo(G);export{ne as default};

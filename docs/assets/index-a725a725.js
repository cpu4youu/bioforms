import{s as y,L as K,S as A,d as U,Q as E,g as B,t as G,u as V,e as Q,r as S,R as T,_ as j,a as J,b as X,j as n}from"./index-37d3433e.js";import{s as Z,u as ee}from"./fightersSort-d07a91af.js";import{u as te}from"./use-transaction-36d26d5c.js";import{u as $}from"./useQuery-37804139.js";import{u as ne,a as re,g as O}from"./weather-query-c23faa9c.js";import{u as ie}from"./config-query-fe23302c.js";import{u as se}from"./inventory-query-524d5d91.js";const ae=y("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",overflowY:"hidden",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),oe=y("div",{gridArea:"header",d:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@lgxxx":{gridColumnStart:2,w:"100%",gridTemplateColumns:"1fr 1fr"},"@md":{gridColumnStart:1,gridTemplateColumns:"1fr 1fr"},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),le=y("div",{position:"relative",gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}},"@md":{minH:"calc(100vh - 185px)",mt:"30px"}}),de=y("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",br:"15px 15px 0 0",bg:"#19192D",position:"absolute",top:"-35px",left:"0"}),ce=y(K,{border:"1px solid rgba(0, 0, 0, 0.25)",padding:"10px 20px",ff:"$heading",fs:"12px",color:"#fff","&:last-child":{br:"15px 15px 0 0"}}),ue=y("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",padding:"0px 15px ",bg:"#141423",br:"15px",w:"100%",overflowY:"auto",position:"relative",">img":{position:"absolute",top:0,left:0,w:"100%",h:"100%",objectFit:"cover"},gridArea:"main",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}},"@md":{minH:"calc(100vh - 185px)"}}),pe=y("div",{d:"flex",align:"center",justify:"center",w:"100%",maxW:"350px",padding:"15px 10px",zIndex:"2",boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.25)",bg:"#1D1B20",color:"#E9E9E9",ff:"$heading",fs:"14px",fw:"bold"}),ge=y("div",{d:"flex",justify:"space-between",gridTemplateColumns:"1fr 2fr",gap:"10px",mt:"48px",pb:"10px",w:"100%",zIndex:"2",">span":{ff:"$heading",fs:"20px",fw:"bold",color:"#fff"},"@lg":{direction:"column",justify:"center",">span":{my:"10px",order:"-1"}}}),xe=y("div",{w:"100%",h:"100%"}),fe=y("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),me=y("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function he(e,t,x,i,l,a,_,f,d,o,m){const{executeTransaction:h}=te(),c=ye(e,t,x,i,l,a,_,f,d,o,m);return!!await h(c)}function ye(e,t,x,i,l,a,_,f,d,o,m){return{actions:[{account:A.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:t,land_id:x,crew_asset_id:i,weapon_asset_id:l,fighter_ids:a,difficulty:_,use_gems:f,history_id:d,x:o,y:m}}]}}const q=U(e=>({myTeam:[null,null,null,null,null],setMyTeam:t=>e({myTeam:t}),selectedCards:[void 0,void 0],setSelectedCards:t=>e({selectedCards:t}),selectedFighterClassname:{label:"All",value:""},setSelectedFighterClassname:t=>e({selectedFighterClassname:t}),selectedSort:Z[0],setSelectedSort:t=>e({selectedSort:t}),selectedElement:[],setSelectedElement:t=>e({selectedElement:t}),selectedMarkers:[],setSelectedMarkers:t=>e({selectedMarkers:t})}));function _e({user:e,areaSelected:t,myTeam:x,selectedCards:i,selectedLevel:l}){var _,f,d,o,m,h,c,s;const a=x.reduce((F,I)=>I?[...F,I.fighter_id]:F,[]);return!e||!(t!=null&&t.landId)||!a.length||!((_=i[0])!=null&&_.asset_id)||!((f=i[1])!=null&&f.asset_id)?(a.length||E.error("No Warrior selected"),(d=i[0])!=null&&d.asset_id||E.error("No Crew selected (First spot on cards)"),(o=i[1])!=null&&o.asset_id||E.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:t,crew_asset_id:Number((m=i[0])==null?void 0:m.asset_id),weapon_asset_id:Number((h=i[1])==null?void 0:h.asset_id),fighter_ids:a,selectedLevel:l})):{user:e,planet:e.planet,landId:t.landId,x:t.x,y:t.y,card1:Number((c=i[0])==null?void 0:c.asset_id),card2:Number((s=i[1])==null?void 0:s.asset_id),teamFiltered:a,level:l.level}}const ve=async()=>await B({options:{code:A.dungeonsAle,index_position:1,limit:"1000",scope:A.dungeonsAle,table:G.config}}),be=()=>$({enabled:!!V.getState().user,queryKey:[Q.dungeonConfigDataState],queryFn:()=>we(),staleTime:1e3*60*20});async function we(){try{const e=await ve();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const Fe=async()=>await B({options:{code:A.battleAle,index_position:1,limit:"1000",scope:A.battleAle,table:"variables"}}),Se=()=>$({enabled:!!V.getState().user,queryKey:[Q.VariablesState],queryFn:()=>Te(),staleTime:1e3*60*20});async function Te(){try{const e=await Fe();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}function je(){const{selectedCards:e,setSelectedCards:t,myTeam:x,setMyTeam:i}=q(),[l,a]=S.useState([]),[_,f]=S.useState("fighter"),[d,o]=S.useState(0),[m,h]=S.useState("level.worlds"),[c,s]=S.useState(-1),{data:F,isLoading:I}=se(m);function P(r){if(s(-1),f("fighter"),r===d){o(-1);return}o(r)}function D(r){if(o(-1),f("nft"),r===c){s(-1);return}s(r),h(r===0?"crew.worlds":r===1?"arms.worlds":"crew.worlds")}function L(r){if(!r){const g=e.map((M,z)=>{if(z!==c)return M}),b=c+1;if(s(b),t(g),h(b===0?"crew.worlds":b===1?"arms.worlds":"crew.worlds"),b>1){s(-1);return}return}if(e.some(g=>(g==null?void 0:g.asset_id)===(r==null?void 0:r.asset_id))){s(-1);return}const p=e.map((g,b)=>b===c?r:g),v=c+1;if(s(v),t(p),h(v===0?"crew.worlds":v===1?"arms.worlds":"crew.worlds"),v>1){s(-1);return}}function R(r){if(l.includes(r)){a(l.filter(p=>p!==r));return}a([...l,r])}function w(r){const p=x.map((g,b)=>b===d?r:g);i(p);const v=d+1;if(v===5){o(-1);return}o(v)}function H(r){return e.some(p=>(p==null?void 0:p.asset_id)!==r.asset_id)}return{selectedCards:e,inventoryPosition:c,filterSelected:l,inventoryFilter:m,fighterPosition:d,itemSelected:_,inventory:F,isInventoryLoading:I,handleFighterPosition:P,handleInventoryPosition:D,handleSelectCard:L,handleSelectFilter:R,handleAddFighter:w,filterInventoryCards:H}}const k=T.lazy(()=>j(()=>import("./index-e8bb5728.js"),["assets/index-e8bb5728.js","assets/index-37d3433e.js","assets/index-55fec1ff.css","assets/index-d54b856c.js"])),Ie=T.lazy(()=>j(()=>import("./index-c7ef525e.js"),["assets/index-c7ef525e.js","assets/index-37d3433e.js","assets/index-55fec1ff.css","assets/weather-query-c23faa9c.js","assets/useQuery-37804139.js","assets/sleep-da79c358.js","assets/landtranking-query-a6ae6128.js"])),Ce=T.lazy(()=>j(()=>import("./index-5649c913.js"),["assets/index-5649c913.js","assets/index-37d3433e.js","assets/index-55fec1ff.css","assets/fightersSort-d07a91af.js","assets/use-media-0bb04e9f.js","assets/emptyTeam-57b35972.js","assets/v4-4a60fe23.js","assets/useQuery-37804139.js","assets/use-transaction-36d26d5c.js","assets/toast-options-baa6c4a9.js","assets/weather-query-c23faa9c.js","assets/sleep-da79c358.js","assets/config-query-fe23302c.js","assets/inventory-query-524d5d91.js","assets/atomic-api-ce71d580.js"])),Ae=T.lazy(()=>j(()=>import("./index-20d74614.js"),["assets/index-20d74614.js","assets/index-37d3433e.js","assets/index-55fec1ff.css","assets/useQuery-37804139.js","assets/fightersSort-d07a91af.js","assets/use-media-0bb04e9f.js"])),Ee=T.lazy(()=>j(()=>import("./index-5bc41da8.js"),["assets/index-5bc41da8.js","assets/index-37d3433e.js","assets/index-55fec1ff.css","assets/config-query-fe23302c.js","assets/useQuery-37804139.js","assets/classtemps-query-8cb87647.js","assets/resStats-2fa1b20e.js"])),Pe=T.lazy(()=>j(()=>import("./index-66d2cf08.js"),["assets/index-66d2cf08.js","assets/index-37d3433e.js","assets/index-55fec1ff.css","assets/fightersSort-d07a91af.js","assets/use-media-0bb04e9f.js","assets/fighters-query-736c3b6a.js","assets/useQuery-37804139.js","assets/fighterFilters-e6065055.js","assets/use-transaction-36d26d5c.js","assets/toast-options-baa6c4a9.js","assets/weather-query-c23faa9c.js","assets/sleep-da79c358.js","assets/config-query-fe23302c.js","assets/inventory-query-524d5d91.js","assets/atomic-api-ce71d580.js"])),De=T.lazy(()=>j(()=>import("./index-9167db00.js"),["assets/index-9167db00.js","assets/index-37d3433e.js","assets/index-55fec1ff.css","assets/inventory-query-524d5d91.js","assets/useQuery-37804139.js","assets/atomic-api-ce71d580.js","assets/toast-options-baa6c4a9.js","assets/fightersSort-d07a91af.js","assets/use-transaction-36d26d5c.js","assets/weather-query-c23faa9c.js","assets/sleep-da79c358.js","assets/config-query-fe23302c.js"])),Le=()=>{const e=V(J(u=>u.user));ie();const{data:t}=be(),{data:x}=Se(),{data:i}=ne(e.planet,(x==null?void 0:x.current_weather_id)||""),{inventoryFilter:l,inventoryPosition:a,fighterPosition:_,itemSelected:f,handleAddFighter:d,handleInventoryPosition:o,handleFighterPosition:m,handleSelectCard:h,filterInventoryCards:c}=je(),{selectedCards:s,myTeam:F,setMyTeam:I,setSelectedCards:P}=q(),{areaSelected:D,setAreaSelected:L}=X(),{selectedLevel:R,selectedFighter:w,setSelectedFighter:H}=ee(),[r,p]=S.useState(!1),[v,g]=S.useState("");async function b(){try{p(!0);const u=_e({areaSelected:D,myTeam:F,selectedCards:s,selectedLevel:R,user:e});if(!u)return;const C=re();if(!await he(e,e.planet,u.landId,u.card1,u.card2,u.teamFiltered,u.level,!0,C,u.x,u.y))return;await O(C,g)||E.warn("No history data found yet. Retrying..."),await O(C,g)}catch(u){console.error(u)}finally{p(!1)}}function M(){P([void 0,void 0]),I([null,null,null,null,null]),L(null)}const z=S.useMemo(()=>{var C,N,W;return!F.filter(Y=>Y!==null).length||!((C=s[0])!=null&&C.asset_id)||!((N=s[1])!=null&&N.asset_id)||Number(((W=e==null?void 0:e.activestats)==null?void 0:W.action_points)||0)<((t==null?void 0:t.energy_cost)||0)},[F,s,t,e]);return v?n.jsx(Ie,{historyId:v}):n.jsxs(ae,{isFighterSelected:!!w,children:[n.jsxs(oe,{children:[n.jsx(k,{onClick:M,children:"Back"}),n.jsxs(k,{disabled:z||r,isLoading:r,onClick:b,children:["Start Fight",n.jsxs("div",{children:["-",t==null?void 0:t.energy_cost,n.jsx("img",{src:"/assets/icons/energy.png",alt:"Potion"})]})]})]}),n.jsxs(le,{isFighterSelected:!!w,children:[n.jsx(de,{children:n.jsx(ce,{to:"/dungeon-leaderboard",children:"Leaderboard"})}),n.jsxs(ue,{isFighterSelected:!!w,children:[(i==null?void 0:i.displayname)&&n.jsx(pe,{children:i==null?void 0:i.displayname}),n.jsxs(ge,{children:[n.jsx(Ce,{inventoryPosition:a,handleInventoryPosition:o,fighterPosition:_,handleFighterPosition:m}),n.jsx("span",{children:"VS"}),n.jsx(Ae,{})]}),n.jsx(xe,{children:f==="fighter"?n.jsx(Pe,{handleAddFighter:d}):n.jsx(De,{inventoryPosition:a,inventoryFilter:l,handleSelectCard:h,filterInventoryCards:c})}),n.jsx("img",{src:"/assets/background/bg-dungeon.png",alt:""})]})]}),n.jsx(fe,{isFighterSelected:!!w,children:w?n.jsx(Ee,{selectedFighter:{...w,...w.stats},onCloseFighterDetail:H}):n.jsx(n.Fragment,{children:n.jsx(me,{children:"Select a Fighter"})})})]})},Re=T.memo(Le),ke=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));export{ke as i,q as u};

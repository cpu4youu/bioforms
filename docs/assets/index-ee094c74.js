import{s as p,g as pe,S as j,e as me,u as P,R as A,_ as E,a as J,r as l,j as s,Q as m}from"./index-9a1d8aef.js";import{s as xe}from"./shimmer-26e0f0a5.js";import{u as ye,o as T}from"./fighters-query-899b7e73.js";import{u as fe,s as ge}from"./fightersSort-bd534b61.js";import{u as he}from"./useQuery-e3635f16.js";import{s as L}from"./sleep-da79c358.js";import{u as M}from"./use-transaction-020c76e2.js";import{u as _e}from"./config-query-4ffdd64a.js";import{f as be,a as je,b as ve,s as we}from"./fighterFilters-e6065055.js";import"./toast-options-3550ec67.js";const Se=p("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%","@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),Fe=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),Te=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",direction:"column",position:"relative",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",br:"0 15px 15px 15px",bg:"#141423",">img":{position:"absolute",top:0,left:0,w:"100%",h:"100%",objectFit:"cover"},"@xmd":{mt:"30px"}}),Le=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",padding:"20px",width:"100%",height:"100%",flexWrap:"wrap",overflowY:"auto"}),Ce=p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-35px",left:"0px"}),X=p("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:first-child":{br:"8px 0px 0px 0px"},"&:last-child":{br:"0 8px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}});p("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"});const ke=p("div",{h:"175px",w:"395px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${xe} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Pe=p("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),Ae=async()=>await pe({options:{code:j.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:j.battleAle,table:"levels"}}),Ee=()=>he({queryKey:[me.levelsState],queryFn:()=>Me(),staleTime:1e3*60*60,enabled:!!P.getState().user});async function Me(){try{return await Ae()}catch(t){return console.log(t),null}}async function Z(t,c){const{executeTransaction:i}=M(),a=De(t,c);return!!await i(a)}function De(t,{cost_credits:c,cost_gems:i,fighter_ids:a}){return{actions:[{account:j.battleAle,name:"levelup",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_ids:a,cost_gems:i,cost_credits:c}}]}}async function Ie(t,c){const{executeTransaction:i}=M(),a=ze(t,c);return!!await i(a)}function ze(t,{fighter_id:c}){return{actions:[{account:j.battleAle,name:"payday",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_id:c}}]}}async function Re(t,c){const{executeTransaction:i}=M(),a=qe(t,c);return!!await i(a)}function qe(t,{fighter_ids:c}){return{actions:[{account:j.battleAle,name:"sellfighter",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_ids:c}}]}}const b=A.lazy(()=>E(()=>import("./index-e0aeaef3.js"),["assets/index-e0aeaef3.js","assets/index-9a1d8aef.js","assets/index-55fec1ff.css","assets/index-ea8a1aa6.js"])),Qe=A.lazy(()=>E(()=>import("./index-8243dea9.js"),["assets/index-8243dea9.js","assets/index-9a1d8aef.js","assets/index-55fec1ff.css","assets/fightersSort-bd534b61.js","assets/sleep-da79c358.js","assets/fighters-query-899b7e73.js","assets/useQuery-e3635f16.js","assets/config-query-4ffdd64a.js","assets/markers-45cb96d1.js","assets/use-transaction-020c76e2.js","assets/toast-options-3550ec67.js","assets/resStats-2fa1b20e.js","assets/classtemps-query-56abce69.js","assets/dateUtils-ab03db27.js","assets/index-ea8a1aa6.js"])),He=A.lazy(()=>E(()=>import("./index-c01b8373.js"),["assets/index-c01b8373.js","assets/index-9a1d8aef.js","assets/index-55fec1ff.css","assets/elements-a94bd2b3.js","assets/markers-45cb96d1.js","assets/fightersSort-bd534b61.js","assets/classtemps-query-56abce69.js","assets/useQuery-e3635f16.js"])),Je=()=>{var Y,$,O,W,B,V,K;const t=P(J(e=>e.user)),c=P(J(e=>e.updatePlayerData)),{data:i}=_e(),{data:a,isLoading:g,isFetching:ee}=ye(t.name),{data:o}=Ee(),{checkedFighters:v,setCheckedFighters:te,selectedFighter:d}=fe(),[h,x]=l.useState(!1),[w,D]=l.useState(!1),[C,I]=l.useState("inventory"),[z,se]=l.useState([]),[R,ae]=l.useState([]),[q,ne]=l.useState({label:"All",value:""}),[Q,re]=l.useState(ge[0]),H=l.useMemo(()=>a==null?void 0:a.some(e=>e.stats.experience>=e.stats.required_experience&&(o==null?void 0:o.some(n=>n.level===e.stats.level+1))),[a,o]),u=l.useMemo(()=>a==null?void 0:a.reduce((e,n)=>{const r=o==null?void 0:o.find(f=>f.level===n.stats.level+1);return r&&n.stats.experience>=n.stats.required_experience?e={cost_credits:e.cost_credits+r.unlock_cost_credits,cost_gems:e.cost_gems+r.unlock_cost_gem,quantity:e.quantity+1}:e},{cost_credits:0,cost_gems:0,quantity:0}),[o,a]),ie=l.useMemo(()=>(a==null?void 0:a.reduce((e,n)=>{const r=new Date(n.next_payday).getTime()/1e3,f=new Date(n.last_payday).getTime()/1e3,_=new Date().getTime()/1e3,k=(i==null?void 0:i.standard_pay_payday)||0;let F=0;r>_&&(F=r-_);const U=r-f-F,ue=r-f,G=Math.floor(U/ue*k+1);return G>1?e+=G:e},0))||0,[i,a]),oe=l.useMemo(()=>v.length*v.reduce((e,n)=>e+n.stats.credits,0),[v]),S=l.useMemo(()=>{if(!d)return 0;const e=new Date(d.next_payday).getTime()/1e3,n=new Date(d.last_payday).getTime()/1e3,r=new Date().getTime()/1e3,f=(i==null?void 0:i.standard_pay_payday)||0;let _=0;e>r&&(_=e-r);const k=e-n-_,F=e-n;return Math.floor(k/F*f+1)},[i,d]),y=l.useMemo(()=>{var n;if(!d)return null;const e=o==null?void 0:o.find(r=>r.level===d.stats.level+1);return e?((n=t.activestats)==null?void 0:n.credits)>=(e==null?void 0:e.unlock_cost_credits)?{type:"credits",amount:e==null?void 0:e.unlock_cost_credits}:{type:"gems",amount:e==null?void 0:e.unlock_cost_gem}:{type:"max-level",amount:0}},[o,t,d]);async function N(){try{x(!0);const e=(a==null?void 0:a.filter(r=>r.stats.experience>=r.stats.required_experience).map(r=>r.fighter_id))||[];if(!await Z(t,{cost_credits:(u==null?void 0:u.cost_credits)||0,cost_gems:(u==null?void 0:u.cost_gems)||0,fighter_ids:e}))return;await L(2e3),T(t.name),m.success("Fighter leveled up!")}catch(e){console.error(e)}finally{x(!1)}}async function ce(){try{if(D(!0),!d)return m.error("No fighter selected for payday");if(!await Ie(t,{fighter_id:[d.fighter_id]}))return;await L(2e3),T(t.name),m.success("Fighter payday!")}catch(e){console.error(e)}finally{D(!1)}}async function le(){if(!d)return m.error("No fighter selected for payday");const e=o==null?void 0:o.find(n=>n.level===d.stats.level);try{if(x(!0),!e){m.error("No level find on levels table");return}if(!await Z(t,{cost_credits:e==null?void 0:e.unlock_cost_credits,cost_gems:e==null?void 0:e.unlock_cost_gem,fighter_ids:[d.fighter_id]}))return;await L(2e3),T(t.name),m.success("Fighter leveled up!")}catch(n){console.error(n)}finally{x(!1)}}async function de(){try{x(!0);const e=v.map(r=>Number(r));if(!await Re(t,{fighter_ids:e}))return;await L(2e3),T(t.name),te([]),await c(),m.success("Fighters sold!")}catch(e){console.error(e)}finally{x(!1)}}return s.jsxs(Se,{children:[s.jsx(Fe,{children:C==="sell"?s.jsx(s.Fragment,{children:s.jsxs(b,{isLoading:h,onClick:de,children:["Sell selected",s.jsxs("div",{children:[oe,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsxs(b,{isLoading:h,disabled:h||!H,onClick:N,children:["Payday All"," ",s.jsxs("div",{children:[ie,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})," "]})]}),s.jsxs(b,{isLoading:h,disabled:h||!H,onClick:N,children:[s.jsxs("span",{children:["Level All ",s.jsxs("span",{children:["(",u==null?void 0:u.quantity,")"]})]}),s.jsxs("div",{children:[u==null?void 0:u.cost_credits,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})," "]})]}),S>0&&s.jsxs(b,{isLoading:w,disabled:w||S>((Y=t.activestats)==null?void 0:Y.action_points)||S<=0,onClick:ce,children:["Payday",s.jsxs("div",{children:["-",S,s.jsx("img",{src:"/assets/icons/credits.png",alt:"Energy"})]})]}),y&&s.jsxs(b,{isLoading:w,disabled:w||y.amount>(($=t.activestats)==null?void 0:$.action_points)||y.amount>((O=t.activestats)==null?void 0:O.credits)||y.amount<=0,onClick:le,children:["Level Up",s.jsxs("div",{children:["-",y.amount,s.jsx("img",{src:`/assets/icons/${y.type}.png`,alt:"Energy"})]})]})]})}),s.jsxs(Te,{children:[s.jsxs(Ce,{children:[s.jsx(X,{isSelected:C==="inventory",onClick:()=>I("inventory"),children:"Inventory"}),s.jsx(X,{isSelected:C==="sell",onClick:()=>I("sell"),children:"Sell"})]}),s.jsx(He,{selectedElement:z,setSelectedElement:se,selectedMarkers:R,setSelectedMarkers:ae,selectedClassname:q,setSelectedClassname:ne,selectedSort:Q,setSelectedSort:re}),s.jsx(Le,{children:g||ee?Array.from({length:9},(e,n)=>s.jsx(ke,{},n)):a?(K=(V=(B=(W=a==null?void 0:a.filter(e=>be(z,e)))==null?void 0:W.filter(e=>je(R,e)))==null?void 0:B.filter(e=>ve(q,e)))==null?void 0:V.toSorted((e,n)=>we(Q,e,n)))==null?void 0:K.map(e=>s.jsx(Qe,{fighter:e},e.fighter_id)):s.jsx(s.Fragment,{children:s.jsx(Pe,{children:"You don't have Fighters"})})}),s.jsx("img",{src:"/assets/background/bg-fighters.png",alt:"",loading:"lazy"})]})]})};export{Je as default};

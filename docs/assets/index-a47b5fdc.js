import{s as i,g as C,S as x,e as S,u as d,R as l,_,j as o,r as p,Q as c}from"./index-168f3470.js";import E from"./index-0f58c040.js";import{u as v}from"./index-5af04009.js";import{u as z}from"./useQuery-4ad63513.js";import{u as w}from"./use-transaction-9d9e831a.js";import{s as A}from"./sleep-da79c358.js";import{c as F,a as L}from"./calculateTImeLeft-c445cd36.js";import{v as R}from"./v4-4a60fe23.js";import"./index-a1ed3e9c.js";import"./toast-options-163c9203.js";const D=i("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",padding:"40px 40px",gap:"13px",mt:"10px",bg:"#141423",br:"15px",w:"100%",maxW:"500px",button:{justify:"center",h:"50px",fw:"bold"},variants:{isHidden:{true:{"@sm":{display:"none"}}}}}),I=i("div",{d:"flex",align:"center",justify:"center",w:"100%",fw:"bold",ff:"$heading",fs:"20px",color:"white",mb:"50px"}),f=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",w:"100%",ff:"$heading",fs:"16px",color:"#C7C7C7",strong:{display:"flex",align:"center",justify:"center",gap:"10px",padding:"10px",w:"100%",color:"white",bg:"#212130",br:"10px"},img:{w:"25px",h:"25px",objectFit:"contain"}}),W=i("button",{display:"none",align:"flex-start",justify:"center",color:"#fff",fs:"30px",w:"50px",h:"50px",top:"0px",right:"0px",position:"absolute","@xmd":{d:"flex"}}),$=i(E,{display:"inline-flex",align:"center",justify:"center",gap:"5px",zIndex:"3",mt:"60px",w:"100%",h:"40px",br:"2px !important",bg:"#6750A4 !important",border:"1px solid #36B9EA !important",fw:"bold",ff:"$heading",fs:"14px",color:"white"}),B=async n=>{const e=await C({options:{code:x.eosioToken,index_position:1,key_type:"i64",limit:"1000",scope:n,table:"accounts"}});return(e==null?void 0:e[0])||null},G=()=>z({queryKey:[S.WaxCoinsState],queryFn:()=>Y(),staleTime:1e3*60*60,enabled:!!d.getState().user});async function Y(){const n=d.getState().user;if(!n)return null;try{const e=await B(n.name);return e?{balance:parseFloat(e.balance),currency:e.balance.split(" ")[1]}:null}catch(e){return console.log(e),null}}async function Q(n,e){const{executeTransaction:t}=w(),r=N(n,e);return!!await t(r)}function N(n,e){return{actions:[{account:x.shopAle,name:"buyshopitem",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,item:e}}]}}async function U(n,e,t){const{executeTransaction:r}=w(),s=q(n,e,t);return!!await r(s)}function q(n,e,t){return{actions:[{account:x.eosioToken,name:"transfer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{from:n.name,to:"shop.ale",memo:`purchase,${e}`,quantity:t}}]}}const K=l.lazy(()=>_(()=>import("./index-90e890d0.js"),["assets/index-90e890d0.js","assets/index-168f3470.js","assets/index-55fec1ff.css","assets/index-5af04009.js","assets/useQuery-4ad63513.js","assets/calculateTImeLeft-c445cd36.js"])),O=l.memo(({list:n})=>o.jsx(o.Fragment,{children:n==null?void 0:n.map(e=>o.jsx(K,{...e},R()))})),X=l.memo(()=>{var b;const{user:n,updatePlayerData:e}=d(),{selectedPack:t,setSelectedPack:r}=v(),{data:s}=G(),[u,g]=l.useState(""),[h,y]=p.useState(!1);async function T(){if(!n)return c.error("You need to be logged in to buy items");if(!t)return c.error("You need to select a pack to buy items");y(!0);let a=!1;try{(t==null?void 0:t.category)==="credits"||(t==null?void 0:t.category)==="flasks"?a=await Q(n,t.item):a=await U(n,t.item,t.cost_wax),a&&(await A(3e3),await e(),c.success("Item bought successfully"))}catch{c.error("Error buying item")}finally{y(!1),r(null)}}const m=p.useCallback(()=>{if(!(t!=null&&t.itemCD))return g("");const a=F(new Date(t==null?void 0:t.itemCD)),j=L(a,"weeks");g(j)},[t]);return p.useEffect(()=>{m();const a=setTimeout(()=>{m()},1e3*60);return()=>{clearTimeout(a)}},[m]),o.jsxs(D,{children:[o.jsx(W,{onClick:()=>r(null),children:"x"}),o.jsx(I,{children:"Confirm Selection"}),o.jsxs(f,{children:[o.jsx("span",{children:"You are about to exchange the following"}),t!=null&&t.cost?o.jsxs("strong",{children:[(b=t==null?void 0:t.cost)==null?void 0:b.toLocaleString("en-US"),o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageCost}.png`,alt:""})]}):o.jsx("strong",{children:"FREE"})]}),o.jsxs(f,{children:[o.jsx("span",{children:"and receive"}),o.jsxs("strong",{children:[t==null?void 0:t.offer_name,o.jsx("img",{loading:"lazy",src:`/assets/icons/${t==null?void 0:t.imageGain}.png`,alt:""})]})]}),o.jsx($,{isLoading:h,disabled:h,onClick:T,color:"blue",children:u||"Confirm exchange"}),o.jsx(f,{children:o.jsxs("strong",{children:[o.jsx("span",{children:"Your current WAX balance:"}),o.jsx("img",{loading:"lazy",src:"/assets/icons/wax-coin.png",alt:""}),(s==null?void 0:s.balance.toLocaleString("en-US",{maximumFractionDigits:2}))??0]})})]})});O.displayName="GemList";X.displayName="GemSelection";export{O as GemList,X as GemSelection};

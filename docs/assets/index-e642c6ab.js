import{s as U,g as $,S as b,q as k,d as Q,u as q,v as B,R as I,_ as K,r as m,j as c}from"./index-c983d5d2.js";import{o as A,a as R}from"./all-buildings-4a82be62.js";import{u as O}from"./useQuery-7a3196f1.js";import{u as P}from"./land-config-95633509.js";import{u as F}from"./use-transaction-7fcb0d62.js";import{s as E}from"./sleep-da79c358.js";import{u as Y}from"./index-82eaa773.js";import"./atomic-api-1b0bb9d2.js";import"./toast-options-1ec79c88.js";import"./constants-2aba6d4c.js";const D=U("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),G=async t=>await $({options:{code:b.landsAle,index_position:1,limit:"1000",scope:t,table:k.buildingcost}}),V=t=>O({queryFn:()=>W(t),queryKey:[Q.buildingConfigState],staleTime:1e3*60*60,enabled:!!q.getState().user});async function M(){return await B.invalidateQueries(Q.buildingConfigState)}async function W(t){try{return await G(t)}catch(n){return console.log(n),null}}async function J(t,n){const{executeTransaction:s}=F(),a=X(t,n);return!!await s(a)}function X(t,n){return{actions:[{account:b.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:n.planet,x:n.x,y:n.y,building:n.building,level:n.level,cost_gem:n.cost_gem,cost_credits:n.cost_credits}}]}}async function Z(t,n){const{executeTransaction:s}=F(),a=tt(t,n);return!!await s(a)}function tt(t,n){return{actions:[{account:b.landsAle,name:"boost",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:n.planet,building:n.building,x:n.x,y:n.y,cost_gem:n.cost_gem,cost_credits:n.cost_credits,boost_target:n.boost_target}}]}}const z=I.lazy(()=>K(()=>import("./index-21d5c206.js"),["assets/index-21d5c206.js","assets/index-c983d5d2.js","assets/index-55fec1ff.css"])),gt=()=>{var h;const{data:t}=P(),n=q(e=>e.user),{selectedLand:s,buildingBoost:a,selectedBuild:o}=Y(),{data:u}=V((o==null?void 0:o.img)||""),[_,f]=m.useState(!1),[x,y]=m.useState(!1);async function H(){var e;if(s)try{y(!0);const r=((e=n==null?void 0:n.activestats)==null?void 0:e.gems)>=g*10,p=r?g*10:0,l=r?0:g,d={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:o.building_name.toLowerCase(),boost_target:a[0],cost_gem:p,cost_credits:l};await Z(n,d)&&(await E(1e3),await A(),await M(),await R())}catch(r){console.error(r)}finally{y(!1)}}async function N(){if(!n){console.log("User not authenticated");return}if(!s||!o){console.log("Selected land or build is not available");return}if(!i){console.log("Building cost not available");return}if(!t||!t[0]){console.log("Land configuration not available");return}if(!a||a.length===0){console.log("Building boost not available");return}try{f(!0);const e={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:o.building_name.toLowerCase(),level:o!=null&&o.boost_score?(o.level||1)+1:1,cost_gem:i.cost_gem,cost_credits:i.cost_credits};await J(n,e)&&(await E(1e3),await A(),await M(),await R())}catch(e){console.error(e)}finally{f(!1)}}const i=m.useMemo(()=>u==null?void 0:u.find(e=>e.building_name===o.img&&e.level===((o==null?void 0:o.level)||0)+1),[u,o]),g=m.useMemo(()=>{var L,S,j,C;const e=((L=t==null?void 0:t[0])==null?void 0:L.boost_base_cost)||0,r=((S=t==null?void 0:t[0])==null?void 0:S.boost_cost_first_percent)||0,p=(o==null?void 0:o.boost_score)||0,l=Number(((j=t==null?void 0:t[0])==null?void 0:j.boost_cost_mod)||0),d=(1-Math.pow(l,a[0]+1))/(1-l),w=(1-Math.pow(l,p/1e4+1))/(1-l),v=e+r*(d-w),T=(((C=t==null?void 0:t[0])==null?void 0:C.start_boost_score)||0)/1e4;return v<T?T:v},[a,t,o]);return c.jsxs(D,{children:[s&&!!(o!=null&&o.boost_score)&&c.jsxs(z,{isLoading:x,disabled:x,onClick:H,children:["Boost"," ",c.jsxs("div",{children:[g.toFixed(2),c.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})," "]})]}),s&&!!i&&c.jsxs(z,{isLoading:_,disabled:_,onClick:N,children:[o!=null&&o.boost_score?`Upgrade ${o==null?void 0:o.building_name}`:`Build ${o==null?void 0:o.building_name}`,c.jsxs("div",{children:[(h=i==null?void 0:i.cost_gem)==null?void 0:h.toLocaleString("en-US")," ",c.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})]})]})]})};export{gt as default};

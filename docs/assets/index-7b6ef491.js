import{s as q,g as k,S as _,t as I,e as Q,u as F,w as K,R as H,_ as O,a as P,r as m,j as c}from"./index-c986e7a0.js";import{o as A,a as R}from"./all-buildings-81f7fa52.js";import{u as Y}from"./useQuery-a015a238.js";import{u as D}from"./land-config-dd3cae08.js";import{u as N}from"./use-transaction-dc0566a1.js";import{s as E}from"./sleep-da79c358.js";import{u as G}from"./index-8046b348.js";import"./atomic-api-09204fdc.js";import"./toast-options-0bc3d098.js";import"./constants-308cd0ac.js";const V=q("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),W=async o=>await k({options:{code:_.landsAle,index_position:1,limit:"1000",scope:o,table:I.buildingcost}}),B=o=>Y({queryFn:()=>J(o),queryKey:[Q.buildingConfigState,o],staleTime:1e3*60*60,enabled:!!F.getState().user});async function M(o){return await K.invalidateQueries([Q.buildingConfigState,o])}async function J(o){try{return await W(o)}catch(n){return console.log(n),null}}async function X(o,n){const{executeTransaction:s}=N(),a=Z(o,n);return!!await s(a)}function Z(o,n){return{actions:[{account:_.landsAle,name:"build",authorization:[{actor:o.name,permission:o.authorization.permission}],data:{wallet:o.name,planet:n.planet,x:n.x,y:n.y,building:n.building,level:n.level,cost_gem:n.cost_gem,cost_credits:n.cost_credits}}]}}async function tt(o,n){const{executeTransaction:s}=N(),a=ot(o,n);return!!await s(a)}function ot(o,n){return{actions:[{account:_.landsAle,name:"boost",authorization:[{actor:o.name,permission:o.authorization.permission}],data:{wallet:o.name,planet:n.planet,building:n.building,x:n.x,y:n.y,cost_gem:n.cost_gem,cost_credits:n.cost_credits,boost_target:n.boost_target}}]}}const z=H.lazy(()=>O(()=>import("./index-c62e7785.js"),["assets/index-c62e7785.js","assets/index-c986e7a0.js","assets/index-55fec1ff.css"])),nt=()=>{var w;const{data:o}=D(),n=F(P(e=>e.user)),{selectedLand:s,buildingBoost:a,selectedBuild:t}=G(),{data:u}=B((t==null?void 0:t.img)||""),[b,f]=m.useState(!1),[x,y]=m.useState(!1);async function U(){var e;if(s)try{y(!0);const r=((e=n==null?void 0:n.activestats)==null?void 0:e.gems)>=g*10,p=r?g*10:0,l=r?0:g,d={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:t.building_name.toLowerCase(),boost_target:a[0],cost_gem:p,cost_credits:l};await tt(n,d)&&(await E(1e3),await A(),await M(t.building_name.toLowerCase()),await R())}catch(r){console.error(r)}finally{y(!1)}}async function $(){if(!n){console.log("User not authenticated");return}if(!s||!t){console.log("Selected land or build is not available");return}if(!i){console.log("Building cost not available");return}if(!o||!o[0]){console.log("Land configuration not available");return}if(!a||a.length===0){console.log("Building boost not available");return}try{f(!0);const e={planet:s.data.planetName,x:s.data.x,y:s.data.y,building:t.building_name.toLowerCase(),level:t!=null&&t.boost_score?(t.level||1)+1:1,cost_gem:i.cost_gem,cost_credits:i.cost_credits};await X(n,e)&&(await E(1e3),await A(),await M(t==null?void 0:t.img),await R())}catch(e){console.error(e)}finally{f(!1)}}const i=m.useMemo(()=>u==null?void 0:u.find(e=>e.building_name===t.img&&e.level===((t==null?void 0:t.level)||0)+1),[u,t]),g=m.useMemo(()=>{var L,S,j,C;const e=((L=o==null?void 0:o[0])==null?void 0:L.boost_base_cost)||0,r=((S=o==null?void 0:o[0])==null?void 0:S.boost_cost_first_percent)||0,p=(t==null?void 0:t.boost_score)||0,l=Number(((j=o==null?void 0:o[0])==null?void 0:j.boost_cost_mod)||0),d=(1-Math.pow(l,a[0]+1))/(1-l),h=(1-Math.pow(l,p/1e4+1))/(1-l),v=e+r*(d-h),T=(((C=o==null?void 0:o[0])==null?void 0:C.start_boost_score)||0)/1e4;return v<T?T:v},[a,o,t]);return c.jsxs(V,{children:[s&&!!(t!=null&&t.boost_score)&&c.jsxs(z,{isLoading:x,disabled:x,onClick:U,children:["Boost"," ",c.jsxs("div",{children:[g.toFixed(2),c.jsx("img",{src:"/assets/icons/gems.png",alt:"Land"})," "]})]}),s&&!!i&&c.jsxs(z,{isLoading:b,disabled:b,onClick:$,children:[t!=null&&t.boost_score?`Upgrade ${t==null?void 0:t.building_name}`:`Build ${t==null?void 0:t.building_name}`,c.jsxs("div",{children:[(w=i==null?void 0:i.cost_gem)==null?void 0:w.toLocaleString("en-US")," ",c.jsx("img",{src:"/assets/icons/gems.png",alt:"Land"})]})]})]})},pt=H.memo(nt);export{pt as default};

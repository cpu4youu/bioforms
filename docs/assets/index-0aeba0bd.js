import{s as d,g as se,S as f,e as ne,u as A,R as L,_ as k,a as Q,r as p,j as n,Q as T}from"./index-7043a4b2.js";import{s as re}from"./shimmer-0bc901da.js";import{u as ie,o as j}from"./fighters-query-a885b0b3.js";import{u as le}from"./index-cabdec58.js";import{u as oe,F as ce}from"./index-71047fdd.js";import{u as de}from"./useQuery-600cc629.js";import{s as w}from"./sleep-da79c358.js";import{u as R}from"./use-transaction-eaef7a1b.js";const ue=d("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{gridTemplateAreas:`
          "empty empty header"
          "main main side"
        `,"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),pe=d("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),me=d("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",direction:"column",position:"relative",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@xmd":{display:"none"}}}},"@xmd":{mt:"30px"}}),xe=d("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",width:"100%",height:"100%",flexWrap:"wrap",overflowY:"auto"}),ge=d("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",position:"absolute",top:"-35px",left:"0px"}),Y=d("button",{d:"flex",align:"center",justify:"center",gap:"5px",padding:"10px 15px",color:"#fff",bg:"#141423",fs:"12px",img:{w:"20px",h:"20px",objectFit:"contain"},"&:first-child":{br:"8px 0px 0px 0px"},"&:last-child":{br:"0 8px 0 0"},variants:{isSelected:{true:{bg:"#19192D"}}}});d("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",maxH:"calc(100vh - 175px)",overflowY:"auto"});d("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}});const fe=d("div",{display:"none",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{display:"flex"},false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"}});d("div",{h:"175px",w:"395px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${re} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}});const he=d("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),_e=async()=>await se({options:{code:f.battleAle,index_position:1,key_type:"i64",limit:"1000",scope:f.battleAle,table:"levels"}}),ve=()=>de({queryKey:[ne.levelsState],queryFn:()=>ye(),staleTime:1e3*60*60,enabled:!!A.getState().user});async function ye(){try{return await _e()}catch(s){return console.log(s),null}}async function Se(s,i){const{executeTransaction:r}=R(),t=be(s,i);return!!await r(t)}function be(s,{cost_credits:i,cost_gems:r,fighter_ids:t}){return{actions:[{account:f.battleAle,name:"levelup",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_ids:t,cost_gems:r,cost_credits:i}}]}}async function Fe(s,i){const{executeTransaction:r}=R(),t=Te(s,i);return!!await r(t)}function Te(s,{fighter_id:i}){return{actions:[{account:f.battleAle,name:"payday",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_id:i}}]}}async function je(s,i){const{executeTransaction:r}=R(),t=we(s,i);return!!await r(t)}function we(s,{fighter_ids:i}){return{actions:[{account:f.battleAle,name:"sellfighter",authorization:[{actor:s.name,permission:s.authorization.permission}],data:{wallet:s.name,fighter_ids:i}}]}}const Ce=[{label:"Level",value:"level"},{label:"Health",value:"health_max"},{label:"Damage",value:"damage_max"},{label:"Initiative",value:"initiative_max"},{label:"Attack Speed",value:"attackspeed_max"},{label:"Taunt",value:"taunt_max"},{label:"Res Fire",value:"res_fire"},{label:"Res Gem",value:"res_gem"},{label:"Res Neutral",value:"res_neutral"},{label:"Res Nature",value:"res_nature"},{label:"Res Air",value:"res_air"},{label:"Res Metal",value:"res_metal"}],C=L.lazy(()=>k(()=>import("./index-f186efb1.js"),["assets/index-f186efb1.js","assets/index-7043a4b2.js","assets/index-55fec1ff.css"])),Ae=L.lazy(()=>k(()=>import("./index-a95030ca.js"),["assets/index-a95030ca.js","assets/index-7043a4b2.js","assets/index-55fec1ff.css","assets/index-cabdec58.js","assets/sleep-da79c358.js","assets/fighters-query-a885b0b3.js","assets/useQuery-600cc629.js","assets/index-71047fdd.js","assets/markers-21ad5773.js","assets/use-transaction-eaef7a1b.js","assets/toast-options-3ea258b9.js","assets/react-icons.esm-fd01647a.js","assets/shimmer-0bc901da.js"])),Le=L.lazy(()=>k(()=>import("./index-65bd91e8.js"),["assets/index-65bd91e8.js","assets/index-7043a4b2.js","assets/index-55fec1ff.css","assets/index-f186efb1.js","assets/elements-a94bd2b3.js","assets/markers-21ad5773.js","assets/index-71047fdd.js","assets/useQuery-600cc629.js","assets/shimmer-0bc901da.js","assets/fighters-query-a885b0b3.js","assets/index-cabdec58.js","assets/sleep-da79c358.js","assets/use-transaction-eaef7a1b.js","assets/toast-options-3ea258b9.js"])),ke=()=>{var U,W,q;const s=A(Q(e=>e.user)),i=A(Q(e=>e.updatePlayerData)),{data:r}=oe(),{data:t,isLoading:h,isFetching:Re}=ie(s.name),{data:u}=ve(),{selectedFighter:x,setSelectedFighter:D,checkedFighters:P,setCheckedFighters:$}=le(),[S,_]=p.useState(!1),[z,E]=p.useState(!1),[v,N]=p.useState("inventory"),[b,B]=p.useState([]),[l,V]=p.useState(Ce[0]),[K,G]=p.useState({label:"",value:""}),J=p.useMemo(()=>t==null?void 0:t.some(e=>e.stats.experience>=e.stats.required_experience&&(u==null?void 0:u.some(a=>a.level===e.stats.level+1))),[t]);function I(e){N(e)}const M=p.useMemo(()=>(t==null?void 0:t.reduce((e,a)=>{var o;const c=(o=u==null?void 0:u.find(m=>m.level===a.stats.level+1))==null?void 0:o.unlock_cost_gem;return c&&a.stats.experience>=a.stats.required_experience?e+=c:e},0))||0,[u,t]);async function X(){try{_(!0);const e=(t==null?void 0:t.filter(o=>o.stats.experience>=o.stats.required_experience).map(o=>o.fighter_id))||[],a=(t==null?void 0:t.reduce((o,m)=>{var g;const y=(g=u==null?void 0:u.find(F=>F.level===m.stats.level+1))==null?void 0:g.unlock_cost_credits;return y&&m.stats.experience>=m.stats.required_experience?o+=y:o},0))||0;if(!await Se(s,{cost_credits:a,cost_gems:M,fighter_ids:e}))return;await w(2e3),j(s.name),T.success("Fighter leveled up!")}catch(e){console.error(e)}finally{_(!1)}}const H=p.useMemo(()=>(t==null?void 0:t.reduce((e,a)=>{const c=new Date(a.next_payday).getTime()/1e3,o=new Date(a.last_payday).getTime()/1e3,m=new Date().getTime()/1e3,y=(r==null?void 0:r.standard_pay_payday)||0;let g=0;c>m&&(g=c-m);const F=c-o-g,ae=c-o,O=Math.floor(F/ae*y+1);return O>1?e+=O:e},0))||0,[r,t]);async function Z(){try{E(!0);const e=(t==null?void 0:t.map(c=>c.fighter_id))||[];if(!await Fe(s,{fighter_id:e}))return;await w(2e3),j(s.name),T.success("Fighter payday!")}catch(e){console.error(e)}finally{E(!1)}}async function ee(){try{_(!0);const e=P.map(c=>Number(c));if(!await je(s,{fighter_ids:e}))return;await w(2e3),j(s.name),$([]),await i(),T.success("Fighters sold!")}catch(e){console.error(e)}finally{_(!1)}}const te=(e,a)=>l.value==="level"?a.stats.level-e.stats.level:l.value==="health_max"?a.stats.health_max-e.stats.health_max:l.value==="damage_max"?a.stats.damage_max-e.stats.damage_max:l.value==="initiative_max"?a.stats.initiative_max-e.stats.initiative_max:l.value==="attackspeed_max"?a.stats.attackspeed_max-e.stats.attackspeed_max:l.value==="taunt_max"?a.stats.taunt_max-e.stats.taunt_max:l.value==="res_fire"?a.stats.res_fire-e.stats.res_fire:l.value==="res_gem"?a.stats.res_gem-e.stats.res_gem:l.value==="res_neutral"?a.stats.res_neutral-e.stats.res_neutral:l.value==="res_nature"?a.stats.res_nature-e.stats.res_nature:l.value==="res_air"?a.stats.res_air-e.stats.res_air:l.value==="res_metal"?a.stats.res_metal-e.stats.res_metal:a.stats.level-e.stats.level;return p.useEffect(()=>()=>D(null),[]),n.jsxs(ue,{isFighterSelected:!!x,children:[n.jsx(pe,{children:v==="sell"?n.jsx(n.Fragment,{children:n.jsxs(C,{isLoading:S,onClick:ee,children:["Sell selected",n.jsxs("div",{children:[P.length*100,n.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})]})]})}):n.jsxs(n.Fragment,{children:[n.jsxs(C,{isLoading:S,disabled:S||!J,onClick:X,children:["Level All"," ",n.jsxs("div",{children:[M,n.jsx("img",{src:"/assets/icons/credits.png",alt:"Credits"})," "]})]}),n.jsxs(C,{isLoading:z,disabled:z||H>((U=s.activestats)==null?void 0:U.action_points),onClick:Z,children:["Payday",n.jsxs("div",{children:["-",H,n.jsx("img",{src:"/assets/icons/energy.png",alt:"Energy"})]})]})]})}),n.jsxs(me,{isFighterSelected:!!x,children:[n.jsxs(ge,{children:[n.jsx(Y,{isSelected:v==="inventory",onClick:()=>I("inventory"),children:"Inventory"}),n.jsx(Y,{isSelected:v==="sell",onClick:()=>I("sell"),children:"Sell"})]}),n.jsx(Le,{filterSelected:b,setFilterSelected:B,selectedSort:l,setSelectedSort:V,selectedFighterClassname:K,setSelectedFighterClassname:G}),n.jsx(xe,{children:t?(q=(W=t==null?void 0:t.filter(e=>b.length===0||b.some(a=>a.type==="element"&&a.value===e.element||a.type==="marker"&&a.value===e.marker)))==null?void 0:W.toSorted(te))==null?void 0:q.map(e=>n.jsx(Ae,{isSelling:v==="sell",fighter:e},e.fighter_id)):n.jsx(n.Fragment,{children:n.jsx(he,{children:"You don't have Fighters"})})})]}),n.jsx(fe,{isFighterSelected:!!x,children:!!x&&n.jsx(ce,{selectedFighter:x,onCloseFighterDetail:D})})]})},We=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"}));export{Fe as a,Se as e,We as i,Ce as s,ve as u};

import{s as p,g as M,S as y,e as k,u as A,R as L,_ as P,a as H,r as u,j as s,Q as w}from"./index-ed29018d.js";import{u as Q,o as S}from"./fighters-query-11e92793.js";import{u as W}from"./index-f4b60224.js";import{u as I,F as O}from"./index-c586c3c1.js";import{u as Y}from"./useQuery-c5560bf9.js";import{s as j}from"./sleep-da79c358.js";import{u as D}from"./use-transaction-2c18a958.js";const q=p("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main main"
  `,gridTemplateRows:"68px 1fr",gridTemplateColumns:"2.5fr 1fr 500px",gap:"10px",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{gridTemplateAreas:`
          "empty empty header"
          "main main side"
        `,"@xmd":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@xmd":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lg":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),$=p("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),B=p("div",{gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-start",gap:"10px",flexWrap:"wrap",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",overflowY:"auto",padding:"10px",br:"15px",bg:"#141423",variants:{isFighterSelected:{true:{"@xmd":{display:"none"}}}}});p("div",{w:"100%",h:"45px",bg:"#201D2C",padding:"10px 20px",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}});const K=p("div",{display:"none",flexDirection:"column",gridArea:"side",padding:"0px 18px",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",variants:{isFighterSelected:{true:{display:"flex"},false:{"@sm":{display:"none"}}}},"@lg":{minW:"initial"}}),N=p("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"}),V=async()=>await M({options:{code:y.battleAle,index_position:2,key_type:"i64",limit:"1000",scope:y.battleAle,table:"levels"}}),G=()=>Y({queryKey:[k.levelsState],queryFn:()=>J(),staleTime:1e3*60*60,enabled:!!A.getState().user});async function J(){try{return await V()}catch(t){return console.log(t),null}}async function X(t,e){const{executeTransaction:n}=D(),r=Z(t,e);return!!await n(r)}function Z(t,{cost_credits:e,cost_gems:n,fighter_ids:r}){return{actions:[{account:y.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_ids:r,cost_gems:n,cost_credits:e}}]}}async function ee(t,e){const{executeTransaction:n}=D(),r=te(t,e);return!!await n(r)}function te(t,{fighter_id:e}){return{actions:[{account:y.battleAle,name:"payday",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,fighter_id:e}}]}}const C=L.lazy(()=>P(()=>import("./index-1a9f0b22.js"),["assets/index-1a9f0b22.js","assets/index-ed29018d.js","assets/index-55fec1ff.css"])),ae=L.lazy(()=>P(()=>import("./index-ba2fc0c2.js"),["assets/index-ba2fc0c2.js","assets/index-ed29018d.js","assets/index-55fec1ff.css","assets/index-f4b60224.js","assets/index-c586c3c1.js","assets/useQuery-c5560bf9.js","assets/sleep-da79c358.js","assets/fighters-query-11e92793.js","assets/markers-21ad5773.js","assets/use-transaction-2c18a958.js","assets/toast-options-ed070a73.js"])),se=()=>{var b;const t=A(H(a=>a.user)),{data:e}=Q(t.name),{data:n}=G(),{data:r}=I(),{selectedFighter:o,setSelectedFighter:g}=W(),[f,h]=u.useState(!1),[v,_]=u.useState(!1),E=e==null?void 0:e.some(a=>a.stats.experience>=a.stats.required_experience),F=u.useMemo(()=>(e==null?void 0:e.reduce((a,d)=>{var i;const l=(i=n==null?void 0:n.find(c=>c.level===d.stats.level))==null?void 0:i.unlock_cost_gem;return l?a+=l:a},0))||0,[n,e]);async function R(){try{h(!0);const a=(e==null?void 0:e.filter(i=>i.stats.experience>=i.stats.required_experience).map(i=>i.fighter_id))||[],d=(e==null?void 0:e.reduce((i,c)=>{var x;const m=(x=n==null?void 0:n.find(U=>U.level===c.stats.level))==null?void 0:x.unlock_cost_credits;return m?i+=m:i},0))||0;if(!await X(t,{cost_credits:d,cost_gems:F,fighter_ids:a}))return;await j(2e3),S(t.name),w.success("Fighter leveled up!")}catch(a){console.error(a)}finally{h(!1)}}const T=u.useMemo(()=>(e==null?void 0:e.reduce((a,d)=>{const l=new Date(d.next_payday),i=new Date,c=(r==null?void 0:r.standard_pay_payday)||0,m=(r==null?void 0:r.standard_days_payday)||1;if(l>i){const x=(l.getTime()-i.getTime())/864e5;return a+=Math.floor(x/m*c)}else return a+=c},0))||0,[r,e]);async function z(){try{_(!0);const a=(e==null?void 0:e.map(l=>l.fighter_id))||[];if(!await ee(t,{fighter_id:a}))return;await j(2e3),S(t.name),w.success("Fighter payday!")}catch(a){console.error(a)}finally{_(!1)}}return u.useEffect(()=>()=>g(null),[]),s.jsxs(q,{isFighterSelected:!!o,children:[s.jsxs($,{children:[s.jsxs(C,{isLoading:f,disabled:f||!E,onClick:R,children:["Level All"," ",s.jsxs("div",{children:[F,s.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})," "]})]}),s.jsxs(C,{isLoading:v,disabled:v||T>((b=t.activestats)==null?void 0:b.action_points),onClick:z,children:["Payday",s.jsxs("div",{children:["-",T,s.jsx("img",{src:"/assets/icons/flasks.png",alt:"Potion"})]})]})]}),s.jsx(B,{isFighterSelected:!!o,children:e?e==null?void 0:e.map(a=>s.jsx(ae,{fighter:a},a.fighter_id)):s.jsx(s.Fragment,{children:s.jsx(N,{children:"You don't have Fighters"})})}),s.jsx(K,{isFighterSelected:!!o,children:!!o&&s.jsx(O,{selectedFighter:o,onCloseFighterDetail:g})})]})},pe=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{ee as a,X as e,pe as i,G as u};

import{s as M,d as Q,S as h,T as B,Q as v,u as T,t as F,R as q,_ as z,r as b,j as i}from"./index-f6906664.js";import{o as H,a as N}from"./all-buildings-fb1ddbfd.js";import{u as I}from"./useQuery-ddc74530.js";import{u as K}from"./land-config-a3a9bd5a.js";import{u as O}from"./use-transaction-a1c6f80f.js";import{s as P}from"./sleep-da79c358.js";import{u as U}from"./index-0ed18e94.js";import"./atomic-api-9c9b7193.js";import"./toast-options-057d1e9b.js";import"./constants-2bbfa292.js";const Y=M("div",{gridArea:"header",d:"flex",justifyContent:"flex-end",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),k=async t=>await Q({options:{code:h.landsAle,index_position:1,limit:"1000",scope:t,table:B.buildingcost}}),D=t=>I({queryFn:()=>W(t),queryKey:[v.buildingConfigState],staleTime:1e3*60*60,enabled:!!T.getState().user});async function V(){return await F.invalidateQueries(v.buildingConfigState)}async function W(t){try{return await k(t)}catch(s){return console.log(s),null}}async function $(t,s){const{executeTransaction:n}=O(),u=G(t,s);return!!await n(u)}function G(t,s){return{actions:[{account:h.landsAle,name:"build",authorization:[{actor:t.name,permission:t.authorization.permission}],data:{wallet:t.name,planet:s.planet,x:s.x,y:s.y,building:s.building,level:s.level,cost_gem:s.cost_gem,cost_credits:s.cost_credits}}]}}const y=q.lazy(()=>z(()=>import("./index-eee5c489.js"),["assets/index-eee5c489.js","assets/index-f6906664.js","assets/index-55fec1ff.css"])),ct=()=>{var d,g,_,x,f;const{data:t}=K(),s=T(a=>a.user),{selectedLand:n,buildingBoost:u,selectedBuild:e}=U(),{data:r}=D((e==null?void 0:e.img)||""),[w,l]=b.useState(!1);async function S(){if(!(!s||!n||!o||!e))try{l(!0);const a={planet:n.data.planetName,x:n.data.x,y:n.data.y,building:e.name,level:e.level||1,cost_gem:o.cost_gem,cost_credits:o.cost_credits};await $(s,a)&&(await P(1e3),await H(),await V(),await N())}catch{}finally{l(!1)}}const o=b.useMemo(()=>r==null?void 0:r.find(a=>a.building_name===e.img&&a.level===((e==null?void 0:e.level)||0)+1),[r,e]),j=((d=t==null?void 0:t[0])==null?void 0:d.boost_base_cost)||0,L=((g=t==null?void 0:t[0])==null?void 0:g.boost_cost_first_percent)||0,R=(e==null?void 0:e.boost_score)||0,c=Number(((_=t==null?void 0:t[0])==null?void 0:_.boost_cost_mod)||0),A=(1-Math.pow(c,u[0]+1))/(1-c),E=(1-Math.pow(c,R/1e4+1))/(1-c),p=j+L*(A-E),m=(((x=t==null?void 0:t[0])==null?void 0:x.start_boost_score)||0)/1e4,C=p<m?m:p;return i.jsxs(Y,{children:[n&&(e==null?void 0:e.building_name)&&i.jsxs(y,{children:["Boost"," ",i.jsxs("div",{children:[C.toFixed(2),i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})," "]})]}),n&&o&&i.jsxs(y,{isLoading:w,onClick:S,children:["Build ",e.name,i.jsxs("div",{children:[(f=o==null?void 0:o.cost_gem)==null?void 0:f.toLocaleString("en-US")," ",i.jsx("img",{src:"/assets/icons/gem.png",alt:"Land"})]})]})]})};export{ct as default};

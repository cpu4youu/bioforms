import{s as c,L as k,S as u,d as B,Q as F,g as C,q,u as S,e as w,R as T,_ as A,a as K,b as Y,r as j,j as n,v as U}from"./index-78dc7b1e.js";import{u as G}from"./index-776b06b1.js";import{u as J,F as X}from"./index-721462f5.js";import{u as Z}from"./use-media-d838e568.js";import{s as ee}from"./sleep-da79c358.js";import{u as te}from"./use-transaction-7fcf6795.js";import{u as D}from"./useQuery-0b74c68b.js";const ne=c("div",{d:"grid",gridTemplateAreas:`
    "empty empty header"
    "main main side"
  `,gridTemplateRows:"auto 1fr",gap:"10px",overflowY:"hidden",br:"15px",w:"100%",h:"100%",variants:{isFighterSelected:{true:{"@lg":{gridTemplateAreas:`
            "header header header"
            "side side side"
          `}},false:{"@lgxxx":{gridTemplateAreas:`
              "header header header"
              "main main main"
            `}}}},"@lgxxx":{gridTemplateColumns:"1fr 1fr 2fr"},"@xmd":{gap:"8px"},"@sm":{}}),re=c("div",{gridArea:"header",d:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",minHeight:"65px",button:{padding:"20px",w:"100%",maxW:"100%",div:{d:"flex",alignItems:"center",gap:"5px",color:"#828282",img:{objectFit:"contain",w:"24px"}}},"@lgxxx":{gridColumnStart:2,w:"100%",gridTemplateColumns:"1fr 1fr"},"@md":{gridColumnStart:1,gridTemplateColumns:"1fr 1fr"},"@sm":{gap:"5px",button:{fs:"12px",padding:"10px",div:{img:{w:"20px"}}}},"@xsm":{button:{gap:"3px",justify:"space-between",padding:"9px 0px 9px 3px",fs:"10px"}}}),ae=c("div",{position:"relative",gridArea:"main",d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",gap:"10px",flexWrap:"wrap",h:"calc(100vh - 235px)",minH:"calc(100vh - 160px)",maxH:"calc(100vh - 160px)",padding:"10px",br:"0 15px 15px 15px",bg:"#141423",variants:{isFighterSelected:{true:{"@lg":{display:"none"},"@xmd":{display:"none"}}}},"@md":{minH:"calc(100vh - 185px)",mt:"30px"}}),ie=c("div",{d:"flex",align:"flex-start",alignContent:"flex-start",justify:"flex-center",justifyContent:"flex-center",br:"15px 15px 0 0",bg:"#19192D",position:"absolute",top:"-35px",left:"0"}),se=c(k,{border:"1px solid rgba(0, 0, 0, 0.25)",padding:"10px 20px",ff:"$heading",fs:"12px",color:"#fff","&:last-child":{br:"15px 15px 0 0"}}),oe=c("div",{gridArea:"main",d:"flex",justify:"space-between",gap:"5px",h:"100%",w:"100%",overflowY:"auto",px:"20px",">span":{mt:"55px",color:"#fff",fw:"bold",ff:"$heading",fs:"12px"},"@xlg":{justify:"center",flexWrap:"wrap",">span":{my:"25px"}},"@md":{h:"calc(-280px + 100vh)"},variants:{isFighterSelected:{true:{justify:"center",flexWrap:"wrap",">span":{my:"25px"}}}}}),le=c("h3",{textAlign:"center",w:"100%",fontSize:"16px",fontWeight:"bold",ff:"$heading",color:"#C9C9C9","@sm":{fontSize:"14px"}}),de=c("span",{textAlign:"center",w:"100%",fontSize:"16px",ff:"$heading",color:"#C9C9C9","@sm":{h:"initial",fontSize:"14px"}}),ce=c("div",{display:"flex",flexDirection:"column",gridArea:"side",br:"15px",bg:"#141423",overflowY:"auto",minW:"500px",maxH:"calc(100vh - 160px)",minH:"calc(100vh - 160px)",variants:{isFighterSelected:{false:{"@lgxxx":{display:"none"}}}},"@lgxxx":{minW:"initial"},"@sm":{mt:"5px"}}),ue=c("h4",{d:"flex",alignItems:"center",justifyContent:"center",w:"100%",h:"100%",color:"#FFFFFF",ff:"$heading",fs:"24px",fw:"normal"});async function pe(e,t,a,r,i,o,d,p,x,g,f){const{executeTransaction:m}=te(),l=xe(e,t,a,r,i,o,d,p,x,g,f);return!!await m(l)}function xe(e,t,a,r,i,o,d,p,x,g,f){return{actions:[{account:u.dungeonsAle,name:"playdungeon",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,planet:t,land_id:a,crew_asset_id:r,weapon_asset_id:i,fighter_ids:o,difficulty:d,use_gems:p,history_id:x,x:g,y:f}}]}}const ge=B(e=>({myTeam:[null,null,null,null,null],setMyTeam:t=>e({myTeam:t}),selectedCards:[void 0,void 0],setSelectedCards:t=>e({selectedCards:t})}));function fe({user:e,areaSelected:t,myTeam:a,selectedCards:r,selectedLevel:i}){var d,p,x,g,f,m,l,y;const o=a.reduce((b,_)=>_?[...b,_.fighter_id]:b,[]);return!e||!(t!=null&&t.landId)||!o.length||!((d=r[0])!=null&&d.asset_id)||!((p=r[1])!=null&&p.asset_id)?(o.length||F.error("No Warrior selected"),(x=r[0])!=null&&x.asset_id||F.error("No Crew selected (First spot on cards)"),(g=r[1])!=null&&g.asset_id||F.error("No Weapon selected (Second spot on cards)"),console.error("Can not find data",{user:e,areaSelected:t,crew_asset_id:Number((f=r[0])==null?void 0:f.asset_id),weapon_asset_id:Number((m=r[1])==null?void 0:m.asset_id),fighter_ids:o,selectedLevel:i})):{user:e,planet:e.planet,landId:t.landId,x:t.x,y:t.y,card1:Number((l=r[0])==null?void 0:l.asset_id),card2:Number((y=r[1])==null?void 0:y.asset_id),teamFiltered:o,level:i.level}}const me=async()=>await C({options:{code:u.dungeonsAle,index_position:1,limit:"1000",scope:u.dungeonsAle,table:q.config}}),he=()=>D({enabled:!!S.getState().user,queryKey:[w.dungeonConfigDataState],queryFn:()=>ye(),staleTime:1e3*60*20});async function ye(){try{const e=await me();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const be=async()=>await C({options:{code:u.battleAle,index_position:1,limit:"1000",scope:u.battleAle,table:"variables"}}),_e=()=>D({enabled:!!S.getState().user,queryKey:[w.VariablesState],queryFn:()=>Fe(),staleTime:1e3*60*20});async function Fe(){try{const e=await be();return e!=null&&e[0]?e[0]:null}catch(e){return console.log(e),null}}const Se=async()=>await C({options:{code:u.battleAle,index_position:1,limit:"1000",scope:u.battleAle,table:"weather"}}),we=()=>D({enabled:!!S.getState().user,queryKey:[w.WeatherState],queryFn:()=>Te(),staleTime:1e3*60*20});async function Te(){try{return await Se()}catch(e){return console.log(e),null}}const ve=async e=>await C({options:{code:u.battleAle,index_position:1,limit:"1000",lower_bound:e,upper_bound:e,scope:u.battleAle,table:q.history}}),Ne=e=>D({enabled:!!S.getState().user,queryKey:[w.HistoryDataState,e],queryFn:()=>z(e),staleTime:1e3*60*20});async function z(e){try{const t=await ve(e);if(!t)return null;const a=t==null?void 0:t.find(i=>i.history_id===e);return a?{...a,team1_fighters:a.team1_fighters.filter(i=>typeof i.fighter_id=="number")}:null}catch(t){return console.log(t),null}}const R=T.lazy(()=>A(()=>import("./index-392c3423.js"),["assets/index-392c3423.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css"])),je=T.lazy(()=>A(()=>import("./index-1d27aab4.js"),["assets/index-1d27aab4.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css","assets/useQuery-0b74c68b.js","assets/v4-4a60fe23.js","assets/index-776b06b1.js","assets/index-721462f5.js","assets/use-media-d838e568.js","assets/sleep-da79c358.js","assets/use-transaction-7fcf6795.js","assets/toast-options-251f3299.js"])),Ce=T.lazy(()=>A(()=>import("./index-8ad20227.js"),["assets/index-8ad20227.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css","assets/fighters-query-8286655b.js","assets/useQuery-0b74c68b.js","assets/index-776b06b1.js","assets/index-392c3423.js","assets/elements-a94bd2b3.js","assets/use-media-d838e568.js","assets/inventory-query-af885043.js","assets/adapters-b752701d.js","assets/atomic-api-226b579c.js","assets/toast-options-251f3299.js","assets/markers-21ad5773.js","assets/v4-4a60fe23.js","assets/index-721462f5.js","assets/sleep-da79c358.js","assets/use-transaction-7fcf6795.js"])),Ae=T.lazy(()=>A(()=>import("./index-76559d18.js"),["assets/index-76559d18.js","assets/index-78dc7b1e.js","assets/index-55fec1ff.css","assets/useQuery-0b74c68b.js","assets/index-776b06b1.js","assets/use-media-d838e568.js","assets/v4-4a60fe23.js"])),De=()=>{const e=S(K(s=>s.user)),{isSuperLarge:t}=Z();J();const{data:a}=he(),{data:r}=_e(),{data:i}=we(),{selectedCards:o,myTeam:d,setMyTeam:p,setSelectedCards:x}=ge(),{areaSelected:g,setAreaSelected:f}=Y(),{selectedLevel:m,selectedFighter:l,setSelectedFighter:y}=G(),[b,_]=j.useState(!1),[H,N]=j.useState("");async function Q(){try{_(!0);const s=fe({areaSelected:g,myTeam:d,selectedCards:o,selectedLevel:m,user:e});if(!s)return;const h=(()=>{const O="abcdefghijklmnopqrstuvwxyz12345";let M="";for(let I=0;I<12;I++){const P=Math.round(Math.random()*12+1);M+=O[P]}return M})();if(!await pe(e,e.planet,s.landId,s.card1,s.card2,s.teamFiltered,s.level,!0,h,s.x,s.y))return;await ee(3e3);const v=await z(h);if(v){U.setQueryData([w.HistoryDataState,h],v),N(h),F.success("Fight Started !");return}F.error("Error fetching fight history data")}catch(s){console.error(s)}finally{_(!1)}}function V(){x([void 0,void 0]),p([null,null,null,null,null]),f(null)}const $=j.useMemo(()=>{var L,h,W;return!d.filter(v=>v!==null).length||!((L=o[0])!=null&&L.asset_id)||!((h=o[1])!=null&&h.asset_id)||Number(((W=e==null?void 0:e.activestats)==null?void 0:W.action_points)||0)<((a==null?void 0:a.energy_cost)||0)},[d,o,a,e]),E=j.useMemo(()=>i==null?void 0:i.find(s=>s.weather_id===(r==null?void 0:r.current_weather_id)),[i,r]);return H?n.jsx(je,{historyId:H}):n.jsxs(ne,{isFighterSelected:!!l,children:[n.jsxs(re,{children:[n.jsx(R,{onClick:V,children:"Back"}),n.jsxs(R,{disabled:$||b,isLoading:b,onClick:Q,children:["Start Fight",n.jsxs("div",{children:["-",a==null?void 0:a.energy_cost,n.jsx("img",{src:"/assets/icons/energy.png",alt:"Potion"})]})]})]}),n.jsxs(ae,{isFighterSelected:!!l,children:[n.jsx(ie,{children:n.jsx(se,{to:"/dungeon-leaderboard",children:"Leaderboard"})}),n.jsx(le,{children:"Weather"}),n.jsx(de,{children:E==null?void 0:E.displayname}),n.jsxs(oe,{isFighterSelected:t&&!!l,children:[n.jsx(Ce,{}),n.jsx("span",{children:"VS"}),n.jsx(Ae,{})]})]}),n.jsx(ce,{isFighterSelected:!!l,children:l?n.jsx(X,{selectedFighter:{...l,...l.stats},onCloseFighterDetail:y}):n.jsx(n.Fragment,{children:n.jsx(ue,{children:"Select a Fighter"})})})]})},Ee=T.memo(De),Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"}));export{we as a,_e as b,ge as c,Qe as i,Ne as u};
